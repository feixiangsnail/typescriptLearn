function __extends(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i}var egret_native,__reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})};!function(e){e.$hashCount=1;var t=function(){function t(){this.$hashCode=e.$hashCount++}return Object.defineProperty(t.prototype,"hashCode",{get:function(){return this.$hashCode},enumerable:!0,configurable:!0}),t}();e.HashObject=t,__reflect(t.prototype,"egret.HashObject",["egret.IHashObject"])}(egret||(egret={})),function(t){var i=[],e=function(s){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0);var n=s.call(this)||this;return n.x=t,n.y=e,n.width=i,n.height=r,n}return __extends(e,s),e.release=function(t){t&&i.push(t)},e.create=function(){var t=i.pop();return t||(t=new e),t},Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new t.Point(this.left,this.top)},set:function(t){this.top=t.y,this.left=t.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new t.Point(this.right,this.bottom)},set:function(t){this.bottom=t.y,this.right=t.x},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.prototype.setTo=function(t,e,i,r){return this.x=t,this.y=e,this.width=i,this.height=r,this},e.prototype.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e},e.prototype.intersection=function(t){return this.clone().$intersectInPlace(t)},e.prototype.inflate=function(t,e){this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e},e.prototype.$intersectInPlace=function(t){var e=this.x,i=this.y,r=t.x,n=t.y,s=Math.max(e,r),o=Math.min(e+this.width,r+t.width);if(s<=o){var a=Math.max(i,n),h=Math.min(i+this.height,n+t.height);if(a<=h)return this.setTo(s,a,o-s,h-a),this}return this.setEmpty(),this},e.prototype.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)},e.prototype.isEmpty=function(){return this.width<=0||this.height<=0},e.prototype.setEmpty=function(){this.x=0,this.y=0,this.width=0,this.height=0},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.containsPoint=function(t){return this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y},e.prototype.containsRect=function(t){var e=t.x+t.width,i=t.y+t.height,r=this.x+this.width,n=this.y+this.height;return t.x>=this.x&&t.x<r&&t.y>=this.y&&t.y<n&&e>this.x&&e<=r&&i>this.y&&i<=n},e.prototype.equals=function(t){return this===t||this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},e.prototype.inflatePoint=function(t){this.inflate(t.x,t.y)},e.prototype.offset=function(t,e){this.x+=t,this.y+=e},e.prototype.offsetPoint=function(t){this.offset(t.x,t.y)},e.prototype.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"},e.prototype.union=function(t){var e=this.clone();if(t.isEmpty())return e;if(e.isEmpty())return e.copyFrom(t),e;var i=Math.min(e.x,t.x),r=Math.min(e.y,t.y);return e.setTo(i,r,Math.max(e.right,t.right)-i,Math.max(e.bottom,t.bottom)-r),e},e.prototype.$getBaseWidth=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return e*this.width+i*this.height},e.prototype.$getBaseHeight=function(t){var e=Math.abs(Math.cos(t));return Math.abs(Math.sin(t))*this.width+e*this.height},e}(t.HashObject);t.Rectangle=e,__reflect(e.prototype,"egret.Rectangle"),t.$TempRectangle=new e}(egret||(egret={})),function(o){var h=[],t=function(i){function t(t){void 0===t&&(t=null);var e=i.call(this)||this;return e.$EventDispatcher={0:t||e,1:{},2:{},3:0},e}return __extends(t,i),t.prototype.$getEventMap=function(t){var e=this.$EventDispatcher;return t?e[2]:e[1]},t.prototype.addEventListener=function(t,e,i,r,n){this.$addListener(t,e,i,r,n)},t.prototype.once=function(t,e,i,r,n){this.$addListener(t,e,i,r,n,!0)},t.prototype.$addListener=function(t,e,i,r,n,s){var o=this.$EventDispatcher,a=r?o[2]:o[1],h=a[t];h?0!==o[3]&&(a[t]=h=h.concat()):h=a[t]=[],this.$insertEventBin(h,t,e,i,r,n,s)},t.prototype.$insertEventBin=function(t,e,i,r,n,s,o){s=0|+s;for(var a=-1,h=t.length,l=0;l<h;l++){var c=t[l];if(c.listener==i&&c.thisObject==r&&c.target==this)return!1;-1==a&&c.priority<s&&(a=l)}var u={type:e,listener:i,thisObject:r,priority:s,target:this,useCapture:n,dispatchOnce:!!o};return-1!==a?t.splice(a,0,u):t.push(u),!0},t.prototype.removeEventListener=function(t,e,i,r){var n=this.$EventDispatcher,s=r?n[2]:n[1],o=s[t];o&&(0!==n[3]&&(s[t]=o=o.concat()),this.$removeEventBin(o,e,i),0==o.length&&(s[t]=null))},t.prototype.$removeEventBin=function(t,e,i){for(var r=t.length,n=0;n<r;n++){var s=t[n];if(s.listener==e&&s.thisObject==i&&s.target==this)return t.splice(n,1),!0}return!1},t.prototype.hasEventListener=function(t){var e=this.$EventDispatcher;return!(!e[1][t]&&!e[2][t])},t.prototype.willTrigger=function(t){return this.hasEventListener(t)},t.prototype.dispatchEvent=function(t){return t.$currentTarget=this.$EventDispatcher[0],t.$setTarget(t.$currentTarget),this.$notifyListener(t,!1)},t.prototype.$notifyListener=function(t,e){var i=this.$EventDispatcher,r=(e?i[2]:i[1])[t.$type];if(!r)return!0;var n=r.length;if(0==n)return!0;var s=h;i[3]++;for(var o=0;o<n;o++){if((a=r[o]).listener.call(a.thisObject,t),a.dispatchOnce&&s.push(a),t.$isPropagationImmediateStopped)break}for(i[3]--;s.length;){var a;(a=s.pop()).target.removeEventListener(a.type,a.listener,a.thisObject,a.useCapture)}return!t.$isDefaultPrevented},t.prototype.dispatchEventWith=function(t,e,i,r){if(e||this.hasEventListener(t)){var n=o.Event.create(o.Event,t,e,r);n.data=i;var s=this.dispatchEvent(n);return o.Event.release(n),s}return!0},t}(o.HashObject);o.EventDispatcher=t,__reflect(t.prototype,"egret.EventDispatcher",["egret.IEventDispatcher"])}(egret||(egret={})),function(f){function n(t){return 180<(t%=360)?t-=360:t<-180&&(t+=360),t}var t=function(h){function l(){var t=h.call(this)||this;return t.$children=null,t.$parent=null,t.$stage=null,t.$nestLevel=0,t.$visible=!0,t.$displayList=null,t.$alpha=1,t.$touchEnabled=l.defaultTouchEnabled,t.$scrollRect=null,t.$blendMode=0,t.$maskedObject=null,t.$mask=null,t.$maskRect=null,t.$parentDisplayList=null,t.$renderNode=null,t.$displayFlags=2032,t.$DisplayObject={0:1,1:1,2:0,3:0,4:0,5:"",6:new f.Matrix,7:new f.Matrix,8:new f.Matrix,9:new f.Rectangle,10:new f.Rectangle,11:!1,12:0,13:0,14:NaN,15:NaN,16:0,17:0,18:0,19:null,20:null},t}return __extends(l,h),l.prototype.$setFlags=function(t){this.$displayFlags|=t},l.prototype.$removeFlags=function(t){this.$displayFlags&=~t},l.prototype.$removeFlagsUp=function(t){if(this.$hasAnyFlags(t)){this.$removeFlags(t);var e=this.$parent;e&&e.$removeFlagsUp(t)}},l.prototype.$hasFlags=function(t){return(this.$displayFlags&t)==t},l.prototype.$propagateFlagsUp=function(t){if(!this.$hasFlags(t)){this.$setFlags(t);var e=this.$parent;e&&e.$propagateFlagsUp(t)}},l.prototype.$propagateFlagsDown=function(t,e){void 0===e&&(e=!1),this.$setFlags(t)},l.prototype.$hasAnyFlags=function(t){return!!(this.$displayFlags&t)},l.prototype.$invalidateMatrix=function(){this.$setFlags(8),this.$invalidatePosition()},l.prototype.$invalidatePosition=function(){this.$invalidateTransform(),this.$propagateFlagsDown(48),this.$parent&&this.$parent.$propagateFlagsUp(4)},Object.defineProperty(l.prototype,"name",{get:function(){return this.$DisplayObject[5]},set:function(t){this.$DisplayObject[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"parent",{get:function(){return this.$parent},enumerable:!0,configurable:!0}),l.prototype.$setParent=function(t){return this.$parent!=t&&(this.$parent=t,!0)},l.prototype.$onAddToStage=function(t,e){this.$stage=t,this.$nestLevel=e,this.$hasAddToStage=!0,f.Sprite.$EVENT_ADD_TO_STAGE_LIST.push(this)},l.prototype.$onRemoveFromStage=function(){this.$nestLevel=0,f.Sprite.$EVENT_REMOVE_FROM_STAGE_LIST.push(this)},Object.defineProperty(l.prototype,"stage",{get:function(){return this.$stage},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"matrix",{get:function(){return this.$getMatrix().clone()},set:function(t){this.$setMatrix(t)},enumerable:!0,configurable:!0}),l.prototype.$getMatrix=function(){var t=this.$DisplayObject;return this.$hasFlags(8)&&(t[6].$updateScaleAndRotation(t[0],t[1],t[2],t[3]),this.$removeFlags(8)),t[6]},l.prototype.$setMatrix=function(t,e){void 0===e&&(e=!0);var i=this.$DisplayObject,r=i[6];return!r.equals(t)&&(r.copyFrom(t),e&&(i[0]=r.$getScaleX(),i[1]=r.$getScaleY(),i[2]=t.$getSkewX(),i[3]=t.$getSkewY(),i[16]=n(180*i[2]/Math.PI),i[17]=n(180*i[3]/Math.PI),i[4]=n(180*i[3]/Math.PI)),this.$removeFlags(8),this.$invalidatePosition(),!0)},l.prototype.$getConcatenatedMatrix=function(){var t=this.$DisplayObject[7];if(this.$hasFlags(16)){this.$parent?this.$parent.$getConcatenatedMatrix().$preMultiplyInto(this.$getMatrix(),t):t.copyFrom(this.$getMatrix());var e=this.$DisplayObject,i=e[12],r=e[13],n=this.$scrollRect;n?t.$preMultiplyInto(f.$TempMatrix.setTo(1,0,0,1,-n.x-i,-n.y-r),t):(0!=i||0!=r)&&t.$preMultiplyInto(f.$TempMatrix.setTo(1,0,0,1,-i,-r),t),this.$displayList&&(this.$displayList.$renderNode.moved=!0),this.$renderNode&&(this.$renderNode.moved=!0),this.$removeFlags(16)}return t},l.prototype.$getInvertedConcatenatedMatrix=function(){var t=this.$DisplayObject;return this.$hasFlags(32)&&(this.$getConcatenatedMatrix().$invertInto(t[8]),this.$removeFlags(32)),t[8]},Object.defineProperty(l.prototype,"x",{get:function(){return this.$getX()},set:function(t){this.$setX(t)},enumerable:!0,configurable:!0}),l.prototype.$getX=function(){return this.$DisplayObject[6].tx},l.prototype.$setX=function(t){t=+t||0;var e=this.$DisplayObject[6];return t!=e.tx&&(e.tx=t,this.$invalidatePosition(),!0)},Object.defineProperty(l.prototype,"y",{get:function(){return this.$getY()},set:function(t){this.$setY(t)},enumerable:!0,configurable:!0}),l.prototype.$getY=function(){return this.$DisplayObject[6].ty},l.prototype.$setY=function(t){t=+t||0;var e=this.$DisplayObject[6];return t!=e.ty&&(e.ty=t,this.$invalidatePosition(),!0)},Object.defineProperty(l.prototype,"scaleX",{get:function(){return this.$getScaleX()},set:function(t){this.$setScaleX(t)},enumerable:!0,configurable:!0}),l.prototype.$getScaleX=function(){return this.$DisplayObject[0]},l.prototype.$setScaleX=function(t){t=+t||0;var e=this.$DisplayObject;return t!=e[0]&&(e[0]=t,this.$invalidateMatrix(),!0)},Object.defineProperty(l.prototype,"scaleY",{get:function(){return this.$getScaleY()},set:function(t){this.$setScaleY(t)},enumerable:!0,configurable:!0}),l.prototype.$getScaleY=function(){return this.$DisplayObject[1]},l.prototype.$setScaleY=function(t){return(t=+t||0)!=this.$DisplayObject[1]&&(this.$DisplayObject[1]=t,this.$invalidateMatrix(),!0)},Object.defineProperty(l.prototype,"rotation",{get:function(){return this.$getRotation()},set:function(t){this.$setRotation(t)},enumerable:!0,configurable:!0}),l.prototype.$getRotation=function(){return this.$DisplayObject[4]},l.prototype.$setRotation=function(t){t=n(t=+t||0);var e=this.$DisplayObject;if(t==e[4])return!1;var i=(t-e[4])/180*Math.PI;return e[2]+=i,e[3]+=i,e[4]=t,this.$invalidateMatrix(),!0},Object.defineProperty(l.prototype,"skewX",{get:function(){return this.$DisplayObject[16]},set:function(t){this.$setSkewX(t)},enumerable:!0,configurable:!0}),l.prototype.$setSkewX=function(t){t=+t||0;var e=this.$DisplayObject;return t!=e[16]&&(t=(t=n(e[16]=t))/180*Math.PI,e[2]=t,this.$invalidateMatrix(),!0)},Object.defineProperty(l.prototype,"skewY",{get:function(){return this.$DisplayObject[17]},set:function(t){this.$setSkewY(t)},enumerable:!0,configurable:!0}),l.prototype.$setSkewY=function(t){t=+t||0;var e=this.$DisplayObject;return t!=e[17]&&(t=(t=n(e[17]=t))/180*Math.PI,e[3]=t,this.$invalidateMatrix(),!0)},Object.defineProperty(l.prototype,"width",{get:function(){return this.$getWidth()},set:function(t){this.$setWidth(t)},enumerable:!0,configurable:!0}),l.prototype.$getWidth=function(){return isNaN(this.$getExplicitWidth())?this.$getOriginalBounds().width:this.$getExplicitWidth()},l.prototype.$getExplicitWidth=function(){return this.$DisplayObject[14]},l.prototype.$setWidth=function(t){return this.$DisplayObject[14]=isNaN(t)?NaN:t,!((t=+t)<0)&&(this.$invalidateMatrix(),!0)},Object.defineProperty(l.prototype,"height",{get:function(){return this.$getHeight()},set:function(t){this.$setHeight(t)},enumerable:!0,configurable:!0}),l.prototype.$getHeight=function(){return isNaN(this.$getExplicitHeight())?this.$getOriginalBounds().height:this.$getExplicitHeight()},l.prototype.$getExplicitHeight=function(){return this.$DisplayObject[15]},l.prototype.$setHeight=function(t){return this.$DisplayObject[15]=isNaN(t)?NaN:t,!((t=+t)<0)&&(this.$invalidateMatrix(),!0)},Object.defineProperty(l.prototype,"measuredWidth",{get:function(){return this.$getOriginalBounds().width},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"measuredHeight",{get:function(){return this.$getOriginalBounds().height},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"anchorOffsetX",{get:function(){return this.$DisplayObject[12]},set:function(t){this.$setAnchorOffsetX(t)},enumerable:!0,configurable:!0}),l.prototype.$getAnchorOffsetX=function(){return this.$DisplayObject[12]},l.prototype.$setAnchorOffsetX=function(t){return(t=+t||0)!=this.$DisplayObject[12]&&(this.$DisplayObject[12]=t,this.$invalidatePosition(),!0)},Object.defineProperty(l.prototype,"anchorOffsetY",{get:function(){return this.$DisplayObject[13]},set:function(t){this.$setAnchorOffsetY(t)},enumerable:!0,configurable:!0}),l.prototype.$getAnchorOffsetY=function(){return this.$DisplayObject[13]},l.prototype.$setAnchorOffsetY=function(t){return(t=+t||0)!=this.$DisplayObject[13]&&(this.$DisplayObject[13]=t,this.$invalidatePosition(),!0)},Object.defineProperty(l.prototype,"visible",{get:function(){return this.$visible},set:function(t){this.$setVisible(t)},enumerable:!0,configurable:!0}),l.prototype.$setVisible=function(t){return(t=!!t)!=this.$visible&&(this.$visible=t,this.$propagateFlagsDown(1024),this.$invalidateTransform(),!0)},l.prototype.$getConcatenatedVisible=function(){var t=this.$DisplayObject;if(this.$hasFlags(1024)){if(this.$parent){var e=this.$parent.$getConcatenatedVisible();t[19]=e&&this.$visible}else t[19]=this.$visible;this.$removeFlags(1024)}return t[19]},Object.defineProperty(l.prototype,"cacheAsBitmap",{get:function(){return this.$DisplayObject[11]},set:function(t){t=!!t,this.$DisplayObject[11]=t,this.$setHasDisplayList(t)},enumerable:!0,configurable:!0}),l.prototype.$setHasDisplayList=function(t){if(!!this.$displayList!=t)if(t){var e=f.sys.DisplayList.create(this);e&&(this.$displayList=e,this.$parentDisplayList&&this.$parentDisplayList.markDirty(e),this.$cacheAsBitmapChanged())}else this.$displayList=null,this.$cacheAsBitmapChanged()},l.prototype.$cacheAsBitmapChanged=function(){var t=this.$displayList||this.$parentDisplayList;this.$renderNode&&t&&t.markDirty(this),this.$propagateFlagsDown(48)},Object.defineProperty(l.prototype,"alpha",{get:function(){return this.$alpha},set:function(t){this.$setAlpha(t)},enumerable:!0,configurable:!0}),l.prototype.$setAlpha=function(t){return(t=+t||0)!=this.$alpha&&(this.$alpha=t,this.$propagateFlagsDown(64),this.$invalidate(),!0)},l.prototype.$getConcatenatedAlpha=function(){var t=this.$DisplayObject;if(this.$hasFlags(64)){if(this.$parent){var e=this.$parent.$getConcatenatedAlpha();t[18]=e*this.$alpha}else t[18]=this.$alpha;this.$removeFlags(64)}return t[18]},Object.defineProperty(l.prototype,"touchEnabled",{get:function(){return this.$getTouchEnabled()},set:function(t){this.$setTouchEnabled(t)},enumerable:!0,configurable:!0}),l.prototype.$getTouchEnabled=function(){return this.$touchEnabled},l.prototype.$setTouchEnabled=function(t){return this.$touchEnabled!=t&&(this.$touchEnabled=t,!0)},Object.defineProperty(l.prototype,"scrollRect",{get:function(){return this.$scrollRect},set:function(t){this.$setScrollRect(t)},enumerable:!0,configurable:!0}),l.prototype.$setScrollRect=function(t){return!(!t&&!this.$scrollRect)&&(t?(this.$scrollRect||(this.$scrollRect=new f.Rectangle),this.$scrollRect.copyFrom(t)):this.$scrollRect=null,this.$invalidatePosition(),!0)},Object.defineProperty(l.prototype,"blendMode",{get:function(){return f.sys.numberToBlendMode(this.$blendMode)},set:function(t){var e=f.sys.blendModeToNumber(t);e!=this.$blendMode&&(this.$blendMode=e,this.$invalidateTransform())},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"mask",{get:function(){return this.$mask?this.$mask:this.$maskRect},set:function(t){if(t!==this){if(t)if(t instanceof l){if(t==this.$mask)return;t.$maskedObject&&(t.$maskedObject.mask=null),t.$maskedObject=this,t.$invalidateTransform(),this.$mask=t,this.$maskRect=null}else this.$setMaskRect(t),this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$invalidateTransform()),this.$mask=null;else this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$invalidateTransform()),this.$mask=null,this.$maskRect=null;this.$invalidateTransform()}},enumerable:!0,configurable:!0}),l.prototype.$setMaskRect=function(t){return!(!t&&!this.$maskRect)&&(t?(this.$maskRect||(this.$maskRect=new f.Rectangle),this.$maskRect.copyFrom(t)):this.$maskRect=null,this.$invalidatePosition(),!0)},Object.defineProperty(l.prototype,"filters",{get:function(){return this.$DisplayObject[20]},set:function(t){var e=this.$DisplayObject[20];if(e||t){if(this.$invalidateContentBounds(),this.$invalidate(!0),e&&e.length)for(var i=e.length,r=0;r<i;r++)e[r].$removeTarget(this);if((this.$DisplayObject[20]=t)&&t.length){var n=t.length;for(r=0;r<n;r++)t[r].$addTarget(this)}}else this.$DisplayObject[20]=t},enumerable:!0,configurable:!0}),l.prototype.$getFilters=function(){return this.$DisplayObject[20]},l.prototype.getTransformedBounds=function(t,e){return t=t||this,this.$getTransformedBounds(t,e)},l.prototype.getBounds=function(t,e){if(void 0===e&&(e=!0),t=this.$getTransformedBounds(this,t),e){var i=this.$DisplayObject;(0!=i[12]||0!=i[13])&&(t.x-=i[12],t.y-=i[13])}return t},l.prototype.$getTransformedBounds=function(t,e){var i,r=this.$getOriginalBounds();if(e||(e=new f.Rectangle),e.copyFrom(r),t==this)return e;t?(i=f.$TempMatrix,t.$getInvertedConcatenatedMatrix().$preMultiplyInto(this.$getConcatenatedMatrix(),i)):i=this.$getConcatenatedMatrix();return i.$transformBounds(e),e},l.prototype.globalToLocal=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),this.$getInvertedConcatenatedMatrix().transformPoint(t,e,i)},l.prototype.localToGlobal=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),this.$getConcatenatedMatrix().transformPoint(t,e,i)},l.prototype.$invalidateContentBounds=function(){this.$invalidate(),this.$setFlags(2),this.$propagateFlagsUp(4)},l.prototype.$getOriginalBounds=function(){var t=this.$DisplayObject[9];if(this.$hasFlags(4)){t.copyFrom(this.$getContentBounds()),this.$measureChildBounds(t),this.$removeFlags(4),this.$displayList&&(this.$displayList.$renderNode.moved=!0);var e=this.$measureFiltersOffset();e&&(t.x+=e.minX,t.y+=e.minY,t.width+=e.maxX,t.height+=e.maxY)}return t},l.prototype.$measureChildBounds=function(t){},l.prototype.$getContentBounds=function(){var t=this.$DisplayObject[10];return this.$hasFlags(2)&&(this.$measureContentBounds(t),this.$renderNode&&(this.$renderNode.moved=!0),this.$removeFlags(2)),t},l.prototype.$measureContentBounds=function(t){},l.prototype.$invalidate=function(t){if(this.$renderNode&&!this.$hasFlags(384)){this.$setFlags(384);var e=this.$displayList?this.$displayList:this.$parentDisplayList;e&&e.markDirty(this)}},l.prototype.$invalidateTransform=function(){var t=this;if(!t.$hasFlags(512)){t.$setFlags(512);var e=t.$displayList;(e||t.$renderNode)&&t.$parentDisplayList&&t.$parentDisplayList.markDirty(e||t)}},l.prototype.$getRenderNode=function(){var t=this.$renderNode;return t?(128&this.$displayFlags&&(t.cleanBeforeRender(),this.$render(),this.$removeFlags(128),t=this.$renderNode),t):null},l.prototype.$update=function(t,e){var i=this;i.$removeFlagsUp(768);var r=i.$renderNode;r.renderAlpha=i.$getConcatenatedAlpha();var n=i.$getConcatenatedMatrix();if(t==f.DirtyRegionPolicy.OFF){if(!(h=i.$displayList||i.$parentDisplayList))return!1;(o=r.renderMatrix).copyFrom(n),(a=h.root)!==i.$stage&&i.$getConcatenatedMatrixAt(a,o)}else{var s=e||i.$getContentBounds();r.renderVisible=i.$getConcatenatedVisible();var o,a,h=i.$displayList||i.$parentDisplayList,l=r.renderRegion;if(!h)return l.setTo(0,0,0,0),r.moved=!1;if(!r.moved)return!1;r.moved=!1,(o=r.renderMatrix).copyFrom(n),(a=h.root)!==i.$stage&&i.$getConcatenatedMatrixAt(a,o),l.updateRegion(s,o);var c=i.$measureFiltersOffset();c&&(l.minX+=c.minX,l.minY+=c.minY,l.maxX+=c.maxX,l.maxY+=c.maxY,l.updateArea())}return!0},l.prototype.$measureFiltersOffset=function(){var t=this.$DisplayObject[20];if(t&&t.length){for(var e=t.length,i=0,r=0,n=0,s=0,o=0;o<e;o++){var a=t[o];if("blur"==a.type)i-=h=a.blurX,r-=l=a.blurY,n+=2*h,s+=2*l;else if("glow"==a.type){var h,l;i-=h=a.blurX,r-=l=a.blurY,n+=2*h,s+=2*l;var c=a.distance||0,u=a.angle||0,p=0,d=0;0!=c&&(0<(p=Math.ceil(c*f.NumberUtils.cos(u)))?n+=p:p<0&&(i+=p,n-=p),0<(d=Math.ceil(c*f.NumberUtils.sin(u)))?s+=d:d<0&&(r+=d,s-=d))}}return{minX:i,minY:r,maxX:n,maxY:s}}return null},l.prototype.$getConcatenatedMatrixAt=function(t,e){var i=t.$getInvertedConcatenatedMatrix();if(0===i.a||0===i.d){var r=this,n=t.$nestLevel;for(e.identity();r.$nestLevel>n;){var s=r.$scrollRect;s&&e.concat(f.$TempMatrix.setTo(1,0,0,1,-s.x,-s.y)),e.concat(r.$getMatrix()),r=r.$parent}}else i.$preMultiplyInto(e,e)},l.prototype.$getConcatenatedAlphaAt=function(t,e){var i=t.$getConcatenatedAlpha();if(0===i){e=1;for(var r=this,n=t.$nestLevel;r.$nestLevel>n;)e*=r.$alpha,r=r.$parent}else e/=i;return e},l.prototype.$render=function(){},l.prototype.$hitTest=function(t,e){var i=this.$DisplayObject;if(!this.$renderNode||!this.$visible||0==i[0]||0==i[1])return null;var r=this.$getInvertedConcatenatedMatrix();if(0==r.a&&0==r.b&&0==r.c&&0==r.d)return null;var n=this.$getContentBounds(),s=r.a*t+r.c*e+r.tx,o=r.b*t+r.d*e+r.ty;if(n.contains(s,o)){if(!this.$children){var a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(s,o))return null;if(this.$mask&&!this.$mask.$hitTest(t,e))return null}return this}return null},l.prototype.hitTestPoint=function(t,e,i){if(i){var r=(c=this.$getInvertedConcatenatedMatrix()).a*t+c.c*e+c.tx,n=c.b*t+c.d*e+c.ty,s=void 0,o=this.$displayList;if(o){var a=o.renderBuffer;try{s=a.getPixels(r-o.offsetX,n-o.offsetY)}catch(t){throw new Error(f.sys.tr(1039))}}else{(a=f.sys.customHitTestBuffer).resize(3,3);var h=f.Matrix.create();h.identity(),h.translate(1-r,1-n),f.sys.systemRenderer.render(this,a,h,null,!0),f.Matrix.release(h);try{s=a.getPixels(1,1)}catch(t){throw new Error(f.sys.tr(1039))}}return 0!==s[3]}var l=this.$DisplayObject;if(0==l[0]||0==l[1])return!1;var c=this.$getInvertedConcatenatedMatrix(),u=this.getBounds(null,!1);r=c.a*t+c.c*e+c.tx,n=c.b*t+c.d*e+c.ty;if(u.contains(r,n)){var p=this.$scrollRect?this.$scrollRect:this.$maskRect;return!(p&&!p.contains(r,n))}return!1},l.prototype.$addListener=function(t,e,i,r,n,s){h.prototype.$addListener.call(this,t,e,i,r,n,s);var o=t==f.Event.ENTER_FRAME;if(o||t==f.Event.RENDER){var a=o?l.$enterFrameCallBackList:l.$renderCallBackList;-1==a.indexOf(this)&&a.push(this)}},l.prototype.removeEventListener=function(t,e,i,r){h.prototype.removeEventListener.call(this,t,e,i,r);var n=t==f.Event.ENTER_FRAME;if((n||t==f.Event.RENDER)&&!this.hasEventListener(t)){var s=n?l.$enterFrameCallBackList:l.$renderCallBackList,o=s.indexOf(this);-1!==o&&s.splice(o,1)}},l.prototype.dispatchEvent=function(t){if(!t.$bubbles)return h.prototype.dispatchEvent.call(this,t);var e=this.$getPropagationList(this),i=.5*e.length;return t.$setTarget(this),this.$dispatchPropagationEvent(t,e,i),!t.$isDefaultPrevented},l.prototype.$getPropagationList=function(t){for(var e=[];t;)e.push(t),t=t.$parent;var i=e.concat();return i.reverse(),i.concat(e)},l.prototype.$dispatchPropagationEvent=function(t,e,i){for(var r=e.length,n=i-1,s=0;s<r;s++){var o=e[s];if(t.$currentTarget=o,t.$eventPhase=s<n?1:s==i||s==n?2:3,o.$notifyListener(t,s<i),t.$isPropagationStopped||t.$isPropagationImmediateStopped)return}},l.prototype.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.$parent}return!1},l}(f.EventDispatcher);t.defaultTouchEnabled=!1,t.boundsForUpdate=new f.Rectangle,t.$enterFrameCallBackList=[],t.$renderCallBackList=[],f.DisplayObject=t,__reflect(t.prototype,"egret.DisplayObject",["egret.sys.Renderable"])}(egret||(egret={})),function(c){var t=function(u){function h(){var t=u.call(this)||this;return t.$touchChildren=!0,t.$children=[],t}return __extends(h,u),h.prototype.$propagateFlagsDown=function(t,e){if(void 0===e&&(e=!1),!this.$hasFlags(t)&&(this.$setFlags(t),!e||!this.$displayList))for(var i=this.$children,r=i.length,n=0;n<r;n++)i[n].$propagateFlagsDown(t,e)},Object.defineProperty(h.prototype,"numChildren",{get:function(){return this.$children.length},enumerable:!0,configurable:!0}),h.prototype.addChild=function(t){var e=this.$children.length;return t.$parent==this&&e--,this.$doAddChild(t,e)},h.prototype.addChildAt=function(t,e){return((e=0|+e)<0||e>=this.$children.length)&&(e=this.$children.length,t.$parent==this&&e--),this.$doAddChild(t,e)},h.prototype.$doAddChild=function(t,e,i){void 0===i&&(i=!0);var r=t.$parent;if(r==this)return this.doSetChildIndex(t,e),t;r&&r.removeChild(t),this.$children.splice(e,0,t),t.$setParent(this);var n=this.$stage;if(n&&t.$onAddToStage(n,this.$nestLevel+1),i&&t.dispatchEventWith(c.Event.ADDED,!0),n)for(var s=h.$EVENT_ADD_TO_STAGE_LIST;s.length;){var o=s.shift();o.$stage&&i&&o.dispatchEventWith(c.Event.ADDED_TO_STAGE)}var a=this.$displayList||this.$parentDisplayList;return this.assignParentDisplayList(t,a,a),t.$propagateFlagsDown(1648,!0),this.$propagateFlagsUp(4),this.$childAdded(t,e),t},h.prototype.contains=function(t){for(;t;){if(t==this)return!0;t=t.$parent}return!1},h.prototype.getChildAt=function(t){return 0<=(t=0|+t)&&t<this.$children.length?this.$children[t]:null},h.prototype.getChildIndex=function(t){return this.$children.indexOf(t)},h.prototype.getChildByName=function(t){for(var e,i=this.$children,r=i.length,n=0;n<r;n++)if((e=i[n]).name==t)return e;return null},h.prototype.removeChild=function(t){var e=this.$children.indexOf(t);return 0<=e?this.$doRemoveChild(e):null},h.prototype.removeChildAt=function(t){return 0<=(t=0|+t)&&t<this.$children.length?this.$doRemoveChild(t):null},h.prototype.$doRemoveChild=function(t,e){void 0===e&&(e=!0),t=0|+t;var i=this.$children,r=i[t];if(this.$childRemoved(r,t),e&&r.dispatchEventWith(c.Event.REMOVED,!0),this.$stage){r.$onRemoveFromStage();for(var n=h.$EVENT_REMOVE_FROM_STAGE_LIST;0<n.length;){var s=n.shift();e&&s.$hasAddToStage&&(s.$hasAddToStage=!1,s.dispatchEventWith(c.Event.REMOVED_FROM_STAGE)),s.$hasAddToStage=!1,s.$stage=null}}var o=this.$displayList||this.$parentDisplayList;this.assignParentDisplayList(r,o,null),r.$propagateFlagsDown(1648,!0),r.$setParent(null);var a=i.indexOf(r);return-1!=a&&i.splice(a,1),this.$propagateFlagsUp(4),r},h.prototype.setChildIndex=function(t,e){((e=0|+e)<0||e>=this.$children.length)&&(e=this.$children.length-1),this.doSetChildIndex(t,e)},h.prototype.doSetChildIndex=function(t,e){var i=this.$children.indexOf(t);i!=e&&(this.$childRemoved(t,i),this.$children.splice(i,1),this.$children.splice(e,0,t),this.$childAdded(t,e),t.$invalidateTransform(),this.$propagateFlagsUp(4))},h.prototype.swapChildrenAt=function(t,e){e=0|+e,0<=(t=0|+t)&&t<this.$children.length&&0<=e&&e<this.$children.length&&this.doSwapChildrenAt(t,e)},h.prototype.swapChildren=function(t,e){var i=this.$children.indexOf(t),r=this.$children.indexOf(e);-1==i||-1==r||this.doSwapChildrenAt(i,r)},h.prototype.doSwapChildrenAt=function(t,e){if(e<t){var i=e;e=t,t=i}else if(t==e)return;var r=this.$children,n=r[t],s=r[e];this.$childRemoved(n,t),this.$childRemoved(s,e),r[t]=s,r[e]=n,this.$childAdded(s,t),this.$childAdded(n,e),n.$invalidateTransform(),s.$invalidateTransform(),this.$propagateFlagsUp(4)},h.prototype.removeChildren=function(){for(var t=this.$children.length-1;0<=t;t--)this.$doRemoveChild(t)},h.prototype.$childAdded=function(t,e){},h.prototype.$childRemoved=function(t,e){},h.prototype.$onAddToStage=function(t,e){u.prototype.$onAddToStage.call(this,t,e);var i=this.$children.length;e++;for(var r=0;r<i;r++){this.$children[r].$onAddToStage(t,e)}},h.prototype.$onRemoveFromStage=function(){u.prototype.$onRemoveFromStage.call(this);for(var t=this.$children,e=t.length,i=0;i<e;i++){t[i].$onRemoveFromStage()}},h.prototype.$measureChildBounds=function(t){var e=this.$children,i=e.length;if(0!=i){for(var r=0,n=0,s=0,o=0,a=!1,h=-1;h<i;h++){var l=-1==h?t:e[h].$getTransformedBounds(this,c.$TempRectangle);l.isEmpty()||(a?(r=Math.min(r,l.x),n=Math.max(n,l.x+l.width),s=Math.min(s,l.y),o=Math.max(o,l.y+l.height)):(a=!0,n=(r=l.x)+l.width,o=(s=l.y)+l.height))}t.setTo(r,s,n-r,o-s)}},Object.defineProperty(h.prototype,"touchChildren",{get:function(){return this.$getTouchChildren()},set:function(t){this.$setTouchChildren(!!t)},enumerable:!0,configurable:!0}),h.prototype.$getTouchChildren=function(){return this.$touchChildren},h.prototype.$setTouchChildren=function(t){return this.$touchChildren!=t&&(this.$touchChildren=t,!0)},h.prototype.$invalidate=function(t){if(u.prototype.$invalidate.call(this,t),t){var e=this.$displayList||this.$parentDisplayList,i=this.$children;if(i)for(var r=i.length-1;0<=r;r--)this.markChildDirty(i[r],e)}},h.prototype.$invalidateTransform=function(){this.markChildDirty(this,this.$parentDisplayList)},h.prototype.markChildDirty=function(t,e){if(!t.$hasFlags(512)){t.$setFlags(512);var i=t.$displayList;if((i||t.$renderNode)&&e&&e.markDirty(i||t),!i){var r=t.$children;if(r)for(var n=r.length-1;0<=n;n--)this.markChildDirty(r[n],e)}}},h.prototype.$cacheAsBitmapChanged=function(){u.prototype.$cacheAsBitmapChanged.call(this);for(var t=this.$displayList||this.$parentDisplayList,e=this.$children,i=e.length-1;0<=i;i--)this.assignParentDisplayList(e[i],t,t)},h.prototype.assignParentDisplayList=function(t,e,i){t.$parentDisplayList=i,t.$setFlags(512);var r=t.$displayList;if((t.$renderNode||r)&&e&&e.markDirty(r||t),!r){var n=t.$children;if(n)for(var s=n.length-1;0<=s;s--)this.assignParentDisplayList(n[s],e,i)}},h.prototype.$hitTest=function(t,e){if(!this.$visible)return null;var i=this.$getInvertedConcatenatedMatrix(),r=i.a*t+i.c*e+i.tx,n=i.b*t+i.d*e+i.ty,s=this.$scrollRect?this.$scrollRect:this.$maskRect;if(s&&!s.contains(r,n))return null;if(this.$mask&&!this.$mask.$hitTest(t,e))return null;for(var o=this.$children,a=!1,h=null,l=o.length-1;0<=l;l--){var c=o[l];if(!c.$maskedObject&&(h=c.$hitTest(t,e))){if(a=!0,h.$touchEnabled)break;h=null}}return h?this.$touchChildren?h:this:a?this:u.prototype.$hitTest.call(this,t,e)},h.prototype.$setAlpha=function(t){return(t=+t||0)!=this.$alpha&&(this.$alpha=t,this.$propagateFlagsDown(64),this.$invalidate(),this.$invalidateAllChildren(),!0)},h.prototype.$invalidateAllChildren=function(){var t=this.$children;if(t)for(var e=t.length-1;0<=e;e--){var i=t[e];i.$invalidate(),i.$children&&i.$invalidateAllChildren()}},h}(c.DisplayObject);t.$EVENT_ADD_TO_STAGE_LIST=[],t.$EVENT_REMOVE_FROM_STAGE_LIST=[],c.DisplayObjectContainer=t,__reflect(t.prototype,"egret.DisplayObjectContainer")}(egret||(egret={})),function(t){var e=function(e){function t(){var t=e.apply(this,arguments)||this;return t.type=null,t.$targets=[],t}return __extends(t,e),t.prototype.$addTarget=function(t){for(var e=this.$targets.length,i=0;i<e;i++)if(this.$targets[i].$hashCode==t.$hashCode)return;this.$targets.push(t)},t.prototype.$removeTarget=function(t){for(var e=this.$targets.length,i=0;i<e;i++)if(this.$targets[i].$hashCode==t.$hashCode)return void this.$targets.splice(i,1)},t.prototype.invalidate=function(){for(var t=this.$targets.length,e=0;e<t;e++)this.$targets[e].$invalidateContentBounds()},t.prototype.$toJson=function(){return""},t}(t.HashObject);t.Filter=e,__reflect(e.prototype,"egret.Filter")}(egret||(egret={})),function(t){t.$locale_strings=t.$locale_strings||{},t.$language="en_US"}(egret||(egret={})),function(o){(o.sys||(o.sys={})).tr=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=o.$locale_strings[o.$language][t];if(!r)return"{"+t+"}";for(var n=e.length,s=0;s<n;s++)r=r.replace("{"+s+"}",e[s]);return r}}(egret||(egret={})),function(t){var e=function(s){function a(t,e,i,r){var n=s.call(this)||this;return n.$eventPhase=2,n.$currentTarget=null,n.$target=null,n.$isDefaultPrevented=!1,n.$isPropagationStopped=!1,n.$isPropagationImmediateStopped=!1,n.$type=t,n.$bubbles=!!e,n.$cancelable=!!i,n.data=r,n}return __extends(a,s),Object.defineProperty(a.prototype,"type",{get:function(){return this.$type},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bubbles",{get:function(){return this.$bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cancelable",{get:function(){return this.$cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"eventPhase",{get:function(){return this.$eventPhase},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentTarget",{get:function(){return this.$currentTarget},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"target",{get:function(){return this.$target},enumerable:!0,configurable:!0}),a.prototype.$setTarget=function(t){return this.$target=t,!0},a.prototype.isDefaultPrevented=function(){return this.$isDefaultPrevented},a.prototype.preventDefault=function(){this.$cancelable&&(this.$isDefaultPrevented=!0)},a.prototype.stopPropagation=function(){this.$bubbles&&(this.$isPropagationStopped=!0)},a.prototype.stopImmediatePropagation=function(){this.$bubbles&&(this.$isPropagationImmediateStopped=!0)},a.prototype.clean=function(){this.data=this.$currentTarget=null,this.$setTarget(null)},a.dispatchEvent=function(t,e,i,r){void 0===i&&(i=!1);var n=a.create(a,e,i),s=a._getPropertyData(a);null!=r&&(s.data=r);var o=t.dispatchEvent(n);return a.release(n),o},a._getPropertyData=function(t){var e=t._props;return e||(e=t._props={}),e},a.create=function(t,e,i,r){var n=t.eventPool;if(n||(n=t.eventPool=[]),n.length){var s=n.pop();return s.$type=e,s.$bubbles=!!i,s.$cancelable=!!r,s.$isDefaultPrevented=!1,s.$isPropagationStopped=!1,s.$isPropagationImmediateStopped=!1,s.$eventPhase=2,s}return new t(e,i,r)},a.release=function(t){t.clean(),Object.getPrototypeOf(t).constructor.eventPool.push(t)},a}(t.HashObject);e.ADDED_TO_STAGE="addedToStage",e.REMOVED_FROM_STAGE="removedFromStage",e.ADDED="added",e.REMOVED="removed",e.ENTER_FRAME="enterFrame",e.RENDER="render",e.RESIZE="resize",e.CHANGE="change",e.CHANGING="changing",e.COMPLETE="complete",e.LOOP_COMPLETE="loopComplete",e.FOCUS_IN="focusIn",e.FOCUS_OUT="focusOut",e.ENDED="ended",e.ACTIVATE="activate",e.DEACTIVATE="deactivate",e.CLOSE="close",e.CONNECT="connect",e.LEAVE_STAGE="leaveStage",e.SOUND_COMPLETE="soundComplete",t.Event=e,__reflect(e.prototype,"egret.Event")}(egret||(egret={})),function(i){var s=[],o=Math.PI/180,t=function(r){function n(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=r.call(this)||this;return i.x=t,i.y=e,i}return __extends(n,r),n.release=function(t){t&&s.push(t)},n.create=function(t,e){var i=s.pop();return i||(i=new n),i.setTo(t,e)},Object.defineProperty(n.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),n.prototype.setTo=function(t,e){return this.x=t,this.y=e,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},n.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},n.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.interpolate=function(t,e,i){var r=1-i;return new n(t.x*i+e.x*r,t.y*i+e.y*r)},n.prototype.normalize=function(t){if(0!=this.x||0!=this.y){var e=t/this.length;this.x*=e,this.y*=e}},n.prototype.offset=function(t,e){this.x+=t,this.y+=e},n.polar=function(t,e){return new n(t*i.NumberUtils.cos(e/o),t*i.NumberUtils.sin(e/o))},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.toString=function(){return"(x="+this.x+", y="+this.y+")"},n}(i.HashObject);i.Point=t,__reflect(t.prototype,"egret.Point"),i.$TempPoint=new t}(egret||(egret={})),function(c){var t=function(i){function t(t){var e=i.call(this)||this;return e._bitmapX=0,e._bitmapY=0,e._textureMap=c.createMap(),e.$texture=t,e._bitmapX=t._bitmapX-t._offsetX,e._bitmapY=t._bitmapY-t._offsetY,e}return __extends(t,i),t.prototype.getTexture=function(t){return this._textureMap[t]},t.prototype.createTexture=function(t,e,i,r,n,s,o,a,h){void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=s+r),void 0===h&&(h=o+n);var l=new c.Texture;return l._bitmapData=this.$texture._bitmapData,l.$initData(this._bitmapX+e,this._bitmapY+i,r,n,s,o,a,h,this.$texture._sourceWidth,this.$texture._sourceHeight),this._textureMap[t]=l},t.prototype.dispose=function(){this.$texture&&this.$texture.dispose()},t}(c.HashObject);c.SpriteSheet=t,__reflect(t.prototype,"egret.SpriteSheet")}(egret||(egret={})),function(t){var e=function(l){function t(t,e,i,r,n,s,o,a){void 0===t&&(t=16711680),void 0===e&&(e=1),void 0===i&&(i=6),void 0===r&&(r=6),void 0===n&&(n=2),void 0===s&&(s=1),void 0===o&&(o=!1),void 0===a&&(a=!1);var h=l.call(this)||this;return h.type="glow",h.$color=t,h.$blue=255&t,h.$green=(65280&t)>>8,h.$red=t>>16,h.$alpha=e,h.$blurX=i,h.$blurY=r,h.$strength=n,h.$quality=s,h.$inner=o,h.$knockout=a,h}return __extends(t,l),Object.defineProperty(t.prototype,"color",{get:function(){return this.$color},set:function(t){this.$color!=t&&(this.$color=t,this.$blue=255&t,this.$green=(65280&t)>>8,this.$red=t>>16,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.$alpha},set:function(t){this.$alpha!=t&&(this.$alpha=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurX",{get:function(){return this.$blurX},set:function(t){this.$blurX!=t&&(this.$blurX=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurY",{get:function(){return this.$blurY},set:function(t){this.$blurY!=t&&(this.$blurY=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this.$strength},set:function(t){this.$strength!=t&&(this.$strength=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return this.$quality},set:function(t){this.$quality!=t&&(this.$quality=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inner",{get:function(){return this.$inner},set:function(t){this.$inner!=t&&(this.$inner=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"knockout",{get:function(){return this.$knockout},set:function(t){this.$knockout!=t&&(this.$knockout=t,this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.$toJson=function(){return'{"color": '+this.$color+', "red": '+this.$red+', "green": '+this.$green+', "blue": '+this.$blue+', "alpha": '+this.$alpha+', "blurX": '+this.$blurX+', "blurY": '+this.blurY+', "strength": '+this.$strength+', "quality": '+this.$quality+', "inner": '+this.$inner+', "knockout": '+this.$knockout+"}"},t}(t.Filter);t.GlowFilter=e,__reflect(e.prototype,"egret.GlowFilter")}(egret||(egret={})),function(u){var t=function(e){function t(){var t=e.call(this)||this;return t.$graphics=new u.Graphics,t.$graphics.$setTarget(t),t}return __extends(t,e),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.$graphics},enumerable:!0,configurable:!0}),t.prototype.$hitTest=function(t,e){if(!this.$visible)return null;var i=this.$getInvertedConcatenatedMatrix(),r=i.a*t+i.c*e+i.tx,n=i.b*t+i.d*e+i.ty,s=this.$scrollRect?this.$scrollRect:this.$maskRect;if(s&&!s.contains(r,n))return null;if(this.$mask&&!this.$mask.$hitTest(t,e))return null;for(var o=this.$children,a=!1,h=null,l=o.length-1;0<=l;l--){var c=o[l];if(!c.$maskedObject&&(h=c.$hitTest(t,e))){if(a=!0,h.$touchEnabled)break;h=null}}return h?this.$touchChildren?h:this:a?this:((h=u.DisplayObject.prototype.$hitTest.call(this,t,e))&&(h=this.$graphics.$hitTest(t,e)),h)},t.prototype.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},t.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},t}(u.DisplayObjectContainer);u.Sprite=t,__reflect(t.prototype,"egret.Sprite")}(egret||(egret={})),function(u){u.$TextureScaleFactor=1;var t=function(e){function t(){var t=e.call(this)||this;return t._bitmapX=0,t._bitmapY=0,t._bitmapWidth=0,t._bitmapHeight=0,t._offsetX=0,t._offsetY=0,t._textureWidth=0,t._textureHeight=0,t._sourceWidth=0,t._sourceHeight=0,t._bitmapData=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this.$getTextureWidth()},enumerable:!0,configurable:!0}),t.prototype.$getTextureWidth=function(){return this._textureWidth},Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this.$getTextureHeight()},enumerable:!0,configurable:!0}),t.prototype.$getTextureHeight=function(){return this._textureHeight},t.prototype.$getScaleBitmapWidth=function(){return this._bitmapWidth*u.$TextureScaleFactor},t.prototype.$getScaleBitmapHeight=function(){return this._bitmapHeight*u.$TextureScaleFactor},Object.defineProperty(t.prototype,"bitmapData",{get:function(){return this._bitmapData},set:function(t){this._setBitmapData(t)},enumerable:!0,configurable:!0}),t.prototype._setBitmapData=function(t){this._bitmapData=t;var e=u.$TextureScaleFactor,i=t.width*e,r=t.height*e;this.$initData(0,0,i,r,0,0,i,r,t.width,t.height)},t.prototype.$initData=function(t,e,i,r,n,s,o,a,h,l){var c=u.$TextureScaleFactor;this._bitmapX=t/c,this._bitmapY=e/c,this._bitmapWidth=i/c,this._bitmapHeight=r/c,this._offsetX=n,this._offsetY=s,this._textureWidth=o,this._textureHeight=a,this._sourceWidth=h,this._sourceHeight=l,u.BitmapData.$invalidate(this)},t.prototype.getPixel32=function(t,e){throw new Error},t.prototype.getPixels=function(t,e,i,r){throw void 0===i&&(i=1),void 0===r&&(r=1),new Error},t.prototype.toDataURL=function(t,e){throw new Error},t.prototype.saveToFile=function(t,e,i){throw new Error},t.prototype.dispose=function(){this._bitmapData&&(this._bitmapData.$dispose(),this._bitmapData=null)},t}(u.HashObject);u.Texture=t,__reflect(t.prototype,"egret.Texture")}(egret||(egret={})),function($){var t=function(r){function i(t){var e=r.call(this)||this;return e.$scale9Grid=null,e.$fillMode="scale",e._pixelHitTest=!1,e.$renderNode=new $.sys.BitmapNode,e.$Bitmap={0:null,1:null,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:i.defaultSmoothing,11:NaN,12:NaN},e.$setBitmapData(t),e}return __extends(i,r),i.prototype.$onAddToStage=function(t,e){r.prototype.$onAddToStage.call(this,t,e);var i=this.$Bitmap[0];i&&$.BitmapData.$addDisplayObject(this,i)},i.prototype.$onRemoveFromStage=function(){r.prototype.$onRemoveFromStage.call(this);var t=this.$Bitmap[0];t&&$.BitmapData.$removeDisplayObject(this,t)},Object.defineProperty(i.prototype,"bitmapData",{get:function(){var t=this.$Bitmap[0];return t instanceof $.Texture?null:t},set:function(t){this.$setBitmapData(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){var t=this.$Bitmap[0];return t instanceof $.Texture?t:null},set:function(t){this.$setBitmapData(t)},enumerable:!0,configurable:!0}),i.prototype.$setBitmapData=function(t){var e=this.$Bitmap,i=e[0];if(t==i)return!1;if(!(e[0]=t))return i&&$.BitmapData.$removeDisplayObject(this,i),this.setImageData(null,0,0,0,0,0,0,0,0,0,0),this.$invalidateContentBounds(),!0;if(this.$refreshImageData(),this.$stage){if(i){if((i._bitmapData&&i._bitmapData.hashCode?i._bitmapData.hashCode:i.hashCode)==(t._bitmapData&&t._bitmapData.hashCode?t._bitmapData.hashCode:t.hashCode))return this.$invalidateContentBounds(),!0;$.BitmapData.$removeDisplayObject(this,i)}$.BitmapData.$addDisplayObject(this,t)}return this.$invalidateContentBounds(),!0},i.prototype.$refreshImageData=function(){var t=this.$Bitmap[0];if(t)if(t instanceof $.Texture){var e=t;this.setImageData(e._bitmapData,e._bitmapX,e._bitmapY,e._bitmapWidth,e._bitmapHeight,e._offsetX,e._offsetY,e.$getTextureWidth(),e.$getTextureHeight(),e._sourceWidth,e._sourceHeight)}else{var i=t.width,r=t.height;this.setImageData(t,0,0,i,r,0,0,i,r,i,r)}},i.prototype.setImageData=function(t,e,i,r,n,s,o,a,h,l,c){var u=this.$Bitmap;u[1]=t,u[2]=e,u[3]=i,u[4]=r,u[5]=n,u[6]=s,u[7]=o,u[8]=a,u[9]=h,u[13]=l,u[14]=c},Object.defineProperty(i.prototype,"scale9Grid",{get:function(){return this.$scale9Grid},set:function(t){this.$scale9Grid=t,this.$invalidateContentBounds()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillMode",{get:function(){return this.$fillMode},set:function(t){this.$setFillMode(t)},enumerable:!0,configurable:!0}),i.prototype.$setFillMode=function(t){return t!=this.$fillMode&&(this.$fillMode=t,!0)},Object.defineProperty(i.prototype,"smoothing",{get:function(){return this.$Bitmap[10]},set:function(t){t=!!t;var e=this.$Bitmap;t!=e[10]&&(e[10]=t,this.$invalidate())},enumerable:!0,configurable:!0}),i.prototype.$setWidth=function(t){var e=this.$Bitmap;return!(t<0||t==e[11])&&(e[11]=t,this.$invalidateContentBounds(),!0)},i.prototype.$setHeight=function(t){var e=this.$Bitmap;return!(t<0||t==e[12])&&(e[12]=t,this.$invalidateContentBounds(),!0)},i.prototype.$getWidth=function(){var t=this.$Bitmap;return isNaN(t[11])?this.$getContentBounds().width:t[11]},i.prototype.$getHeight=function(){var t=this.$Bitmap;return isNaN(t[12])?this.$getContentBounds().height:t[12]},i.prototype.$measureContentBounds=function(t){var e=this.$Bitmap;if(e[1]){var i=this.$Bitmap,r=isNaN(i[11])?i[8]:i[11],n=isNaN(i[12])?i[9]:i[12];t.setTo(0,0,r,n)}else{r=isNaN(e[11])?0:e[11],n=isNaN(e[12])?0:e[12];t.setTo(0,0,r,n)}},i.prototype.$render=function(){var t=this.$Bitmap;if(t[1]){var e=isNaN(t[11])?t[8]:t[11],i=isNaN(t[12])?t[9]:t[12];$.sys.BitmapNode.$updateTextureData(this.$renderNode,t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],e,i,t[13],t[14],this.scale9Grid||t[0].scale9Grid,this.fillMode,t[10])}},Object.defineProperty(i.prototype,"pixelHitTest",{get:function(){return this._pixelHitTest},set:function(t){this._pixelHitTest=!!t},enumerable:!0,configurable:!0}),i.prototype.$hitTest=function(t,e){var i=r.prototype.$hitTest.call(this,t,e);return i&&this._pixelHitTest&&(i=this.hitTestPixel(t,e)),i},i.prototype.hitTestPixel=function(t,e){var i,r=this.$getInvertedConcatenatedMatrix(),n=r.a*t+r.c*e+r.tx,s=r.b*t+r.d*e+r.ty,o=this.$displayList;if(o){var a=o.renderBuffer;try{i=a.getPixels(n-o.offsetX,s-o.offsetY)}catch(t){throw console.log(this.$Bitmap[0]),new Error($.sys.tr(1039))}}else{(a=$.sys.customHitTestBuffer).resize(3,3);var h=this.$getRenderNode(),l=$.Matrix.create();l.identity(),l.translate(1-n,1-s),$.sys.systemRenderer.drawNodeToBuffer(h,a,l,!0),$.Matrix.release(l);try{i=a.getPixels(1,1)}catch(t){throw console.log(this.$Bitmap[0]),new Error($.sys.tr(1039))}}return 0===i[3]?null:this},i.$drawImage=function(t,e,i,r,n,s,o,a,h,l,c,u,p,d,f,g,y){console.warn("deprecated method : Bitmap.$drawImage,use egret.sys.BitmapNode.$drawImage instead of it"),$.sys.BitmapNode.$updateTextureData(t,e,i,r,n,s,o,a,h,l,c,u,p,d,f,g,y)},i}($.DisplayObject);t.defaultSmoothing=!0,$.Bitmap=t,__reflect(t.prototype,"egret.Bitmap")}(egret||(egret={})),function(e){var i,t;i=e.sys||(e.sys={}),t=function(){function t(){this.type=0,this.needRedraw=!1,this.renderAlpha=1,this.renderVisible=!0,this.renderMatrix=new e.Matrix,this.renderRegion=new i.Region,this.moved=!1,this.drawData=[],this.renderCount=0}return t.prototype.cleanBeforeRender=function(){this.drawData.length=0,this.renderCount=0},t.prototype.$getRenderCount=function(){return this.renderCount},t}(),i.RenderNode=t,__reflect(t.prototype,"egret.sys.RenderNode")}(egret||(egret={})),function(t){var e,i;e=t.sys||(t.sys={}),i=function(){function t(){this.type=0,this.$commands=[],this.$data=[],this.commandPosition=0,this.dataPosition=0,this.$lastX=0,this.$lastY=0}return t.prototype.moveTo=function(t,e){this.$commands[this.commandPosition++]=1;var i=this.dataPosition;this.$data[i++]=t,this.$data[i++]=e,this.dataPosition=i},t.prototype.lineTo=function(t,e){this.$commands[this.commandPosition++]=2;var i=this.dataPosition;this.$data[i++]=t,this.$data[i++]=e,this.dataPosition=i},t.prototype.curveTo=function(t,e,i,r){this.$commands[this.commandPosition++]=3;var n=this.dataPosition;this.$data[n++]=t,this.$data[n++]=e,this.$data[n++]=i,this.$data[n++]=r,this.dataPosition=n},t.prototype.cubicCurveTo=function(t,e,i,r,n,s){this.$commands[this.commandPosition++]=4;var o=this.dataPosition;this.$data[o++]=t,this.$data[o++]=e,this.$data[o++]=i,this.$data[o++]=r,this.$data[o++]=n,this.$data[o++]=s,this.dataPosition=o},t.prototype.drawRect=function(t,e,i,r){var n=t+i,s=e+r;this.moveTo(t,e),this.lineTo(n,e),this.lineTo(n,s),this.lineTo(t,s),this.lineTo(t,e)},t.prototype.drawRoundRect=function(t,e,i,r,n,s){var o=.5*n|0,a=s?.5*s|0:o;if(o&&a){var h=.5*i,l=.5*r;if(h<o&&(o=h),l<a&&(a=l),h!==o||l!==a){var c=t+i,u=e+r,p=t+o,d=c-o,f=e+a,g=u-a;this.moveTo(c,g),this.curveTo(c,u,d,u),this.lineTo(p,u),this.curveTo(t,u,t,g),this.lineTo(t,f),this.curveTo(t,e,p,e),this.lineTo(d,e),this.curveTo(c,e,c,f),this.lineTo(c,g)}else o===a?this.drawCircle(t+o,e+a,o):this.drawEllipse(t,e,2*o,2*a)}else this.drawRect(t,e,i,r)},t.prototype.drawCircle=function(t,e,i){this.arcToBezier(t,e,i,i,0,2*Math.PI)},t.prototype.drawEllipse=function(t,e,i,r){var n=.5*i,s=.5*r;t+=n,e+=s,this.arcToBezier(t,e,n,s,0,2*Math.PI)},t.prototype.drawArc=function(t,e,i,r,n,s){s?r<=n&&(n-=2*Math.PI):n<=r&&(n+=2*Math.PI),this.arcToBezier(t,e,i,i,r,n,s)},t.prototype.arcToBezier=function(t,e,i,r,n,s,o){var a=.5*Math.PI,h=n,l=h;o?(l+=-a-h%a)<s&&(l=s):s<(l+=a-h%a)&&(l=s);var c=t+Math.cos(h)*i,u=e+Math.sin(h)*r;(this.$lastX!=c||this.$lastY!=u)&&this.moveTo(c,u);for(var p=Math.cos(h),d=Math.sin(h),f=0;f<4;f++){var g=l-h,y=4*Math.tan(g/4)/3,$=c-d*y*i,v=u+p*y*r,m=(c=t+(p=Math.cos(l))*i)+(d=Math.sin(l))*y*i,b=(u=e+d*r)-p*y*r;if(this.cubicCurveTo($,v,m,b,c,u),l===s)break;h=l,o?(l=h-a)<s&&(l=s):s<(l=h+a)&&(l=s)}},t}(),e.Path2D=i,__reflect(i.prototype,"egret.sys.Path2D")}(egret||(egret={})),(egret||(egret={})).createMap=function(){var t=Object.create(null);return t.__v8__=void 0,delete t.__v8__,t},function(t){t.getString=function(){return""},t.$error=function(t){throw new Error("#"+t)},t.$warn=function(){},t.$markCannotUse=function(){}}(egret||(egret={})),(egret||(egret={})).CapsStyle={NONE:"none",ROUND:"round",SQUARE:"square"},(egret||(egret={})).DirtyRegionPolicy={OFF:"off",ON:"on"},function(a){var t=function(){function o(){}return o.compileProgram=function(t,e,i){var r=o.compileFragmentShader(t,i),n=o.compileVertexShader(t,e),s=t.createProgram();return t.attachShader(s,n),t.attachShader(s,r),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||a.$warn(1020),s},o.compileFragmentShader=function(t,e){return o._compileShader(t,e,t.FRAGMENT_SHADER)},o.compileVertexShader=function(t,e){return o._compileShader(t,e,t.VERTEX_SHADER)},o._compileShader=function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:null},o.checkCanUseWebGL=function(){if(null==o.canUseWebGL)try{var t=document.createElement("canvas");o.canUseWebGL=!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){o.canUseWebGL=!1}return o.canUseWebGL},o.deleteWebGLTexture=function(t){if(t){var e=t.glContext;e&&e.deleteTexture(t)}},o}();a.WebGLUtils=t,__reflect(t.prototype,"egret.WebGLUtils")}(egret||(egret={})),function(t){var e=function(r){function t(t,e,i){return void 0===e&&(e=!1),void 0===i&&(i=!1),r.call(this,t,e,i)||this}return __extends(t,r),t}(t.Event);e.FOCUS_IN="focusIn",e.FOCUS_OUT="focusOut",t.FocusEvent=e,__reflect(e.prototype,"egret.FocusEvent")}(egret||(egret={})),function(t){var e=function(t){function e(){return t.apply(this,arguments)||this}return __extends(e,t),e}(t.Event);e.PERMISSION_DENIED="permissionDenied",e.UNAVAILABLE="unavailable",t.GeolocationEvent=e,__reflect(e.prototype,"egret.GeolocationEvent")}(egret||(egret={})),function(o){var t=function(n){function s(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var r=n.call(this,t,e,i)||this;return r._status=0,r}return __extends(s,n),Object.defineProperty(s.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),s.dispatchHTTPStatusEvent=function(t,e){var i=o.Event.create(s,s.HTTP_STATUS);i._status=e;var r=t.dispatchEvent(i);return o.Event.release(i),r},s}(o.Event);t.HTTP_STATUS="httpStatus",o.HTTPStatusEvent=t,__reflect(t.prototype,"egret.HTTPStatusEvent")}(egret||(egret={})),function(s){var t=function(r){function n(t,e,i){return void 0===e&&(e=!1),void 0===i&&(i=!1),r.call(this,t,e,i)||this}return __extends(n,r),n.dispatchIOErrorEvent=function(t){var e=s.Event.create(n,n.IO_ERROR),i=t.dispatchEvent(e);return s.Event.release(e),i},n}(s.Event);t.IO_ERROR="ioError",s.IOErrorEvent=t,__reflect(t.prototype,"egret.IOErrorEvent")}(egret||(egret={})),function(t){var e=function(t){function e(){return t.apply(this,arguments)||this}return __extends(e,t),e}(t.Event);t.MotionEvent=e,__reflect(e.prototype,"egret.MotionEvent")}(egret||(egret={})),function(t){var e=function(t){function e(){return t.apply(this,arguments)||this}return __extends(e,t),e}(t.Event);t.OrientationEvent=e,__reflect(e.prototype,"egret.OrientationEvent")}(egret||(egret={})),function(h){var t=function(o){function a(t,e,i,r,n){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=0),void 0===n&&(n=0);var s=o.call(this,t,e,i)||this;return s.bytesLoaded=0,s.bytesTotal=0,s.bytesLoaded=r,s.bytesTotal=n,s}return __extends(a,o),a.dispatchProgressEvent=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=h.Event.create(a,e);n.bytesLoaded=i,n.bytesTotal=r;var s=t.dispatchEvent(n);return h.Event.release(n),s},a}(h.Event);t.PROGRESS="progress",t.SOCKET_DATA="socketData",h.ProgressEvent=t,__reflect(t.prototype,"egret.ProgressEvent")}(egret||(egret={})),function(s){var t=function(r){function n(t,e,i){return void 0===e&&(e=!1),void 0===i&&(i=!1),r.call(this,t,e,i)||this}return __extends(n,r),n.dispatchStageOrientationEvent=function(t,e){var i=s.Event.create(n,e),r=t.dispatchEvent(i);return s.Event.release(i),r},n}(s.Event);t.ORIENTATION_CHANGE="orientationChange",s.StageOrientationEvent=t,__reflect(t.prototype,"egret.StageOrientationEvent")}(egret||(egret={})),function(a){var t=function(s){function o(t,e,i,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r="");var n=s.call(this,t,e,i)||this;return n.text=r,n}return __extends(o,s),o.dispatchTextEvent=function(t,e,i){var r=a.Event.create(o,e);r.text=i;var n=t.dispatchEvent(r);return a.Event.release(r),n},o}(a.Event);t.LINK="link",a.TextEvent=t,__reflect(t.prototype,"egret.TextEvent")}(egret||(egret={})),function(a){var t=function(r){function o(t,e,i){return r.call(this,t,e,i)||this}return __extends(o,r),o.prototype.updateAfterEvent=function(){a.sys.$requestRenderingFlag=!0},o.dispatchTimerEvent=function(t,e,i,r){var n=a.Event.create(o,e,i,r),s=t.dispatchEvent(n);return a.Event.release(n),s},o}(a.Event);t.TIMER="timer",t.TIMER_COMPLETE="timerComplete",a.TimerEvent=t,__reflect(t.prototype,"egret.TimerEvent")}(egret||(egret={})),function(o){var t=function(i){function s(t){var e=i.call(this)||this;return e.format="image",e.$deleteSource=!0,e.source=t,e.width=t.width,e.height=t.height,e}return __extends(s,i),s.prototype.$dispose=function(){o.Capabilities.runtimeType==o.RuntimeType.WEB&&"webgl"==o.Capabilities.renderMode&&this.webGLTexture&&(o.WebGLUtils.deleteWebGLTexture(this.webGLTexture),this.webGLTexture=null),this.source&&this.source.dispose&&this.source.dispose(),this.source=null,s.$dispose(this)},s.$addDisplayObject=function(t,e){var i;if(i=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode){if(!s._displayList[i])return void(s._displayList[i]=[t]);var r=s._displayList[i];r.indexOf(t)<0&&r.push(t)}},s.$removeDisplayObject=function(t,e){var i;if((i=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode)&&s._displayList[i]){var r=s._displayList[i],n=r.indexOf(t);0<=n&&r.splice(n)}},s.$invalidate=function(t){var e;if((e=t._bitmapData&&t._bitmapData.hashCode?t._bitmapData.hashCode:t.hashCode)&&s._displayList[e])for(var i=s._displayList[e],r=0;r<i.length;r++)i[r]instanceof o.Bitmap&&i[r].$refreshImageData(),i[r].$invalidateContentBounds()},s.$dispose=function(t){var e;if((e=t._bitmapData&&t._bitmapData.hashCode?t._bitmapData.hashCode:t.hashCode)&&s._displayList[e]){for(var i=0,r=s._displayList[e];i<r.length;i++){var n=r[i];n instanceof o.Bitmap&&(n.$Bitmap[1]=null),n.$invalidateContentBounds()}delete s._displayList[e]}},s}(o.HashObject);t._displayList=o.createMap(),o.BitmapData=t,__reflect(t.prototype,"egret.BitmapData")}(egret||(egret={})),function(u){var t=new u.Point,e=function(a){function c(t,e,i,r,n,s){var o=a.call(this,t,e,i)||this;return o.targetChanged=!0,o.touchDown=!1,o.$initTo(r,n,s),o}return __extends(c,a),c.prototype.$initTo=function(t,e,i){this.touchPointID=+i||0,this.$stageX=+t||0,this.$stageY=+e||0},Object.defineProperty(c.prototype,"stageX",{get:function(){return this.$stageX},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stageY",{get:function(){return this.$stageY},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"localX",{get:function(){return this.targetChanged&&this.getLocalXY(),this._localX},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"localY",{get:function(){return this.targetChanged&&this.getLocalXY(),this._localY},enumerable:!0,configurable:!0}),c.prototype.getLocalXY=function(){this.targetChanged=!1,this.$target.$getInvertedConcatenatedMatrix().transformPoint(this.$stageX,this.$stageY,t),this._localX=t.x,this._localY=t.y},c.prototype.$setTarget=function(t){return this.$target=t,this.targetChanged=!!t,!0},c.prototype.updateAfterEvent=function(){u.sys.$requestRenderingFlag=!0},c.dispatchTouchEvent=function(t,e,i,r,n,s,o,a){if(void 0===a&&(a=!1),!i&&!t.hasEventListener(e))return!0;var h=u.Event.create(c,e,i,r);h.$initTo(n,s,o),h.touchDown=a;var l=t.dispatchEvent(h);return u.Event.release(h),l},c}(u.Event);e.TOUCH_MOVE="touchMove",e.TOUCH_BEGIN="touchBegin",e.TOUCH_END="touchEnd",e.TOUCH_CANCEL="touchCancel",e.TOUCH_TAP="touchTap",e.TOUCH_RELEASE_OUTSIDE="touchReleaseOutside",e.TOUCH_ROLL_OUT="touchRollOut",e.TOUCH_ROLL_OVER="touchRollOver",u.TouchEvent=e,__reflect(e.prototype,"egret.TouchEvent")}(egret||(egret={})),egret||(egret={}),function(t){var e=function(n){function t(t,e,i){void 0===t&&(t=4),void 0===e&&(e=4),void 0===i&&(i=1);var r=n.call(this)||this;return r.type="blur",r.$blurX=t,r.$blurY=e,r.$quality=i,r}return __extends(t,n),Object.defineProperty(t.prototype,"blurX",{get:function(){return this.$blurX},set:function(t){this.$blurX!=t&&(this.$blurX=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurY",{get:function(){return this.$blurY},set:function(t){this.$blurY!=t&&(this.$blurY=t,this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.$toJson=function(){return'{"blurX": '+this.$blurX+', "blurY": '+this.$blurY+', "quality": 1}'},t}(t.Filter);t.BlurFilter=e,__reflect(e.prototype,"egret.BlurFilter")}(egret||(egret={})),function(t){var e=function(i){function t(t){void 0===t&&(t=null);var e=i.call(this)||this;return e.$matrix=[],e.matrix2=[],e.type="colorTransform",e.setMatrix(t),e}return __extends(t,i),Object.defineProperty(t.prototype,"matrix",{get:function(){for(var t=0;t<20;t++)this.matrix2[t]=this.$matrix[t];return this.matrix2},set:function(t){this.setMatrix(t),this.invalidate()},enumerable:!0,configurable:!0}),t.prototype.setMatrix=function(t){if(t)for(var e=0;e<20;e++)this.$matrix[e]=t[e];else for(e=0;e<20;e++)this.$matrix[e]=0==e||6==e||12==e||18==e?1:0},t.prototype.$toJson=function(){return'{"matrix": ['+this.$matrix.toString()+"]}"},t}(t.Filter);t.ColorMatrixFilter=e,__reflect(e.prototype,"egret.ColorMatrixFilter")}(egret||(egret={})),function(t){var e=function(p){function t(t,e,i,r,n,s,o,a,h,l,c){void 0===t&&(t=4),void 0===e&&(e=45),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=4),void 0===s&&(s=4),void 0===o&&(o=1),void 0===a&&(a=1),void 0===h&&(h=!1),void 0===l&&(l=!1),void 0===c&&(c=!1);var u=p.call(this,i,r,n,s,o,a,h,l)||this;return u.$distance=t,u.$angle=e,u.$hideObject=c,u}return __extends(t,p),Object.defineProperty(t.prototype,"distance",{get:function(){return this.$distance},set:function(t){this.$distance!=t&&(this.$distance=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.$angle},set:function(t){this.$angle!=t&&(this.$angle=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hideObject",{get:function(){return this.$hideObject},set:function(t){this.$hideObject!=t&&(this.$hideObject=t,this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.$toJson=function(){return'{"distance": '+this.$distance+', "angle": '+this.$angle+', "color": '+this.$color+', "red": '+this.$red+', "green": '+this.$green+', "blue": '+this.$blue+', "alpha": '+this.$alpha+', "blurX": '+this.$blurX+', "blurY": '+this.blurY+', "strength": '+this.$strength+', "quality": '+this.$quality+', "inner": '+this.$inner+', "knockout": '+this.$knockout+', "hideObject": '+this.$hideObject+"}"},t}(t.GlowFilter);t.DropShadowFilter=e,__reflect(e.prototype,"egret.DropShadowFilter")}(egret||(egret={})),function(t){var e=function(){};e.LINEAR="linear",e.RADIAL="radial",t.GradientType=e,__reflect(e.prototype,"egret.GradientType")}(egret||(egret={})),function(l){function c(t){return(t%=2*Math.PI)<0&&(t+=2*Math.PI),t}var t=function(e){function t(){var t=e.call(this)||this;return t.lastX=0,t.lastY=0,t.fillPath=null,t.strokePath=null,t.topLeftStrokeWidth=0,t.bottomRightStrokeWidth=0,t.minX=1/0,t.minY=1/0,t.maxX=-1/0,t.maxY=-1/0,t.includeLastPosition=!0,t.$renderNode=new l.sys.GraphicsNode,t}return __extends(t,e),t.prototype.$setTarget=function(t){this.targetDisplay&&(this.targetDisplay.$renderNode=null),t.$renderNode=this.$renderNode,this.targetDisplay=t},t.prototype.setStrokeWidth=function(t){switch(t){case 1:this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=1;break;case 3:this.topLeftStrokeWidth=1,this.bottomRightStrokeWidth=2;break;default:var e=0|Math.ceil(.5*t);this.topLeftStrokeWidth=e,this.bottomRightStrokeWidth=e}},t.prototype.beginFill=function(t,e){void 0===e&&(e=1),t=+t||0,e=+e||0,this.fillPath=this.$renderNode.beginFill(t,e,this.strokePath),1<this.$renderNode.drawData.length&&this.fillPath.moveTo(this.lastX,this.lastY)},t.prototype.beginGradientFill=function(t,e,i,r,n){void 0===n&&(n=null),this.fillPath=this.$renderNode.beginGradientFill(t,e,i,r,n,this.strokePath),1<this.$renderNode.drawData.length&&this.fillPath.moveTo(this.lastX,this.lastY)},t.prototype.endFill=function(){this.fillPath=null},t.prototype.lineStyle=function(t,e,i,r,n,s,o,a){void 0===t&&(t=NaN),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=!1),void 0===n&&(n="normal"),void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=3),(t=+t||0)<=0?(this.strokePath=null,this.setStrokeWidth(0)):(e=+e||0,i=+i||0,a=+a||0,this.setStrokeWidth(t),this.strokePath=this.$renderNode.lineStyle(t,e,i,s,o,a),1<this.$renderNode.drawData.length&&this.strokePath.moveTo(this.lastX,this.lastY))},t.prototype.drawRect=function(t,e,i,r){t=+t||0,e=+e||0,i=+i||0,r=+r||0;var n=this.fillPath,s=this.strokePath;n&&n.drawRect(t,e,i,r),s&&s.drawRect(t,e,i,r),this.extendBoundsByPoint(t+i,e+r),this.updatePosition(t,e),this.$renderNode.dirtyRender=!0},t.prototype.drawRoundRect=function(t,e,i,r,n,s){t=+t||0,e=+e||0,i=+i||0,r=+r||0,n=+n||0,s=+s||0;var o=this.fillPath,a=this.strokePath;o&&o.drawRoundRect(t,e,i,r,n,s),a&&a.drawRoundRect(t,e,i,r,n,s);var h=t+i,l=e+r,c=l-(s?.5*s|0:.5*n|0);this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(h,l),this.updatePosition(h,c),this.$renderNode.dirtyRender=!0},t.prototype.drawCircle=function(t,e,i){t=+t||0,e=+e||0,i=+i||0;var r=this.fillPath,n=this.strokePath;r&&r.drawCircle(t,e,i),n&&n.drawCircle(t,e,i),this.extendBoundsByPoint(t-i,e-i),this.extendBoundsByPoint(t+i,e+i),this.updatePosition(t+i,e),this.$renderNode.dirtyRender=!0},t.prototype.drawEllipse=function(t,e,i,r){t=+t||0,e=+e||0,i=+i||0,r=+r||0;var n=this.fillPath,s=this.strokePath;n&&n.drawEllipse(t,e,i,r),s&&s.drawEllipse(t,e,i,r),this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(t+i,e+r),this.updatePosition(t+i,e+.5*r),this.$renderNode.dirtyRender=!0},t.prototype.moveTo=function(t,e){t=+t||0,e=+e||0;var i=this.fillPath,r=this.strokePath;i&&i.moveTo(t,e),r&&r.moveTo(t,e),this.includeLastPosition=!1,this.lastX=t,this.lastY=e,this.$renderNode.dirtyRender=!0},t.prototype.lineTo=function(t,e){t=+t||0,e=+e||0;var i=this.fillPath,r=this.strokePath;i&&i.lineTo(t,e),r&&r.lineTo(t,e),this.updatePosition(t,e),this.$renderNode.dirtyRender=!0},t.prototype.curveTo=function(t,e,i,r){t=+t||0,e=+e||0,i=+i||0,r=+r||0;var n=this.fillPath,s=this.strokePath;n&&n.curveTo(t,e,i,r),s&&s.curveTo(t,e,i,r),this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(i,r),this.updatePosition(i,r),this.$renderNode.dirtyRender=!0},t.prototype.cubicCurveTo=function(t,e,i,r,n,s){t=+t||0,e=+e||0,i=+i||0,r=+r||0,n=+n||0,s=+s||0;var o=this.fillPath,a=this.strokePath;o&&o.cubicCurveTo(t,e,i,r,n,s),a&&a.cubicCurveTo(t,e,i,r,n,s),this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(i,r),this.extendBoundsByPoint(n,s),this.updatePosition(n,s),this.$renderNode.dirtyRender=!0},t.prototype.drawArc=function(t,e,i,r,n,s){if(!(i<0||r===n)){t=+t||0,e=+e||0,i=+i||0,n=+n||0,s=!!s,r=c(r=+r||0),n=c(n);var o=this.fillPath,a=this.strokePath;o&&(o.$lastX=this.lastX,o.$lastY=this.lastY,o.drawArc(t,e,i,r,n,s)),a&&(a.$lastX=this.lastX,a.$lastY=this.lastY,a.drawArc(t,e,i,r,n,s)),s?this.arcBounds(t,e,i,n,r):this.arcBounds(t,e,i,r,n);var h=t+Math.cos(n)*i,l=e+Math.sin(n)*i;this.updatePosition(h,l),this.$renderNode.dirtyRender=!0}},t.prototype.arcBounds=function(t,e,i,r,n){var s=Math.PI;if(Math.abs(r-n)<.01)return this.extendBoundsByPoint(t-i,e-i),void this.extendBoundsByPoint(t+i,e+i);n<r&&(n+=2*s);for(var o=Math.cos(r)*i,a=Math.cos(n)*i,h=Math.min(o,a),l=Math.max(o,a),c=Math.sin(r)*i,u=Math.sin(n)*i,p=Math.min(c,u),d=Math.max(c,u),f=r/(.5*s),g=n/(.5*s),y=Math.ceil(f);y<=g;y++)switch(y%4){case 0:l=i;break;case 1:d=i;break;case 2:h=-i;break;case 3:p=-i}h=Math.floor(h),p=Math.floor(p),l=Math.ceil(l),d=Math.ceil(d),this.extendBoundsByPoint(h+t,p+e),this.extendBoundsByPoint(l+t,d+e)},t.prototype.clear=function(){this.$renderNode.clear(),this.updatePosition(0,0),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.extendBoundsByPoint=function(t,e){this.extendBoundsByX(t),this.extendBoundsByY(e)},t.prototype.extendBoundsByX=function(t){this.minX=Math.min(this.minX,t-this.topLeftStrokeWidth),this.maxX=Math.max(this.maxX,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},t.prototype.extendBoundsByY=function(t){this.minY=Math.min(this.minY,t-this.topLeftStrokeWidth),this.maxY=Math.max(this.maxY,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},t.prototype.updateNodeBounds=function(){var t=this.$renderNode;t.x=this.minX,t.y=this.minY,t.width=Math.ceil(this.maxX-this.minX),t.height=Math.ceil(this.maxY-this.minY)},t.prototype.updatePosition=function(t,e){this.includeLastPosition||(this.extendBoundsByPoint(this.lastX,this.lastY),this.includeLastPosition=!0),this.lastX=t,this.lastY=e,this.extendBoundsByPoint(t,e),this.targetDisplay.$invalidateContentBounds()},t.prototype.$measureContentBounds=function(t){this.minX===1/0?t.setEmpty():t.setTo(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY)},t.prototype.$hitTest=function(t,e){var i=this.targetDisplay,r=i.$getInvertedConcatenatedMatrix(),n=r.a*t+r.c*e+r.tx,s=r.b*t+r.d*e+r.ty,o=l.sys.canvasHitTestBuffer;o.resize(3,3);var a=this.$renderNode,h=l.Matrix.create();h.identity(),h.translate(1-n,1-s),l.sys.canvasRenderer.drawNodeToBuffer(a,o,h,!0),l.Matrix.release(h);try{if(0===o.getPixels(1,1)[3])return null}catch(t){throw new Error(l.sys.tr(1039))}return i},t.prototype.$onRemoveFromStage=function(){this.$renderNode&&this.$renderNode.clean()},t}(l.HashObject);l.Graphics=t,__reflect(t.prototype,"egret.Graphics")}(egret||(egret={})),function(l){var t=Math.PI,o=2*t,c=t/180,i=[],e=function(a){function e(t,e,i,r,n,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===s&&(s=0);var o=a.call(this)||this;return o.a=t,o.b=e,o.c=i,o.d=r,o.tx=n,o.ty=s,o}return __extends(e,a),e.release=function(t){t&&i.push(t)},e.create=function(){var t=i.pop();return t||(t=new e),t},e.prototype.clone=function(){return new e(this.a,this.b,this.c,this.d,this.tx,this.ty)},e.prototype.concat=function(t){var e=this.a*t.a,i=0,r=0,n=this.d*t.d,s=this.tx*t.a+t.tx,o=this.ty*t.d+t.ty;(0!==this.b||0!==this.c||0!==t.b||0!==t.c)&&(e+=this.b*t.c,n+=this.c*t.b,i+=this.a*t.b+this.b*t.d,r+=this.c*t.a+this.d*t.c,s+=this.ty*t.c,o+=this.tx*t.b),this.a=e,this.b=i,this.c=r,this.d=n,this.tx=s,this.ty=o},e.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},e.prototype.identity=function(){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0},e.prototype.invert=function(){this.$invertInto(this)},e.prototype.$invertInto=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,s=this.tx,o=this.ty;if(0==i&&0==r)return t.b=t.c=0,void(0==e||0==n?t.a=t.d=t.tx=t.ty=0:(e=t.a=1/e,n=t.d=1/n,t.tx=-e*s,t.ty=-n*o));var a=e*n-i*r;if(0!=a){a=1/a;var h=t.a=n*a;i=t.b=-i*a,r=t.c=-r*a,n=t.d=e*a,t.tx=-(h*s+r*o),t.ty=-(i*s+n*o)}else t.identity()},e.prototype.rotate=function(t){if(0!==(t=+t)){t/=c;var e=l.NumberUtils.cos(t),i=l.NumberUtils.sin(t),r=this.a,n=this.b,s=this.c,o=this.d,a=this.tx,h=this.ty;this.a=r*e-n*i,this.b=r*i+n*e,this.c=s*e-o*i,this.d=s*i+o*e,this.tx=a*e-h*i,this.ty=a*i+h*e}},e.prototype.scale=function(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)},e.prototype.setTo=function(t,e,i,r,n,s){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s,this},e.prototype.transformPoint=function(t,e,i){var r=this.a*t+this.c*e+this.tx,n=this.b*t+this.d*e+this.ty;return i?(i.setTo(r,n),i):new l.Point(r,n)},e.prototype.translate=function(t,e){this.tx+=t,this.ty+=e},e.prototype.equals=function(t){return this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.tx==t.tx&&this.ty==t.ty},e.prototype.prepend=function(t,e,i,r,n,s){var o=this.tx;if(1!=t||0!=e||0!=i||1!=r){var a=this.a,h=this.c;this.a=a*t+this.b*i,this.b=a*e+this.b*r,this.c=h*t+this.d*i,this.d=h*e+this.d*r}return this.tx=o*t+this.ty*i+n,this.ty=o*e+this.ty*r+s,this},e.prototype.append=function(t,e,i,r,n,s){var o=this.a,a=this.b,h=this.c,l=this.d;return(1!=t||0!=e||0!=i||1!=r)&&(this.a=t*o+e*h,this.b=t*a+e*l,this.c=i*o+r*h,this.d=i*a+r*l),this.tx=n*o+s*h+this.tx,this.ty=n*a+s*l+this.ty,this},e.prototype.deltaTransformPoint=function(t){var e=this.a*t.x+this.c*t.y,i=this.b*t.x+this.d*t.y;return new l.Point(e,i)},e.prototype.toString=function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},e.prototype.createBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0);var s=this;if(0!==i){i/=c;var o=l.NumberUtils.cos(i),a=l.NumberUtils.sin(i);s.a=o*t,s.b=a*e,s.c=-a*t,s.d=o*e}else s.a=t,s.b=0,s.c=0,s.d=e;s.tx=r,s.ty=n},e.prototype.createGradientBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this.createBox(t/1638.4,e/1638.4,i,r+t/2,n+e/2)},e.prototype.$transformBounds=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,s=this.tx,o=this.ty,a=t.x,h=t.y,l=a+t.width,c=h+t.height,u=e*a+r*h+s,p=i*a+n*h+o,d=e*l+r*h+s,f=i*l+n*h+o,g=e*l+r*c+s,y=i*l+n*c+o,$=e*a+r*c+s,v=i*a+n*c+o,m=0;d<u&&(m=u,u=d,d=m),$<g&&(m=g,g=$,$=m),t.x=Math.floor(u<g?u:g),t.width=Math.ceil(($<d?d:$)-t.x),f<p&&(m=p,p=f,f=m),v<y&&(m=y,y=v,v=m),t.y=Math.floor(p<y?p:y),t.height=Math.ceil((v<f?f:v)-t.y)},e.prototype.getDeterminant=function(){return this.a*this.d-this.b*this.c},e.prototype.$getScaleX=function(){var t=this;if(1==t.a&&0==t.b)return 1;var e=Math.sqrt(t.a*t.a+t.b*t.b);return this.getDeterminant()<0?-e:e},e.prototype.$getScaleY=function(){var t=this;if(0==t.c&&1==t.d)return 1;var e=Math.sqrt(t.c*t.c+t.d*t.d);return this.getDeterminant()<0?-e:e},e.prototype.$getSkewX=function(){return Math.atan2(this.d,this.c)-t/2},e.prototype.$getSkewY=function(){return Math.atan2(this.b,this.a)},e.prototype.$updateScaleAndRotation=function(t,e,i,r){if(!(0!=i&&i!=o||0!=r&&r!=o))return this.a=t,this.b=this.c=0,void(this.d=e);i/=c,r/=c;var n=l.NumberUtils.cos(i),s=l.NumberUtils.sin(i);i==r?(this.a=n*t,this.b=s*t):(this.a=l.NumberUtils.cos(r)*t,this.b=l.NumberUtils.sin(r)*t),this.c=-s*e,this.d=n*e},e.prototype.$preMultiplyInto=function(t,e){var i=t.a*this.a,r=0,n=0,s=t.d*this.d,o=t.tx*this.a+this.tx,a=t.ty*this.d+this.ty;(0!==t.b||0!==t.c||0!==this.b||0!==this.c)&&(i+=t.b*this.c,s+=t.c*this.b,r+=t.a*this.b+t.b*this.d,n+=t.c*this.a+t.d*this.c,o+=t.ty*this.c,a+=t.tx*this.b),e.a=i,e.b=r,e.c=n,e.d=s,e.tx=o,e.ty=a},e}(l.HashObject);l.Matrix=e,__reflect(e.prototype,"egret.Matrix"),l.$TempMatrix=new e}(egret||(egret={})),(egret||(egret={})).JointStyle={BEVEL:"bevel",MITER:"miter",ROUND:"round"},function(t){t.$locale_strings=t.$locale_strings||{},t.$locale_strings.en_US=t.$locale_strings.en_US||{};var e=t.$locale_strings.en_US;e[1001]="Could not find Egret entry class: {0}。",e[1002]="Egret entry class '{0}' must inherit from egret.DisplayObject.",e[1003]="Parameter {0} must be non-null.",e[1004]="An object cannot be added as a child to one of it's children (or children's children, etc.).",e[1005]="An object cannot be added as a child of itself.",e[1006]="The supplied DisplayObject must be a child of the caller.",e[1007]="An index specified for a parameter was out of range.",e[1008]="Instantiate singleton error，singleton class {0} can not create multiple instances.",e[1009]='the Class {0} cannot use the property "{1}"',e[1010]='the property "{1}" of the Class "{0}" is readonly',e[1011]="Stream Error. URL: {0}",e[1012]="The type of parameter {0} must be Class.",e[1013]="Variable assignment is NaN, please see the code!",e[1014]='the constant "{1}" of the Class "{0}" is read-only',e[1015]="xml not found!",e[1016]="{0}has been obsoleted",e[1017]="The format of JSON file is incorrect: {0}\ndata: {1}",e[1018]="the scale9Grid is not correct",e[1019]="Network ab:{0}",e[1020]="Cannot initialize Shader",e[1021]="Current browser does not support webgl",e[1022]="{0} ArgumentError",e[1023]="This method is not available in the ScrollView!",e[1025]="end of the file",e[1026]="! EncodingError The code point {0} could not be encoded.",e[1027]="DecodingError",e[1028]=". called injection is not configured rule: {0}, please specify configuration during its initial years of injection rule, and then call the corresponding single case.",e[1029]="Function.prototype.bind - what is trying to be bound is not callable",e[1033]="Photos can not be used across domains toDataURL to convert base64",e[1034]='Music file decoding failed: "{0}", please use the standard conversion tool reconversion under mp3.',e[1035]="Native does not support this feature!",e[1036]="Sound has stopped, please recall Sound.play () to play the sound!",e[1037]="Non-load the correct blob!",e[1038]="XML format error!",e[1039]="Cross domains pictures can not get pixel information!",e[1040]="hitTestPoint can not detect crossOrigin images! Please check if the display object has crossOrigin elements.",e[1041]="{0} is deprecated, please use {1} replace",e[1042]="The parameters passed in the region needs is an integer in drawToTexture method. Otherwise, some browsers will draw abnormal.",e[1043]="Compile errors in {0}, the attribute name: {1}, the attribute value: {2}.",e[1044]="The current version of the Runtime does not support video playback, please use the latest version",e[1045]="The resource url is not found",e[1046]="BitmapText no corresponding characters: {0}, please check the configuration file",e[1047]="egret.localStorage.setItem save failed,key={0}&value={1}",e[1048]="Video loading failed",e[1049]="In the absence of sound is not allowed to play after loading",e[1050]="ExternalInterface calls the method without js registration: {0}",e[3e3]="Theme configuration file failed to load: {0}",e[3001]="Cannot find the skin name which is configured in Theme: {0}",e[3002]='Index:"{0}" is out of the collection element index range',e[3003]="Cannot be available in this component. If this component is container, please continue to use",e[3004]="addChild(){0}addElement() replace",e[3005]="addChildAt(){0}addElementAt() replace",e[3006]="removeChild(){0}removeElement() replace",e[3007]="removeChildAt(){0}removeElementAt() replace",e[3008]="setChildIndex(){0}setElementIndex() replace",e[3009]="swapChildren(){0}swapElements() replace",e[3010]="swapChildrenAt(){0}swapElementsAt() replace",e[3011]='Index:"{0}" is out of the visual element index range',e[3012]="This method is not available in Scroller component!",e[3013]="UIStage is GUI root container, and only one such instant is in the display list！",e[3014]="set fullscreen error",e[3100]="Current browser does not support WebSocket",e[3101]="Please connect Socket firstly",e[3102]="Please set the type of binary type",e[4e3]="An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)",e[4001]="Abstract class can not be instantiated!",e[4002]="Unnamed data!",e[4003]="Nonsupport version!"}(egret||(egret={})),function(l){var t=function(i){function t(t){var e=i.call(this,t)||this;return e._verticesDirty=!0,e._bounds=new l.Rectangle,e.$renderNode=new l.sys.MeshNode,e}return __extends(t,i),t.prototype.$render=function(){var t=this.$Bitmap,e=t[1];if(e){var i=(l.$TextureScaleFactor,this.$renderNode);i.smoothing=t[10],i.image=e,i.imageWidth=t[13],i.imageHeight=t[14];var r=isNaN(t[11])?t[8]:t[11],n=isNaN(t[12])?t[9]:t[12],s=r/t[8],o=n/t[9],a=t[4],h=t[5];i.drawMesh(t[2],t[3],a,h,t[6]*s,t[7]*o,s*a,o*h)}},t.prototype.$updateVertices=function(){this._verticesDirty=!0,this.$invalidateContentBounds()},t.prototype.$measureContentBounds=function(t){if(this._verticesDirty){this._verticesDirty=!1;var e=this.$renderNode,i=e.vertices;if(i.length){this._bounds.setTo(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(var r=0,n=i.length;r<n;r+=2){var s=i[r],o=i[r+1];this._bounds.x>s&&(this._bounds.x=s),this._bounds.width<s&&(this._bounds.width=s),this._bounds.y>o&&(this._bounds.y=o),this._bounds.height<o&&(this._bounds.height=o)}this._bounds.width-=this._bounds.x,this._bounds.height-=this._bounds.y}else this._bounds.setTo(0,0,0,0);e.bounds.copyFrom(this._bounds)}t.copyFrom(this._bounds)},t}(l.Bitmap);l.Mesh=t,__reflect(t.prototype,"egret.Mesh")}(egret||(egret={})),function(t){t.$locale_strings=t.$locale_strings||{},t.$locale_strings.zh_CN=t.$locale_strings.zh_CN||{};var e=t.$locale_strings.zh_CN;e[1001]="找不到Egret入口类: {0}。",e[1002]="Egret入口类 {0} 必须继承自egret.DisplayObject。",e[1003]="参数 {0} 不能为 null。",e[1004]="无法将对象添加为它的一个子对象（或子对象的子对象等）的子对象。",e[1005]="不能将对象添加为其自身的子对象。",e[1006]="提供的 DisplayObject 必须是调用者的子级。",e[1007]="为参数指定的索引不在范围内。",e[1008]="实例化单例出错，不允许实例化多个 {0} 对象。",e[1009]="类 {0} 不可以使用属性 {1}",e[1010]="类 {0} 属性 {1} 是只读的",e[1011]="流错误。URL: {0}",e[1012]="参数 {0} 的类型必须为 Class。",e[1013]="变量赋值为NaN，请查看代码！",e[1014]="类 {0} 常量 {1} 是只读的",e[1015]="xml not found!",e[1016]="{0}已经废弃",e[1017]="JSON文件格式不正确: {0}\ndata: {1}",e[1018]="9宫格设置错误",e[1019]="网络异常:{0}",e[1020]="无法初始化着色器",e[1021]="当前浏览器不支持webgl",e[1022]="{0} ArgumentError",e[1023]="此方法在ScrollView内不可用!",e[1025]="遇到文件尾",e[1026]="EncodingError! The code point {0} could not be encoded.",e[1027]="DecodingError",e[1028]="调用了未配置的注入规则:{0}。 请先在项目初始化里配置指定的注入规则，再调用对应单例。",e[1029]="Function.prototype.bind - what is trying to be bound is not callable",e[1033]="跨域图片不可以使用toDataURL来转换成base64",e[1034]='音乐文件解码失败："{0}"，请使用标准的转换工具重新转换下mp3。',e[1035]="Native 下暂未实现此功能！",e[1036]="声音已停止，请重新调用 Sound.play() 来播放声音！",e[1037]="非正确的blob加载！",e[1038]="XML 格式错误!",e[1039]="跨域图片不能获取像素信息!",e[1040]="hitTestPoint 不能对跨域图片进行检测! 请检查该显示对象内是否含有跨域元素",e[1041]="{0} 已废弃,请使用 {1} 代替",e[1042]="drawToTexture方法传入的区域各个参数需要为整数,否则某些浏览器绘制会出现异常",e[1043]="{0} 中存在编译错误，属性名 : {1}，属性值 : {2}",e[1044]="当前的 runtime 版本不支持视频播放,请使用最新的版本",e[1045]="没有设置要加载的资源地址",e[1046]="BitmapText 找不到对应字符:{0}，请检查配置文件",e[1047]="egret.localStorage.setItem保存失败,key={0}&value={1}",e[1048]="视频加载失败",e[1049]="声音在没有加载完之前不允许播放",e[1050]="ExternalInterface调用了js没有注册的方法: {0}",e[3e3]="主题配置文件加载失败: {0}",e[3001]="找不到主题中所配置的皮肤类名: {0}",e[3002]='索引:"{0}"超出集合元素索引范围',e[3003]="在此组件中不可用，若此组件为容器类，请使用",e[3004]="addChild(){0}addElement()代替",e[3005]="addChildAt(){0}addElementAt()代替",e[3006]="removeChild(){0}removeElement()代替",e[3007]="removeChildAt(){0}removeElementAt()代替",e[3008]="setChildIndex(){0}setElementIndex()代替",e[3009]="swapChildren(){0}swapElements()代替",e[3010]="swapChildrenAt(){0}swapElementsAt()代替",e[3011]='索引:"{0}"超出可视元素索引范围',e[3012]="此方法在Scroller组件内不可用!",e[3013]="UIStage是GUI根容器，只能有一个此实例在显示列表中！",e[3014]="设置全屏模式失败",e[3100]="当前浏览器不支持WebSocket",e[3101]="请先连接WebSocket",e[3102]="请先设置type为二进制类型",e[4e3]="An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)",e[4001]="Abstract class can not be instantiated!",e[4002]="Unnamed data!",e[4003]="Nonsupport version!"}(egret||(egret={})),function(t){t.localStorage||(t.localStorage={})}(egret||(egret={})),function(t){var e,i;e=t.sys||(t.sys={}),i=[],e.$pushSoundChannel=function(t){i.indexOf(t)<0&&i.push(t)},e.$popSoundChannel=function(t){var e=i.indexOf(t);return 0<=e&&(i.splice(e,1),!0)}}(egret||(egret={})),egret||(egret={}),egret||(egret={}),egret_native||(egret_native={}),function(e){var t=function(){function t(){this.onSuccessFunc=null,this.onSuccessThisObject=null,this.onErrorFunc=null,this.onErrorThisObject=null,this.downloadingSizeFunc=null,this.downloadingSizeThisObject=null,this.onResponseHeaderFunc=null,this.onResponseHeaderThisObject=null}return t.create=function(){return t.promiseObjectList.length?t.promiseObjectList.pop():new e.PromiseObject},t.prototype.onSuccess=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onSuccessFunc&&this.onSuccessFunc.apply(this.onSuccessThisObject,t),this.destroy()},t.prototype.onError=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onErrorFunc&&this.onErrorFunc.apply(this.onErrorThisObject,t),this.destroy()},t.prototype.downloadingSize=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.downloadingSizeFunc&&this.downloadingSizeFunc.apply(this.downloadingSizeThisObject,t)},t.prototype.onResponseHeader=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onResponseHeaderFunc&&this.onResponseHeaderFunc.apply(this.onResponseHeaderThisObject,t)},t.prototype.destroy=function(){this.onSuccessFunc=void 0,this.onSuccessThisObject=void 0,this.onErrorFunc=void 0,this.onErrorThisObject=void 0,this.downloadingSizeFunc=void 0,this.downloadingSizeThisObject=void 0,this.onResponseHeaderFunc=void 0,this.onResponseHeaderThisObject=void 0,t.promiseObjectList.push(this)},t}();t.promiseObjectList=[],e.PromiseObject=t,__reflect(t.prototype,"egret.PromiseObject")}(egret||(egret={})),function(t){var e=function(){};e.GET="GET",e.POST="POST",t.HttpMethod=e,__reflect(e.prototype,"egret.HttpMethod")}(egret||(egret={})),egret||(egret={}),function(t){var e=function(){};e.TEXT="text",e.ARRAY_BUFFER="arraybuffer",t.HttpResponseType=e,__reflect(e.prototype,"egret.HttpResponseType")}(egret||(egret={})),egret||(egret={}),function(a){var $,t;$=a.sys||(a.sys={}),t=function(){function t(t){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1,this.$dirtyRegionPolicy=a.DirtyRegionPolicy.ON,this.root=t}return t.prototype.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},t.prototype.addRegion=function(t){var e=t.minX,i=t.minY,r=t.maxX,n=t.maxY;if(this.hasClipRect&&(e<0&&(e=0),i<0&&(i=0),r>this.clipWidth&&(r=this.clipWidth),n>this.clipHeight&&(n=this.clipHeight)),r<=e||n<=i)return!1;if(this.clipRectChanged)return!0;var s=this.dirtyList,o=$.Region.create();return s.push(o.setTo(e,i,r,n)),this.$dirtyRegionPolicy!=a.DirtyRegionPolicy.OFF&&this.mergeDirtyList(s),!0},t.prototype.clear=function(){for(var t=this.dirtyList,e=t.length,i=0;i<e;i++)$.Region.release(t[i]);t.length=0},t.prototype.getDirtyRegions=function(){var t=this.dirtyList;if(this.$dirtyRegionPolicy==a.DirtyRegionPolicy.OFF){this.clipRectChanged=!0,this.clear();var e=$.Region.create();if(this.hasClipRect)t.push(e.setTo(0,0,this.clipWidth,this.clipHeight));else{var i=this.root.$getOriginalBounds();t.push(e.setTo(i.x,i.y,i.width,i.height))}}else if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();e=$.Region.create();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var r=this.dirtyList.length;if(0<r)for(var n=0;n<r;n++)this.dirtyList[n].intValues();return this.dirtyList},t.prototype.mergeDirtyList=function(t){var e,i,r,n,s=t.length;if(s<2)return!1;for(var o=this.hasClipRect,a=3<s?Number.POSITIVE_INFINITY:0,h=0,l=0,c=0,u=0;u<s-1;u++){var p=t[u];o&&(c+=p.area);for(var d=u+1;d<s;d++){var f=t[d],g=(i=f,void 0,r=(e=p).minX<i.minX?e.minX:i.minX,n=e.minY<i.minY?e.minY:i.minY,((e.maxX>i.maxX?e.maxX:i.maxX)-r)*((e.maxY>i.maxY?e.maxY:i.maxY)-n)-p.area-f.area);g<a&&(h=u,l=d,a=g)}}if(o&&.95<c/this.clipArea&&(this.clipRectChanged=!0),h!=l){var y=t[l];return t[h].union(y),$.Region.release(y),t.splice(l,1),!0}return!1},t.prototype.setDirtyRegionPolicy=function(t){this.$dirtyRegionPolicy=t},t}(),$.DirtyRegion=t,__reflect(t.prototype,"egret.sys.DirtyRegion")}(egret||(egret={})),function(l){var a,t;a=l.sys||(l.sys={}),t=function(i){function t(t){var e=i.call(this)||this;return e.isStage=!1,e.$renderNode=new a.BitmapNode,e.renderBuffer=null,e.offsetX=0,e.offsetY=0,e.offsetMatrix=new l.Matrix,e.isDirty=!1,e.needUpdateRegions=!1,e.dirtyNodeList=[],e.dirtyList=null,e.sizeChanged=!1,e.$dirtyRegionPolicy=l.DirtyRegionPolicy.ON,e.root=t,e.dirtyRegion=new a.DirtyRegion(t),e.isStage=t instanceof l.Stage,e.dirtyNodes=l.createMap(),e}return __extends(t,i),t.create=function(t){var e=new l.sys.DisplayList(t);try{var i=new a.RenderBuffer;e.renderBuffer=i}catch(t){return null}return e.root=t,e},t.prototype.$getRenderNode=function(){return this.$renderNode},t.prototype.$update=function(t){var e=this.root;if(null==e)return!1;e.$removeFlagsUp(768);var i=this.$renderNode,r=e.$getConcatenatedMatrix();if(t==l.DirtyRegionPolicy.OFF){var n=e.$parentDisplayList;if(this.needUpdateRegions&&this.updateDirtyRegions(),!n)return!1;(s=i.renderMatrix).copyFrom(r),(o=n.root)!==e.$stage&&e.$getConcatenatedMatrixAt(o,s)}else{var s,o,a=e.$getOriginalBounds(),h=(n=e.$parentDisplayList,i.renderRegion);if(this.needUpdateRegions&&this.updateDirtyRegions(),!n)return h.setTo(0,0,0,0),i.moved=!1;if(!i.moved)return!1;i.moved=!1,(s=i.renderMatrix).copyFrom(r),(o=n.root)!==e.$stage&&e.$getConcatenatedMatrixAt(o,s),h.updateRegion(a,s)}return!0},t.prototype.setClipRect=function(t,e){this.dirtyRegion.setClipRect(t,e),this.renderBuffer.resize(t,e)},t.prototype.markDirty=function(t){var e=t.$hashCode;if(!this.dirtyNodes[e]&&(this.dirtyNodes[e]=!0,this.dirtyNodeList.push(t),!this.needUpdateRegions)){this.needUpdateRegions=!0,this.isDirty=!0;var i=this.root.$parentDisplayList;i&&i.markDirty(this)}},t.prototype.updateDirtyRegions=function(){var t=this.dirtyNodeList;this.dirtyNodeList=[],this.dirtyNodes=l.createMap(),this.needUpdateRegions=!1;for(var e=this.dirtyRegion,i=t.length,r=0;r<i;r++){var n=t[r],s=n.$getRenderNode();if(s)if(s.needRedraw=!1,this.isStage){0<s.renderAlpha&&s.renderVisible&&e.addRegion(s.renderRegion)&&(s.needRedraw=!0);var o=n.$update(this.$dirtyRegionPolicy);0<s.renderAlpha&&s.renderVisible&&(o||!s.needRedraw)&&e.addRegion(s.renderRegion)&&(s.needRedraw=!0)}else{e.addRegion(s.renderRegion)&&(s.needRedraw=!0),((o=n.$update(this.$dirtyRegionPolicy))||!s.needRedraw)&&e.addRegion(s.renderRegion)&&(s.needRedraw=!0)}}return this.dirtyList=e.getDirtyRegions(),this.dirtyList},t.prototype.drawToSurface=function(){var t=0,e=this.dirtyList;if(e&&0<e.length){this.isStage||this.changeSurfaceSize();var i=this.renderBuffer;if(i.beginClip(this.dirtyList,this.offsetX,this.offsetY),e=this.$dirtyRegionPolicy==l.DirtyRegionPolicy.OFF?null:this.dirtyList,t=a.systemRenderer.render(this.root,i,this.offsetMatrix,e),i.endClip(),!this.isStage){var r=i.surface,n=this.$renderNode;n.drawData.length=0;var s=r.width,o=r.height;this.bitmapData?(this.bitmapData.source=r,this.bitmapData.width=s,this.bitmapData.height=o):this.bitmapData=new l.BitmapData(r),n.image=this.bitmapData,n.imageWidth=s,n.imageHeight=o,n.drawImage(0,0,s,o,-this.offsetX,-this.offsetY,s,o)}}return this.dirtyList=null,this.dirtyRegion.clear(),this.isDirty=!1,t},t.prototype.changeSurfaceSize=function(){var t=(this.root,this.offsetX),e=this.offsetY,i=this.root.$getOriginalBounds();this.offsetX=-i.x,this.offsetY=-i.y,this.offsetMatrix.setTo(1,0,0,1,this.offsetX,this.offsetY);var r=this.renderBuffer,n=Math.max(257,i.width),s=Math.max(257,i.height);(this.offsetX!=t||this.offsetY!=e||r.surface.width!=n||r.surface.height!=s)&&(this.sizeChanged?r.resizeTo(n,s,this.offsetX-t,this.offsetY-e):(this.sizeChanged=!0,r.resize(n,s)))},t.prototype.setDirtyRegionPolicy=function(t){this.$dirtyRegionPolicy=t,this.dirtyRegion.setDirtyRegionPolicy(t),this.renderBuffer.setDirtyRegionPolicy(t)},t}(l.HashObject),a.DisplayList=t,__reflect(t.prototype,"egret.sys.DisplayList",["egret.sys.Renderable"])}(egret||(egret={})),egret||(egret={}),egret||(egret={}),function(d){!function(p){function s(t,e,i,r){if(e&&(d.log=function(){for(var t=arguments.length,e="",i=0;i<t;i++)e+=arguments[i]+" ";p.$logToFPS(e),console.log.apply(console,l(arguments))}),r?{}:r,e=!!e,this.showFPS=!!t,this.showLog=e,!this.fps){var n=void 0===r.x?0:r.x,s=void 0===r.y?0:r.y;(c=this.fps=new FPS(this.stage,t,e,i,r)).x=n,c.y=s;for(var o=u.length,a=0;a<o;a++)c.updateInfo(u[a]);u=null}}function o(t){t=!!t,this._showPaintRect!=t&&((this._showPaintRect=t)?(this.stageDisplayList||(this.stageDisplayList=p.DisplayList.create(this.stage)),this.stage.$displayList=this.stageDisplayList):this.stage.$displayList=this.screenDisplayList)}function a(t){for(var e=t.length,i=[],r=0;r<e;r++){var n=t[r];i[r]=[n.minX,n.minY,n.width,n.height],n.width-=1,n.height-=1}var s=this.paintList;s.push(i),1<s.length&&s.shift();var o=this.screenDisplayList.renderBuffer,a=o.context;a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,o.surface.width,o.surface.height),a.drawImage(this.stageDisplayList.renderBuffer.surface,0,0),e=s.length;for(r=0;r<e;r++)for(var h=(i=s[r]).length-1;0<=h;h--){var l=i[h];this.drawDirtyRect(l[0],l[1],l[2],l[3],a)}a.save(),a.beginPath(),e=t.length;for(r=0;r<e;r++){n=t[r];a.clearRect(n.minX,n.minY,n.width,n.height),a.rect(n.minX,n.minY,n.width,n.height)}a.clip(),a.drawImage(this.stageDisplayList.renderBuffer.surface,0,0),a.restore()}function h(t,e,i,r,n){n.strokeStyle="rgb(255,0,0)",n.lineWidth=5,n.strokeRect(t-.5,e-.5,i,r)}function l(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e}var t=function(n){function t(t,e,i){var r=n.call(this)||this;return r.isPlaying=!1,r.entryClassName=i,r.stage=e,r.screenDisplayList=r.createDisplayList(e,t),r.showFPS=!1,r.showLog=!1,r._showPaintRect=!1,r.stageDisplayList=null,r.paintList=[],r.displayFPS=s,r.showPaintRect=o,r.drawPaintRect=a,r.drawDirtyRect=h,r}return __extends(t,n),t.prototype.createDisplayList=function(t,e){var i=new p.DisplayList(t);return i.renderBuffer=e,t.$displayList=i},t.prototype.start=function(){!this.isPlaying&&this.stage&&(p.$TempStage=p.$TempStage||this.stage,this.isPlaying=!0,this.root||this.initialize(),p.$ticker.$addPlayer(this))},t.prototype.initialize=function(){var t;if(this.entryClassName&&(t=d.getDefinitionByName(this.entryClassName)),t){var e=new t;(this.root=e)instanceof d.DisplayObject&&this.stage.addChild(e)}},t.prototype.stop=function(){this.pause(),this.stage=null},t.prototype.pause=function(){this.isPlaying&&(this.isPlaying=!1,p.$ticker.$removePlayer(this))},t.prototype.$render=function(t,e){(this.showFPS||this.showLog)&&this.stage.addChild(this.fps);var i=this.stage,r=d.getTimer(),n=i.$displayList.updateDirtyRegions(),s=d.getTimer();n=n.concat();var o=i.$displayList.drawToSurface();this._showPaintRect&&this.drawPaintRect(n);var a=d.getTimer();if(t&&this.showFPS){var h=0;if(0<o){for(var l=n.length,c=0,u=0;u<l;u++)c+=n[u].area;h=Math.ceil(1e3*c/(i.stageWidth*i.stageHeight))/10}this.fps.update(o,h,s-r,a-s,e)}},t.prototype.updateStageSize=function(t,e){var i=this.stage;i.$stageWidth=t,i.$stageHeight=e,this.screenDisplayList.setClipRect(t,e),this.stageDisplayList&&this.stageDisplayList.setClipRect(t,e),i.dispatchEventWith(d.Event.RESIZE),i.$invalidate(!0)},t}(d.HashObject);p.Player=t,__reflect(t.prototype,"egret.sys.Player");var c,u=[];p.$logToFPS=function(t){return c?void c.updateInfo(t):void u.push(t)},FPS=function(o){function t(t,e,i,r,n){var s;o.call(this),this.isFPS=!0,this.infoLines=[],this.totalTime=0,this.totalTick=0,this.lastTime=0,this.drawCalls=0,this.dirtyRatio=0,this.costDirty=0,this.costRender=0,this.costTicker=0,this._stage=t,this.showFPS=e,this.showLog=i,this.logFilter=r,this.touchChildren=!1,this.touchEnabled=!1,this.styles=n,this.fpsDisplay=new d.FPSDisplay(t,e,i,r,n),this.addChild(this.fpsDisplay);try{s=r?new RegExp(r):null}catch(t){d.log(t)}this.filter=function(t){return s?s.test(t):!r||0==t.indexOf(r)}}return __extends(t,o),t.prototype.update=function(t,e,i,r,n){var s=d.getTimer();if(this.totalTime+=s-this.lastTime,this.lastTime=s,this.totalTick++,this.drawCalls+=t,this.dirtyRatio+=e,this.costDirty+=i,this.costRender+=r,this.costTicker+=n,1e3<=this.totalTime){var o=Math.min(Math.ceil(1e3*this.totalTick/this.totalTime),p.$ticker.$frameRate),a=Math.round(this.drawCalls/this.totalTick),h=Math.round(this.dirtyRatio/this.totalTick),l=Math.round(this.costDirty/this.totalTick),c=Math.round(this.costRender/this.totalTick),u=Math.round(this.costTicker/this.totalTick);this.fpsDisplay.update({fps:o,draw:a,dirty:h,costTicker:u,costDirty:l,costRender:c}),this.totalTick=0,this.totalTime=this.totalTime%1e3,this.drawCalls=0,this.dirtyRatio=0,this.costDirty=0,this.costRender=0,this.costTicker=0}},t.prototype.updateInfo=function(t){t&&this.showLog&&this.filter(t)&&this.fpsDisplay.updateInfo(t)},t}(d.Sprite),d.warn=function(){console.warn.apply(console,l(arguments))},d.error=function(){console.error.apply(console,l(arguments))},d.assert=function(){console.assert.apply(console,l(arguments))},d.log=function(){console.log.apply(console,l(arguments))}}(d.sys||(d.sys={}))}(egret||(egret={})),(egret||(egret={})).OrientationMode={AUTO:"auto",PORTRAIT:"portrait",LANDSCAPE:"landscape",LANDSCAPE_FLIPPED:"landscapeFlipped"},function(t){var e,i,r;e=t.sys||(t.sys={}),i=[],r=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0,this.moved=!1}return e.release=function(t){i.push(t)},e.create=function(){var t=i.pop();return t||(t=new e),t},e.prototype.setTo=function(t,e,i,r){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=r,this.updateArea(),this},e.prototype.intValues=function(){this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this.updateArea()},e.prototype.updateArea=function(){this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this.area=this.width*this.height},e.prototype.union=function(t){this.minX>t.minX&&(this.minX=t.minX),this.minY>t.minY&&(this.minY=t.minY),this.maxX<t.maxX&&(this.maxX=t.maxX),this.maxY<t.maxY&&(this.maxY=t.maxY),this.updateArea()},e.prototype.intersect=function(t){return this.minX<t.minX&&(this.minX=t.minX),this.maxX>t.maxX&&(this.maxX=t.maxX),this.minX>=this.maxX?void this.setEmpty():(this.minY<t.minY&&(this.minY=t.minY),this.maxY>t.maxY&&(this.maxY=t.maxY),this.minY>=this.maxY?void this.setEmpty():void this.updateArea())},e.prototype.setEmpty=function(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0},e.prototype.isEmpty=function(){return this.width<=0||this.height<=0},e.prototype.intersects=function(t){if(this.isEmpty())return!1;var e=this.minX>t.minX?this.minX:t.minX,i=this.maxX<t.maxX?this.maxX:t.maxX;return!(i<e)&&(e=this.minY>t.minY?this.minY:t.minY)<=(i=this.maxY<t.maxY?this.maxY:t.maxY)},e.prototype.updateRegion=function(t,e){if(0!=t.width&&0!=t.height){var i,r,n,s,o=e,a=o.a,h=o.b,l=o.c,c=o.d,u=o.tx,p=o.ty,d=t.x,f=t.y,g=d+t.width,y=f+t.height;if(1==a&&0==h&&0==l&&1==c)i=d+u-1,r=f+p-1,n=g+u+1,s=y+p+1;else{var $=a*d+l*f+u,v=h*d+c*f+p,m=a*g+l*f+u,b=h*g+c*f+p,T=a*g+l*y+u,x=h*g+c*y+p,_=a*d+l*y+u,O=h*d+c*y+p,E=0;m<$&&(E=$,$=m,m=E),_<T&&(E=T,T=_,_=E),i=($<T?$:T)-1,n=(_<m?m:_)+1,b<v&&(E=v,v=b,b=E),O<x&&(E=x,x=O,O=E),r=(v<x?v:x)-1,s=(O<b?b:O)+1}this.minX=i,this.minY=r,this.maxX=n,this.maxY=s,this.width=n-i,this.height=s-r,this.area=this.width*this.height}else this.setEmpty()},e}(),e.Region=r,__reflect(r.prototype,"egret.sys.Region")}(egret||(egret={})),function(t){t.sys||(t.sys={})}(egret||(egret={})),function(u){var t,e;t=u.sys||(u.sys={}),e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.calculateStageSize=function(t,e,i,r,n){var s=e,o=i,a=r,h=n,l=e/a||0,c=i/h||0;switch(t){case u.StageScaleMode.EXACT_FIT:break;case u.StageScaleMode.FIXED_HEIGHT:a=Math.round(e/c);break;case u.StageScaleMode.FIXED_WIDTH:h=Math.round(i/l);break;case u.StageScaleMode.NO_BORDER:c<l?o=Math.round(h*l):s=Math.round(a*c);break;case u.StageScaleMode.SHOW_ALL:c<l?s=Math.round(a*c):o=Math.round(h*l);break;case u.StageScaleMode.FIXED_NARROW:c<l?a=Math.round(e/c):h=Math.round(i/l);break;case u.StageScaleMode.FIXED_WIDE:c<l?h=Math.round(i/l):a=Math.round(e/c);break;default:a=e,h=i}return s%2!=0&&(s+=1),o%2!=0&&(o+=1),{stageWidth:a,stageHeight:h,displayWidth:s,displayHeight:o}},e}(u.HashObject),t.DefaultScreenAdapter=e,__reflect(e.prototype,"egret.sys.DefaultScreenAdapter",["egret.sys.IScreenAdapter"])}(egret||(egret={})),function(t){var e=function(){};e.NO_SCALE="noScale",e.SHOW_ALL="showAll",e.NO_BORDER="noBorder",e.EXACT_FIT="exactFit",e.FIXED_WIDTH="fixedWidth",e.FIXED_HEIGHT="fixedHeight",e.FIXED_NARROW="fixedNarrow",e.FIXED_WIDE="fixedWide",t.StageScaleMode=e,__reflect(e.prototype,"egret.StageScaleMode")}(egret||(egret={})),function(t){t.sys||(t.sys={})}(egret||(egret={})),function(p){!function(u){u.$START_TIME=0,u.$invalidateRenderFlag=!1,u.$requestRenderingFlag=!1;var t=function(){function t(){this.playerList=[],this.callBackList=[],this.thisObjectList=[],this.$frameRate=30,this.lastTimeStamp=0,this.costEnterFrame=0,u.$START_TIME=Date.now(),this.frameDeltaTime=1e3/this.$frameRate,this.lastCount=this.frameInterval=Math.round(6e4/this.$frameRate)}return t.prototype.$addPlayer=function(t){-1==this.playerList.indexOf(t)&&(this.playerList=this.playerList.concat(),this.playerList.push(t))},t.prototype.$removePlayer=function(t){var e=this.playerList.indexOf(t);-1!==e&&(this.playerList=this.playerList.concat(),this.playerList.splice(e,1))},t.prototype.$startTick=function(t,e){-1==this.getTickIndex(t,e)&&(this.concatTick(),this.callBackList.push(t),this.thisObjectList.push(e))},t.prototype.$stopTick=function(t,e){var i=this.getTickIndex(t,e);-1!=i&&(this.concatTick(),this.callBackList.splice(i,1),this.thisObjectList.splice(i,1))},t.prototype.getTickIndex=function(t,e){for(var i=this.callBackList,r=this.thisObjectList,n=i.length-1;0<=n;n--)if(i[n]==t&&r[n]==e)return n;return-1},t.prototype.concatTick=function(){this.callBackList=this.callBackList.concat(),this.thisObjectList=this.thisObjectList.concat()},t.prototype.$setFrameRate=function(t){return!((t=+t||0)<=0)&&(this.$frameRate!=t&&(60<(this.$frameRate=t)&&(t=60),p.Capabilities.runtimeType==p.RuntimeType.NATIVE&&(egret_native.setFrameRate(t),t=60),this.frameDeltaTime=1e3/t,this.lastCount=this.frameInterval=Math.round(6e4/t),!0))},t.prototype.update=function(){var t=p.getTimer(),e=this.callBackList,i=this.thisObjectList,r=e.length,n=u.$requestRenderingFlag,s=p.getTimer();this.callLaterAsyncs();for(var o=0;o<r;o++)e[o].call(i[o],s)&&(n=!0);var a=p.getTimer(),h=s-this.lastTimeStamp;if(this.lastTimeStamp=s,h>=this.frameDeltaTime)this.lastCount=this.frameInterval;else{if(this.lastCount-=1e3,0<this.lastCount)return void(n&&this.render(!1,this.costEnterFrame+a-t));this.lastCount+=this.frameInterval}this.render(!0,this.costEnterFrame+a-t);var l=p.getTimer();this.broadcastEnterFrame();var c=p.getTimer();this.costEnterFrame=c-l},t.prototype.render=function(t,e){var i=this.playerList,r=i.length;if(0!=r){this.callLaters(),u.$invalidateRenderFlag&&(this.broadcastRender(),u.$invalidateRenderFlag=!1);for(var n=0;n<r;n++)i[n].$render(t,e);u.$requestRenderingFlag=!1}},t.prototype.broadcastEnterFrame=function(){var t=p.DisplayObject.$enterFrameCallBackList,e=t.length;if(0!=e){t=t.concat();for(var i=0;i<e;i++)t[i].dispatchEventWith(p.Event.ENTER_FRAME)}},t.prototype.broadcastRender=function(){var t=p.DisplayObject.$renderCallBackList,e=t.length;if(0!=e){t=t.concat();for(var i=0;i<e;i++)t[i].dispatchEventWith(p.Event.RENDER)}},t.prototype.callLaters=function(){var t,e,i;if(0<p.$callLaterFunctionList.length&&(t=p.$callLaterFunctionList,p.$callLaterFunctionList=[],e=p.$callLaterThisList,p.$callLaterThisList=[],i=p.$callLaterArgsList,p.$callLaterArgsList=[]),t)for(var r=t.length,n=0;n<r;n++){var s=t[n];null!=s&&s.apply(e[n],i[n])}},t.prototype.callLaterAsyncs=function(){if(0<p.$callAsyncFunctionList.length){var t=p.$callAsyncFunctionList,e=p.$callAsyncThisList,i=p.$callAsyncArgsList;p.$callAsyncFunctionList=[],p.$callAsyncThisList=[],p.$callAsyncArgsList=[];for(var r=0;r<t.length;r++){var n=t[r];null!=n&&n.apply(e[r],i[r])}}},t}();u.SystemTicker=t,__reflect(t.prototype,"egret.sys.SystemTicker"),u.$ticker=new u.SystemTicker}(p.sys||(p.sys={}))}(egret||(egret={})),function(s){var t,e;t=s.sys||(s.sys={}),e=function(i){function t(t){var e=i.call(this)||this;return e.maxTouches=0,e.useTouchesCount=0,e.touchDownTarget={},e.lastTouchX=-1,e.lastTouchY=-1,e.stage=t,e}return __extends(t,i),t.prototype.$initMaxTouches=function(){this.maxTouches=this.stage.$maxTouches},t.prototype.onTouchBegin=function(t,e,i){if(!(this.useTouchesCount>=this.maxTouches)){this.lastTouchX=t,this.lastTouchY=e;var r=this.findTarget(t,e);null==this.touchDownTarget[i]&&(this.touchDownTarget[i]=r,this.useTouchesCount++),s.TouchEvent.dispatchTouchEvent(r,s.TouchEvent.TOUCH_BEGIN,!0,!0,t,e,i,!0)}},t.prototype.onTouchMove=function(t,e,i){if(null!=this.touchDownTarget[i]&&(this.lastTouchX!=t||this.lastTouchY!=e)){this.lastTouchX=t,this.lastTouchY=e;var r=this.findTarget(t,e);s.TouchEvent.dispatchTouchEvent(r,s.TouchEvent.TOUCH_MOVE,!0,!0,t,e,i,!0)}},t.prototype.onTouchEnd=function(t,e,i){if(null!=this.touchDownTarget[i]){var r=this.findTarget(t,e),n=this.touchDownTarget[i];delete this.touchDownTarget[i],this.useTouchesCount--,s.TouchEvent.dispatchTouchEvent(r,s.TouchEvent.TOUCH_END,!0,!0,t,e,i,!1),n==r?s.TouchEvent.dispatchTouchEvent(r,s.TouchEvent.TOUCH_TAP,!0,!0,t,e,i,!1):s.TouchEvent.dispatchTouchEvent(n,s.TouchEvent.TOUCH_RELEASE_OUTSIDE,!0,!0,t,e,i,!1)}},t.prototype.findTarget=function(t,e){var i=this.stage.$hitTest(t,e);return i||(i=this.stage),i},t}(s.HashObject),t.TouchHandler=e,__reflect(e.prototype,"egret.sys.TouchHandler")}(egret||(egret={})),function(I){var t,e;t=I.sys||(I.sys={}),e=function(e){function F(){var t=e.call(this)||this;return t.image=null,t.smoothing=!0,t.blendMode=null,t.alpha=NaN,t.filter=null,t.type=1,t}return __extends(F,e),F.prototype.drawImage=function(t,e,i,r,n,s,o,a){this.drawData.push(t,e,i,r,n,s,o,a),this.renderCount++},F.prototype.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this),this.image=null,this.matrix=null,this.blendMode=null,this.alpha=NaN,this.filter=null},F.$updateTextureData=function(t,e,i,r,n,s,o,a,h,l,c,u,p,d,f,g,y){if(e){var $=I.$TextureScaleFactor;if(t.smoothing=y,t.image=e,t.imageWidth=p,t.imageHeight=d,f)F.$updateTextureDataWithScale9Grid(t,f,i,r,n,s,o,a,h,l,c,u);else if(g==I.BitmapFillMode.SCALE){var v=c/h*$,m=u/l*$;t.drawImage(i,r,n,s,v*o,m*a,v*n,m*s)}else if(g==I.BitmapFillMode.CLIP){var b=Math.min(h,c),T=Math.min(l,u);F.drawClipImage(t,$,i,r,x=n*$,_=s*$,o,a,b,T)}else for(var x=n*$,_=s*$,O=0;O<c;O+=h)for(var E=0;E<u;E+=l){b=Math.min(c-O,h),T=Math.min(u-E,l);F.drawClipImage(t,$,i,r,x,_,o,a,b,T,O,E)}}},F.$updateTextureDataWithScale9Grid=function(t,e,i,r,n,s,o,a,h,l,c,u){var p=n,d=s;c-=h-n*I.$TextureScaleFactor,u-=l-s*I.$TextureScaleFactor;var f=e.x-o,g=e.y-a,y=f/I.$TextureScaleFactor,$=g/I.$TextureScaleFactor,v=e.width/I.$TextureScaleFactor,m=e.height/I.$TextureScaleFactor;0==m&&(m=1,d<=$&&$--),0==v&&(v=1,p<=y&&y--);var b=i,T=b+y,x=T+v,_=p-y-v,O=r,E=O+$,F=E+m,w=d-$-m,C=_*I.$TextureScaleFactor,R=w*I.$TextureScaleFactor;if((y+_)*I.$TextureScaleFactor>c||($+w)*I.$TextureScaleFactor>u)t.drawImage(i,r,n,s,o,a,c,u);else{var S=o,P=S+f,D=S+(c-C),L=c-f-C,N=a,M=N+g,A=N+u-R,B=u-g-R;0<$&&(0<y&&t.drawImage(b,O,y,$,S,N,f,g),0<v&&t.drawImage(T,O,v,$,P,N,L,g),0<_&&t.drawImage(x,O,_,$,D,N,C,g)),0<m&&(0<y&&t.drawImage(b,E,y,m,S,M,f,B),0<v&&t.drawImage(T,E,v,m,P,M,L,B),0<_&&t.drawImage(x,E,_,m,D,M,C,B)),0<w&&(0<y&&t.drawImage(b,F,y,w,S,A,f,R),0<v&&t.drawImage(T,F,v,w,P,A,L,R),0<_&&t.drawImage(x,F,_,w,D,A,C,R))}},F.drawClipImage=function(t,e,i,r,n,s,o,a,h,l,c,u){void 0===c&&(c=0),void 0===u&&(u=0);var p=o+n-h;0<p&&(n-=p),0<(p=a+s-l)&&(s-=p),t.drawImage(i,r,n/e,s/e,c+o,u+a,n,s)},F}(t.RenderNode),t.BitmapNode=e,__reflect(e.prototype,"egret.sys.BitmapNode")}(egret||(egret={})),function(l){var c,a,h,t;c=l.sys||(l.sys={}),a=["none","round","square"],h=["bevel","miter","round"],t=function(e){function t(){var t=e.call(this)||this;return t.dirtyRender=!0,t.type=3,t}return __extends(t,e),t.prototype.beginFill=function(t,e,i){void 0===e&&(e=1);var r=new c.FillPath;if(r.fillColor=t,r.fillAlpha=e,i){var n=this.drawData.lastIndexOf(i);this.drawData.splice(n,0,r)}else this.drawData.push(r);return r},t.prototype.beginGradientFill=function(t,e,i,r,n,s){var o=new l.Matrix;n?(o.a=819.2*n.a,o.b=819.2*n.b,o.c=819.2*n.c,o.d=819.2*n.d,o.tx=n.tx,o.ty=n.ty):(o.a=100,o.d=100);var a=new c.GradientFillPath;if(a.gradientType=t,a.colors=e,a.alphas=i,a.ratios=r,a.matrix=o,s){var h=this.drawData.lastIndexOf(s);this.drawData.splice(h,0,a)}else this.drawData.push(a);return a},t.prototype.lineStyle=function(t,e,i,r,n,s){void 0===i&&(i=1),void 0===s&&(s=3),-1==a.indexOf(r)&&(r="round"),-1==h.indexOf(n)&&(n="round");var o=new c.StrokePath;return o.lineWidth=t,o.lineColor=e,o.lineAlpha=i,o.caps=r||l.CapsStyle.ROUND,o.joints=n,o.miterLimit=s,this.drawData.push(o),o},t.prototype.clear=function(){this.drawData.length=0,this.dirtyRender=!0},t.prototype.cleanBeforeRender=function(){},t.prototype.clean=function(){this.$texture&&(l.WebGLUtils.deleteWebGLTexture(this.$texture),this.$texture=null,this.dirtyRender=!0)},t}(c.RenderNode),c.GraphicsNode=t,__reflect(t.prototype,"egret.sys.GraphicsNode")}(egret||(egret={})),function(t){var e,i;e=t.sys||(t.sys={}),i=function(e){function t(){var t=e.call(this)||this;return t.type=4,t}return __extends(t,e),t.prototype.addNode=function(t){this.drawData.push(t)},t.prototype.cleanBeforeRender=function(){for(var t=this.drawData,e=t.length-1;0<=e;e--)t[e].cleanBeforeRender()},t.prototype.$getRenderCount=function(){for(var t=0,e=this.drawData,i=e.length-1;0<=i;i--)t+=e[i].$getRenderCount();return t},t}(e.RenderNode),e.GroupNode=i,__reflect(i.prototype,"egret.sys.GroupNode")}(egret||(egret={})),function(i){var t,e;t=i.sys||(i.sys={}),e=function(e){function t(){var t=e.call(this)||this;return t.image=null,t.smoothing=!0,t.bounds=new i.Rectangle,t.type=7,t.vertices=[],t.uvs=[],t.indices=[],t}return __extends(t,e),t.prototype.drawMesh=function(t,e,i,r,n,s,o,a){this.drawData.push(t,e,i,r,n,s,o,a),this.renderCount++},t.prototype.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this),this.image=null,this.matrix=null},t}(t.RenderNode),t.MeshNode=e,__reflect(e.prototype,"egret.sys.MeshNode")}(egret||(egret={})),function(h){var t=function(i){function t(){var t=i.call(this)||this;t.$renderBuffer=new h.sys.RenderBuffer;var e=new h.BitmapData(t.$renderBuffer.surface);return e.$deleteSource=!1,t._setBitmapData(e),t}return __extends(t,i),t.prototype.drawToTexture=function(t,e,i){if(void 0===i&&(i=1),e&&(0==e.width||0==e.height))return!1;var r=e||t.$getOriginalBounds();if(0==r.width||0==r.height)return!1;i/=h.$TextureScaleFactor;var n=(r.x+r.width)*i,s=(r.y+r.height)*i;e&&(n=r.width*i,s=r.height*i);var o=this.$renderBuffer;if(!o)return!1;o.resize(n,s),this._bitmapData.width=n,this._bitmapData.height=s;var a=h.Matrix.create();return a.identity(),e&&a.translate(-e.x,-e.y),a.scale(i,i),h.sys.systemRenderer.render(t,o,a,null,!0),h.Matrix.release(a),this.$initData(0,0,n,s,0,0,n,s,n,s),!0},t.prototype.getPixel32=function(t,e){var i;if(this.$renderBuffer){var r=h.$TextureScaleFactor;t=Math.round(t/r),e=Math.round(e/r),i=this.$renderBuffer.getPixels(t,e,1,1)}return i},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.$renderBuffer=null},t}(h.Texture);h.RenderTexture=t,__reflect(t.prototype,"egret.RenderTexture")}(egret||(egret={})),function(t){var e,i;e=t.sys||(t.sys={}),i=function(e){function t(){var t=e.call(this)||this;return t.type=6,t}return __extends(t,e),t.prototype.setAlpha=function(t){0!=this.drawData.length&&(this.drawData.length=0),this.drawData.push(t),this.renderCount++},t}(e.RenderNode),e.SetAlphaNode=i,__reflect(i.prototype,"egret.sys.SetAlphaNode")}(egret||(egret={})),function(i){var t,e;t=i.sys||(i.sys={}),e=function(e){function t(){var t=e.call(this)||this;return t.textColor=16777215,t.strokeColor=0,t.size=30,t.stroke=0,t.bold=!1,t.italic=!1,t.fontFamily="Arial",t.dirtyRender=!0,t.type=2,t}return __extends(t,e),t.prototype.drawText=function(t,e,i,r){this.drawData.push(t,e,i,r),this.renderCount++,this.dirtyRender=!0},t.prototype.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this)},t.prototype.clean=function(){this.$texture&&(i.WebGLUtils.deleteWebGLTexture(this.$texture),this.$texture=null,this.dirtyRender=!0)},t}(t.RenderNode),t.TextNode=e,__reflect(e.prototype,"egret.sys.TextNode")}(egret||(egret={})),function(t){var e,i;e=t.sys||(t.sys={}),i=function(e){function t(){var t=e.call(this)||this;return t.type=1,t}return __extends(t,e),t}(e.Path2D),e.FillPath=i,__reflect(i.prototype,"egret.sys.FillPath")}(egret||(egret={})),function(t){var e,i;e=t.sys||(t.sys={}),i=function(e){function t(){var t=e.call(this)||this;return t.type=2,t}return __extends(t,e),t}(e.Path2D),e.GradientFillPath=i,__reflect(i.prototype,"egret.sys.GradientFillPath")}(egret||(egret={})),function(e){var t=function(r){function t(){var t=r.call(this)||this;return t.$graphics=new e.Graphics,t.$graphics.$setTarget(t),t}return __extends(t,r),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.$graphics},enumerable:!0,configurable:!0}),t.prototype.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},t.prototype.$hitTest=function(t,e){var i=r.prototype.$hitTest.call(this,t,e);return i==this&&(i=this.$graphics.$hitTest(t,e)),i},t.prototype.$onRemoveFromStage=function(){r.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},t}(e.DisplayObject);e.Shape=t,__reflect(t.prototype,"egret.Shape")}(egret||(egret={})),function(t){var e,i;e=t.sys||(t.sys={}),i=function(e){function t(){var t=e.call(this)||this;return t.type=3,t}return __extends(t,e),t}(e.Path2D),e.StrokePath=i,__reflect(i.prototype,"egret.sys.StrokePath")}(egret||(egret={})),function(L){function d(t,e){return"rgba("+(t>>16)+","+(t>>8&255)+","+(255&t)+","+e+")"}function f(t,e,i,r,n,s){var o;o=e==L.GradientType.LINEAR?t.createLinearGradient(-1,0,1,0):t.createRadialGradient(0,0,0,0,0,1);for(var a=i.length,h=0;h<a;h++)o.addColorStop(n[h]/255,d(i[h],r[h]));return o}function z(t,e,i){void 0===i&&(i=0);for(var r=0,n=e.length;r<n;r++)t[r+i]=e[r]}function N(t,e,i,r){for(var n=r[0],s=r[1],o=r[2],a=r[3],h=r[4],l=r[5],c=r[6],u=r[7],p=r[8],d=r[9],f=r[10],g=r[11],y=r[12],$=r[13],v=r[14],m=r[15],b=r[16],T=r[17],x=r[18],_=r[19],O=0,E=e*i*4;O<E;O+=4){var F=t[O+0],w=t[O+1],C=t[O+2],R=t[O+3];t[O+0]=n*F+s*w+o*C+a*R+h,t[O+1]=l*F+c*w+u*C+p*R+d,t[O+2]=f*F+g*w+y*C+$*R+v,t[O+3]=m*F+b*w+T*C+x*R+_}}function M(t,e,i,r,n){(function(t,e,i,r){var n;n=q?new Uint8ClampedArray(4*e):new Array(4*e);for(var s=4*e,o=2*r+1,a=0;a<i;a++){for(var h=a*s,l=0,c=0,u=0,p=0,d=0,f=0,g=4*-r,y=4*r+4;g<y;g+=4){var $=h+g;$<h||h+s<=$||(d=t[$+3],l+=t[$+0]*d,c+=t[$+1]*d,u+=t[$+2]*d,p+=d)}for(var g=h,y=h+s,v=0,m=g-4*r,b=g+4*(r+1);g<y;g+=4,v+=4,b+=4,m+=4)0===p?(n[v+0]=0,n[v+1]=0,n[v+2]=0,n[v+3]=0):(n[v+0]=l/p,n[v+1]=c/p,n[v+2]=u/p,n[v+3]=p/o),d=t[b+3],f=t[m+3],d||0==d?f||0==f?(l+=t[b+0]*d-t[m+0]*f,c+=t[b+1]*d-t[m+1]*f,u+=t[b+2]*d-t[m+2]*f,p+=d-f):(l+=t[b+0]*d,c+=t[b+1]*d,u+=t[b+2]*d,p+=d):(f||0==f)&&(l+=-t[m+0]*f,c+=-t[m+1]*f,u+=-t[m+2]*f,p+=-f);q?t.set(n,h):z(t,n,h)}})(t,e,i,r),function(t,e,i,r){var n;n=q?new Uint8ClampedArray(4*i):new Array(4*i);for(var s=4*e,o=2*r+1,a=0;a<e;a++){for(var h=4*a,l=0,c=0,u=0,p=0,d=0,f=0,g=-r*s,y=r*s+s;g<y;g+=s){var $=h+g;$<h||h+i*s<=$||(d=t[$+3],l+=t[$+0]*d,c+=t[$+1]*d,u+=t[$+2]*d,p+=d)}for(var g=h,y=h+i*s,v=0,m=h-r*s,b=h+(r+1)*s;g<y;g+=s,v+=4,b+=s,m+=s)0===p?(n[v+0]=0,n[v+1]=0,n[v+2]=0,n[v+3]=0):(n[v+0]=l/p,n[v+1]=c/p,n[v+2]=u/p,n[v+3]=p/o),d=t[b+3],f=t[m+3],d||0==d?f||0==f?(l+=t[b+0]*d-t[m+0]*f,c+=t[b+1]*d-t[m+1]*f,u+=t[b+2]*d-t[m+2]*f,p+=d-f):(l+=t[b+0]*d,c+=t[b+1]*d,u+=t[b+2]*d,p+=d):(f||0==f)&&(l+=-t[m+0]*f,c+=-t[m+1]*f,u+=-t[m+2]*f,p+=-f);for(var T=4*a,y=T+i*s,x=0;T<y;T+=s,x+=4)t[T+0]=n[x+0],t[T+1]=n[x+1],t[T+2]=n[x+2],t[T+3]=n[x+3]}}(t,e,i,n)}function A(t,e,i,r,n,s,o,a,h){var l=function(t,e){var i;e||(e=[0,0,0,0]),q?i=new Uint8ClampedArray(t):z(i=new Array(t.length),t);for(var r=0,n=i.length;r<n;r+=4){var s=i[r+3];i[r+0]=e[0]*s,i[r+1]=e[1]*s,i[r+2]=e[2]*s}return i}(t,r);(function(t,e,i,r,n){var s,o,a=Math.sin(r)*n|0,h=Math.cos(r)*n|0;if(q){s=new Int32Array(t.buffer),o=new Int32Array(s.length);for(var l=0;l<i;l++){var c=l+a;if(!(c<0||i<c))for(var u=0;u<e;u++){var p=u+h;p<0||e<p||(o[c*e+p]=s[l*e+u])}}s.set(o)}else{s=t,o=new Array(s.length);for(var l=0;l<i;l++){var c=l+a;if(!(c<0||i<c))for(var u=0;u<e;u++){var p=u+h;p<0||e<p||(o[4*(c*e+p)+0]=s[4*(l*e+u)+0],o[4*(c*e+p)+1]=s[4*(l*e+u)+1],o[4*(c*e+p)+2]=s[4*(l*e+u)+2],o[4*(c*e+p)+3]=s[4*(l*e+u)+3])}}z(s,o)}})(l,e,i,o,a),M(l,e,i,n,s),function(t,e){for(var i=0,r=t.length;i<r;i+=4)t[i+3]*=e}(l,h),function(t,e){for(var i=0,r=t.length;i<r;i+=4){var n=t[i+0],s=t[i+1],o=t[i+2],a=t[i+3]/255,h=e[i+0],l=e[i+1],c=e[i+2],u=e[i+3]/255;t[i+0]=h+n*(1-u),t[i+1]=l+s*(1-u),t[i+2]=c+o*(1-u),t[i+3]=255*(u+a*(1-u))}}(l,t),t.set(l),q?t.set(l):z(t,l)}function Z(t,e,i){return t*(1-i)+e*i}function B(t,e,i,r,n,s,o,a,h,l,c,u){var p;p=q?new Uint8ClampedArray(t.length):new Array(t.length);for(var d,f,g=r[3],y=0,$=0,v=a*Math.cos(o),m=a*Math.sin(o),b=3.141592653589793,T=n/7,x=s/7,_=0;_<e;_++)for(var O=0;O<i;O++){for(var E=O*e*4+4*_,F=0,w=0,C=t[E+0]/255,R=t[E+1]/255,S=t[E+2]/255,P=t[E+3]/255,D=0;D<=2*b;D+=2*b/12){d=Math.cos(D+0),f=Math.sin(D+0);for(var L=0;L<7;L++){y=L*T*d,$=L*x*f;var N=Math.round(_+y-v),M=Math.round(O+$-m),A=0;if(e<=N||N<0||M<0||i<=M)A=0;else A=t[M*e*4+4*N+3]/255;F+=(7-L)*A,w+=7-L}}P=Math.max(P,1e-4);var B=F/w*h*g*(1-l)*Math.max(Math.min(u,c),1-P),I=(w-F)/w*h*g*l*P,j=I/(I+(P=Math.max(P*c*(1-u),1e-4))),k=Z(C,r[0],j),U=Z(R,r[1],j),X=Z(S,r[2],j),Y=B/(I+P+B),H=Z(k,r[0],Y),W=Z(U,r[1],Y),G=Z(X,r[2],Y),V=Math.min(P+B+I,1);p[E+0]=255*H,p[E+1]=255*W,p[E+2]=255*G,p[E+3]=255*V}q?t.set(p):z(t,p)}var I=["source-over","lighter","destination-out"],j="source-over",g="#000000",y={none:"butt",square:"square",round:"round"},k=[],t=function(){function t(){this.nestLevel=0,this.renderingMask=!1}return t.prototype.render=function(t,e,i,r,n){this.nestLevel++;var s=e.context,o=n?t:null,a=this.drawDisplayObject(t,s,r,i,null,null,o);if(this.nestLevel--,0===this.nestLevel){6<k.length&&(k.length=6);for(var h=k.length,l=0;l<h;l++)k[l].resize(0,0)}return a},t.prototype.drawDisplayObject=function(t,e,i,r,n,s,o){var a,h=0;if(n&&!o?(n.isDirty&&(h+=n.drawToSurface()),a=n.$renderNode):a=t.$getRenderNode(),a){if(i){var l=a.renderRegion;if(s&&!s.intersects(l))a.needRedraw=!1;else if(!a.needRedraw)for(var c=i.length,u=0;u<c;u++)if(l.intersects(i[u])){a.needRedraw=!0;break}}else a.needRedraw=!0;if(a.needRedraw){var p=void 0,d=void 0;o?(p=t.$getConcatenatedAlphaAt(o,t.$getConcatenatedAlpha()),d=L.Matrix.create().copyFrom(t.$getConcatenatedMatrix()),t.$getConcatenatedMatrixAt(o,d),r.$preMultiplyInto(d,d),e.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty),L.Matrix.release(d)):(p=a.renderAlpha,d=a.renderMatrix,e.setTransform(d.a,d.b,d.c,d.d,d.tx+r.tx,d.ty+r.ty)),e.globalAlpha=p,h+=this.renderNode(a,e),a.needRedraw=!1}}if(n&&!o)return h;var f=t.$children;if(f)for(var g=f.length,y=0;y<g;y++){var $=f[y];if(!(!$.$visible||$.$alpha<=0||$.$maskedObject)){var v=$.$getFilters();v&&0<v.length?h+=this.drawWithFilter($,e,i,r,s,o):0!==$.$blendMode||$.$mask&&($.$mask.$parentDisplayList||o)?h+=this.drawWithClip($,e,i,r,s,o):$.$scrollRect||$.$maskRect?h+=this.drawWithScrollRect($,e,i,r,s,o):$.isFPS?this.drawDisplayObject($,e,i,r,$.$displayList,s,o):h+=this.drawDisplayObject($,e,i,r,$.$displayList,s,o)}}return h},t.prototype.drawWithFilter=function(t,e,i,r,n,s){if(L.Capabilities.runtimeType==L.RuntimeType.NATIVE){var o,a=0,h=t.$getFilters(),l=0!==t.$blendMode;if(l&&((o=I[t.$blendMode])||(o=j)),1==h.length&&"colorTransform"==h[0].type&&!t.$children)return l&&(e.globalCompositeOperation=o),e.setGlobalShader(h[0]),a+=t.$mask&&(t.$mask.$parentDisplayList||s)?this.drawWithClip(t,e,i,r,n,s):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,e,i,r,n,s):this.drawDisplayObject(t,e,i,r,t.$displayList,n,s),e.setGlobalShader(null),l&&(e.globalCompositeOperation=j),a;var c,u=L.Matrix.create();u.copyFrom(t.$getConcatenatedMatrix()),s&&t.$getConcatenatedMatrixAt(s,u),c=L.sys.Region.create();var p=t.$getOriginalBounds();c.updateRegion(p,u);var d=this.createRenderBuffer(c.width,c.height);d.context.setTransform(1,0,0,1,-c.minX,-c.minY);var f=L.Matrix.create().setTo(1,0,0,1,-c.minX,-c.minY);return a+=t.$mask&&(t.$mask.$parentDisplayList||s)?this.drawWithClip(t,d.context,i,f,c,s):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,d.context,i,f,c,s):this.drawDisplayObject(t,d.context,i,f,t.$displayList,c,s),L.Matrix.release(f),0<a&&(l&&(e.globalCompositeOperation=o),a++,e.globalAlpha=1,e.setTransform(1,0,0,1,c.minX+r.tx,c.minY+r.ty),e.setGlobalShader(h[0]),e.drawImage(d.surface,0,0,d.width,d.height,0,0,d.width,d.height),e.setGlobalShader(null),l&&(e.globalCompositeOperation=j)),k.push(d),L.sys.Region.release(c),L.Matrix.release(u),a}var g,y=0,$=t.$getFilters(),v=$.length,m=0!==t.$blendMode;m&&((g=I[t.$blendMode])||(g=j));var b,T=L.Matrix.create();T.copyFrom(t.$getConcatenatedMatrix()),s&&t.$getConcatenatedMatrixAt(s,T),b=L.sys.Region.create();var x=t.$getOriginalBounds();b.updateRegion(x,T);var _=this.createRenderBuffer(b.width,b.height),O=_.context;O.setTransform(1,0,0,1,-b.minX,-b.minY);var E=L.Matrix.create().setTo(1,0,0,1,-b.minX,-b.minY);if(y+=t.$mask&&(t.$mask.$parentDisplayList||s)?this.drawWithClip(t,O,i,E,b,s):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,O,i,E,b,s):this.drawDisplayObject(t,O,i,E,t.$displayList,b,s),L.Matrix.release(E),0<y){m&&(e.globalCompositeOperation=g),y++,e.globalAlpha=1,e.setTransform(1,0,0,1,b.minX+r.tx,b.minY+r.ty);for(var F=O.getImageData(0,0,_.surface.width,_.surface.height),w=0;w<v;w++){var C=$[w];if("colorTransform"==C.type)N(F.data,_.surface.width,_.surface.height,C.$matrix);else if("blur"==C.type)M(F.data,_.surface.width,_.surface.height,C.$blurX,C.$blurY);else if("glow"==C.type){var R=C.$red,S=C.$green,P=C.$blue,D=C.$alpha;C.$inner||C.$knockout||C.$hideObject?B(F.data,_.surface.width,_.surface.height,[R/255,S/255,P/255,D],C.$blurX,C.$blurY,C.$angle?C.$angle/180*Math.PI:0,C.$distance||0,C.$strength,C.$inner?1:0,C.$knockout?0:1,C.$hideObject?1:0):A(F.data,_.surface.width,_.surface.height,[R/255,S/255,P/255,D/255],C.$blurX,C.$blurY,C.$angle?C.$angle/180*Math.PI:0,C.$distance||0,C.$strength)}}O.putImageData(F,0,0),e.drawImage(_.surface,0,0),m&&(e.globalCompositeOperation=j)}return k.push(_),L.sys.Region.release(b),L.Matrix.release(T),y},t.prototype.drawWithClip=function(t,e,i,r,n,s){var o,a=0,h=0!==t.$blendMode;h&&((o=I[t.$blendMode])||(o=j));var l,c=t.$scrollRect?t.$scrollRect:t.$maskRect,u=t.$mask;if(u&&(l=u.$getRenderNode())){var p=l.renderMatrix;if(0==p.a&&0==p.b||0==p.c&&0==p.d)return a}var d,f,g,y=L.Matrix.create();if(y.copyFrom(t.$getConcatenatedMatrix()),t.$parentDisplayList){var $=t.$parentDisplayList.root;$!==t.$stage&&t.$getConcatenatedMatrixAt($,y)}u&&(f=u.$getOriginalBounds(),d=L.sys.Region.create(),(T=L.Matrix.create()).copyFrom(u.$getConcatenatedMatrix()),d.updateRegion(f,T),L.Matrix.release(T));if(c&&(g=L.sys.Region.create()).updateRegion(c,y),g&&d?(g.intersect(d),L.sys.Region.release(d)):!g&&d&&(g=d),g){if(g.isEmpty()||n&&!n.intersects(g))return L.sys.Region.release(g),L.Matrix.release(y),a}else g=L.sys.Region.create(),f=t.$getOriginalBounds(),g.updateRegion(f,y);var v=!1;if(i){for(var m=i.length,b=0;b<m;b++)if(g.intersects(i[b])){v=!0;break}}else v=!0;if(!v)return L.sys.Region.release(g),L.Matrix.release(y),a;if(!(u||t.$children&&0!=t.$children.length)){if(c){var T=y;e.save(),e.setTransform(T.a,T.b,T.c,T.d,T.tx-g.minX,T.ty-g.minY),e.beginPath(),e.rect(c.x,c.y,c.width,c.height),e.clip()}return h&&(e.globalCompositeOperation=o),a+=this.drawDisplayObject(t,e,i,r,t.$displayList,n,s),h&&(e.globalCompositeOperation=j),c&&e.restore(),a}if(u&&L.Capabilities.$runtimeType==L.RuntimeType.WEB&&(!u.$children||0==u.$children.length)&&l&&3==l.type&&1==l.drawData.length&&1==l.drawData[0].type&&1==l.drawData[0].fillAlpha){this.renderingMask=!0,e.save();var x=this.drawDisplayObject(u,e,i,r,u.$displayList,n,s);if(this.renderingMask=!1,c){T=y;e.setTransform(T.a,T.b,T.c,T.d,T.tx-g.minX,T.ty-g.minY),e.beginPath(),e.rect(c.x,c.y,c.width,c.height),e.clip()}return x+=this.drawDisplayObject(t,e,i,r,t.$displayList,n,s),e.restore(),x}var _=this.createRenderBuffer(g.width,g.height),O=_.context;if(!O)return a+=this.drawDisplayObject(t,e,i,r,t.$displayList,n,s),L.sys.Region.release(g),L.Matrix.release(y),a;O.setTransform(1,0,0,1,-g.minX,-g.minY);var E=L.Matrix.create().setTo(1,0,0,1,-g.minX,-g.minY);if(a+=this.drawDisplayObject(t,O,i,E,t.$displayList,g,s),u)if(L.Capabilities.$runtimeType==L.RuntimeType.WEB&&l&&1==l.$getRenderCount()||u.$displayList)O.globalCompositeOperation="destination-in",a+=this.drawDisplayObject(u,O,i,E,u.$displayList,g,s);else{var F=this.createRenderBuffer(g.width,g.height),w=F.context;if(!w)return a+=this.drawDisplayObject(t,e,i,r,t.$displayList,n,s),k.push(_),L.sys.Region.release(g),L.Matrix.release(y),a;w.setTransform(1,0,0,1,-g.minX,-g.minY),E=L.Matrix.create().setTo(1,0,0,1,-g.minX,-g.minY),a+=this.drawDisplayObject(u,w,i,E,u.$displayList,g,s),O.globalCompositeOperation="destination-in",O.setTransform(1,0,0,1,0,0),O.globalAlpha=1,O.drawImage(F.surface,0,0),k.push(F)}if(L.Matrix.release(E),0<a){if(a++,h&&(e.globalCompositeOperation=o),c){T=y;e.save(),e.setTransform(T.a,T.b,T.c,T.d,T.tx-g.minX,T.ty-g.minY),e.beginPath(),e.rect(c.x,c.y,c.width,c.height),e.clip()}e.globalAlpha=1,e.setTransform(1,0,0,1,g.minX+r.tx,g.minY+r.ty),e.drawImage(_.surface,0,0),c&&e.restore(),h&&(e.globalCompositeOperation=j)}return k.push(_),L.sys.Region.release(g),L.Matrix.release(y),a},t.prototype.drawWithScrollRect=function(t,e,i,r,n,s){var o=0,a=t.$scrollRect?t.$scrollRect:t.$maskRect;if(a.isEmpty())return o;var h=L.Matrix.create();if(h.copyFrom(t.$getConcatenatedMatrix()),s)t.$getConcatenatedMatrixAt(s,h);else if(t.$parentDisplayList){var l=t.$parentDisplayList.root;l!==t.$stage&&t.$getConcatenatedMatrixAt(l,h)}var c=L.sys.Region.create();if(c.updateRegion(a,h),c.isEmpty()||n&&!n.intersects(c))return L.sys.Region.release(c),L.Matrix.release(h),o;var u=!1;if(i){for(var p=i.length,d=0;d<p;d++)if(c.intersects(i[d])){u=!0;break}}else u=!0;return u&&(e.save(),e.setTransform(h.a,h.b,h.c,h.d,h.tx+r.tx,h.ty+r.ty),e.beginPath(),e.rect(a.x,a.y,a.width,a.height),e.clip(),o+=this.drawDisplayObject(t,e,i,r,t.$displayList,c,s),e.restore()),L.sys.Region.release(c),L.Matrix.release(h),o},t.prototype.drawNodeToBuffer=function(t,e,i,r){var n=e.context;n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(t,n,r)},t.prototype.renderNode=function(t,e,i){var r=0;switch(t.type){case 1:r=this.renderBitmap(t,e);break;case 2:r=1,this.renderText(t,e);break;case 3:r=this.renderGraphics(t,e,i);break;case 4:r=this.renderGroup(t,e);break;case 6:e.globalAlpha=t.drawData[0];break;case 7:r=this.renderMesh(t,e)}return r},t.prototype.renderMesh=function(t,e){if(L.Capabilities.runtimeType!=L.RuntimeType.NATIVE)return 0;var i=t.image,r=t.drawData,n=r.length,s=0,o=t.matrix;for(o&&(e.saveTransform(),e.transform(o.a,o.b,o.c,o.d,o.tx,o.ty));s<n;)e.drawMesh(i.source,r[s++],r[s++],r[s++],r[s++],r[s++],r[s++],r[s++],r[s++],t.imageWidth,t.imageHeight,t.uvs,t.vertices,t.indices,t.bounds);return o&&e.restoreTransform(),1},t.prototype.renderBitmap=function(t,e){var i=t.image;if(!i||!i.source)return 0;e.$imageSmoothingEnabled!=t.smoothing&&(e.imageSmoothingEnabled=t.smoothing,e.$imageSmoothingEnabled=t.smoothing);var r,n=t.drawData,s=n.length,o=0,a=t.matrix,h=t.blendMode,l=t.alpha,c=!1;a&&(e.saveTransform?e.saveTransform():e.save(),c=!0,e.transform(a.a,a.b,a.c,a.d,a.tx,a.ty)),h&&(e.globalCompositeOperation=I[h]),l==l&&(r=e.globalAlpha,e.globalAlpha*=l);var u=0,p=t.filter;if(p&&8==s)if(L.Capabilities.runtimeType==L.RuntimeType.NATIVE){for(egret_native.Graphics.setGlobalShader(p);o<s;)u++,e.drawImage(i.source,n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++]);egret_native.Graphics.setGlobalShader(null)}else{var d=this.createRenderBuffer(n[6],n[7]),f=d.context;u++,f.drawImage(i.source,n[0],n[1],n[2],n[3],0,0,n[6],n[7]),u++;var g=f.getImageData(0,0,d.surface.width,d.surface.height);N(g.data,d.surface.width,d.surface.height,p.$matrix),f.putImageData(g,0,0),e.drawImage(d.surface,0,0,n[6],n[7],n[4],n[5],n[6],n[7]),k.push(d)}else for(;o<s;)u++,e.drawImage(i.source,n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++]);return c?e.restoreTransform?(e.restoreTransform(),h&&(e.globalCompositeOperation=j),l==l&&(e.globalAlpha=r)):e.restore():(h&&(e.globalCompositeOperation=j),l==l&&(e.globalAlpha=r)),u},t.prototype.renderText=function(t,e){e.textAlign="left",e.textBaseline="middle",e.lineJoin="round";for(var i=t.drawData,r=i.length,n=0;n<r;){var s=i[n++],o=i[n++],a=i[n++],h=i[n++];e.font=(p=t,f=void 0,f=(null==(d=h).italic?p.italic:d.italic)?"italic ":"normal ",(f+=(null==d.bold?p.bold:d.bold)?"bold ":"normal ")+(null==d.size?p.size:d.size)+"px "+(d.fontFamily||p.fontFamily));var l=null==h.textColor?t.textColor:h.textColor,c=null==h.strokeColor?t.strokeColor:h.strokeColor,u=null==h.stroke?t.stroke:h.stroke;e.fillStyle=L.toColorString(l),e.strokeStyle=L.toColorString(c),u&&(e.lineWidth=2*u,e.strokeText(a,s,o)),e.fillText(a,s,o)}var p,d,f},t.prototype.renderGraphics=function(t,e,i){var r=t.drawData,n=r.length;i=!!i;for(var s=0;s<n;s++){var o=r[s];switch(o.type){case 1:var a=o;e.fillStyle=i?g:d(a.fillColor,a.fillAlpha),this.renderPath(o,e),this.renderingMask?e.clip():e.fill();break;case 2:var h=o;e.fillStyle=i?g:f(e,h.gradientType,h.colors,h.alphas,h.ratios,h.matrix),e.save();var l=h.matrix;this.renderPath(o,e),e.transform(l.a,l.b,l.c,l.d,l.tx,l.ty),e.fill(),e.restore();break;case 3:var c=o,u=c.lineWidth;e.lineWidth=u,e.strokeStyle=i?g:d(c.lineColor,c.lineAlpha),e.lineCap=y[c.caps],e.lineJoin=c.joints,e.miterLimit=c.miterLimit;var p=1===u||3===u;p&&e.translate(.5,.5),this.renderPath(o,e),e.stroke(),p&&e.translate(-.5,-.5)}}return 0==n?0:1},t.prototype.renderPath=function(t,e){e.beginPath();for(var i=t.$data,r=t.$commands,n=r.length,s=0,o=0;o<n;o++){switch(r[o]){case 4:e.bezierCurveTo(i[s++],i[s++],i[s++],i[s++],i[s++],i[s++]);break;case 3:e.quadraticCurveTo(i[s++],i[s++],i[s++],i[s++]);break;case 2:e.lineTo(i[s++],i[s++]);break;case 1:e.moveTo(i[s++],i[s++])}}},t.prototype.renderGroup=function(t,e){var i=t.matrix,r=!1;i&&(e.saveTransform?e.saveTransform():e.save(),r=!0,e.transform(i.a,i.b,i.c,i.d,i.tx,i.ty));for(var n=0,s=t.drawData,o=s.length,a=0;a<o;a++){var h=s[a];n+=this.renderNode(h,e)}return r&&(e.restoreTransform?e.restoreTransform():e.restore()),n},t.prototype.createRenderBuffer=function(t,e){var i=k.pop();return i?i.resize(t,e,!0):i=new L.sys.CanvasRenderBuffer(t,e),i},t}();L.CanvasRenderer=t,__reflect(t.prototype,"egret.CanvasRenderer",["egret.sys.SystemRenderer"]);var q=!1;try{q=void 0!==typeof Uint8ClampedArray}catch(t){}}(egret||(egret={})),(egret||(egret={})).DeviceOrientation=null,egret||(egret={}),egret||(egret={}),function(t){var e=function(){};e.WEB="web",e.NATIVE="native",t.RuntimeType=e,__reflect(e.prototype,"egret.RuntimeType");var i=function(){function n(){}return Object.defineProperty(n,"language",{get:function(){return n.$language},enumerable:!0,configurable:!0}),Object.defineProperty(n,"isMobile",{get:function(){return n.$isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(n,"os",{get:function(){return n.$os},enumerable:!0,configurable:!0}),Object.defineProperty(n,"runtimeType",{get:function(){return n.$runtimeType},enumerable:!0,configurable:!0}),Object.defineProperty(n,"supportVersion",{get:function(){return n.$supportVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n,"engineVersion",{get:function(){return"4.0.0"},enumerable:!0,configurable:!0}),n.$setNativeCapabilities=function(t){var e=t.split("-");if(e.length<=4){var i=e[0];switch(i){case"android":i="Android";break;case"ios":i="iOS"}n.$os=i;var r=e[2].substring(1,e[2].length);n.$supportVersion=r}},Object.defineProperty(n,"renderMode",{get:function(){return n.$renderMode},enumerable:!0,configurable:!0}),Object.defineProperty(n,"boundingClientWidth",{get:function(){return n.$boundingClientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n,"boundingClientHeight",{get:function(){return n.$boundingClientHeight},enumerable:!0,configurable:!0}),n}();i.$language="zh-CN",i.$os="Unknown",i.$runtimeType="Unknown",i.$supportVersion="Unknown",i.$renderMode="Unknown",i.$boundingClientWidth=0,i.$boundingClientHeight=0,t.Capabilities=i,__reflect(i.prototype,"egret.Capabilities")}(egret||(egret={}));var testDeviceType=function(){if(!this.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")},testRuntimeType=function(){return!!this.navigator};egret.Capabilities.$isMobile=testDeviceType(),egret.Capabilities.$runtimeType=testRuntimeType()?egret.RuntimeType.WEB:egret.RuntimeType.NATIVE,(egret||(egret={})).BitmapFillMode={REPEAT:"repeat",SCALE:"scale",CLIP:"clip"},function(t){var i={};t.registerImplementation=function(t,e){i[t]=e},t.getImplementation=function(t){return i[t]}}(egret||(egret={})),function(t){var e=function(r){function t(t,e){var i=r.call(this,t)||this;return i.firstCharHeight=0,"string"==typeof e?i.charList=i.parseConfig(e):e&&e.hasOwnProperty("frames")?i.charList=e.frames:i.charList={},i}return __extends(t,r),t.prototype.getTexture=function(t){var e=this._textureMap[t];if(!e){var i=this.charList[t];if(!i)return null;e=this.createTexture(t,i.x,i.y,i.w,i.h,i.offX,i.offY,i.sourceW,i.sourceH),this._textureMap[t]=e}return e},t.prototype.getConfig=function(t,e){return this.charList[t]?this.charList[t][e]:0},t.prototype._getFirstCharHeight=function(){if(0==this.firstCharHeight)for(var t in this.charList){var e=this.charList[t];if(e){var i=e.sourceH;if(void 0===i){var r=e.h;void 0===r&&(r=0);var n=e.offY;void 0===n&&(n=0),i=r+n}if(i<=0)continue;this.firstCharHeight=i;break}}return this.firstCharHeight},t.prototype.parseConfig=function(t){for(var e=(t=t.split("\r\n").join("\n")).split("\n"),i=this.getConfigByKey(e[3],"count"),r={},n=4;n<4+i;n++){var s=e[n],o={};(r[String.fromCharCode(this.getConfigByKey(s,"id"))]=o).x=this.getConfigByKey(s,"x"),o.y=this.getConfigByKey(s,"y"),o.w=this.getConfigByKey(s,"width"),o.h=this.getConfigByKey(s,"height"),o.offX=this.getConfigByKey(s,"xoffset"),o.offY=this.getConfigByKey(s,"yoffset"),o.xadvance=this.getConfigByKey(s,"xadvance")}return r},t.prototype.getConfigByKey=function(t,e){for(var i=t.split(" "),r=0,n=i.length;r<n;r++){var s=i[r];if(e==s.substring(0,e.length)){var o=s.substring(e.length+1);return parseInt(o)}}return 0},t}(t.SpriteSheet);t.BitmapFont=e,__reflect(e.prototype,"egret.BitmapFont")}(egret||(egret={})),function(A){var t=function(e){function M(){var t=e.call(this)||this;return t.$textOffsetX=0,t.$textOffsetY=0,t.$textStartX=0,t.$textStartY=0,t.$lineHeights=[],t.$renderNode=new A.sys.BitmapNode,t.$BitmapText={0:NaN,1:NaN,2:"",3:0,4:0,5:null,6:!1,7:!1,8:!1,9:!1,10:"left",11:"top",12:A.Bitmap.defaultSmoothing},t}return __extends(M,e),Object.defineProperty(M.prototype,"smoothing",{get:function(){return this.$BitmapText[12]},set:function(t){t=!!t;var e=this.$BitmapText;t!=e[12]&&(e[12]=t,this.$invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"text",{get:function(){return this.$BitmapText[2]},set:function(t){this.$setText(t)},enumerable:!0,configurable:!0}),M.prototype.$setText=function(t){null==t&&(t=""),t=String(t);var e=this.$BitmapText;return t!=e[2]&&(e[2]=t,this.$invalidateContentBounds(),!0)},M.prototype.$getWidth=function(){var t=this.$BitmapText[0];return isNaN(t)?this.$getContentBounds().width:t},M.prototype.$setWidth=function(t){var e=this.$BitmapText;return!(t<0||t==e[0])&&(e[0]=t,this.$invalidateContentBounds(),!0)},M.prototype.$invalidateContentBounds=function(){e.prototype.$invalidateContentBounds.call(this),this.$BitmapText[7]=!0},M.prototype.$getHeight=function(){var t=this.$BitmapText[1];return isNaN(t)?this.$getContentBounds().height:t},M.prototype.$setHeight=function(t){var e=this.$BitmapText;return!(t<0||t==e[1])&&(e[1]=t,this.$invalidateContentBounds(),!0)},Object.defineProperty(M.prototype,"font",{get:function(){return this.$BitmapText[5]},set:function(t){this.$setFont(t)},enumerable:!0,configurable:!0}),M.prototype.$setFont=function(t){var e=this.$BitmapText;return e[5]!=t&&(e[5]=t,this.$BitmapText[6]=!0,this.$invalidateContentBounds(),!0)},Object.defineProperty(M.prototype,"lineSpacing",{get:function(){return this.$BitmapText[3]},set:function(t){this.$setLineSpacing(t)},enumerable:!0,configurable:!0}),M.prototype.$setLineSpacing=function(t){t=+t||0;var e=this.$BitmapText;return e[3]!=t&&(e[3]=t,this.$invalidateContentBounds(),!0)},Object.defineProperty(M.prototype,"letterSpacing",{get:function(){return this.$BitmapText[4]},set:function(t){this.$setLetterSpacing(t)},enumerable:!0,configurable:!0}),M.prototype.$setLetterSpacing=function(t){t=+t||0;var e=this.$BitmapText;return e[4]!=t&&(e[4]=t,this.$invalidateContentBounds(),!0)},Object.defineProperty(M.prototype,"textAlign",{get:function(){return this.$BitmapText[10]},set:function(t){this.$setTextAlign(t)},enumerable:!0,configurable:!0}),M.prototype.$setTextAlign=function(t){var e=this.$BitmapText;return e[10]!=t&&(e[10]=t,this.$invalidateContentBounds(),!0)},Object.defineProperty(M.prototype,"verticalAlign",{get:function(){return this.$BitmapText[11]},set:function(t){this.$setVerticalAlign(t)},enumerable:!0,configurable:!0}),M.prototype.$setVerticalAlign=function(t){var e=this.$BitmapText;return e[11]!=t&&(e[11]=t,this.$invalidateContentBounds(),!0)},M.prototype.$render=function(){var t=this.$BitmapText,e=this.$getTextLines(),i=e.length;if(0!=i){var r=this.$textLinesWidth,n=t[5],s=this.$renderNode;n.$texture&&(s.image=n.$texture._bitmapData),s.smoothing=t[12];for(var o=n._getFirstCharHeight(),a=Math.ceil(o*M.EMPTY_FACTOR),h=!isNaN(t[1]),l=t[8],c=t[0],u=t[1],p=t[10],d=this.$textOffsetY+this.$textStartY,f=this.$lineHeights,g=0;g<i;g++){var y=f[g];if(h&&0<g&&u<d+y)break;var $=e[g],v=$.length,m=this.$textOffsetX;if(p!=A.HorizontalAlign.LEFT){var b=l<c?c:l;p==A.HorizontalAlign.RIGHT?m+=b-r[g]:p==A.HorizontalAlign.CENTER&&(m+=Math.floor((b-r[g])/2))}for(var T=0;T<v;T++){var x=$.charAt(T),_=n.getTexture(x);if(_){var O=_._bitmapWidth,E=_._bitmapHeight;s.imageWidth=_._sourceWidth,s.imageHeight=_._sourceHeight,s.drawImage(_._bitmapX,_._bitmapY,O,E,m+_._offsetX,d+_._offsetY,_.$getScaleBitmapWidth(),_.$getScaleBitmapHeight()),m+=(n.getConfig(x,"xadvance")||_.$getTextureWidth())+t[4]}else" "==x?m+=a:A.$warn(1046,x)}d+=y+t[3]}}},M.prototype.$measureContentBounds=function(t){0==this.$getTextLines().length?t.setEmpty():t.setTo(this.$textOffsetX+this.$textStartX,this.$textOffsetY+this.$textStartY,this.$BitmapText[8]-this.$textOffsetX,this.$BitmapText[9]-this.$textOffsetY)},Object.defineProperty(M.prototype,"textWidth",{get:function(){return this.$getTextLines(),this.$BitmapText[8]},enumerable:!0,configurable:!0}),Object.defineProperty(M.prototype,"textHeight",{get:function(){return this.$getTextLines(),this.$BitmapText[9]},enumerable:!0,configurable:!0}),M.prototype.$getTextLines=function(){function t(t){return!(v&&0<i.length&&v<d)&&(d+=h+c,o||a||(l-=u),i.push(t),s.push(h),r.push(l),p=Math.max(l,p),!0)}var e=this.$BitmapText;if(!e[7])return this.textLines;var i=[];this.textLines=i;var r=[];this.$textLinesWidth=r,e[7]=!1;var n,s=[];if(this.$lineHeights=s,!e[2]||!e[5])return i;for(var o,a,h,l,c=e[3],u=e[4],p=0,d=0,f=0,g=0,y=!isNaN(e[0]),$=e[0],v=e[1],m=e[5],b=m._getFirstCharHeight(),T=Math.ceil(b*M.EMPTY_FACTOR),x=e[2].split(/(?:\r\n|\r|\n)/),_=x.length,O=!0,E=0;E<_;E++){var F=x[E],w=F.length;a=!(o=!(l=h=0));for(var C=0;C<w;C++){o||(l+=u);var R=F.charAt(C),S=void 0,P=void 0,D=0,L=0,N=m.getTexture(R);if(N)S=N.$getTextureWidth(),P=N.$getTextureHeight(),D=N._offsetX,L=N._offsetY;else{if(" "!=R){A.$warn(1046,R),o&&(o=!1);continue}S=T,P=b}if(o&&(o=!1,f=Math.min(D,f)),O&&(O=!1,g=Math.min(L,g)),y&&0<C&&$<l+S){if(!t(F.substring(0,C)))break;w=(F=F.substring(C)).length,l=(C=0)==w-1?S:m.getConfig(R,"xadvance")||S,h=P}else l+=C==w-1?S:m.getConfig(R,"xadvance")||S,h=Math.max(P,h)}if(v&&0<E&&v<d)break;if(a=!0,!t(F))break}return d-=c,e[8]=p,e[9]=d,this.$textOffsetX=f,this.$textOffsetY=g,this.$textStartX=0,this.$textStartY=0,p<$&&((n=e[10])==A.HorizontalAlign.RIGHT?this.$textStartX=$-p:n==A.HorizontalAlign.CENTER&&(this.$textStartX=Math.floor(($-p)/2))),d<v&&((n=e[11])==A.VerticalAlign.BOTTOM?this.$textStartY=v-d:n==A.VerticalAlign.MIDDLE&&(this.$textStartY=Math.floor((v-d)/2))),i},M}(A.DisplayObject);t.EMPTY_FACTOR=.33,A.BitmapText=t,__reflect(t.prototype,"egret.BitmapText")}(egret||(egret={})),function(t){var e=function(){};e.LEFT="left",e.RIGHT="right",e.CENTER="center",e.JUSTIFY="justify",e.CONTENT_JUSTIFY="contentJustify",t.HorizontalAlign=e,__reflect(e.prototype,"egret.HorizontalAlign")}(egret||(egret={})),function(s){var t=function(){function t(){this.replaceArr=[],this.resutlArr=[],this.initReplaceArr()}return t.prototype.initReplaceArr=function(){this.replaceArr=[],this.replaceArr.push([/&lt;/g,"<"]),this.replaceArr.push([/&gt;/g,">"]),this.replaceArr.push([/&amp;/g,"&"]),this.replaceArr.push([/&quot;/g,'"']),this.replaceArr.push([/&apos;/g,"'"])},t.prototype.replaceSpecial=function(t){for(var e=0;e<this.replaceArr.length;e++){var i=this.replaceArr[e][0],r=this.replaceArr[e][1];t=t.replace(i,r)}return t},t.prototype.parse=function(t){this.stackArray=[],this.resutlArr=[];for(var e=0,i=t.length;e<i;){var r=t.indexOf("<",e);if(r<0)this.addToResultArr(t.substring(e)),e=i;else{this.addToResultArr(t.substring(e,r));var n=t.indexOf(">",r);-1==n?(s.$error(1038),n=r):"/"==t.charAt(r+1)?this.stackArray.pop():this.addToArray(t.substring(r+1,n)),e=n+1}}return this.resutlArr},t.prototype.parser=function(t){return this.parse(t)},t.prototype.addToResultArr=function(t){""!=t&&(t=this.replaceSpecial(t),0<this.stackArray.length?this.resutlArr.push({text:t,style:this.stackArray[this.stackArray.length-1]}):this.resutlArr.push({text:t}))},t.prototype.changeStringToObject=function(t){var e={},i=[];if("i"==(t=t.trim()).charAt(0)||"b"==t.charAt(0)||"u"==t.charAt(0))this.addProperty(e,t,"true");else if(i=t.match(/^(font|a)\s/)){t=t.substring(i[0].length).trim();for(var r=0,n=void 0;n=t.match(this.getHeadReg());){var s=n[0],o="";'"'==(t=t.substring(s.length).trim()).charAt(0)?(r=t.indexOf('"',1),o=t.substring(1,r),r+=1):"'"==t.charAt(0)?(r=t.indexOf("'",1),o=t.substring(1,r),r+=1):r=(o=t.match(/(\S)+/)[0]).length,this.addProperty(e,s.substring(0,s.length-1).trim(),o.trim()),t=t.substring(r).trim()}}return e},t.prototype.getHeadReg=function(){return/^(color|textcolor|strokecolor|stroke|b|bold|i|italic|u|size|fontfamily|href|target)(\s)*=/},t.prototype.addProperty=function(t,e,i){switch(e.toLowerCase()){case"color":case"textcolor":i=i.replace(/#/,"0x"),t.textColor=parseInt(i);break;case"strokecolor":i=i.replace(/#/,"0x"),t.strokeColor=parseInt(i);break;case"stroke":t.stroke=parseInt(i);break;case"b":case"bold":t.bold="true"==i;break;case"u":t.underline="true"==i;break;case"i":case"italic":t.italic="true"==i;break;case"size":t.size=parseInt(i);break;case"fontfamily":t.fontFamily=i;break;case"href":t.href=this.replaceSpecial(i);break;case"target":t.target=this.replaceSpecial(i)}},t.prototype.addToArray=function(t){var e=this.changeStringToObject(t);if(0==this.stackArray.length)this.stackArray.push(e);else{var i=this.stackArray[this.stackArray.length-1];for(var r in i)null==e[r]&&(e[r]=i[r]);this.stackArray.push(e)}},t}();s.HtmlTextParser=t,__reflect(t.prototype,"egret.HtmlTextParser")}(egret||(egret={})),function(o){var t=function(e){function t(){var t=e.call(this)||this;return t.stageTextAdded=!1,t._text=null,t._isFocus=!1,t}return __extends(t,e),t.prototype.init=function(t){this._text=t,this.stageText=new o.StageText,this.stageText.$setTextField(this._text)},t.prototype._addStageText=function(){this.stageTextAdded||(this._text.$inputEnabled||(this._text.$touchEnabled=!0),this.tempStage=this._text.stage,this.stageText.$addToStage(),this.stageText.addEventListener("updateText",this.updateTextHandler,this),this._text.addEventListener(o.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this.stageText.addEventListener("blur",this.blurHandler,this),this.stageText.addEventListener("focus",this.focusHandler,this),this.stageTextAdded=!0)},t.prototype._removeStageText=function(){this.stageTextAdded&&(this._text.$inputEnabled||(this._text.$touchEnabled=!1),this.stageText.$removeFromStage(),this.stageText.removeEventListener("updateText",this.updateTextHandler,this),this._text.removeEventListener(o.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this.tempStage.removeEventListener(o.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this.stageText.removeEventListener("blur",this.blurHandler,this),this.stageText.removeEventListener("focus",this.focusHandler,this),this.stageTextAdded=!1)},t.prototype._getText=function(){return this.stageText.$getText()},t.prototype._setText=function(t){this.stageText.$setText(t)},t.prototype._setColor=function(t){this.stageText.$setColor(t)},t.prototype.focusHandler=function(t){this._isFocus||(this._isFocus=!0,t.showing||(this._text.$isTyping=!0),this._text.$invalidateContentBounds(),this._text.dispatchEvent(new o.FocusEvent(o.FocusEvent.FOCUS_IN,!0)))},t.prototype.blurHandler=function(t){this._isFocus&&(this._isFocus=!1,this.tempStage.removeEventListener(o.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this._text.$isTyping=!1,this._text.$invalidateContentBounds(),this.stageText.$onBlur(),this._text.dispatchEvent(new o.FocusEvent(o.FocusEvent.FOCUS_OUT,!0)))},t.prototype.onMouseDownHandler=function(t){this.$onFocus()},t.prototype.$onFocus=function(){this._text.visible&&(this._isFocus||(this.tempStage.addEventListener(o.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this.stageText.$show()))},t.prototype.onStageDownHandler=function(t){t.$target!=this._text&&this.stageText.$hide()},t.prototype.updateTextHandler=function(t){var e,i,r=this._text.$TextField,n=this.stageText.$getText(),s=!1;null!=r[35]&&(e=new RegExp("["+r[35]+"]","g"),n=(i=n.match(e))?i.join(""):"",s=!0),null!=r[36]&&(e=new RegExp("[^"+r[36]+"]","g"),n=(i=n.match(e))?i.join(""):"",s=!0),s&&this.stageText.$getText()!=n&&this.stageText.$setText(n),this.resetText(),this._text.dispatchEvent(new o.Event(o.Event.CHANGE,!0))},t.prototype.resetText=function(){this._text.$setBaseText(this.stageText.$getText())},t.prototype._hideInput=function(){this.stageText.$removeFromStage()},t.prototype.updateInput=function(){!this._text.$visible&&this.stageText&&this._hideInput()},t.prototype._updateProperties=function(){if(this._isFocus)return this.stageText.$resetStageText(),void this.updateInput();var t=this._text.$stage;if(null==t);else for(var e=this._text,i=e.$visible;i&&(e=e.parent)!=t;)i=e.$visible;this.stageText.$setText(this._text.$TextField[13]),this.stageText.$resetStageText(),this.updateInput()},t}(o.HashObject);o.InputController=t,__reflect(t.prototype,"egret.InputController")}(egret||(egret={})),egret||(egret={}),function(N){function M(t,e,i){var r=null==(i=i||{}).italic?e[16]:i.italic,n=null==i.bold?e[15]:i.bold,s=null==i.size?e[0]:i.size,o=i.fontFamily||e[8]||a.default_fontFamily;return N.sys.measureText(t,o,s,n,r)}var A=new RegExp("(?=[\\u00BF-\\u1FFF\\u2C00-\\uD7FF]|\\b|\\s)(?![。，！、》…）)}”】\\.\\,\\!\\?\\]\\:])"),a=function(n){function m(){var t=n.call(this)||this;t.$inputEnabled=!1,t.inputUtils=null,t.graphicsNode=null,t.isFlow=!1,t.textArr=[],t.linesArr=[],t.$isTyping=!1;var e=new N.sys.TextNode;return e.fontFamily=m.default_fontFamily,t.textNode=e,t.$renderNode=e,t.$TextField={0:m.default_size,1:0,2:m.default_textColor,3:NaN,4:NaN,5:0,6:0,7:0,8:m.default_fontFamily,9:"left",10:"top",11:"#ffffff",12:"",13:"",14:[],15:!1,16:!1,17:!0,18:!1,19:!1,20:!1,21:0,22:0,23:0,24:N.TextFieldType.DYNAMIC,25:0,26:"#000000",27:0,28:-1,29:0,30:!1,31:!1,32:0,33:!1,34:16777215,35:null,36:null,37:N.TextFieldInputType.TEXT},t}return __extends(m,n),m.prototype.isInput=function(){return this.$TextField[24]==N.TextFieldType.INPUT},m.prototype.$setTouchEnabled=function(t){var e=n.prototype.$setTouchEnabled.call(this,t);return this.isInput()&&(this.$inputEnabled=!0),e},Object.defineProperty(m.prototype,"fontFamily",{get:function(){return this.$TextField[8]},set:function(t){this.$setFontFamily(t)},enumerable:!0,configurable:!0}),m.prototype.$setFontFamily=function(t){var e=this.$TextField;return e[8]!=t&&(e[8]=t,this.invalidateFontString(),!0)},Object.defineProperty(m.prototype,"size",{get:function(){return this.$TextField[0]},set:function(t){this.$setSize(t)},enumerable:!0,configurable:!0}),m.prototype.$setSize=function(t){t=+t||0;var e=this.$TextField;return e[0]!=t&&(e[0]=t,this.invalidateFontString(),!0)},Object.defineProperty(m.prototype,"bold",{get:function(){return this.$TextField[15]},set:function(t){this.$setBold(t)},enumerable:!0,configurable:!0}),m.prototype.$setBold=function(t){t=!!t;var e=this.$TextField;return t!=e[15]&&(e[15]=t,this.invalidateFontString(),!0)},Object.defineProperty(m.prototype,"italic",{get:function(){return this.$TextField[16]},set:function(t){this.$setItalic(t)},enumerable:!0,configurable:!0}),m.prototype.$setItalic=function(t){t=!!t;var e=this.$TextField;return t!=e[16]&&(e[16]=t,this.invalidateFontString(),!0)},m.prototype.invalidateFontString=function(){this.$TextField[17]=!0,this.$invalidateTextField()},Object.defineProperty(m.prototype,"textAlign",{get:function(){return this.$TextField[9]},set:function(t){this.$setTextAlign(t)},enumerable:!0,configurable:!0}),m.prototype.$setTextAlign=function(t){var e=this.$TextField;return e[9]!=t&&(e[9]=t,this.$invalidateTextField(),!0)},Object.defineProperty(m.prototype,"verticalAlign",{get:function(){return this.$TextField[10]},set:function(t){this.$setVerticalAlign(t)},enumerable:!0,configurable:!0}),m.prototype.$setVerticalAlign=function(t){var e=this.$TextField;return e[10]!=t&&(e[10]=t,this.$invalidateTextField(),!0)},Object.defineProperty(m.prototype,"lineSpacing",{get:function(){return this.$TextField[1]},set:function(t){this.$setLineSpacing(t)},enumerable:!0,configurable:!0}),m.prototype.$setLineSpacing=function(t){t=+t||0;var e=this.$TextField;return e[1]!=t&&(e[1]=t,this.$invalidateTextField(),!0)},Object.defineProperty(m.prototype,"textColor",{get:function(){return this.$TextField[2]},set:function(t){this.$setTextColor(t)},enumerable:!0,configurable:!0}),m.prototype.$setTextColor=function(t){t=0|+t;var e=this.$TextField;return e[2]!=t&&(e[2]=t,this.inputUtils&&this.inputUtils._setColor(this.$TextField[2]),this.$invalidate(),!0)},Object.defineProperty(m.prototype,"wordWrap",{get:function(){return this.$TextField[19]},set:function(t){this.$setWordWrap(t)},enumerable:!0,configurable:!0}),m.prototype.$setWordWrap=function(t){t=!!t;var e=this.$TextField;t!=e[19]&&(e[20]||(e[19]=t,this.$invalidateTextField()))},Object.defineProperty(m.prototype,"type",{get:function(){return this.$TextField[24]},set:function(t){this.$setType(t)},enumerable:!0,configurable:!0}),m.prototype.$setType=function(t){var e=this.$TextField;return e[24]!=t&&((e[24]=t)==N.TextFieldType.INPUT?(isNaN(e[3])&&this.$setWidth(100),isNaN(e[4])&&this.$setHeight(30),this.$setTouchEnabled(!0),null==this.inputUtils&&(this.inputUtils=new N.InputController),this.inputUtils.init(this),this.$invalidateTextField(),this.$stage&&this.inputUtils._addStageText()):(this.inputUtils&&(this.inputUtils._removeStageText(),this.inputUtils=null),this.$setTouchEnabled(!1)),!0)},Object.defineProperty(m.prototype,"inputType",{get:function(){return this.$TextField[37]},set:function(t){this.$TextField[37]=t},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"text",{get:function(){return this.$getText()},set:function(t){this.$setText(t)},enumerable:!0,configurable:!0}),m.prototype.$getText=function(){return this.$TextField[24]==N.TextFieldType.INPUT?this.inputUtils._getText():this.$TextField[13]},m.prototype.$setBaseText=function(t){null==t&&(t=""),t=t.toString(),this.isFlow=!1;var e=this.$TextField;if(e[13]!=t){this.$invalidateTextField(),e[13]=t;var i;return i=e[20]?this.changeToPassText(t):t,this.setMiddleStyle([{text:i}]),!0}return!1},m.prototype.$setText=function(t){null==t&&(t="");var e=this.$setBaseText(t);return this.inputUtils&&this.inputUtils._setText(this.$TextField[13]),e},Object.defineProperty(m.prototype,"displayAsPassword",{get:function(){return this.$TextField[20]},set:function(t){this.$setDisplayAsPassword(t)},enumerable:!0,configurable:!0}),m.prototype.$setDisplayAsPassword=function(t){var e=this.$TextField;if(e[20]!=t){e[20]=t,this.$invalidateTextField();var i;return i=t?this.changeToPassText(e[13]):e[13],this.setMiddleStyle([{text:i}]),!0}return!1},Object.defineProperty(m.prototype,"strokeColor",{get:function(){return this.$TextField[25]},set:function(t){t=+t||0,this.$setStrokeColor(t)},enumerable:!0,configurable:!0}),m.prototype.$setStrokeColor=function(t){var e=this.$TextField;return e[25]!=t&&(this.$invalidateTextField(),e[25]=t,e[26]=N.toColorString(t),!0)},Object.defineProperty(m.prototype,"stroke",{get:function(){return this.$TextField[27]},set:function(t){this.$setStroke(t)},enumerable:!0,configurable:!0}),m.prototype.$setStroke=function(t){return this.$TextField[27]!=t&&(this.$invalidateTextField(),this.$TextField[27]=t,!0)},Object.defineProperty(m.prototype,"maxChars",{get:function(){return this.$TextField[21]},set:function(t){this.$setMaxChars(t)},enumerable:!0,configurable:!0}),m.prototype.$setMaxChars=function(t){return this.$TextField[21]!=t&&(this.$TextField[21]=t,!0)},Object.defineProperty(m.prototype,"scrollV",{get:function(){return Math.min(Math.max(this.$TextField[28],1),this.maxScrollV)},set:function(t){this.$TextField[28]=Math.max(t,1),this.$invalidateTextField()},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"maxScrollV",{get:function(){return this.$getLinesArr(),Math.max(this.$TextField[29]-N.TextFieldUtils.$getScrollNum(this)+1,1)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"selectionBeginIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"selectionEndIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"caretIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),m.prototype.$setSelection=function(t,e){return!1},m.prototype.$getLineHeight=function(){return this.$TextField[1]+this.$TextField[0]},Object.defineProperty(m.prototype,"numLines",{get:function(){return this.$getLinesArr(),this.$TextField[29]},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"multiline",{get:function(){return this.$TextField[30]},set:function(t){this.$setMultiline(t)},enumerable:!0,configurable:!0}),m.prototype.$setMultiline=function(t){return this.$TextField[30]=t,this.$invalidateTextField(),!0},Object.defineProperty(m.prototype,"restrict",{get:function(){var t=this.$TextField,e=null;return null!=t[35]&&(e=t[35]),null!=t[36]&&(null==e&&(e=""),e+="^"+t[36]),e},set:function(t){var e=this.$TextField;if(null==t)e[35]=null,e[36]=null;else{for(var i=-1;i<t.length&&0!=(i=t.indexOf("^",i))&&0<i&&"\\"==t.charAt(i-1);)i++;0==i?(e[35]=null,e[36]=t.substring(i+1)):0<i?(e[35]=t.substring(0,i),e[36]=t.substring(i+1)):(e[35]=t,e[36]=null)}},enumerable:!0,configurable:!0}),m.prototype.$setWidth=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[3]))return!1;e[3]=NaN}else{if(e[3]==t)return!1;e[3]=t}return!((t=+t)<0)&&(this.$invalidateTextField(),!0)},m.prototype.$setHeight=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[4]))return!1;e[4]=NaN}else{if(e[4]==t)return!1;e[4]=t}return!((t=+t)<0)&&(this.$invalidateTextField(),!0)},m.prototype.$getWidth=function(){var t=this.$TextField;return isNaN(t[3])?this.$getContentBounds().width:t[3]},m.prototype.$getHeight=function(){var t=this.$TextField;return isNaN(t[4])?this.$getContentBounds().height:t[4]},Object.defineProperty(m.prototype,"border",{get:function(){return this.$TextField[31]},set:function(t){this.$setBorder(t)},enumerable:!0,configurable:!0}),m.prototype.$setBorder=function(t){this.$TextField[31]=!!t,this.$invalidate()},Object.defineProperty(m.prototype,"borderColor",{get:function(){return this.$TextField[32]},set:function(t){this.$setBorderColor(t)},enumerable:!0,configurable:!0}),m.prototype.$setBorderColor=function(t){this.$TextField[32]=+t||0,this.$invalidate()},Object.defineProperty(m.prototype,"background",{get:function(){return this.$TextField[33]},set:function(t){this.$setBackground(t)},enumerable:!0,configurable:!0}),m.prototype.$setBackground=function(t){this.$TextField[33]=t,this.$invalidate()},Object.defineProperty(m.prototype,"backgroundColor",{get:function(){return this.$TextField[34]},set:function(t){this.$setBackgroundColor(t)},enumerable:!0,configurable:!0}),m.prototype.$setBackgroundColor=function(t){this.$TextField[34]=t,this.$invalidate()},m.prototype.fillBackground=function(t){var e=this.graphicsNode;e&&e.clear();var i=this.$TextField;if(i[33]||i[31]||t&&0<t.length){if(!e){e=this.graphicsNode=new N.sys.GraphicsNode;var r=new N.sys.GroupNode;r.addNode(e),r.addNode(this.textNode),this.$renderNode=r}var n=void 0;if(i[33]&&e.beginFill(i[34]).drawRect(0,0,this.$getWidth(),this.$getHeight()),i[31]&&(n=e.lineStyle(1,i[32])).drawRect(0,0,this.$getWidth()-1,this.$getHeight()-1),t&&0<t.length)for(var s=i[2],o=-1,a=t.length,h=0;h<a;h+=4){var l=t[h],c=t[h+1],u=t[h+2],p=t[h+3]||s;(o<0||o!=p)&&(o=p,n=e.lineStyle(2,p,1,N.CapsStyle.NONE)),n.moveTo(l,c),n.lineTo(l+u,c)}}if(e){var d=this.$getRenderBounds();e.x=d.x,e.y=d.y,e.width=d.width,e.height=d.height,N.Rectangle.release(d)}},m.prototype.setFocus=function(){this.type==N.TextFieldType.INPUT&&this.$stage&&this.inputUtils.$onFocus()},m.prototype.$onRemoveFromStage=function(){n.prototype.$onRemoveFromStage.call(this),this.removeEvent(),this.$TextField[24]==N.TextFieldType.INPUT&&this.inputUtils._removeStageText(),this.textNode&&this.textNode.clean()},m.prototype.$onAddToStage=function(t,e){n.prototype.$onAddToStage.call(this,t,e),this.addEvent(),this.$TextField[24]==N.TextFieldType.INPUT&&this.inputUtils._addStageText()},m.prototype.$invalidateTextField=function(){this.$invalidateContentBounds(),this.$TextField[18]=!0},m.prototype.$update=function(t,e){var i=this.$getRenderBounds(),r=n.prototype.$update.call(this,t,i);return N.Rectangle.release(i),r},m.prototype.$getRenderBounds=function(){var t=this.$getContentBounds(),e=N.Rectangle.create();e.copyFrom(t),this.$TextField[31]&&(e.width+=2,e.height+=2);var i=2*this.$TextField[27];return 0<i&&(e.width+=2*i,e.height+=2*i),e.x-=i+2,e.y-=i+2,e.width=Math.ceil(e.width)+4,e.height=Math.ceil(e.height)+4,e},m.prototype.$measureContentBounds=function(t){this.$getLinesArr();var e=isNaN(this.$TextField[3])?this.$TextField[5]:this.$TextField[3],i=isNaN(this.$TextField[4])?N.TextFieldUtils.$getTextHeight(this):this.$TextField[4];t.setTo(0,0,e,i)},m.prototype.$render=function(){if(this.$TextField[24]==N.TextFieldType.INPUT){if((this.$hasAnyFlags(2032)||this.$hasAnyFlags(1648))&&this.inputUtils._updateProperties(),this.$isTyping)return void this.fillBackground()}else if(0==this.$TextField[3])return;var t=this.drawText();this.fillBackground(t);var e=this.$getRenderBounds(),i=this.textNode;i.x=e.x,i.y=e.y,i.width=Math.ceil(e.width),i.height=Math.ceil(e.height),N.Rectangle.release(e)},Object.defineProperty(m.prototype,"textFlow",{get:function(){return this.textArr},set:function(t){this.isFlow=!0;var e="";null==t&&(t=[]);for(var i=0;i<t.length;i++){e+=t[i].text}this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.setMiddleStyle(t))},enumerable:!0,configurable:!0}),m.prototype.changeToPassText=function(t){if(this.$TextField[20]){for(var e="",i=0,r=t.length;i<r;i++)switch(t.charAt(i)){case"\n":e+="\n";break;case"\r":break;default:e+="*"}return e}return t},m.prototype.setMiddleStyle=function(t){this.$TextField[18]=!0,this.textArr=t,this.$invalidateTextField()},Object.defineProperty(m.prototype,"textWidth",{get:function(){return this.$getLinesArr(),this.$TextField[5]},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"textHeight",{get:function(){return this.$getLinesArr(),N.TextFieldUtils.$getTextHeight(this)},enumerable:!0,configurable:!0}),m.prototype.appendText=function(t){this.appendElement({text:t})},m.prototype.appendElement=function(t){var e=this.$TextField[13]+t.text;this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.textArr.push(t),this.setMiddleStyle(this.textArr))},m.prototype.$getLinesArr=function(){var t=this.$TextField;if(!t[18])return this.linesArr;t[18]=!1;var e=this.textArr;this.linesArr.length=0,t[6]=0,t[5]=0;var i=t[3];if(!isNaN(i)&&0==i)return[{width:t[29]=0,height:0,charNum:0,elements:[],hasNextLine:!1}];for(var r,n=this.linesArr,s=0,o=0,a=0,h=0,l=0,c=e.length;l<c;l++){var u=e[l];if(u.text){u.style=u.style||{};for(var p=u.text.toString().split(/(?:\r\n|\r|\n)/),d=0,f=p.length;d<f;d++){null==n[h]&&(r={width:0,height:0,elements:[],charNum:0,hasNextLine:!1},n[h]=r,o=a=s=0),a=t[24]==N.TextFieldType.INPUT?t[0]:Math.max(a,u.style.size||t[0]);var g=!0;if(""==p[d])d==f-1&&(g=!1);else{var y=M(p[d],t,u.style);if(isNaN(i))s+=y,o+=p[d].length,r.elements.push({width:y,text:p[d],style:u.style}),d==f-1&&(g=!1);else if(s+y<=i)r.elements.push({width:y,text:p[d],style:u.style}),s+=y,o+=p[d].length,d==f-1&&(g=!1);else{for(var $=0,v=0,m=p[d],b=void 0,T=(b=t[19]?m.split(A):m.match(/./g)).length,x=0;$<T;$++){var _=!1;if(1==(R=b[$].length)&&$<T-1){var O=b[$].charCodeAt(0),E=b[$+1].charCodeAt(0);if(55296<=O&&O<=56319&&56320==(64512&E))R=2,_=!0,y=M(b[$]+b[$+1],t,u.style);else y=M(b[$],t,u.style)}else y=M(b[$],t,u.style);if(0!=s&&i<s+y&&s+$!=0)break;if(i<v+y)for(var F=b[$].match(/./g),w=0,C=F.length;w<C;w++){var R,S=!1;if(1==(R=F[w].length)&&w<C-1){O=F[w].charCodeAt(0),E=F[w+1].charCodeAt(0);if(55296<=O&&O<=56319&&56320==(64512&E))R=2,S=!0,y=M(F[w]+F[w+1],t,u.style);else y=M(F[w],t,u.style)}else y=M(F[w],t,u.style);if(0<w&&i<s+y)break;v+=y,s+=y,o+=x+=R,S&&w++}else v+=y,s+=y,o+=x+=R;_&&$++}if(0<$){r.elements.push({width:v,text:m.substring(0,x),style:u.style});var P=m.substring(x),D=void 0,L=P.length;for(D=0;D<L&&" "==P.charAt(D);D++);p[d]=P.substring(D)}""!=p[d]&&(d--,g=!1)}}g&&(o++,r.hasNextLine=!0),d<p.length-1&&(r.width=s,r.height=a,r.charNum=o,t[5]=Math.max(t[5],s),t[6]+=a,h++)}l==e.length-1&&r&&(r.width=s,r.height=a,r.charNum=o,t[5]=Math.max(t[5],s),t[6]+=a)}else r&&(r.width=s,r.height=a,r.charNum=o,t[5]=Math.max(t[5],s),t[6]+=a)}return t[29]=n.length,n},m.prototype.drawText=function(){var t=this.textNode,e=this.$TextField;t.bold=e[15],t.fontFamily=e[8]||m.default_fontFamily,t.italic=e[16],t.size=e[0],t.stroke=e[27],t.strokeColor=e[25],t.textColor=e[2];var i=this.$getLinesArr();if(0==e[5])return[];var r=isNaN(e[3])?e[5]:e[3],n=N.TextFieldUtils.$getTextHeight(this),s=0,o=N.TextFieldUtils.$getStartLine(this),a=e[4];!isNaN(a)&&n<a&&(s+=N.TextFieldUtils.$getValign(this)*(a-n));s=Math.round(s);for(var h=N.TextFieldUtils.$getHalign(this),l=0,c=[],u=o,p=e[29];u<p;u++){var d=i[u],f=d.height;if(s+=f/2,u!=o){if(e[24]==N.TextFieldType.INPUT&&!e[30])break;if(!isNaN(a)&&a<s)break}l=Math.round((r-d.width)*h);for(var g=0,y=d.elements.length;g<y;g++){var $=d.elements[g],v=$.style.size||e[0];t.drawText(l,s+(f-v)/2,$.text,$.style),$.style.underline&&c.push(l,s+f/2,$.width,$.style.textColor),l+=$.width}s+=f/2+e[1]}return c},m.prototype.addEvent=function(){this.addEventListener(N.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},m.prototype.removeEvent=function(){this.removeEventListener(N.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},m.prototype.onTapHandler=function(t){if(this.$TextField[24]!=N.TextFieldType.INPUT){var e=N.TextFieldUtils.$getTextElement(this,t.localX,t.localY);if(null!=e){var i=e.style;if(i&&i.href)if(i.href.match(/^event:/)){var r=i.href.match(/^event:/)[0];N.TextEvent.dispatchTextEvent(this,N.TextEvent.LINK,i.href.substring(r.length))}else open(i.href,i.target||"_blank")}}},m}(N.DisplayObject);a.default_fontFamily="Arial",a.default_size=30,a.default_textColor=16777215,N.TextField=a,__reflect(a.prototype,"egret.TextField")}(egret||(egret={})),function(t){var e=function(){};e.TEXT="text",e.TEL="tel",e.PASSWORD="password",t.TextFieldInputType=e,__reflect(e.prototype,"egret.TextFieldInputType")}(egret||(egret={})),function(t){var e=function(){};e.DYNAMIC="dynamic",e.INPUT="input",t.TextFieldType=e,__reflect(e.prototype,"egret.TextFieldType")}(egret||(egret={})),function(n){var t=function(){function g(){}return g.$getStartLine=function(t){var e=t.$TextField,i=g.$getTextHeight(t),r=0,n=e[4];return isNaN(n)||(i<n||n<i&&(r=Math.max(e[28]-1,0),r=Math.min(e[29]-1,r)),e[30]||(r=Math.max(e[28]-1,0),0<e[29]&&(r=Math.min(e[29]-1,r)))),r},g.$getHalign=function(t){var e=t.$getLinesArr(),i=0;return t.$TextField[9]==n.HorizontalAlign.CENTER?i=.5:t.$TextField[9]==n.HorizontalAlign.RIGHT&&(i=1),t.$TextField[24]==n.TextFieldType.INPUT&&!t.$TextField[30]&&1<e.length&&(i=0),i},g.$getTextHeight=function(t){return n.TextFieldType.INPUT!=t.$TextField[24]||t.$TextField[30]?t.$TextField[6]+(t.$TextField[29]-1)*t.$TextField[1]:t.$TextField[0]},g.$getValign=function(t){var e=g.$getTextHeight(t),i=t.$TextField[4];if(!isNaN(i)&&e<i){var r=0;return t.$TextField[10]==n.VerticalAlign.MIDDLE?r=.5:t.$TextField[10]==n.VerticalAlign.BOTTOM&&(r=1),r}return 0},g.$getTextElement=function(t,e,i){var r=g.$getHit(t,e,i),n=t.$getLinesArr();return r&&n[r.lineIndex]&&n[r.lineIndex].elements[r.textElementIndex]?n[r.lineIndex].elements[r.textElementIndex]:null},g.$getHit=function(t,e,i){var r=t.$getLinesArr();if(0==t.$TextField[3])return null;var n=0,s=g.$getTextHeight(t),o=0,a=t.$TextField[4];!isNaN(a)&&s<a&&(0!=(o=g.$getValign(t)*(a-s))&&(i-=o));for(var h=0,l=g.$getStartLine(t);l<r.length;l++){var c=r[l];if(h+c.height>=i){h<i&&(n=l+1);break}if((h+=c.height)+t.$TextField[1]>i)return null;h+=t.$TextField[1]}if(0==n)return null;var u=r[n-1],p=t.$TextField[3];isNaN(p)&&(p=t.textWidth),e-=g.$getHalign(t)*(p-u.width);var d=0;for(l=0;l<u.elements.length;l++){var f=u.elements[l];if(d+f.width<=e)d+=f.width;else if(d<e)return{lineIndex:n-1,textElementIndex:l}}return null},g.$getScrollNum=function(t){var e=1;if(t.$TextField[30]){var i=t.height,r=t.size,n=t.lineSpacing;r/2<i-(r+n)*(e=Math.floor(i/(r+n)))&&e++}return e},g}();n.TextFieldUtils=t,__reflect(t.prototype,"egret.TextFieldUtils")}(egret||(egret={})),function(t){t.sys||(t.sys={})}(egret||(egret={})),function(t){var e=function(){};e.TOP="top",e.BOTTOM="bottom",e.MIDDLE="middle",e.JUSTIFY="justify",e.CONTENT_JUSTIFY="contentJustify",t.VerticalAlign=e,__reflect(e.prototype,"egret.VerticalAlign")}(egret||(egret={})),function(i){var r=function(){};r.LITTLE_ENDIAN="littleEndian",r.BIG_ENDIAN="bigEndian",i.Endian=r,__reflect(r.prototype,"egret.Endian");var t=function(){function n(t){this.BUFFER_EXT_SIZE=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=r.BIG_ENDIAN}return n.prototype._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},n.prototype.setArrayBuffer=function(t){},Object.defineProperty(n.prototype,"buffer",{get:function(){return this.data.buffer},set:function(t){this.data=new DataView(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataView",{get:function(){return this.data},set:function(t){this.data=t,this.write_position=t.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this.write_position},set:function(t){this.write_position=t;var e=new Uint8Array(new ArrayBuffer(t)),i=this.data.buffer.byteLength;t<i&&(this._position=t);var r=Math.min(i,t);e.set(new Uint8Array(this.data.buffer,0,r)),this.buffer=e.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),n.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},n.prototype.readBoolean=function(){return this.validate(n.SIZE_OF_BOOLEAN)?0!=this.data.getUint8(this.position++):null},n.prototype.readByte=function(){return this.validate(n.SIZE_OF_INT8)?this.data.getInt8(this.position++):null},n.prototype.readBytes=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),0==i)i=this.bytesAvailable;else if(!this.validate(i))return null;t?t.validateBuffer(e+i):t=new n(new ArrayBuffer(e+i));for(var r=0;r<i;r++)t.data.setUint8(r+e,this.data.getUint8(this.position++))},n.prototype.readDouble=function(){if(!this.validate(n.SIZE_OF_FLOAT64))return null;var t=this.data.getFloat64(this.position,this.endian==r.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_FLOAT64,t},n.prototype.readFloat=function(){if(!this.validate(n.SIZE_OF_FLOAT32))return null;var t=this.data.getFloat32(this.position,this.endian==r.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_FLOAT32,t},n.prototype.readInt=function(){if(!this.validate(n.SIZE_OF_INT32))return null;var t=this.data.getInt32(this.position,this.endian==r.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_INT32,t},n.prototype.readShort=function(){if(!this.validate(n.SIZE_OF_INT16))return null;var t=this.data.getInt16(this.position,this.endian==r.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_INT16,t},n.prototype.readUnsignedByte=function(){return this.validate(n.SIZE_OF_UINT8)?this.data.getUint8(this.position++):null},n.prototype.readUnsignedInt=function(){if(!this.validate(n.SIZE_OF_UINT32))return null;var t=this.data.getUint32(this.position,this.endian==r.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_UINT32,t},n.prototype.readUnsignedShort=function(){if(!this.validate(n.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==r.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_UINT16,t},n.prototype.readUTF=function(){if(!this.validate(n.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==r.LITTLE_ENDIAN);return this.position+=n.SIZE_OF_UINT16,0<t?this.readUTFBytes(t):""},n.prototype.readUTFBytes=function(t){if(!this.validate(t))return null;var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},n.prototype.writeBoolean=function(t){this.validateBuffer(n.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,t?1:0)},n.prototype.writeByte=function(t){this.validateBuffer(n.SIZE_OF_INT8),this.data.setInt8(this.position++,t)},n.prototype.writeBytes=function(t,e,i){var r;if(void 0===e&&(e=0),void 0===i&&(i=0),!(e<0)&&!(i<0)&&0<(r=0==i?t.length-e:Math.min(t.length-e,i))){this.validateBuffer(r);for(var n=new DataView(t.buffer),s=r;4<s;s-=4)this.data.setUint32(this._position,n.getUint32(e)),this.position+=4,e+=4;for(;0<s;s--)this.data.setUint8(this.position++,n.getUint8(e++))}},n.prototype.writeDouble=function(t){this.validateBuffer(n.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==r.LITTLE_ENDIAN),this.position+=n.SIZE_OF_FLOAT64},n.prototype.writeFloat=function(t){this.validateBuffer(n.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,t,this.endian==r.LITTLE_ENDIAN),this.position+=n.SIZE_OF_FLOAT32},n.prototype.writeInt=function(t){this.validateBuffer(n.SIZE_OF_INT32),this.data.setInt32(this.position,t,this.endian==r.LITTLE_ENDIAN),this.position+=n.SIZE_OF_INT32},n.prototype.writeShort=function(t){this.validateBuffer(n.SIZE_OF_INT16),this.data.setInt16(this.position,t,this.endian==r.LITTLE_ENDIAN),this.position+=n.SIZE_OF_INT16},n.prototype.writeUnsignedInt=function(t){this.validateBuffer(n.SIZE_OF_UINT32),this.data.setUint32(this.position,t,this.endian==r.LITTLE_ENDIAN),this.position+=n.SIZE_OF_UINT32},n.prototype.writeUnsignedShort=function(t){this.validateBuffer(n.SIZE_OF_UINT16),this.data.setUint16(this.position,t,this.endian==r.LITTLE_ENDIAN),this.position+=n.SIZE_OF_UINT16},n.prototype.writeUTF=function(t){var e=this.encodeUTF8(t),i=e.length;this.validateBuffer(n.SIZE_OF_UINT16+i),this.data.setUint16(this.position,i,this.endian==r.LITTLE_ENDIAN),this.position+=n.SIZE_OF_UINT16,this._writeUint8Array(e,!1)},n.prototype.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},n.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},n.prototype._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},n.prototype.validate=function(t){return 0<this.data.byteLength&&this._position+t<=this.data.byteLength||void i.$error(1025)},n.prototype.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),r=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,r)),this.buffer=i.buffer}},n.prototype.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),r=[];i.length>e;){var n=i[e++];if(this.inRange(n,55296,57343))this.encoderError(n);else if(this.inRange(n,0,127))r.push(n);else{var s=void 0,o=void 0;for(this.inRange(n,128,2047)?(s=1,o=192):this.inRange(n,2048,65535)?(s=2,o=224):this.inRange(n,65536,1114111)&&(s=3,o=240),r.push(this.div(n,Math.pow(64,s))+o);0<s;){var a=this.div(n,Math.pow(64,s-1));r.push(128+a%64),s-=1}}}return new Uint8Array(r)},n.prototype.decodeUTF8=function(t){for(var e,i=0,r="",n=0,s=0,o=0,a=0;t.length>i;){var h=t[i++];if(h==this.EOF_byte)e=0!=s?this.decoderError(!1):this.EOF_code_point;else if(0==s)this.inRange(h,0,127)?e=h:(this.inRange(h,194,223)?(s=1,a=128,n=h-192):this.inRange(h,224,239)?(s=2,a=2048,n=h-224):this.inRange(h,240,244)?(s=3,a=65536,n=h-240):this.decoderError(!1),n*=Math.pow(64,s),e=null);else if(this.inRange(h,128,191))if(o+=1,n+=(h-128)*Math.pow(64,s-o),o!==s)e=null;else{var l=n,c=a;a=o=s=n=0,e=this.inRange(l,c,1114111)&&!this.inRange(l,55296,57343)?l:this.decoderError(!1,h)}else a=o=s=n=0,i--,e=this.decoderError(!1,h);null!==e&&e!==this.EOF_code_point&&(e<=65535?0<e&&(r+=String.fromCharCode(e)):(e-=65536,r+=String.fromCharCode(55296+(e>>10&1023)),r+=String.fromCharCode(56320+(1023&e))))}return r},n.prototype.encoderError=function(t){i.$error(1026,t)},n.prototype.decoderError=function(t,e){return t&&i.$error(1027),e||65533},n.prototype.inRange=function(t,e,i){return e<=t&&t<=i},n.prototype.div=function(t,e){return Math.floor(t/e)},n.prototype.stringToCodePoints=function(t){for(var e=[],i=0,r=t.length;i<t.length;){var n=t.charCodeAt(i);if(this.inRange(n,55296,57343))if(this.inRange(n,56320,57343))e.push(65533);else if(i==r-1)e.push(65533);else{var s=t.charCodeAt(i+1);if(this.inRange(s,56320,57343)){var o=1023&n,a=1023&s;i+=1,e.push(65536+(o<<10)+a)}else e.push(65533)}else e.push(n);i+=1}return e},n}();t.SIZE_OF_BOOLEAN=1,t.SIZE_OF_INT8=1,t.SIZE_OF_INT16=2,t.SIZE_OF_INT32=4,t.SIZE_OF_UINT8=1,t.SIZE_OF_UINT16=2,t.SIZE_OF_UINT32=4,t.SIZE_OF_FLOAT32=4,t.SIZE_OF_FLOAT64=8,i.ByteArray=t,__reflect(t.prototype,"egret.ByteArray")}(egret||(egret={})),function(t){var e=function(){};e.NORMAL="normal",e.ADD="add",e.ERASE="erase",t.BlendMode=e,__reflect(e.prototype,"egret.BlendMode")}(egret||(egret={})),function(t){!function(t){for(var i=["normal","add","erase"],r={},e=i.length,n=0;n<e;n++){var s=i[n];r[s]=n}t.blendModeToNumber=function(t){var e=r[t];return void 0===e?0:e},t.numberToBlendMode=function(t){var e=i[t];return void 0===e?"normal":e}}(t.sys||(t.sys={}))}(egret||(egret={})),function(i){i.fontMapping={},i.useFontMapping=!1,i.registerFontMapping=function(t,e){i.useFontMapping=!0,i.fontMapping[t]=e}}(egret||(egret={})),(egret||(egret={})).registerClass=function(t,e,i){var r=t.prototype,n=[r.__class__=e];i&&(n=n.concat(i));var s=r.__types__;if(r.__types__)for(var o=s.length,a=0;a<o;a++){var h=s[a];-1==n.indexOf(h)&&n.push(h)}r.__types__=n},function(i){var t=function(e){function t(){var t=e.call(this)||this;return t.$stageWidth=0,t.$stageHeight=0,t.$scaleMode=i.StageScaleMode.SHOW_ALL,t.$orientation=i.OrientationMode.AUTO,t.$maxTouches=99,t.$dirtyRegionPolicy=i.DirtyRegionPolicy.ON,(t.$stage=t).$nestLevel=1,t}return __extends(t,e),Object.defineProperty(t.prototype,"frameRate",{get:function(){return i.sys.$ticker.$frameRate},set:function(t){i.sys.$ticker.$setFrameRate(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageWidth",{get:function(){return this.$stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return this.$stageHeight},enumerable:!0,configurable:!0}),t.prototype.invalidate=function(){i.sys.$invalidateRenderFlag=!0},t.prototype.registerImplementation=function(t,e){i.registerImplementation(t,e)},t.prototype.getImplementation=function(t){return i.getImplementation(t)},Object.defineProperty(t.prototype,"scaleMode",{get:function(){return this.$scaleMode},set:function(t){this.$scaleMode!=t&&(this.$scaleMode=t,this.$screen.updateScreenSize())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orientation",{get:function(){return this.$orientation},set:function(t){this.$orientation!=t&&(this.$orientation=t,this.$screen.updateScreenSize())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureScaleFactor",{get:function(){return i.$TextureScaleFactor},set:function(t){i.$TextureScaleFactor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTouches",{get:function(){return this.$maxTouches},set:function(t){this.$maxTouches!=t&&(this.$maxTouches=t,this.$screen.updateMaxTouches())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dirtyRegionPolicy",{get:function(){return this.$dirtyRegionPolicy},set:function(t){this.$dirtyRegionPolicy!=t&&(this.$dirtyRegionPolicy=t,this.$displayList.setDirtyRegionPolicy(t))},enumerable:!0,configurable:!0}),t.prototype.setContentSize=function(t,e){this.$screen.setContentSize(t,e)},t}(i.DisplayObjectContainer);i.Stage=t,__reflect(t.prototype,"egret.Stage")}(egret||(egret={})),function(t){var e=function(){function t(){}return Object.defineProperty(t,"logLevel",{set:function(t){},enumerable:!0,configurable:!0}),t}();e.ALL="all",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e.OFF="off",t.Logger=e,__reflect(e.prototype,"egret.Logger")}(egret||(egret={})),function(t){var e=function(){function n(){}return n.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},n.sin=function(t){var e=Math.floor(t),i=e+1,r=n.sinInt(e);return e==t?r:(t-e)*n.sinInt(i)+(i-t)*r},n.sinInt=function(t){return(t%=360)<0&&(t+=360),egret_sin_map[t]},n.cos=function(t){var e=Math.floor(t),i=e+1,r=n.cosInt(e);return e==t?r:(t-e)*n.cosInt(i)+(i-t)*r},n.cosInt=function(t){return(t%=360)<0&&(t+=360),egret_cos_map[t]},n}();t.NumberUtils=e,__reflect(e.prototype,"egret.NumberUtils")}(egret||(egret={}));for(var egret_sin_map={},egret_cos_map={},DEG_TO_RAD=Math.PI/180,NumberUtils_i=0;NumberUtils_i<360;NumberUtils_i++)egret_sin_map[NumberUtils_i]=Math.sin(NumberUtils_i*DEG_TO_RAD),egret_cos_map[NumberUtils_i]=Math.cos(NumberUtils_i*DEG_TO_RAD);egret_sin_map[90]=1,egret_cos_map[90]=0,egret_sin_map[180]=0,egret_cos_map[180]=-1,egret_sin_map[270]=-1,egret_cos_map[270]=0,Function.prototype.bind||(Function.prototype.bind=function(t){"function"!=typeof this&&egret.$error(1029);var e=Array.prototype.slice.call(arguments,1),i=this,r=function(){},n=function(){return i.apply(this instanceof r&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,n.prototype=new r,n}),function(i){var t=function(r){function t(t,e){void 0===e&&(e=0);var i=r.call(this)||this;return i._delay=0,i._currentCount=0,i._running=!1,i.updateInterval=1e3,i.lastCount=1e3,i.lastTimeStamp=0,i.delay=t,i.repeatCount=0|+e,i}return __extends(t,r),Object.defineProperty(t.prototype,"delay",{get:function(){return this._delay},set:function(t){t<1&&(t=1),this._delay!=t&&(this._delay=t,this.lastCount=this.updateInterval=Math.round(60*t))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentCount",{get:function(){return this._currentCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.stop(),this._currentCount=0},t.prototype.start=function(){this._running||(this.lastCount=this.updateInterval,this.lastTimeStamp=i.getTimer(),i.sys.$ticker.$startTick(this.$update,this),this._running=!0)},t.prototype.stop=function(){this._running&&(i.stopTick(this.$update,this),this._running=!1)},t.prototype.$update=function(t){if(t-this.lastTimeStamp>=this._delay)this.lastCount=this.updateInterval;else{if(this.lastCount-=1e3,0<this.lastCount)return!1;this.lastCount+=this.updateInterval}this.lastTimeStamp=t,this._currentCount++;var e=0<this.repeatCount&&this._currentCount>=this.repeatCount;return i.TimerEvent.dispatchTimerEvent(this,i.TimerEvent.TIMER),e&&(this.stop(),i.TimerEvent.dispatchTimerEvent(this,i.TimerEvent.TIMER_COMPLETE)),!1},t}(i.EventDispatcher);i.Timer=t,__reflect(t.prototype,"egret.Timer")}(egret||(egret={})),egret||(egret={}),function(n){n.$callLaterFunctionList=[],n.$callLaterThisList=[],n.$callLaterArgsList=[],n.callLater=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];n.$callLaterFunctionList.push(t),n.$callLaterThisList.push(e),n.$callLaterArgsList.push(i)},n.$callAsyncFunctionList=[],n.$callAsyncThisList=[],n.$callAsyncArgsList=[],n.$callAsync=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];n.$callAsyncFunctionList.push(t),n.$callAsyncThisList.push(e),n.$callAsyncArgsList.push(i)}}(egret||(egret={})),function(t){t.superSetter=function(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var s,o=t.prototype;t.hasOwnProperty("__sets__")||Object.defineProperty(t,"__sets__",{value:{}});var a=(s=t.__sets__)[i];if(a)return a.apply(e,r);var h=Object.getPrototypeOf(o);if(null!=h){for(;!h.hasOwnProperty(i);)if(null==(h=Object.getPrototypeOf(h)))return;a=Object.getOwnPropertyDescriptor(h,i).set,(s[i]=a).apply(e,r)}},t.superGetter=function(t,e,i){var r,n=t.prototype;t.hasOwnProperty("__gets__")||Object.defineProperty(t,"__gets__",{value:{}});var s=(r=t.__gets__)[i];if(s)return s.call(e);var o=Object.getPrototypeOf(n);if(null!=o){for(;!o.hasOwnProperty(i);)if(null==(o=Object.getPrototypeOf(o)))return;return s=Object.getOwnPropertyDescriptor(o,i).get,(r[i]=s).call(e)}}}(egret||(egret={})),function(t){var s={};t.getDefinitionByName=function(t){if(!t)return null;var e=s[t];if(e)return e;var i=t.split("."),r=i.length;e=__global;for(var n=0;n<r;n++)if(!(e=e[i[n]]))return null;return s[t]=e}}(egret||(egret={}));var egret,__global=this.__global||this;egret||(egret={}),(egret||(egret={})).getQualifiedClassName=function(t){var e=typeof t;if(!t||"object"!=e&&!t.prototype)return e;var i=t.prototype?t.prototype:Object.getPrototypeOf(t);if(i.hasOwnProperty("__class__"))return i.__class__;var r=i.constructor.toString().trim(),n=r.indexOf("("),s=r.substring(9,n);return Object.defineProperty(i,"__class__",{value:s,enumerable:!1,writable:!0}),s},function(n){n.getQualifiedSuperclassName=function(t){if(!t||"object"!=typeof t&&!t.prototype)return null;var e=t.prototype?t.prototype:Object.getPrototypeOf(t),i=Object.getPrototypeOf(e);if(!i)return null;var r=n.getQualifiedClassName(i.constructor);return r||null}}(egret||(egret={})),function(t){t.getTimer=function(){return Date.now()-t.sys.$START_TIME}}(egret||(egret={})),function(e){e.hasDefinition=function(t){return!!e.getDefinitionByName(t)}}(egret||(egret={})),(egret||(egret={})).is=function(t,e){if(!t||"object"!=typeof t)return!1;var i=Object.getPrototypeOf(t),r=i?i.__types__:null;return!!r&&-1!==r.indexOf(e)},function(i){i.startTick=function(t,e){i.sys.$ticker.$startTick(t,e)}}(egret||(egret={})),function(i){i.stopTick=function(t,e){i.sys.$ticker.$stopTick(t,e)}}(egret||(egret={})),(egret||(egret={})).toColorString=function(t){t<0&&(t=0),16777215<t&&(t=16777215);for(var e=t.toString(16).toUpperCase();6<e.length;)e=e.slice(1,e.length);for(;e.length<6;)e="0"+e;return"#"+e};
var language,egret,__reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};!function(r){var e,t;e=r.web||(r.web={}),t=function(){function e(e){this.defaultVertexSrc="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",this.fragmentSrc="",this.gl=null,this.program=null,this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0}},this.gl=e}return e.prototype.init=function(){var e=this.gl,t=r.WebGLUtils.compileProgram(e,this.defaultVertexSrc,this.fragmentSrc);for(var i in e.useProgram(t),this.aVertexPosition=e.getAttribLocation(t,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(t,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(t,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[i].uniformLocation=e.getUniformLocation(t,i);this.initUniforms(),this.program=t},e.prototype.initUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms){(e=this.uniforms[i]).dirty=!0;var r=e.type;"mat2"===r||"mat3"===r||"mat4"===r?(e.glMatrix=!0,e.glValueLength=1,"mat2"===r?e.glFunc=t.uniformMatrix2fv:"mat3"===r?e.glFunc=t.uniformMatrix3fv:"mat4"===r&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+r],e.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1)}}},e.prototype.syncUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms)(e=this.uniforms[i]).dirty&&(1===e.glValueLength?!0===e.glMatrix?e.glFunc.call(t,e.uniformLocation,e.transpose,e.value):e.glFunc.call(t,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength&&e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w),e.dirty=!1)}},e.prototype.setProjection=function(e,t){var i=this.uniforms.projectionVector;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},e.prototype.setAttribPointer=function(e){var t=this.gl;t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.colorAttribute,1,t.FLOAT,!1,e,16)},e}(),e.EgretShader=t,__reflect(t.prototype,"egret.web.EgretShader")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(t){function e(){var e=t.apply(this,arguments)||this;return e.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}",e}return __extends(e,t),e}(t.EgretShader),t.TextureShader=i,__reflect(i.prototype,"egret.web.TextureShader")}(egret||(egret={})),function(i){!function(e){function t(e){if(window.location){var t=location.search;if(""==t)return"";for(var i=(t=t.slice(1)).split("&"),r=i.length,n=0;n<r;n++){var o=i[n].split("=");if(o[0]==e)return o[1]}}return""}(i.web||(i.web={})).getOption=t,i.getOption=t}()}(egret||(egret={})),function(l){var n,e;n=l.web||(l.web={}),(e=function(t){function s(){var e=t.call(this)||this;return e.loaded=!1,e}return __extends(s,t),Object.defineProperty(s.prototype,"length",{get:function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),s.prototype.load=function(e){function t(){r(),0<=a.indexOf("firefox")&&(o.pause(),o.muted=!1),n.loaded=!0,n.dispatchEventWith(l.Event.COMPLETE)}function i(){r(),n.dispatchEventWith(l.IOErrorEvent.IO_ERROR)}function r(){o.removeEventListener("canplaythrough",t),o.removeEventListener("error",i)}var n=this;this.url=e;var o=new Audio(e);o.addEventListener("canplaythrough",t),o.addEventListener("error",i);var a=navigator.userAgent.toLowerCase();0<=a.indexOf("firefox")&&(o.autoplay=!0,o.muted=!0),o.load(),this.originAudio=o,s.$recycle(this.url,o)},s.prototype.play=function(e,t){e=+e||0,t=+t||0;var i=s.$pop(this.url);null==i&&(i=this.originAudio.cloneNode()),i.autoplay=!0;var r=new n.HtmlSoundChannel(i);return r.$url=this.url,r.$loops=t,r.$startTime=e,r.$play(),l.sys.$pushSoundChannel(r),r},s.prototype.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),s.$clear(this.url)},s.$clear=function(e){var t=s.audios[e];t&&(t.length=0)},s.$pop=function(e){var t=s.audios[e];return t&&0<t.length?t.pop():null},s.$recycle=function(e,t){var i=s.audios[e];null==s.audios[e]&&(i=s.audios[e]=[]),i.push(t)},s}(l.EventDispatcher)).MUSIC="music",e.EFFECT="effect",e.audios={},n.HtmlSound=e,__reflect(e.prototype,"egret.web.HtmlSound",["egret.Sound"])}(egret||(egret={})),function(r){var n,e;n=r.web||(r.web={}),e=function(i){function e(e){var t=i.call(this)||this;return t.$startTime=0,t.audio=null,t.isStopped=!1,t.canPlay=function(){t.audio.removeEventListener("canplay",t.canPlay);try{t.audio.currentTime=t.$startTime}catch(e){}finally{t.audio.play()}},t.onPlayEnd=function(){return 1==t.$loops?(t.stop(),void t.dispatchEventWith(r.Event.SOUND_COMPLETE)):(0<t.$loops&&t.$loops--,void t.$play())},t._volume=1,e.addEventListener("ended",t.onPlayEnd),t.audio=e,t}return __extends(e,i),e.prototype.$play=function(){if(this.isStopped)r.$error(1036);else{try{this.audio.volume=this._volume,this.audio.currentTime=this.$startTime}catch(e){return void this.audio.addEventListener("canplay",this.canPlay)}this.audio.play()}},e.prototype.stop=function(){if(this.audio){this.isStopped||r.sys.$popSoundChannel(this),this.isStopped=!0;var e=this.audio;e.removeEventListener("ended",this.onPlayEnd),e.volume=0,this._volume=0,this.audio=null;var t=this.$url;window.setTimeout(function(){e.pause(),n.HtmlSound.$recycle(t,e)},200)}},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){return this.isStopped?void r.$error(1036):(this._volume=e,void(this.audio&&(this.audio.volume=e)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.audio?this.audio.currentTime:0},enumerable:!0,configurable:!0}),e}(r.EventDispatcher),n.HtmlSoundChannel=e,__reflect(e.prototype,"egret.web.HtmlSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={})),function(r){var n,e;n=r.web||(r.web={}),(e=function(t){function e(){var e=t.call(this)||this;return e.loaded=!1,e}return __extends(e,t),e.prototype.load=function(e){var t=this;this.url=e,QZAppExternal.preloadSound(function(e){0==e.code?(t.loaded=!0,t.dispatchEventWith(r.Event.COMPLETE)):t.dispatchEventWith(r.IOErrorEvent.IO_ERROR)},{bid:-1,url:n.Html5Capatibility._QQRootPath+e,refresh:1})},Object.defineProperty(e.prototype,"length",{get:function(){throw new Error("qq sound not supported!")},enumerable:!0,configurable:!0}),e.prototype.play=function(e,t){e=+e||0,t=+t||0;var i=new n.QQSoundChannel;return i.$url=this.url,i.$loops=t,i.$type=this.type,i.$startTime=e,i.$play(),r.sys.$pushSoundChannel(i),i},e.prototype.close=function(){},e}(r.EventDispatcher)).MUSIC="music",e.EFFECT="effect",n.QQSound=e,__reflect(e.prototype,"egret.web.QQSound",["egret.Sound"])}(egret||(egret={})),function(i){var e,t;e=i.web||(i.web={}),t=function(t){function e(){var e=t.call(this)||this;return e.$startTime=0,e.isStopped=!1,e.onPlayEnd=function(){return 1==e.$loops?(e.stop(),void e.dispatchEventWith(i.Event.SOUND_COMPLETE)):(0<e.$loops&&e.$loops--,void e.$play())},e._startTime=0,e}return __extends(e,t),e.prototype.$play=function(){if(this.isStopped)i.$error(1036);else{this._startTime=Date.now();var e;e=0<this.$loops?this.$loops-1:-1,this.$type==i.Sound.EFFECT?QZAppExternal.playLocalSound(function(e){},{bid:-1,url:this.$url,loop:e}):QZAppExternal.playLocalBackSound(function(e){},{bid:-1,url:this.$url,loop:e})}},e.prototype.stop=function(){this.$type==i.Sound.EFFECT?QZAppExternal.stopSound():QZAppExternal.stopBackSound(),this.isStopped||i.sys.$popSoundChannel(this),this.isStopped=!0},Object.defineProperty(e.prototype,"volume",{get:function(){return 1},set:function(e){return this.isStopped?void i.$error(1036):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return(Date.now()-this._startTime)/1e3},enumerable:!0,configurable:!0}),e}(i.EventDispatcher),e.QQSoundChannel=t,__reflect(t.prototype,"egret.web.QQSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={})),function(a){!function(r){var o=function(){function i(){}return i.decodeAudios=function(){if(!(i.decodeArr.length<=0||i.isDecoding)){i.isDecoding=!0;var t=i.decodeArr.shift();i.ctx.decodeAudioData(t.buffer,function(e){t.self.audioBuffer=e,t.success&&t.success(),i.isDecoding=!1,i.decodeAudios()},function(){alert("sound decode error: "+t.url+"！\nsee http://edn.egret.com/cn/docs/page/156"),t.fail&&t.fail(),i.isDecoding=!1,i.decodeAudios()})}},i}();o.canUseWebAudio=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,o.ctx=o.canUseWebAudio?new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext):void 0,o.decodeArr=[],o.isDecoding=!1,r.WebAudioDecode=o,__reflect(o.prototype,"egret.web.WebAudioDecode");var e=function(t){function e(){var e=t.call(this)||this;return e.loaded=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"length",{get:function(){if(this.audioBuffer)return this.audioBuffer.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),e.prototype.load=function(e){function t(){r.loaded=!0,r.dispatchEventWith(a.Event.COMPLETE)}function i(){r.dispatchEventWith(a.IOErrorEvent.IO_ERROR)}var r=this;this.url=e;var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){o.decodeArr.push({buffer:n.response,success:t,fail:i,self:r,url:r.url}),o.decodeAudios()},n.send()},e.prototype.play=function(e,t){e=+e||0,t=+t||0;var i=new r.WebAudioSoundChannel;return i.$url=this.url,i.$loops=t,i.$audioBuffer=this.audioBuffer,i.$startTime=e,i.$play(),a.sys.$pushSoundChannel(i),i},e.prototype.close=function(){},e}(a.EventDispatcher);e.MUSIC="music",e.EFFECT="effect",r.WebAudioSound=e,__reflect(e.prototype,"egret.web.WebAudioSound",["egret.Sound"])}(a.web||(a.web={}))}(egret||(egret={})),function(r){var i,e;i=r.web||(r.web={}),e=function(t){function e(){var e=t.call(this)||this;return e.$startTime=0,e.bufferSource=null,e.context=i.WebAudioDecode.ctx,e.isStopped=!1,e._currentTime=0,e._volume=1,e.onPlayEnd=function(){return 1==e.$loops?(e.stop(),void e.dispatchEventWith(r.Event.SOUND_COMPLETE)):(0<e.$loops&&e.$loops--,void e.$play())},e._startTime=0,e.context.createGain?e.gain=e.context.createGain():e.gain=e.context.createGainNode(),e}return __extends(e,t),e.prototype.$play=function(){if(this.isStopped)r.$error(1036);else{this.bufferSource&&(this.bufferSource.onended=null,this.bufferSource=null);var e=this.context,t=this.gain,i=e.createBufferSource();(this.bufferSource=i).buffer=this.$audioBuffer,i.connect(t),t.connect(e.destination),i.onended=this.onPlayEnd,this._startTime=Date.now(),this.gain.gain.value=this._volume,i.start(0,this.$startTime),this._currentTime=0}},e.prototype.stop=function(){if(this.bufferSource){var e=this.bufferSource;e.stop?e.stop(0):e.noteOff(0),this.bufferSource.disconnect(),this.bufferSource=null,this.$audioBuffer=null}this.isStopped||r.sys.$popSoundChannel(this),this.isStopped=!0},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){return this.isStopped?void r.$error(1036):(this._volume=e,void(this.gain.gain.value=e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.bufferSource?(Date.now()-this._startTime)/1e3+this.$startTime:0},enumerable:!0,configurable:!0}),e}(r.EventDispatcher),i.WebAudioSoundChannel=e,__reflect(e.prototype,"egret.web.WebAudioSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={})),function(o){var e,t;e=o.web||(o.web={}),t=function(r){function e(e,t){void 0===t&&(t=!0);var i=r.call(this)||this;return i.loaded=!1,i.closed=!1,i.heightSet=NaN,i.widthSet=NaN,i.isPlayed=!1,i.screenChanged=function(e){var t=!!i.video.webkitDisplayingFullscreen;t||(i.checkFullScreen(!1),o.Capabilities.isMobile||(i._fullscreen=t))},i._fullscreen=!0,i.onVideoLoaded=function(){i.video.removeEventListener("canplay",i.onVideoLoaded);var e=i.video;i.loaded=!0,i.posterData&&(i.posterData.width=i.getPlayWidth(),i.posterData.height=i.getPlayHeight()),e.width=e.videoWidth,e.height=e.videoHeight,i.$invalidateContentBounds(),window.setTimeout(function(){i.dispatchEventWith(o.Event.COMPLETE)},200)},i.$renderNode=new o.sys.BitmapNode,i.src=e,i.once(o.Event.ADDED_TO_STAGE,i.loadPoster,i),e&&i.load(),i}return __extends(e,r),e.prototype.load=function(e,t){var i,r=this;(void 0===t&&(t=!0),e=e||this.src,this.src=e,this.video&&this.video.src==e)||(!this.video||o.Capabilities.isMobile?(i=document.createElement("video"),(this.video=i).controls=null):i=this.video,i.src=e,i.setAttribute("autoplay","autoplay"),i.setAttribute("webkit-playsinline","true"),i.addEventListener("canplay",this.onVideoLoaded),i.addEventListener("error",function(){return r.onVideoError()}),i.addEventListener("ended",function(){return r.onVideoEnded()}),i.load(),i.play(),i.style.position="absolute",i.style.top="0px",i.style.zIndex="-88888",i.style.left="0px",i.height=1,i.width=1,window.setTimeout(function(){return i.pause()},170))},e.prototype.play=function(t,i){var r=this;if(void 0===i&&(i=!1),0==this.loaded)return this.load(this.src),void this.once(o.Event.COMPLETE,function(e){return r.play(t,i)},this);this.isPlayed=!0;var e=this.video;null!=t&&(e.currentTime=+t||0),e.loop=!!i,o.Capabilities.isMobile?e.style.zIndex="-88888":e.style.zIndex="9999",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.height=e.videoHeight,e.width=e.videoWidth,"Windows PC"!=o.Capabilities.os&&"Mac OS"!=o.Capabilities.os&&window.setTimeout(function(){e.width=0},1e3),this.checkFullScreen(this._fullscreen)},e.prototype.checkFullScreen=function(e){var t=this.video;if(e)null==t.parentElement&&(t.removeAttribute("webkit-playsinline"),document.body.appendChild(t)),o.stopTick(this.markDirty,this),this.goFullscreen();else if(null!=t.parentElement&&t.parentElement.removeChild(t),t.setAttribute("webkit-playsinline","true"),this.setFullScreenMonitor(!1),o.startTick(this.markDirty,this),o.Capabilities.isMobile)return this.video.currentTime=0,void this.onVideoEnded();t.play()},e.prototype.goFullscreen=function(){var e,t=this.video;return(t[e=o.web.getPrefixStyleName("requestFullscreen",t)]||t[e=o.web.getPrefixStyleName("requestFullScreen",t)])&&(t.removeAttribute("webkit-playsinline"),t[e](),this.setFullScreenMonitor(!0)),!0},e.prototype.setFullScreenMonitor=function(e){var t=this.video;e?(t.addEventListener("mozfullscreenchange",this.screenChanged),t.addEventListener("webkitfullscreenchange",this.screenChanged),t.addEventListener("mozfullscreenerror",this.screenError),t.addEventListener("webkitfullscreenerror",this.screenError)):(t.removeEventListener("mozfullscreenchange",this.screenChanged),t.removeEventListener("webkitfullscreenchange",this.screenChanged),t.removeEventListener("mozfullscreenerror",this.screenError),t.removeEventListener("webkitfullscreenerror",this.screenError))},e.prototype.screenError=function(){o.$error(3014)},e.prototype.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.oCancelFullScreen?document.oCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},e.prototype.onVideoEnded=function(){this.pause(),this.isPlayed=!1,this.$invalidateContentBounds(),this.dispatchEventWith(o.Event.ENDED)},e.prototype.onVideoError=function(){this.dispatchEventWith(o.IOErrorEvent.IO_ERROR)},e.prototype.close=function(){var e=this;this.closed=!0,this.video.removeEventListener("canplay",this.onVideoLoaded),this.video.removeEventListener("error",function(){return e.onVideoError()}),this.video.removeEventListener("ended",function(){return e.onVideoEnded()}),this.pause(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&this.video.parentElement&&(this.video.parentElement.removeChild(this.video),this.video=null),this.loaded=!1},e.prototype.pause=function(){this.video&&this.video.pause(),o.stopTick(this.markDirty,this),this.$invalidate()},Object.defineProperty(e.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(e){this.video&&(this.video.volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.video?this.video.currentTime:0},set:function(e){this.video&&(this.video.currentTime=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullscreen",{get:function(){return this._fullscreen},set:function(e){o.Capabilities.isMobile||(this._fullscreen=!!e,this.video&&0==this.video.paused&&this.checkFullScreen(this._fullscreen))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bitmapData",{get:function(){return this.video&&this.loaded?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=new o.BitmapData(this.video),this._bitmapData.$deleteSource=!1),this._bitmapData):null},enumerable:!0,configurable:!0}),e.prototype.loadPoster=function(){var t=this,e=this.poster;if(e){var i=new o.ImageLoader;i.once(o.Event.COMPLETE,function(e){i.data,t.posterData=i.data,t.posterData.width=t.getPlayWidth(),t.posterData.height=t.getPlayHeight(),t.$invalidateContentBounds()},this),i.load(e)}},e.prototype.$measureContentBounds=function(e){var t=this.bitmapData,i=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):i?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},e.prototype.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:NaN:this.widthSet},e.prototype.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:NaN:this.heightSet},e.prototype.$render=function(){var e=this.$renderNode,t=this.bitmapData,i=this.posterData,r=this.getPlayWidth(),n=this.getPlayHeight();this.isPlayed&&!o.Capabilities.isMobile||!i?this.isPlayed&&t&&(e.image=t,e.imageWidth=t.width,e.imageHeight=t.height,o.WebGLUtils.deleteWebGLTexture(t.webGLTexture),t.webGLTexture=null,e.drawImage(0,0,t.width,t.height,0,0,r,n)):(e.image=i,e.imageWidth=r,e.imageHeight=n,e.drawImage(0,0,i.width,i.height,0,0,r,n))},e.prototype.markDirty=function(){return this.$invalidate(),!0},e.prototype.$setHeight=function(e){return this.heightSet=+e||0,this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$setHeight.call(this,e)},e.prototype.$setWidth=function(e){return this.widthSet=+e||0,this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$setWidth.call(this,e)},Object.defineProperty(e.prototype,"paused",{get:function(){return!this.video||this.video.paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){if(this.video)return this.video.duration;throw new Error("Video not loaded!")},enumerable:!0,configurable:!0}),e}(o.DisplayObject),e.WebVideo=t,__reflect(t.prototype,"egret.web.WebVideo",["egret.Video","egret.DisplayObject"]),o.Video=t}(egret||(egret={})),function(r){var e,t;e=r.web||(r.web={}),t=function(t){function e(){var e=t.call(this)||this;return e._url="",e._method="",e}return __extends(e,t),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr?null!=this._xhr.response?this._xhr.response:"text"==this._responseType?this._xhr.responseText:"arraybuffer"==this._responseType&&/msie 9.0/i.test(navigator.userAgent)?window.convertResponseBodyToText(this._xhr.responseBody):"document"==this._responseType?this._xhr.responseXML:null:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._responseType},set:function(e){this._responseType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withCredentials",{get:function(){return this._withCredentials},set:function(e){this._withCredentials=e},enumerable:!0,configurable:!0}),e.prototype.getXHR=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},e.prototype.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t,this._xhr&&(this._xhr.abort(),this._xhr=null),this._xhr=this.getXHR(),this._xhr.onreadystatechange=this.onReadyStateChange.bind(this),this._xhr.onprogress=this.updateProgress.bind(this),this._xhr.open(this._method,this._url,!0)},e.prototype.send=function(e){if(null!=this._responseType&&(this._xhr.responseType=this._responseType),null!=this._withCredentials&&(this._xhr.withCredentials=this._withCredentials),this.headerObj)for(var t in this.headerObj)this._xhr.setRequestHeader(t,this.headerObj[t]);this._xhr.send(e)},e.prototype.abort=function(){this._xhr&&this._xhr.abort()},e.prototype.getAllResponseHeaders=function(){if(!this._xhr)return null;var e=this._xhr.getAllResponseHeaders();return e||""},e.prototype.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},e.prototype.getResponseHeader=function(e){if(!this._xhr)return null;var t=this._xhr.getResponseHeader(e);return t||""},e.prototype.onReadyStateChange=function(){var e=this._xhr;if(4==e.readyState){var t=400<=e.status||0==e.status,i=(this._url,this);window.setTimeout(function(){t?i.dispatchEventWith(r.IOErrorEvent.IO_ERROR):i.dispatchEventWith(r.Event.COMPLETE)},0)}},e.prototype.updateProgress=function(e){e.lengthComputable&&r.ProgressEvent.dispatchProgressEvent(this,r.ProgressEvent.PROGRESS,e.loaded,e.total)},e}(r.EventDispatcher),e.WebHttpRequest=t,__reflect(t.prototype,"egret.web.WebHttpRequest",["egret.HttpRequest"]),r.HttpRequest=t}(egret||(egret={})),function(r){var n,o,e;n=r.web||(r.web={}),o=window.URL||window.webkitURL,(e=function(t){function i(){var e=t.apply(this,arguments)||this;return e.data=null,e._crossOrigin=null,e._hasCrossOriginSet=!1,e.currentImage=null,e.request=null,e}return __extends(i,t),Object.defineProperty(i.prototype,"crossOrigin",{get:function(){return this._crossOrigin},set:function(e){this._hasCrossOriginSet=!0,this._crossOrigin=e},enumerable:!0,configurable:!0}),i.prototype.load=function(e){if(n.Html5Capatibility._canUseBlob&&0!=e.indexOf("wxLocalResource:")&&0!=e.indexOf("data:")&&0!=e.indexOf("http:")&&0!=e.indexOf("https:")){var t=this.request;t||((t=this.request=new r.web.WebHttpRequest).addEventListener(r.Event.COMPLETE,this.onBlobLoaded,this),t.addEventListener(r.IOErrorEvent.IO_ERROR,this.onBlobError,this),t.responseType="blob"),t.open(e),t.send()}else this.loadImage(e)},i.prototype.onBlobLoaded=function(e){var t=this.request.response;this.loadImage(o.createObjectURL(t))},i.prototype.onBlobError=function(e){this.dispatchIOError(this.currentURL)},i.prototype.loadImage=function(e){var t=new Image;this.data=null,this.currentImage=t,this._hasCrossOriginSet?this._crossOrigin&&(t.crossOrigin=this._crossOrigin):i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.onload=this.onImageComplete.bind(this),t.onerror=this.onLoadError.bind(this),t.src=e},i.prototype.onImageComplete=function(e){var t=this.getImage(e);if(t){this.data=new r.BitmapData(t);var i=this;window.setTimeout(function(){i.dispatchEventWith(r.Event.COMPLETE)},0)}},i.prototype.onLoadError=function(e){var t=this.getImage(e);t&&this.dispatchIOError(t.src)},i.prototype.dispatchIOError=function(e){var t=this;window.setTimeout(function(){t.dispatchEventWith(r.IOErrorEvent.IO_ERROR)},0)},i.prototype.getImage=function(e){var t=e.target;if(0==t.src.indexOf("blob:"))try{o.revokeObjectURL(t.src)}catch(e){r.$warn(1037)}return t.onerror=null,t.onload=null,this.currentImage!==t?null:(this.currentImage=null,t)},i}(r.EventDispatcher)).crossOrigin=null,n.WebImageLoader=e,__reflect(e.prototype,"egret.web.WebImageLoader",["egret.ImageLoader"]),r.ImageLoader=e}(egret||(egret={})),function(u){var i,e;i=u.web||(u.web={}),e=function(t){function e(){var e=t.call(this)||this;return e._isNeedShow=!1,e.inputElement=null,e.inputDiv=null,e._gscaleX=0,e._gscaleY=0,e._isNeesHide=!1,e.textValue="",e.colorValue=16777215,e._styleInfoes={},e}return __extends(e,t),e.prototype.$setTextField=function(e){return this.$textfield=e,!0},e.prototype.$addToStage=function(){this.htmlInput=u.web.$getTextAdapter(this.$textfield)},e.prototype._initElement=function(){var e=this.$textfield.localToGlobal(0,0),t=e.x,i=e.y,r=this.htmlInput.$scaleX,n=this.htmlInput.$scaleY;this.inputDiv.style.left=t*r+"px",this.inputDiv.style.top=i*n+"px",this.$textfield.multiline&&this.$textfield.height>this.$textfield.size?(this.inputDiv.style.top=i*n+"px",this.inputElement.style.top=-this.$textfield.lineSpacing/2*n+"px"):(this.inputDiv.style.top=i*n+"px",this.inputElement.style.top="0px");for(var o=this.$textfield,a=1,s=1,l=0;o.parent;)a*=o.scaleX,s*=o.scaleY,l+=o.rotation,o=o.parent;var h=u.web.getPrefixStyleName("transform");this.inputDiv.style[h]="rotate("+l+"deg)",this._gscaleX=r*a,this._gscaleY=n*s},e.prototype.$show=function(){this.htmlInput.isCurrentStageText(this)?this.inputElement.onblur=null:(this.inputElement=this.htmlInput.getInputElement(this),this.$textfield.multiline?this.inputElement.type="text":this.inputElement.type=this.$textfield.inputType,this.inputDiv=this.htmlInput._inputDIV),this.htmlInput._needShow=!0,this._isNeedShow=!0,this._initElement()},e.prototype.onBlurHandler=function(){this.htmlInput.clearInputElement(),window.scrollTo(0,0)},e.prototype.executeShow=function(){this.inputElement.value=this.$getText(),null==this.inputElement.onblur&&(this.inputElement.onblur=this.onBlurHandler.bind(this)),this.$resetStageText(),0<this.$textfield.maxChars?this.inputElement.setAttribute("maxlength",this.$textfield.maxChars):this.inputElement.removeAttribute("maxlength"),this.inputElement.selectionStart=this.inputElement.value.length,this.inputElement.selectionEnd=this.inputElement.value.length,this.inputElement.focus()},e.prototype.$hide=function(){this._isNeesHide=!0,this.htmlInput&&u.web.Html5Capatibility._System_OS==u.web.SystemOSType.IOS&&this.htmlInput.disconnectStageText(this)},e.prototype.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},e.prototype.$setText=function(e){return this.textValue=e,this.resetText(),!0},e.prototype.resetText=function(){this.inputElement&&(this.inputElement.value=this.textValue)},e.prototype.$setColor=function(e){return this.colorValue=e,this.resetColor(),!0},e.prototype.resetColor=function(){this.inputElement&&this.setElementStyle("color",u.toColorString(this.colorValue))},e.prototype.$onBlur=function(){i.Html5Capatibility._System_OS==i.SystemOSType.WPHONE&&u.Event.dispatchEvent(this,"updateText",!1)},e.prototype._onInput=function(){var e=this;if(i.Html5Capatibility._System_OS==i.SystemOSType.WPHONE){var t=this.$textfield.$TextField;null==t[35]&&null==t[36]?(e.textValue=e.inputElement.value,u.Event.dispatchEvent(e,"updateText",!1)):window.setTimeout(function(){e.inputElement&&e.inputElement.selectionStart&&e.inputElement.selectionEnd&&e.inputElement.selectionStart==e.inputElement.selectionEnd&&(e.textValue=e.inputElement.value,u.Event.dispatchEvent(e,"updateText",!1))},0)}else window.setTimeout(function(){e.inputElement&&e.inputElement.selectionStart==e.inputElement.selectionEnd&&(e.textValue=e.inputElement.value,u.Event.dispatchEvent(e,"updateText",!1))},0)},e.prototype.setAreaHeight=function(){var e=this.$textfield;if(e.multiline){var t=u.TextFieldUtils.$getTextHeight(e);if(e.height<=e.size)this.setElementStyle("height",e.size*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",e.size*this._gscaleY+"px");else if(e.height<t)this.setElementStyle("height",e.height*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",(e.size+e.lineSpacing)*this._gscaleY+"px");else{this.setElementStyle("height",(t+e.lineSpacing)*this._gscaleY+"px");var i=(e.height-t)*this._gscaleY,r=i*u.TextFieldUtils.$getValign(e),n=i-r;this.setElementStyle("padding",r+"px 0px "+n+"px 0px"),this.setElementStyle("lineHeight",(e.size+e.lineSpacing)*this._gscaleY+"px")}}},e.prototype._onClickHandler=function(e){this._isNeedShow&&(e.stopImmediatePropagation(),this._isNeedShow=!1,this.executeShow(),this.dispatchEvent(new u.Event("focus")))},e.prototype._onDisconnect=function(){this.inputElement=null,this.dispatchEvent(new u.Event("blur"))},e.prototype.setElementStyle=function(e,t){this.inputElement&&this._styleInfoes[e]!=t&&(this.inputElement.style[e]=t)},e.prototype.$removeFromStage=function(){this.inputElement&&this.htmlInput.disconnectStageText(this)},e.prototype.$resetStageText=function(){if(this.inputElement){var e=this.$textfield;this.setElementStyle("fontFamily",e.fontFamily),this.setElementStyle("fontStyle",e.italic?"italic":"normal"),this.setElementStyle("fontWeight",e.bold?"bold":"normal"),this.setElementStyle("textAlign",e.textAlign),this.setElementStyle("fontSize",e.size*this._gscaleY+"px"),this.setElementStyle("color",u.toColorString(e.textColor));var t=void 0;if(e.stage?(t=e.localToGlobal(0,0).x,t=Math.min(e.width,e.stage.stageWidth-t)):t=e.width,this.setElementStyle("width",t*this._gscaleX+"px"),this.setElementStyle("verticalAlign",e.verticalAlign),e.multiline)this.setAreaHeight();else if(this.setElementStyle("lineHeight",e.size*this._gscaleY+"px"),e.height<e.size){this.setElementStyle("height",e.size*this._gscaleY+"px");var i=e.size/2*this._gscaleY;this.setElementStyle("padding","0px 0px "+i+"px 0px")}else{this.setElementStyle("height",e.size*this._gscaleY+"px");var r=(e.height-e.size)*this._gscaleY,n=r*u.TextFieldUtils.$getValign(e);(i=r-n)<e.size/2*this._gscaleY&&(i=e.size/2*this._gscaleY),this.setElementStyle("padding",n+"px 0px "+i+"px 0px")}this.inputDiv.style.clip="rect(0px "+e.width*this._gscaleX+"px "+e.height*this._gscaleY+"px 0px)",this.inputDiv.style.height=e.height*this._gscaleY+"px",this.inputDiv.style.width=t*this._gscaleX+"px"}},e}(u.EventDispatcher),i.HTML5StageText=e,__reflect(e.prototype,"egret.web.HTML5StageText",["egret.StageText"]),u.StageText=e}(egret||(egret={})),function(o){var e,t;e=o.web||(o.web={}),t=function(){function e(){this._needShow=!1,this.$scaleX=1,this.$scaleY=1}return e.prototype.isInputOn=function(){return null!=this._stageText},e.prototype.isCurrentStageText=function(e){return this._stageText==e},e.prototype.initValue=function(e){e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border="none",e.style.padding="0"},e.prototype.$updateSize=function(){if(this.canvas){var e=this.canvas.width,t=this.canvas.height,i=this.canvas.style.width.split("px")[0],r=this.canvas.style.height.split("px")[0];this.$scaleX=i/e,this.$scaleY=r/t,this.StageDelegateDiv.style.left=this.canvas.style.left,this.StageDelegateDiv.style.top=this.canvas.style.top;var n=o.web.getPrefixStyleName("transform");this.StageDelegateDiv.style[n]=this.canvas.style[n],this.StageDelegateDiv.style[o.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px"}},e.prototype._initStageDelegateDiv=function(e,t){this.canvas=t;var i,r=this;i||(i=document.createElement("div"),(this.StageDelegateDiv=i).id="StageDelegateDiv",e.appendChild(i),r.initValue(i),r._inputDIV=document.createElement("div"),r.initValue(r._inputDIV),r._inputDIV.style.width="0px",r._inputDIV.style.height="0px",r._inputDIV.style.left="0px",r._inputDIV.style.top="-100px",r._inputDIV.style[o.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",i.appendChild(r._inputDIV),this.canvas.addEventListener("click",function(e){r._needShow?(r._needShow=!1,r._stageText._onClickHandler(e),r.show()):r._inputElement&&(r.clearInputElement(),r._inputElement.blur(),r._inputElement=null)}),r.initInputElement(!0),r.initInputElement(!1))},e.prototype.initInputElement=function(e){var t,i=this;e?((t=document.createElement("textarea")).style.resize="none",(i._multiElement=t).id="egretTextarea"):(t=document.createElement("input"),(i._simpleElement=t).id="egretInput"),t.type="text",i._inputDIV.appendChild(t),t.setAttribute("tabindex","-1"),t.style.width="1px",t.style.height="12px",i.initValue(t),t.style.outline="thin",t.style.background="none",t.style.overflow="hidden",t.style.wordBreak="break-all",t.style.opacity=0,t.oninput=function(){i._stageText&&i._stageText._onInput()}},e.prototype.show=function(){var e=this._inputElement;o.$callAsync(function(){e.style.opacity=1},this)},e.prototype.disconnectStageText=function(e){(null==this._stageText||this._stageText==e)&&(this.clearInputElement(),this._inputElement&&this._inputElement.blur())},e.prototype.clearInputElement=function(){var e=this;if(e._inputElement){e._inputElement.value="",e._inputElement.onblur=null,e._inputElement.style.width="1px",e._inputElement.style.height="12px",e._inputElement.style.left="0px",e._inputElement.style.top="0px";e._inputElement.style.opacity=0;(e._simpleElement==e._inputElement?e._multiElement:e._simpleElement).style.display="block",e._inputDIV.style.left="0px",e._inputDIV.style.top="-100px",e._inputDIV.style.height="0px",e._inputDIV.style.width="0px"}e._stageText&&(e._stageText._onDisconnect(),e._stageText=null,this.canvas.userTyping=!1)},e.prototype.getInputElement=function(e){var t=this;return t.clearInputElement(),t._stageText=e,this.canvas.userTyping=!0,t._stageText.$textfield.multiline?t._inputElement=t._multiElement:t._inputElement=t._simpleElement,(t._simpleElement==t._inputElement?t._multiElement:t._simpleElement).style.display="none",t._inputElement},e}(),e.HTMLInput=t,__reflect(t.prototype,"egret.web.HTMLInput")}(egret||(egret={})),function(e){var t,o,a,s;t=e.web||(e.web={}),o={},a={},s={},t.$getTextAdapter=function(e){var t=e.stage?e.stage.$hashCode:0,i=o[t],r=a[t],n=s[t];return r&&n&&(delete a[t],delete s[t]),i},t.$cacheTextAdapter=function(e,t,i,r){e._initStageDelegateDiv(i,r),o[t.$hashCode]=e,a[t.$hashCode]=r,s[t.$hashCode]=i}}(egret||(egret={})),function(a){var s;a.web||(a.web={}),s=null,a.sys.measureText=function(e,t,i,r,n){s||((s=a.sys.canvasHitTestBuffer.context).textAlign="left",s.textBaseline="middle");var o="";return n&&(o+="italic "),r&&(o+="bold "),o+=(i||12)+"px ",o+=t||"Arial",s.font=o,s.measureText(e).width}}(egret||(egret={})),function(e){!function(e){function s(e,t){var i=document.createElement("canvas");isNaN(e)||isNaN(t)||(i.width=e,i.height=t);var r=i.getContext("2d");if(void 0===r.imageSmoothingEnabled){for(var n,o=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],a=o.length-1;0<=a&&void 0===r[n=o[a]];a--);try{Object.defineProperty(r,"imageSmoothingEnabled",{get:function(){return this[n]},set:function(e){this[n]=e}})}catch(e){r.imageSmoothingEnabled=r[n]}}return i}var l,t=function(){function e(e,t,i){this.surface=s(e,t),this.context=this.surface.getContext("2d")}return Object.defineProperty(e.prototype,"width",{get:function(){return this.surface.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.surface.height},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t,i){var r=this.surface;if(i){var n=!1;r.width<e&&(r.width=e,n=!0),r.height<t&&(r.height=t,n=!0),n||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else r.width!=e&&(r.width=e),r.height!=t&&(r.height=t);this.clear()},e.prototype.resizeTo=function(e,t,i,r){l||(l=s());var n=(this.context,this.surface),o=l,a=o.getContext("2d");l=n,this.context=a,(this.surface=o).width=Math.max(e,257),o.height=Math.max(t,257),a.setTransform(1,0,0,1,0,0),a.drawImage(n,i,r),n.height=1,n.width=1},e.prototype.setDirtyRegionPolicy=function(e){},e.prototype.beginClip=function(e,t,i){t=+t||0,i=+i||0;var r=this.context;r.save(),r.beginPath(),r.setTransform(1,0,0,1,t,i);for(var n=e.length,o=0;o<n;o++){var a=e[o];r.clearRect(a.minX,a.minY,a.width,a.height),r.rect(a.minX,a.minY,a.width,a.height)}r.clip()},e.prototype.endClip=function(){this.context.restore()},e.prototype.getPixels=function(e,t,i,r){return void 0===i&&(i=1),void 0===r&&(r=1),this.context.getImageData(e,t,i,r).data},e.prototype.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},e.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.destroy=function(){this.surface.width=this.surface.height=0},e}();e.CanvasRenderBuffer=t,__reflect(t.prototype,"egret.web.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(e.web||(e.web={}))}(egret||(egret={})),function(h){var e,t;e=h.web||(h.web={}),t=function(r){function e(e,t){var i=r.call(this)||this;return i.onTouchBegin=function(e){var t=i.getLocation(e);i.touch.onTouchBegin(t.x,t.y,e.identifier)},i.onTouchMove=function(e){var t=i.getLocation(e);i.touch.onTouchMove(t.x,t.y,e.identifier)},i.onTouchEnd=function(e){var t=i.getLocation(e);i.touch.onTouchEnd(t.x,t.y,e.identifier)},i.scaleX=1,i.scaleY=1,i.rotation=0,i.canvas=t,i.touch=new h.sys.TouchHandler(e),i.addListeners(),i}return __extends(e,r),e.prototype.addListeners=function(){var t=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(e){e.identifier=e.pointerId,t.onTouchBegin(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerMove",function(e){e.identifier=e.pointerId,t.onTouchMove(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerUp",function(e){e.identifier=e.pointerId,t.onTouchEnd(e),t.prevent(e)},!1)):(h.Capabilities.$isMobile||this.addMouseListener(),this.addTouchListener())},e.prototype.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onTouchMove),this.canvas.addEventListener("mouseup",this.onTouchEnd)},e.prototype.addTouchListener=function(){var r=this;this.canvas.addEventListener("touchstart",function(e){for(var t=e.changedTouches.length,i=0;i<t;i++)r.onTouchBegin(e.changedTouches[i]);r.prevent(e)},!1),this.canvas.addEventListener("touchmove",function(e){for(var t=e.changedTouches.length,i=0;i<t;i++)r.onTouchMove(e.changedTouches[i]);r.prevent(e)},!1),this.canvas.addEventListener("touchend",function(e){for(var t=e.changedTouches.length,i=0;i<t;i++)r.onTouchEnd(e.changedTouches[i]);r.prevent(e)},!1),this.canvas.addEventListener("touchcancel",function(e){for(var t=e.changedTouches.length,i=0;i<t;i++)r.onTouchEnd(e.changedTouches[i]);r.prevent(e)},!1)},e.prototype.prevent=function(e){e.stopPropagation(),1==e.isScroll||this.canvas.userTyping||e.preventDefault()},e.prototype.getLocation=function(e){e.identifier=+e.identifier||0;var t=document.documentElement,i=this.canvas.getBoundingClientRect(),r=i.left+window.pageXOffset-t.clientLeft,n=i.top+window.pageYOffset-t.clientTop,o=e.pageX-r,a=o,s=e.pageY-n,l=s;return 90==this.rotation?(a=s,l=i.width-o):-90==this.rotation&&(a=i.height-s,l=o),a/=this.scaleX,l/=this.scaleY,h.$TempPoint.setTo(Math.round(a),Math.round(l))},e.prototype.updateScaleMode=function(e,t,i){this.scaleX=e,this.scaleY=t,this.rotation=i},e.prototype.$updateMaxTouches=function(){this.touch.$initMaxTouches()},e}(h.HashObject),e.WebTouchHandler=t,__reflect(t.prototype,"egret.web.WebTouchHandler")}(egret||(egret={})),function(h){var e,t;e=h.web||(h.web={}),t=function(i){function e(e){var t=i.call(this)||this;return t.isActivate=!0,t.stage=e,t.registerListener(),t}return __extends(e,i),e.prototype.registerListener=function(){var e,t,i=this,r=function(){i.isActivate&&(i.isActivate=!1,i.stage.dispatchEvent(new h.Event(h.Event.DEACTIVATE)))},n=function(){i.isActivate||(i.isActivate=!0,i.stage.dispatchEvent(new h.Event(h.Event.ACTIVATE)))};window.addEventListener("focus",n,!1),window.addEventListener("blur",r,!1),void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden?(e="webkitHidden",t="webkitvisibilitychange"):void 0!==document.oHidden&&(e="oHidden",t="ovisibilitychange"),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pageshow",n,!1),window.addEventListener("pagehide",r,!1)),e&&t&&document.addEventListener(t,function(){document[e]?r():n()},!1);var o=navigator.userAgent,a=/micromessenger/gi.test(o),s=/mqq/gi.test(o);if((/mobile.*qq/gi.test(o)||a)&&(s=!1),s){var l=window.browser||{};l.execWebFn=l.execWebFn||{},l.execWebFn.postX5GamePlayerMessage=function(e){var t=e.type;"app_enter_background"==t?r():"app_enter_foreground"==t&&n()},window.browser=l}},e}(h.HashObject),e.WebHideHandler=t,__reflect(t.prototype,"egret.web.WebHideHandler")}(egret||(egret={})),function(u){!function(e){function n(e,t){if(e in t)return"";e=e.charAt(0).toUpperCase()+e.substring(1,e.length);for(var i=["webkit","ms","Moz","O"],r=0;r<i.length;r++){if(i[r]+e in t)return i[r]}return""}var l=function(){};l.QQ_AUDIO=1,l.WEB_AUDIO=2,l.HTML5_AUDIO=3,e.AudioType=l,__reflect(l.prototype,"egret.web.AudioType");var h=function(){};h.WPHONE=1,h.IOS=2,h.ADNROID=3,e.SystemOSType=h,__reflect(h.prototype,"egret.web.SystemOSType");var t=function(e){function s(){return e.call(this)||this}return __extends(s,e),s.$init=function(){var e=navigator.userAgent.toLowerCase();s.ua=e,u.Capabilities.$isMobile=-1!=e.indexOf("mobile")||-1!=e.indexOf("android"),s._canUseBlob=!1;var t,i=s._audioType,r=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(1==i||2==i||3==i?(t=!1,s.setAudioType(i)):(t=!0,s.setAudioType(l.HTML5_AUDIO)),0<=e.indexOf("windows phone"))s._System_OS=h.WPHONE,u.Capabilities.$os="Windows Phone";else if(0<=e.indexOf("android")){if(u.Capabilities.$os="Android",s._System_OS=h.ADNROID,t&&s.setAudioType(r?l.WEB_AUDIO:l.HTML5_AUDIO),window.hasOwnProperty("QZAppExternal")&&0<=e.indexOf("qzone")){t&&s.setAudioType(l.QQ_AUDIO);var n=document.getElementsByTagName("base");if(n&&0<n.length)s._QQRootPath=n[0].baseURI;else{var o=window.location.href.indexOf("?");-1==o&&(o=window.location.href.length);var a=window.location.href.substring(0,o);a=a.substring(0,a.lastIndexOf("/")),s._QQRootPath=a+"/"}}}else 0<=e.indexOf("iphone")||0<=e.indexOf("ipad")||0<=e.indexOf("ipod")?(u.Capabilities.$os="iOS",s._System_OS=h.IOS,7<=s.getIOSVersion()&&(s._canUseBlob=!0,t&&s.setAudioType(l.WEB_AUDIO))):-1!=e.indexOf("windows nt")?u.Capabilities.$os="Windows PC":-1!=e.indexOf("mac os")&&(u.Capabilities.$os="Mac OS");window.URL||window.webkitURL||(s._canUseBlob=!1),u.Sound=s._AudioClass},s.setAudioType=function(e){switch(s._audioType=e){case l.QQ_AUDIO:s._AudioClass=u.web.QQSound;break;case l.WEB_AUDIO:s._AudioClass=u.web.WebAudioSound;break;case l.HTML5_AUDIO:s._AudioClass=u.web.HtmlSound}},s.getIOSVersion=function(){var e=s.ua.toLowerCase().match(/cpu [^\d]*\d.*like mac os x/)[0];return parseInt(e.match(/\d+(_\d)*/)[0])||0},s.checkHtml5Support=function(){var e=(navigator.language||navigator.browserLanguage).toLowerCase().split("-");1<e.length&&(e[1]=e[1].toUpperCase()),u.Capabilities.$language=e.join("-")},s}(u.HashObject);t._canUseBlob=!1,t._audioType=0,t._QQRootPath="",t._System_OS=0,t.ua="",e.Html5Capatibility=t,__reflect(t.prototype,"egret.web.Html5Capatibility");var o=null;e.getPrefixStyleName=function(e,t){var i="";if(null!=t)i=n(e,t);else{if(null==o){var r=document.createElement("div").style;o=n("transform",r)}i=o}return""==i?e:i+e.charAt(0).toUpperCase()+e.substring(1,e.length)},e.getPrefix=n}(u.web||(u.web={}))}(egret||(egret={})),function(d){!function(u){function e(){t=NaN,d.updateAllScreens()}var c=!1;window.isNaN=function(e){return(e=+e)!=e},d.runEgret=function(e){if(!c){if(c=!0,e||(e={}),u.Html5Capatibility._audioType=e.audioType,u.Html5Capatibility.$init(),"webgl"==e.renderMode){var t=e.antialias;u.WebGLRenderContext.antialias=!!t}d.sys.CanvasRenderBuffer=u.CanvasRenderBuffer,"webgl"==e.renderMode&&d.WebGLUtils.checkCanUseWebGL()?(d.sys.RenderBuffer=u.WebGLRenderBuffer,d.sys.systemRenderer=new u.WebGLRenderer,d.sys.canvasRenderer=new d.CanvasRenderer,d.sys.customHitTestBuffer=new u.WebGLRenderBuffer(3,3),d.sys.canvasHitTestBuffer=new u.CanvasRenderBuffer(3,3),d.Capabilities.$renderMode="webgl"):(d.sys.RenderBuffer=u.CanvasRenderBuffer,d.sys.systemRenderer=new d.CanvasRenderer,d.sys.canvasRenderer=d.sys.systemRenderer,d.sys.customHitTestBuffer=new u.CanvasRenderBuffer(3,3),d.sys.canvasHitTestBuffer=d.sys.customHitTestBuffer,d.Capabilities.$renderMode="canvas");var i=d.sys.$ticker;l=i,(h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame)||(h=function(e){return window.setTimeout(e,1e3/60)}),h.call(window,function e(){l.update(),h.call(window,e)}),e.screenAdapter?d.sys.screenAdapter=e.screenAdapter:d.sys.screenAdapter||(d.sys.screenAdapter=new d.sys.DefaultScreenAdapter);for(var r=document.querySelectorAll(".egret-player"),n=r.length,o=0;o<n;o++){var a=r[o],s=new u.WebPlayer(a,e);a["egret-player"]=s,"webgl"==d.Capabilities.$renderMode&&(s.stage.dirtyRegionPolicy=d.DirtyRegionPolicy.OFF)}"webgl"==d.Capabilities.$renderMode&&(d.sys.DisplayList.prototype.setDirtyRegionPolicy=function(){})}var l,h},d.updateAllScreens=function(){if(c)for(var e=document.querySelectorAll(".egret-player"),t=e.length,i=0;i<t;i++)e[i]["egret-player"].updateScreenSize()};var t=NaN;window.addEventListener("resize",function(){isNaN(t)&&(t=window.setTimeout(e,300))})}(d.web||(d.web={}))}(egret||(egret={})),function(n){var e,t;e=n.web||(n.web={}),t=function(){function r(){}return r.detect=function(){var e=n.Capabilities,t=navigator.userAgent.toLowerCase();e.$isMobile=-1!=t.indexOf("mobile")||-1!=t.indexOf("android"),e.$isMobile?t.indexOf("windows")<0&&(-1!=t.indexOf("iphone")||-1!=t.indexOf("ipad")||-1!=t.indexOf("ipod"))?e.$os="iOS":-1!=t.indexOf("android")&&-1!=t.indexOf("linux")?e.$os="Android":-1!=t.indexOf("windows")&&(e.$os="Windows Phone"):-1!=t.indexOf("windows nt")?e.$os="Windows PC":-1!=t.indexOf("mac os")&&(e.$os="Mac OS");var i=(navigator.language||navigator.browserLanguage).toLowerCase().split("-");1<i.length&&(i[1]=i[1].toUpperCase()),e.$language=i.join("-"),r.injectUIntFixOnIE9()},r.injectUIntFixOnIE9=function(){if(/msie 9.0/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){document.write("\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\n<script type='text/vbscript' language='VBScript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n<\/script>\r\n\x3c!-- convertResponseBodyToText --\x3e\r\n<script>\r\nlet convertResponseBodyToText = function (binary) {\r\n   let byteMapping = {};\r\n   for ( let i = 0; i < 256; i++ ) {\r\n       for ( let j = 0; j < 256; j++ ) {\r\n           byteMapping[ String.fromCharCode( i + j * 256 ) ] =\r\n           String.fromCharCode(i) + String.fromCharCode(j);\r\n       }\r\n   }\r\n   let rawBytes = IEBinaryToArray_ByteStr(binary);\r\n   let lastChr = IEBinaryToArray_ByteStr_Last(binary);\r\n   return rawBytes.replace(/[\\s\\S]/g,                           function( match ) { return byteMapping[match]; }) + lastChr;\r\n};\r\n<\/script>\r\n")}},r}(),e.WebCapability=t,__reflect(t.prototype,"egret.web.WebCapability"),t.detect()}(egret||(egret={})),function(h){var e,t;e=h.web||(h.web={}),t=function(l){function e(e,t,i,r,n){var o=l.call(this)||this;if(o.showPanle=!0,o.fpsHeight=0,o.WIDTH=101,o.HEIGHT=20,o.bgCanvasColor="#18304b",o.fpsFrontColor="#18fefe",o.WIDTH_COST=33,o.cost1Color="#18fefe",o.cost2Color="#ffff00",o.cost3Color="#ff0000",o.arrFps=[],o.arrCost=[],o.arrLog=[],t||i){"canvas"==h.Capabilities.renderMode?o.renderMode="Canvas":o.renderMode="WebGL",o.panelX=void 0===n.x?0:parseInt(n.x),o.panelY=void 0===n.y?0:parseInt(n.y),o.fontColor=void 0===n.textColor?"#ffffff":n.textColor.replace("0x","#"),o.fontSize=void 0===n.size?12:parseInt(n.size),h.Capabilities.isMobile&&(o.fontSize-=2);var a=document.createElement("div");a.style.position="absolute",a.style.background="rgba(0,0,0,"+n.bgAlpha+")",a.style.left=o.panelX+"px",a.style.top=o.panelY+"px",a.style.pointerEvents="none",document.body.appendChild(a);var s=document.createElement("div");s.style.color=o.fontColor,s.style.fontSize=o.fontSize+"px",s.style.lineHeight=o.fontSize+"px",s.style.margin="4px 4px 4px 4px",o.container=s,a.appendChild(s),t&&o.addFps(),i&&o.addLog()}return o}return __extends(e,l),e.prototype.addFps=function(){var e=document.createElement("div");e.style.display="inline-block",this.containerFps=e,this.container.appendChild(e);var t=document.createElement("div");t.style.paddingBottom="2px",this.fps=t,this.containerFps.appendChild(t),t.innerHTML="0 FPS "+this.renderMode+"<br/>min0 max0 avg0";var i=document.createElement("canvas");this.containerFps.appendChild(i),i.width=this.WIDTH,i.height=this.HEIGHT;var r=(this.canvasFps=i).getContext("2d");(this.contextFps=r).fillStyle=this.bgCanvasColor,r.fillRect(0,0,this.WIDTH,this.HEIGHT);var n=document.createElement("div");this.divDatas=n,this.containerFps.appendChild(n);var o=document.createElement("div");o.style.float="left",o.innerHTML="Draw<br/>Dirty<br/>Cost",n.appendChild(o);var a=document.createElement("div");a.style.paddingLeft=o.offsetWidth+20+"px",n.appendChild(a);var s=document.createElement("div");(this.divDraw=s).innerHTML="0<br/>0<br/>",a.appendChild(s);var l=document.createElement("div");(this.divCost=l).innerHTML='<font  style="color:'+this.cost1Color+'">0<font/> <font  style="color:'+this.cost2Color+'">0<font/> <font  style="color:'+this.cost3Color+'">0<font/>',a.appendChild(l),i=document.createElement("canvas"),this.canvasCost=i,this.containerFps.appendChild(i),i.width=this.WIDTH,i.height=this.HEIGHT,r=i.getContext("2d"),(this.contextCost=r).fillStyle=this.bgCanvasColor,r.fillRect(0,0,this.WIDTH,this.HEIGHT),r.fillStyle="#000000",r.fillRect(this.WIDTH_COST,0,1,this.HEIGHT),r.fillRect(2*this.WIDTH_COST+1,0,1,this.HEIGHT),this.fpsHeight=this.container.offsetHeight},e.prototype.addLog=function(){var e=document.createElement("div");e.style.maxWidth=document.body.clientWidth-8-this.panelX+"px",e.style.wordWrap="break-word",this.log=e,this.container.appendChild(e)},e.prototype.update=function(e,t){var i,r,n,o;void 0===t&&(t=!1),t?(i=this.arrFps[this.arrFps.length-1],r=this.arrCost[this.arrCost.length-1][0],n=this.arrCost[this.arrCost.length-1][1],o=this.arrCost[this.arrCost.length-1][2]):(i=e.fps,r=e.costTicker,n=e.costDirty,o=e.costRender,this.lastNumDraw=e.draw,this.lastNumDirty=e.dirty,this.arrFps.push(i),this.arrCost.push([r,n,o]));var a=0,s=this.arrFps.length;101<s&&(s=101,this.arrFps.shift());for(var l=this.arrFps[0],h=this.arrFps[0],u=0;u<s;u++){var c=this.arrFps[u];a+=c,c<l?l=c:h<c&&(h=c)}var d=this.WIDTH,p=this.HEIGHT,f=this.contextFps;f.drawImage(this.canvasFps,1,0,d-1,p,0,0,d-1,p),f.fillStyle=this.bgCanvasColor,f.fillRect(d-1,0,1,p);var g=Math.floor(i/60*20);g<1&&(g=1),f.fillStyle=this.fpsFrontColor,f.fillRect(d-1,20-g,1,g);var v=this.WIDTH_COST;(f=this.contextCost).drawImage(this.canvasCost,1,0,v-1,p,0,0,v-1,p),f.drawImage(this.canvasCost,v+2,0,v-1,p,v+1,0,v-1,p),f.drawImage(this.canvasCost,2*v+3,0,v-1,p,2*v+2,0,v-1,p);var y=Math.floor(r/2);y<1?y=1:20<y&&(y=20);var m=Math.floor(n/2);m<1?m=1:20<m&&(m=20);var x=Math.floor(o/2);x<1?x=1:20<x&&(x=20),f.fillStyle=this.bgCanvasColor,f.fillRect(v-1,0,1,p),f.fillRect(2*v,0,1,p),f.fillRect(3*v+1,0,1,p),f.fillStyle=this.cost1Color,f.fillRect(v-1,20-y,1,y),f.fillStyle=this.cost2Color,f.fillRect(2*v,20-m,1,m),f.fillStyle=this.cost3Color,f.fillRect(3*v+1,20-x,1,x);var b=Math.floor(a/s),w=i+" FPS "+this.renderMode;this.showPanle&&(w+="<br/>min"+l+" max"+h+" avg"+b,this.divDraw.innerHTML=this.lastNumDraw+"<br/>"+this.lastNumDirty+"%<br/>",this.divCost.innerHTML='<font  style="color:#18fefe">'+r+'<font/> <font  style="color:#ffff00">'+n+'<font/> <font  style="color:#ff0000">'+o+"<font/>"),this.fps.innerHTML=w},e.prototype.updateInfo=function(e){for(this.arrLog.push(e),this.log.innerHTML=this.arrLog.join("<br/>");document.body.clientHeight<this.log.offsetHeight+this.fpsHeight+this.panelY+2*this.fontSize;)this.arrLog.shift(),this.log.innerHTML=this.arrLog.join("<br/>")},e}(h.DisplayObject),e.WebFps=t,__reflect(t.prototype,"egret.web.WebFps",["egret.FPSDisplay","egret.DisplayObject"]),h.FPSDisplay=t}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(){function e(){}return e.call=function(e,t){},e.addCallback=function(e,t){},e}(),t.WebExternalInterface=i,__reflect(i.prototype,"egret.web.WebExternalInterface",["egret.ExternalInterface"]),e.ExternalInterface=i}(egret||(egret={})),function(v){var u,e;u=v.web||(v.web={}),e=function(r){function e(e,t){var i=r.call(this)||this;return i.init(e,t),i.initOrientation(),i}return __extends(e,r),e.prototype.init=function(e,t){var i=this.readOption(e,t),r=new v.Stage;r.$screen=this,r.$scaleMode=i.scaleMode,r.$orientation=i.orientation,r.$maxTouches=i.maxTouches,r.frameRate=i.frameRate,r.textureScaleFactor=i.textureScaleFactor;var n=new v.sys.RenderBuffer(void 0,void 0,!0),o=n.surface;this.attachCanvas(e,o);var a=new u.WebTouchHandler(r,o),s=new v.sys.Player(n,r,i.entryClassName),l=new v.web.WebHideHandler(r),h=new u.HTMLInput;s.showPaintRect(i.showPaintRect),(i.showFPS||i.showLog)&&s.displayFPS(i.showFPS,i.showLog,i.logFilter,i.fpsStyles),this.playerOption=i,this.container=e,this.canvas=o,this.stage=r,this.player=s,this.webTouchHandler=a,this.webInput=h,this.webHide=l,v.web.$cacheTextAdapter(h,r,e,o),this.updateScreenSize(),this.updateMaxTouches(),s.start()},e.prototype.initOrientation=function(){var e=this;window.addEventListener("orientationchange",function(){window.setTimeout(function(){v.StageOrientationEvent.dispatchStageOrientationEvent(e.stage,v.StageOrientationEvent.ORIENTATION_CHANGE)},350)})},e.prototype.readOption=function(e,t){var i={};i.entryClassName=e.getAttribute("data-entry-class"),i.scaleMode=e.getAttribute("data-scale-mode")||v.StageScaleMode.NO_SCALE,i.frameRate=+e.getAttribute("data-frame-rate")||30,i.contentWidth=+e.getAttribute("data-content-width")||480,i.contentHeight=+e.getAttribute("data-content-height")||800,i.orientation=e.getAttribute("data-orientation")||v.OrientationMode.AUTO,i.maxTouches=+e.getAttribute("data-multi-fingered")||2,i.textureScaleFactor=+e.getAttribute("texture-scale-factor")||1,"webgl"==t.renderMode?i.showPaintRect=!1:i.showPaintRect="true"==e.getAttribute("data-show-paint-rect"),i.showFPS="true"==e.getAttribute("data-show-fps");for(var r=(e.getAttribute("data-show-fps-style")||"").split(","),n={},o=0;o<r.length;o++){var a=r[o].split(":");n[a[0]]=a[1]}return i.fpsStyles=n,i.showLog="true"==e.getAttribute("data-show-log"),i.logFilter=e.getAttribute("data-log-filter"),i},e.prototype.attachCanvas=function(e,t){var i=t.style;i.cursor="inherit",i.position="absolute",i.top="0",i.bottom="0",i.left="0",i.right="0",e.appendChild(t),(i=e.style).overflow="hidden",i.position="relative",i.webkitTransform="translateZ(0)"},e.prototype.updateScreenSize=function(){var e=this.canvas;if(!e.userTyping){var t=this.playerOption,i=this.container.getBoundingClientRect(),r=!1,n=this.stage.$orientation;n!=v.OrientationMode.AUTO&&(r=n!=v.OrientationMode.PORTRAIT&&i.height>i.width||n==v.OrientationMode.PORTRAIT&&i.width>i.height);var o=r?i.height:i.width,a=r?i.width:i.height;v.Capabilities.$boundingClientWidth=o,v.Capabilities.$boundingClientHeight=a;var s=v.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,o,a,t.contentWidth,t.contentHeight),l=s.stageWidth,h=s.stageHeight,u=s.displayWidth,c=s.displayHeight;e.width!==l&&(e.width=l),e.height!==h&&(e.height=h),e.style[v.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",e.style.width=u+"px",e.style.height=c+"px";var d=0;r?n==v.OrientationMode.LANDSCAPE?(d=90,e.style.top=(i.height-u)/2+"px",e.style.left=(i.width+c)/2+"px"):(d=-90,e.style.top=(i.height+u)/2+"px",e.style.left=(i.width-c)/2+"px"):(e.style.top=(i.height-c)/2+"px",e.style.left=(i.width-u)/2+"px");var p="rotate("+d+"deg)";e.style[v.web.getPrefixStyleName("transform")]=p;var f=u/l,g=c/h;this.webTouchHandler.updateScaleMode(f,g,d),this.webInput.$updateSize(),this.player.updateStageSize(l,h)}},e.prototype.setContentSize=function(e,t){var i=this.playerOption;i.contentWidth=e,i.contentHeight=t,this.updateScreenSize()},e.prototype.updateMaxTouches=function(){this.webTouchHandler.$updateMaxTouches()},e}(v.HashObject),u.WebPlayer=e,__reflect(e.prototype,"egret.web.WebPlayer",["egret.sys.Screen"])}(egret||(egret={})),function(m){!function(e){function n(e,t){v||(v=document.createElement("canvas"),y=v.getContext("2d"));var i=e.$getTextureWidth(),r=e.$getTextureHeight();null==t&&((t=m.$TempRectangle).x=0,t.y=0,t.width=i,t.height=r),t.x=Math.min(t.x,i-1),t.y=Math.min(t.y,r-1),t.width=Math.min(t.width,i-t.x),t.height=Math.min(t.height,r-t.y);var n=t.width,o=t.height,a=v;if(a.style.width=n+"px",a.style.height=o+"px",v.width=n,v.height=o,"webgl"==m.Capabilities.$renderMode){var s=void 0;e.$renderBuffer?s=e:(s=new m.RenderTexture).drawToTexture(new m.Bitmap(e));for(var l=s.$renderBuffer.getPixels(t.x,t.y,n,o),h=new ImageData(n,o),u=0;u<l.length;u++)h.data[u]=l[u];return y.putImageData(h,0,0),e.$renderBuffer||s.dispose(),a}var c=e,d=Math.round(c._offsetX),p=Math.round(c._offsetY),f=c._bitmapWidth,g=c._bitmapHeight;return y.drawImage(c._bitmapData.source,c._bitmapX+t.x/m.$TextureScaleFactor,c._bitmapY+t.y/m.$TextureScaleFactor,f*t.width/i,g*t.height/r,d,p,t.width,t.height),a}function s(e,t){try{return n(this,t).toDataURL(e)}catch(e){m.$error(1033)}return null}var v,y;m.Texture.prototype.toDataURL=s,m.Texture.prototype.saveToFile=function(e,t,i){var r=s.call(this,e,i);if(null!=r){var n=r.replace(/^data:image[^;]*/,"data:image/octet-stream"),o=document.createElement("a");o.download=t,o.href=n;var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(a)}},m.Texture.prototype.getPixel32=function(e,t){return m.$warn(1041,"getPixel32","getPixels"),this.getPixels(e,t)},m.Texture.prototype.getPixels=function(e,t,i,r){void 0===i&&(i=1),void 0===r&&(r=1);try{return n(this),y.getImageData(e,t,i,r).data}catch(e){m.$error(1039)}}}(m.web||(m.web={}))}(egret||(egret={})),function(i){!function(e){function g(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);for(var i=new v(e.localName,t,e.prefix,e.namespaceURI,e.nodeName),r=e.attributes,n=i.attributes,o=r.length,a=0;a<o;a++){var s=r[a],l=s.name;0!=l.indexOf("xmlns:")&&(n[l]=s.value,i["$"+l]=s.value)}var h=e.childNodes;o=h.length;var u=i.children;for(a=0;a<o;a++){var c=h[a],d=c.nodeType,p=null;if(1==d)p=g(c,i);else if(3==d){var f=c.textContent.trim();f&&(p=new y(f,i))}p&&u.push(p)}return i}var t=function(e,t){this.nodeType=e,this.parent=t};e.XMLNode=t,__reflect(t.prototype,"egret.web.XMLNode");var v=function(a){function e(e,t,i,r,n){var o=a.call(this,1,t)||this;return o.attributes={},o.children=[],o.localName=e,o.prefix=i,o.namespace=r,o.name=n,o}return __extends(e,a),e}(t);e.XML=v,__reflect(v.prototype,"egret.web.XML");var y=function(r){function e(e,t){var i=r.call(this,3,t)||this;return i.text=e,i}return __extends(e,r),e}(t);e.XMLText=y,__reflect(y.prototype,"egret.web.XMLText");var o=new DOMParser;i.XML={parse:function(e){for(var t=o.parseFromString(e,"text/xml"),i=t.childNodes.length,r=0;r<i;r++){var n=t.childNodes[r];if(1==n.nodeType)return g(n,null)}return null}}}(i.web||(i.web={}))}(egret||(egret={})),function(r){var e,t;e=r.web||(r.web={}),t=function(e){function t(){var i=e.apply(this,arguments)||this;return i.onChange=function(e){var t=new r.OrientationEvent(r.Event.CHANGE);t.beta=e.beta,t.gamma=e.gamma,t.alpha=e.alpha,i.dispatchEvent(t)},i}return __extends(t,e),t.prototype.start=function(){window.addEventListener("deviceorientation",this.onChange)},t.prototype.stop=function(){window.removeEventListener("deviceorientation",this.onChange)},t}(r.EventDispatcher),e.WebDeviceOrientation=t,__reflect(t.prototype,"egret.web.WebDeviceOrientation",["egret.DeviceOrientation"])}(egret||(egret={})),egret.DeviceOrientation=egret.web.WebDeviceOrientation,function(n){var e,t;e=n.web||(n.web={}),t=function(t){function e(e){var r=t.call(this)||this;return r.onUpdate=function(e){var t=new n.GeolocationEvent(n.Event.CHANGE),i=e.coords;t.altitude=i.altitude,t.heading=i.heading,t.accuracy=i.accuracy,t.latitude=i.latitude,t.longitude=i.longitude,t.speed=i.speed,t.altitudeAccuracy=i.altitudeAccuracy,r.dispatchEvent(t)},r.onError=function(e){var t=n.GeolocationEvent.UNAVAILABLE;e.code==e.PERMISSION_DENIED&&(t=n.GeolocationEvent.PERMISSION_DENIED);var i=new n.GeolocationEvent(n.IOErrorEvent.IO_ERROR);i.errorType=t,i.errorMessage=e.message,r.dispatchEvent(i)},r.geolocation=navigator.geolocation,r}return __extends(e,t),e.prototype.start=function(){var e=this.geolocation;e?this.watchId=e.watchPosition(this.onUpdate,this.onError):this.onError({code:2,message:n.sys.tr(3004),PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2})},e.prototype.stop=function(){this.geolocation.clearWatch(this.watchId)},e}(n.EventDispatcher),e.WebGeolocation=t,__reflect(t.prototype,"egret.web.WebGeolocation",["egret.Geolocation"]),n.Geolocation=n.web.WebGeolocation}(egret||(egret={})),function(a){var e,t;e=a.web||(a.web={}),t=function(e){function t(){var o=e.apply(this,arguments)||this;return o.onChange=function(e){var t=new a.MotionEvent(a.Event.CHANGE),i={x:e.acceleration.x,y:e.acceleration.y,z:e.acceleration.z},r={x:e.accelerationIncludingGravity.x,y:e.accelerationIncludingGravity.y,z:e.accelerationIncludingGravity.z},n={alpha:e.rotationRate.alpha,beta:e.rotationRate.beta,gamma:e.rotationRate.gamma};t.acceleration=i,t.accelerationIncludingGravity=r,t.rotationRate=n,o.dispatchEvent(t)},o}return __extends(t,e),t.prototype.start=function(){window.addEventListener("devicemotion",this.onChange)},t.prototype.stop=function(){window.removeEventListener("devicemotion",this.onChange)},t}(a.EventDispatcher),e.WebMotion=t,__reflect(t.prototype,"egret.web.WebMotion",["egret.Motion"]),a.Motion=a.web.WebMotion}(egret||(egret={})),function(e){e.web||(e.web={})}(egret||(egret={})),function(e){var t;e.web||(e.web={}),t="egret.BitmapData",e.registerClass(HTMLImageElement,t),e.registerClass(HTMLCanvasElement,t),e.registerClass(HTMLVideoElement,t)}(egret||(egret={})),function(t){t.$toBitmapData=function(e){return e.hashCode=e.$hashCode=t.$hashCount++,e}}(egret||(egret={})),function(r){var e;(e=r.localStorage||(r.localStorage={})).web||(e.web={}),e.getItem=function(e){return window.localStorage.getItem(e)},e.setItem=function(t,i){try{return window.localStorage.setItem(t,i),!0}catch(e){return r.$warn(1047,t,i),!1}},e.removeItem=function(e){window.localStorage.removeItem(e)},e.clear=function(){window.localStorage.clear()}}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(t){function e(){var e=t.apply(this,arguments)||this;return e.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\ngl_FragColor = vColor;\n}",e}return __extends(e,t),e}(t.EgretShader),t.PrimitiveShader=i,__reflect(i.prototype,"egret.web.PrimitiveShader")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(t){function e(){var e=t.apply(this,arguments)||this;return e.fragmentSrc="precision mediump float;uniform vec2 blur;uniform sampler2D uSampler;varying vec2 vTextureCoord;uniform vec2 uTextureSize;void main(){const int sampleRadius = 5;const int samples = sampleRadius * 2 + 1;vec2 blurUv = blur / uTextureSize;vec4 color = vec4(0, 0, 0, 0);vec2 uv = vec2(0.0, 0.0);blurUv /= float(sampleRadius);for (int i = -sampleRadius; i <= sampleRadius; i++) {uv.x = vTextureCoord.x + float(i) * blurUv.x;uv.y = vTextureCoord.y + float(i) * blurUv.y;color += texture2D(uSampler, uv);}color /= float(samples);gl_FragColor = color;}",e.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},blur:{type:"2f",value:{x:2,y:2},dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}},e}return __extends(e,t),e.prototype.setBlur=function(e,t){var i=this.uniforms.blur;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},e.prototype.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},e}(t.TextureShader),t.BlurShader=i,__reflect(i.prototype,"egret.web.BlurShader")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(t){function e(){var e=t.apply(this,arguments)||this;return e.fragmentSrc="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 texColor = texture2D(uSampler, vTextureCoord);\nif(texColor.a > 0.) {texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n}vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\ngl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",e.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dirty:!0},colorAdd:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0}},e}return __extends(e,t),e.prototype.setMatrix=function(e){var t=this.uniforms.matrix;(t.value[0]!=e[0]||t.value[0]!=e[0]||t.value[1]!=e[1]||t.value[2]!=e[2]||t.value[3]!=e[3]||t.value[4]!=e[5]||t.value[5]!=e[6]||t.value[6]!=e[7]||t.value[7]!=e[8]||t.value[8]!=e[10]||t.value[9]!=e[11]||t.value[10]!=e[12]||t.value[11]!=e[13]||t.value[12]!=e[15]||t.value[13]!=e[16]||t.value[14]!=e[17]||t.value[15]!=e[18])&&(t.value[0]=e[0],t.value[1]=e[1],t.value[2]=e[2],t.value[3]=e[3],t.value[4]=e[5],t.value[5]=e[6],t.value[6]=e[7],t.value[7]=e[8],t.value[8]=e[10],t.value[9]=e[11],t.value[10]=e[12],t.value[11]=e[13],t.value[12]=e[15],t.value[13]=e[16],t.value[14]=e[17],t.value[15]=e[18],t.dirty=!0);var i=this.uniforms.colorAdd;(i.value.x!=e[4]/255||i.value.y!=e[9]/255||i.value.z!=e[14]/255||i.value.w!=e[19]/255)&&(i.value.x=e[4]/255,i.value.y=e[9]/255,i.value.z=e[14]/255,i.value.w=e[19]/255,i.dirty=!0)},e}(t.TextureShader),t.ColorTransformShader=i,__reflect(i.prototype,"egret.web.ColorTransformShader")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(t){function e(){var e=t.apply(this,arguments)||this;return e.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform float distance;","uniform float angle;","uniform vec4 color;","uniform float alpha;","uniform float blurX;","uniform float blurY;","uniform float strength;","uniform float inner;","uniform float knockout;","uniform float hideObject;","uniform vec2 uTextureSize;vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);","float random(vec3 scale, float seed)","{","return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);","}","void main(void) {","const float linearSamplingTimes = 7.0;","const float circleSamplingTimes = 12.0;","vec4 ownColor = texture2D(uSampler, vTextureCoord);","vec4 curColor;","float totalAlpha = 0.0;","float maxTotalAlpha = 0.0;","float curDistanceX = 0.0;","float curDistanceY = 0.0;","float offsetX = distance * cos(angle) * px.x;","float offsetY = distance * sin(angle) * px.y;","const float PI = 3.14159265358979323846264;","float cosAngle;","float sinAngle;","float offset = PI * 2.0 / circleSamplingTimes * random(vec3(12.9898, 78.233, 151.7182), 0.0);","float stepX = blurX * px.x / linearSamplingTimes;","float stepY = blurY * px.y / linearSamplingTimes;","for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {","cosAngle = cos(a + offset);","sinAngle = sin(a + offset);","for (float i = 1.0; i <= linearSamplingTimes; i++) {","curDistanceX = i * stepX * cosAngle;","curDistanceY = i * stepY * sinAngle;","curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));","totalAlpha += (linearSamplingTimes - i) * curColor.a;","maxTotalAlpha += (linearSamplingTimes - i);","}","}","ownColor.a = max(ownColor.a, 0.0001);","ownColor.rgb = ownColor.rgb / ownColor.a;","float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);","float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;","ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);","vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));","vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));","float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);","gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);","}"].join("\n"),e.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},distance:{type:"1f",value:15,dirty:!0},angle:{type:"1f",value:1,dirty:!0},color:{type:"4f",value:{x:1,y:0,z:0,w:0},dirty:!0},alpha:{type:"1f",value:1,dirty:!0},blurX:{type:"1f",value:1,dirty:!0},blurY:{type:"1f",value:1,dirty:!0},strength:{type:"1f",value:1,dirty:!0},inner:{type:"1f",value:1,dirty:!0},knockout:{type:"1f",value:1,dirty:!0},hideObject:{type:"1f",value:0,dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}},e}return __extends(e,t),e.prototype.setDistance=function(e){var t=this.uniforms.distance;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setAngle=function(e){var t=this.uniforms.angle;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setColor=function(e,t,i){var r=this.uniforms.color;(r.value.x!=e||r.value.y!=t||r.value.z!=i)&&(r.value.x=e,r.value.y=t,r.value.z=i,r.dirty=!0)},e.prototype.setAlpha=function(e){var t=this.uniforms.alpha;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setBlurX=function(e){var t=this.uniforms.blurX;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setBlurY=function(e){var t=this.uniforms.blurY;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setStrength=function(e){var t=this.uniforms.strength;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setInner=function(e){var t=this.uniforms.inner;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setKnockout=function(e){var t=this.uniforms.knockout;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setHideObject=function(e){var t=this.uniforms.hideObject;t.value!=e&&(t.value=e,t.dirty=!0)},e.prototype.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},e}(t.TextureShader),t.GlowShader=i,__reflect(i.prototype,"egret.web.GlowShader")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(){function e(e){this.gl=null,this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.currentShader=null,this.defaultShader=null,this.primitiveShader=null,this.colorTransformShader=null,this.blurShader=null,this.glowShader=null;for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)}return e.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.defaultShader=new t.TextureShader(e),this.colorTransformShader=new t.ColorTransformShader(e),this.glowShader=new t.GlowShader(e),this.blurShader=new t.BlurShader(e),this.primitiveShader.init(),this.defaultShader.init(),this.colorTransformShader.init(),this.blurShader.init(),this.glowShader.init()},e.prototype.activateShader=function(e,t){this.currentShader!=e&&(this.gl.useProgram(e.program),this.setAttribs(e.attributes),e.setAttribPointer(t),this.currentShader=e)},e.prototype.setAttribs=function(e){var t,i;for(i=this.tempAttribState.length,t=0;t<i;t++)this.tempAttribState[t]=!1;for(i=e.length,t=0;t<i;t++){var r=e[t];this.tempAttribState[r]=!0}var n=this.gl;for(i=this.attribState.length,t=0;t<i;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?n.enableVertexAttribArray(t):n.disableVertexAttribArray(t))},e}(),t.WebGLShaderManager=i,__reflect(i.prototype,"egret.web.WebGLShaderManager")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(){function e(){this.drawData=[],this.drawDataLen=0}return e.prototype.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=1,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},e.prototype.pushDrawTexture=function(e,t,i,r,n){if(void 0===t&&(t=2),i){(o=this.drawData[this.drawDataLen]||{}).type=0,o.texture=e,o.filter=i,o.count=t,o.textureWidth=r,o.textureHeight=n,this.drawData[this.drawDataLen]=o,this.drawDataLen++}else{var o;if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter)(o=this.drawData[this.drawDataLen]||{}).type=0,o.texture=e,o.count=0,this.drawData[this.drawDataLen]=o,this.drawDataLen++;this.drawData[this.drawDataLen-1].count+=t}},e.prototype.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=3,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushSetBlend=function(e){for(var t=!1,i=this.drawDataLen-1;0<=i;i--){var r=this.drawData[i];if(r){if((0==r.type||1==r.type)&&(t=!0),!t&&4==r.type){this.drawData.splice(i,1),this.drawDataLen--;continue}if(4==r.type){if(r.value==e)return;break}}}var n=this.drawData[this.drawDataLen]||{};n.type=4,n.value=e,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushResize=function(e,t,i){var r=this.drawData[this.drawDataLen]||{};r.type=5,r.buffer=e,r.width=t,r.height=i,this.drawData[this.drawDataLen]=r,this.drawDataLen++},e.prototype.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=6,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.pushActivateBuffer=function(e){for(var t=!1,i=this.drawDataLen-1;0<=i;i--){var r=this.drawData[i];!r||(4!=r.type&&7!=r.type&&(t=!0),t||7!=r.type)||(this.drawData.splice(i,1),this.drawDataLen--)}var n=this.drawData[this.drawDataLen]||{};n.type=7,n.buffer=e,n.width=e.rootRenderTarget.width,n.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushEnableScissor=function(e,t,i,r){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=e,n.y=t,n.width=i,n.height=r,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=9,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}(),t.WebGLDrawCmdManager=i,__reflect(i.prototype,"egret.web.WebGLDrawCmdManager")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var i=0,r=0;i<t;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3}return e.prototype.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},e.prototype.getVertices=function(){return this.vertices.subarray(0,this.vertexIndex*this.vertSize)},e.prototype.getIndices=function(){return this.indices},e.prototype.getMeshIndices=function(){return this.indicesForMesh},e.prototype.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;e<t;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},e.prototype.isMesh=function(){return this.hasMesh},e.prototype.cacheArrays=function(e,t,i,r,n,o,a,s,l,h,u,c,d,p,f){var g=e,v=g.a,y=g.b,m=g.c,x=g.d,b=g.tx,w=g.ty;(0!=a||0!=s)&&g.append(1,0,0,1,a,s),(n/l!=1||o/h!=1)&&g.append(l/n,0,0,h/o,0,0);var T=g.a,E=g.b,S=g.c,_=g.d,C=g.tx,R=g.ty;if(g.a=v,g.b=y,g.c=m,g.d=x,g.tx=b,g.ty=w,p){var L,D=this.vertices,A=this.vertexIndex*this.vertSize,M=0,$=0,I=0,O=0,B=0,P=0;for(M=0,L=d.length;M<L;M+=2)$=5*M/2,B=p[M],P=p[M+1],I=d[M],O=d[M+1],D[A+$+0]=T*B+S*P+C,D[A+$+1]=E*B+_*P+R,D[A+$+2]=(i+I*n)/u,D[A+$+3]=(r+O*o)/c,D[A+$+4]=t;if(this.hasMesh)for(var F=0,W=f.length;F<W;++F)this.indicesForMesh[this.indexIndex+F]=f[F]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=f.length}else{var H=n,G=o;i/=u,r/=c,n/=u,o/=c;D=this.vertices,A=this.vertexIndex*this.vertSize;if(D[A++]=C,D[A++]=R,D[A++]=i,D[A++]=r,D[A++]=t,D[A++]=T*H+C,D[A++]=E*H+R,D[A++]=n+i,D[A++]=r,D[A++]=t,D[A++]=T*H+S*G+C,D[A++]=_*G+E*H+R,D[A++]=n+i,D[A++]=o+r,D[A++]=t,D[A++]=S*G+C,D[A++]=_*G+R,D[A++]=i,D[A++]=o+r,D[A++]=t,this.hasMesh){var N=this.indicesForMesh;N[this.indexIndex+0]=0+this.vertexIndex,N[this.indexIndex+1]=1+this.vertexIndex,N[this.indexIndex+2]=2+this.vertexIndex,N[this.indexIndex+3]=0+this.vertexIndex,N[this.indexIndex+4]=2+this.vertexIndex,N[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},e.prototype.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}(),t.WebGLVertexArrayObject=i,__reflect(i.prototype,"egret.web.WebGLVertexArrayObject")}(egret||(egret={})),function(e){var t,i;t=e.web||(e.web={}),i=function(n){function e(e,t,i){var r=n.call(this)||this;return r.clearColor=[0,0,0,0],r.useFrameBuffer=!0,r.gl=e,r.width=t||1,r.height=i||1,r.texture=r.createTexture(),r.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,r.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r.texture,0),r.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,r.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,r.stencilBuffer),r}return __extends(e,n),e.prototype.resize=function(e,t){var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.bindRenderbuffer(i.RENDERBUFFER,this.stencilBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e,t),this.width=e,this.height=t},e.prototype.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},e.prototype.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},e.prototype.createTexture=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},e.prototype.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},e}(e.HashObject),t.WebGLRenderTarget=i,__reflect(i.prototype,"egret.web.WebGLRenderTarget")}(egret||(egret={})),function(l){var u,e;u=l.web||(l.web={}),(e=function(){function n(e,t){var i,r,n;this.glID=null,this.projectionX=NaN,this.projectionY=NaN,this.shaderManager=null,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.blurFilter=null,this.surface=(i=e,r=t,n=document.createElement("canvas"),isNaN(i)||isNaN(r)||(n.width=i,n.height=r),n),this.initWebGL(),this.$bufferStack=[];var o=this.context;this.vertexBuffer=o.createBuffer(),this.indexBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new u.WebGLDrawCmdManager,this.vao=new u.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}return n.getInstance=function(e,t){return this.instance||(this.instance=new n(e,t)),this.instance},n.prototype.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},n.prototype.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},n.prototype.activateBuffer=function(e){e.rootRenderTarget.activate(),this.bindIndices||(this.uploadIndicesArray(this.vao.getIndices()),this.bindIndices=!0),e.restoreStencil(),e.restoreScissor(),this.onResize(e.width,e.height)},n.prototype.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},n.prototype.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)},n.prototype.destroy=function(){this.surface.width=this.surface.height=0},n.prototype.onResize=function(e,t){e=e||this.surface.width,t=t||this.surface.height,this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},n.prototype.resize=function(e,t,i){var r=this.surface;i?(r.width<e&&(r.width=e),r.height<t&&(r.height=t)):(r.width!=e&&(r.width=e),r.height!=t&&(r.height=t)),this.onResize()},n.prototype.initWebGL=function(){this.onResize(),this.surface.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.surface.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.getWebGLContext(),this.shaderManager=new u.WebGLShaderManager(this.context)},n.prototype.handleContextLost=function(){this.contextLost=!0},n.prototype.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},n.prototype.getWebGLContext=function(){for(var e,t={antialias:n.antialias,stencil:!0},i=["webgl","experimental-webgl"],r=0;r<i.length;r++){try{e=this.surface.getContext(i[r],t)}catch(e){}if(e)break}e||l.$error(1021),this.setContext(e)},n.prototype.setContext=function(e){(this.context=e).id=n.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},n.prototype.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},n.prototype.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},n.prototype.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},n.prototype.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},n.prototype.getPixels=function(e,t,i,r,n){var o=this.context;o.readPixels(e,t,i,r,o.RGBA,o.UNSIGNED_BYTE,n)},n.prototype.createTexture=function(e){var t=this.context,i=t.createTexture();return i?((i.glContext=t).bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i):void(this.contextLost=!0)},n.prototype.createTextureFromCompressedData=function(e,t,i,r,n){return null},n.prototype.updateTexture=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)},n.prototype.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source=null)),e.webGLTexture},n.prototype.clearRect=function(e,t,i,r){if(0!=e||0!=t||i!=this.surface.width||r!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over");else{var o=n.globalMatrix;0==o.b&&0==o.c?(e=e*o.a+o.tx,t=t*o.d+o.ty,i*=o.a,r*=o.d,this.enableScissor(e,-t-r+n.height,i,r),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},n.prototype.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},n.prototype.drawImage=function(e,t,i,r,n,o,a,s,l,h,u){var c=this.currentBuffer;if(!this.contextLost&&e&&c){var d;if(e.texture||e.source&&e.source.texture)d=e.texture||e.source.texture,c.saveTransform(),c.transform(1,0,0,-1,0,l+2*a);else{if(!e.source&&!e.webGLTexture)return;d=this.getWebGLTexture(e)}d&&(this.drawTexture(d,t,i,r,n,o,a,s,l,h,u),e.source&&e.source.texture&&c.restoreTransform())}},n.prototype.drawMesh=function(e,t,i,r,n,o,a,s,l,h,u,c,d,p,f){var g=this.currentBuffer;if(!this.contextLost&&e&&g){var v;if(e.texture||e.source&&e.source.texture)v=e.texture||e.source.texture,g.saveTransform(),g.transform(1,0,0,-1,0,l+2*a);else{if(!e.source&&!e.webGLTexture)return;v=this.getWebGLTexture(e)}v&&this.drawTexture(v,t,i,r,n,o,a,s,l,h,u,c,d,p,f)}},n.prototype.drawTexture=function(e,t,i,r,n,o,a,s,l,h,u,c,d,p,f){var g=this.currentBuffer;if(!this.contextLost&&e&&g){d&&p?this.vao.reachMaxSize(d.length/2,p.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),c&&this.vao.changeToMeshIndices();var v=g.globalMatrix,y=g.globalAlpha,m=p?p.length/3:2;this.drawCmdManager.pushDrawTexture(e,m,this.$filter),this.vao.cacheArrays(v,y,t,i,r,n,o,a,s,l,h,u,c,d,p)}},n.prototype.drawRect=function(e,t,i,r){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,i,r,e,t,i,r,i,r))},n.prototype.pushMask=function(e){var t=this.currentBuffer;if(!this.contextLost&&t){t.$stencilList.push(e),this.vao.reachMaxSize()&&this.$drawWebGL();var i=e.length;if(i){this.drawCmdManager.pushPushMask(i);for(var r=0;r<i;r++){var n=e[r];this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},n.prototype.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL();var i=t.length;if(i){this.drawCmdManager.pushPopMask(i);for(var r=0;r<i;r++){var n=t[r];this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},n.prototype.clear=function(){this.drawCmdManager.pushClearColor()},n.prototype.enableScissor=function(e,t,i,r){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,i,r),n.$hasScissor=!0},n.prototype.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},n.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,i=0;i<e;i++){var r=this.drawCmdManager.drawData[i];t=this.drawData(r,t),7==r.type&&(this.activatedBuffer=r.buffer),(0==r.type||1==r.type||2==r.type||3==r.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},n.prototype.drawData=function(e,t){if(e){var i;switch(e.type){case 0:var r=e.filter;r?"colorTransform"==r.type?(i=this.shaderManager.colorTransformShader).setMatrix(r.$matrix):"blur"==r.type?((i=this.shaderManager.blurShader).setBlur(r.$blurX,r.$blurY),i.setTextureSize(e.textureWidth,e.textureHeight)):"glow"==r.type&&((i=this.shaderManager.glowShader).setDistance(r.$distance||0),i.setAngle(r.$angle?r.$angle/180*Math.PI:0),i.setColor(r.$red/255,r.$green/255,r.$blue/255),i.setAlpha(r.$alpha),i.setBlurX(r.$blurX),i.setBlurY(r.$blurY),i.setStrength(r.$strength),i.setInner(r.$inner?1:0),i.setKnockout(r.$knockout?0:1),i.setHideObject(r.$hideObject?1:0),i.setTextureSize(e.textureWidth,e.textureHeight)):i=this.shaderManager.defaultShader,i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawTextureElements(e,t);break;case 1:(i=this.shaderManager.primitiveShader).setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawRectElements(e,t);break;case 2:(i=this.shaderManager.primitiveShader).setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPushMaskElements(e,t);break;case 3:(i=this.shaderManager.primitiveShader).setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPopMaskElements(e,t);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var n=this.activatedBuffer.rootRenderTarget;(0!=n.width||0!=n.height)&&n.clear()}break;case 7:this.activateBuffer(e.buffer);break;case 8:var o=this.activatedBuffer;o&&o.enableScissor(e.x,e.y,e.width,e.height);break;case 9:(o=this.activatedBuffer)&&o.disableScissor()}return t}},n.prototype.drawTextureElements=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e.texture);var r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},n.prototype.drawRectElements=function(e,t){var i=this.context,r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},n.prototype.drawPushMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n){0==n.stencilHandleCount&&(n.enableStencil(),i.clear(i.STENCIL_BUFFER_BIT));var o=n.stencilHandleCount;n.stencilHandleCount++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,o,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,o+1,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},n.prototype.drawPopMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var o=n.stencilHandleCount;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,o+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,o,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},n.prototype.setBlendMode=function(e){var t=this.context,i=n.blendModesForGL[e];i&&t.blendFunc(i[0],i[1])},n.prototype.drawTargetWidthFilters=function(e,t){var i,r=t,n=e.length;if(1<n)for(var o=0;o<n-1;o++){var a=e[o],s=t.rootRenderTarget.width,l=t.rootRenderTarget.height;(i=u.WebGLRenderBuffer.create(s,l)).setTransform(1,0,0,1,0,0),i.globalAlpha=1,this.drawToRenderTarget(a,t,i),t!=r&&u.WebGLRenderBuffer.release(t),t=i}var h=e[n-1];this.drawToRenderTarget(h,t,this.currentBuffer),t!=r&&u.WebGLRenderBuffer.release(t)},n.prototype.drawToRenderTarget=function(e,t,i){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(i);var r,n,o=t,a=t.rootRenderTarget.width,s=t.rootRenderTarget.height;"blur"==e.type&&(this.blurFilter||(this.blurFilter=new l.BlurFilter(2,2)),0!=e.blurX&&0!=e.blurY?(this.blurFilter.blurX=e.blurX,this.blurFilter.blurY=0,(r=u.WebGLRenderBuffer.create(a,s)).setTransform(1,0,0,1,0,0),r.globalAlpha=1,this.drawToRenderTarget(this.blurFilter,t,r),t!=o&&u.WebGLRenderBuffer.release(t),t=r,this.blurFilter.blurX=0):this.blurFilter.blurX=e.blurX,this.blurFilter.blurY=e.blurY,e=this.blurFilter),i.saveTransform(),i.transform(1,0,0,-1,0,s),this.vao.cacheArrays(i.globalMatrix,i.globalAlpha,0,0,a,s,0,0,a,s,a,s),i.restoreTransform(),n="blur"==e.type?{type:"blur",$blurX:e.$blurX,$blurY:e.$blurY}:e,this.drawCmdManager.pushDrawTexture(t.rootRenderTarget.texture,2,n,a,s),t!=o&&u.WebGLRenderBuffer.release(t),this.popBuffer()}},n.initBlendMode=function(){(n.blendModesForGL={})["source-over"]=[1,771],n.blendModesForGL.lighter=[1,1],n.blendModesForGL["lighter-in"]=[770,771],n.blendModesForGL["destination-out"]=[0,771],n.blendModesForGL["destination-in"]=[0,770]},n}()).glContextId=0,e.blendModesForGL=null,u.WebGLRenderContext=e,__reflect(e.prototype,"egret.web.WebGLRenderContext"),e.initBlendMode()}(egret||(egret={})),function(l){!function(a){var e=function(o){function s(e,t,i){var r=o.call(this)||this;if(r.globalAlpha=1,r.stencilState=!1,r.$stencilList=[],r.stencilHandleCount=0,r.$scissorState=!1,r.scissorRect=new l.Rectangle,r.$hasScissor=!1,r.dirtyRegionPolicy=!0,r._dirtyRegionPolicy=!0,r.$drawCalls=0,r.$computeDrawCall=!1,r.globalMatrix=new l.Matrix,r.savedGlobalMatrix=new l.Matrix,r.context=a.WebGLRenderContext.getInstance(e,t),r.rootRenderTarget=new a.WebGLRenderTarget(r.context.context,3,3),e&&t&&r.resize(e,t),r.root=i,r.root)r.context.pushBuffer(r),r.surface=r.context.surface;else{var n=r.context.activatedBuffer;n&&n.rootRenderTarget.activate(),r.surface=r.rootRenderTarget}return r}return __extends(s,o),s.prototype.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},s.prototype.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},s.prototype.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},s.prototype.enableScissor=function(e,t,i,r){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,i,r),this.context.enableScissorTest(this.scissorRect))},s.prototype.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},s.prototype.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},Object.defineProperty(s.prototype,"width",{get:function(){return this.rootRenderTarget.width},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"height",{get:function(){return this.rootRenderTarget.height},enumerable:!0,configurable:!0}),s.prototype.resize=function(e,t,i){this.context.pushBuffer(this),t=t||1,((e=e||1)!=this.rootRenderTarget.width||t!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,i),this.context.clear(),this.context.popBuffer()},s.prototype.resizeTo=function(e,t,i,r){this.context.pushBuffer(this);var n=this.rootRenderTarget.width,o=this.rootRenderTarget.height,a=s.create(n,o);this.context.pushBuffer(a),this.context.drawImage(this.rootRenderTarget,0,0,n,o,0,0,n,o,n,o),this.context.popBuffer(),this.resize(e,t),this.setTransform(1,0,0,1,0,0),this.context.drawImage(a.rootRenderTarget,0,0,n,o,i,r,n,o,n,o),s.release(a),this.context.popBuffer()},s.prototype.setDirtyRegionPolicy=function(e){this.dirtyRegionPolicy="on"==e},s.prototype.beginClip=function(e,t,i){this.context.pushBuffer(this),this.root&&(this._dirtyRegionPolicy?(this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate()):(this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.clear())),t=+t||0,i=+i||0,this.setTransform(1,0,0,1,t,i);var r=e.length;if(1==r&&0==e[0].minX&&0==e[0].minY&&e[0].width==this.rootRenderTarget.width&&e[0].height==this.rootRenderTarget.height)return this.maskPushed=!1,this.rootRenderTarget.useFrameBuffer&&this.context.clear(),void this.context.popBuffer();for(var n=0;n<r;n++){var o=e[n];this.context.clearRect(o.minX,o.minY,o.width,o.height)}if(0<r){if(this.$hasScissor||1!=r)this.scissorEnabled=!1;else{o=e[0];e=e.slice(1);var a=o.minX+t,s=o.minY+i,l=o.width,h=o.height;this.context.enableScissor(a,-s-h+this.height,l,h),this.scissorEnabled=!0}0<e.length?(this.context.pushMask(e),this.maskPushed=!0):this.maskPushed=!1,this.offsetX=t,this.offsetY=i}else this.maskPushed=!1;this.context.popBuffer()},s.prototype.endClip=function(){(this.maskPushed||this.scissorEnabled)&&(this.context.pushBuffer(this),this.maskPushed&&(this.setTransform(1,0,0,1,this.offsetX,this.offsetY),this.context.popMask()),this.scissorEnabled&&this.context.disableScissor(),this.context.popBuffer())},s.prototype.getPixels=function(e,t,i,r){void 0===i&&(i=1),void 0===r&&(r=1);var n=new Uint8Array(4*i*r),o=this.rootRenderTarget.useFrameBuffer;this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,i,r,n),this.rootRenderTarget.useFrameBuffer=o,this.rootRenderTarget.activate();for(var a=new Uint8Array(4*i*r),s=0;s<r;s++)for(var l=0;l<i;l++)a[4*(i*(r-s-1)+l)]=n[4*(i*s+l)],a[4*(i*(r-s-1)+l)+1]=n[4*(i*s+l)+1],a[4*(i*(r-s-1)+l)+2]=n[4*(i*s+l)+2],a[4*(i*(r-s-1)+l)+3]=n[4*(i*s+l)+3];return a},s.prototype.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},s.prototype.destroy=function(){this.context.destroy()},s.prototype.onRenderFinish=function(){this.$drawCalls=0,this.root&&(!this._dirtyRegionPolicy&&this.dirtyRegionPolicy&&this.drawSurfaceToFrameBuffer(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,!0),this._dirtyRegionPolicy&&this.drawFrameBufferToSurface(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height),this._dirtyRegionPolicy=this.dirtyRegionPolicy)},s.prototype.drawFrameBufferToSurface=function(e,t,i,r,n,o,a,s,l){void 0===l&&(l=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),l&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,i,r,n,o,a,s,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.prototype.drawSurfaceToFrameBuffer=function(e,t,i,r,n,o,a,s,l){void 0===l&&(l=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),l&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,i,r,n,o,a,s,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.prototype.clear=function(){this.context.clear()},s.prototype.setTransform=function(e,t,i,r,n,o){var a=this.globalMatrix;a.a=e,a.b=t,a.c=i,a.d=r,a.tx=n,a.ty=o},s.prototype.transform=function(e,t,i,r,n,o){var a=this.globalMatrix,s=a.a,l=a.b,h=a.c,u=a.d;(1!=e||0!=t||0!=i||1!=r)&&(a.a=e*s+t*h,a.b=e*l+t*u,a.c=i*s+r*h,a.d=i*l+r*u),a.tx=n*s+o*h+a.tx,a.ty=n*l+o*u+a.ty},s.prototype.translate=function(e,t){var i=this.globalMatrix;i.tx+=e,i.ty+=t},s.prototype.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},s.prototype.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},s.create=function(e,t){var i=n.pop();if(i){i.resize(e,t);var r=i.globalMatrix;r.a=1,r.b=0,r.c=0,r.d=1,r.tx=0,r.ty=0}else(i=new s(e,t)).$computeDrawCall=!1;return i},s.release=function(e){n.push(e)},s}(l.HashObject);a.WebGLRenderBuffer=e,__reflect(e.prototype,"egret.web.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var n=[]}(l.web||(l.web={}))}(egret||(egret={})),function(D){var h,A,M,$,e;h=D.web||(D.web={}),A=["source-over","lighter","destination-out"],M="source-over",$=[],e=function(){function e(){this.nestLevel=0}return e.prototype.render=function(e,t,i,r,n){this.nestLevel++;var o=t,a=o.context,s=n?e:null;a.pushBuffer(o),this.drawDisplayObject(e,o,r,i,null,null,s),a.$drawWebGL();var l=o.$drawCalls;if(o.onRenderFinish(),a.popBuffer(),this.nestLevel--,0===this.nestLevel){6<$.length&&($.length=6);for(var h=$.length,u=0;u<h;u++)$[u].resize(0,0)}return l},e.prototype.drawDisplayObject=function(e,t,i,r,n,o,a){var s,l=0;if(n&&!a?(n.isDirty&&(l+=n.drawToSurface()),s=n.$renderNode):s=e.$getRenderNode(),s){if(i){var h=s.renderRegion;if(o&&!o.intersects(h))s.needRedraw=!1;else if(!s.needRedraw)for(var u=i.length,c=0;c<u;c++)if(h.intersects(i[c])){s.needRedraw=!0;break}}else s.needRedraw=!0;if(s.needRedraw){l++;var d=void 0,p=void 0;a?(d=e.$getConcatenatedAlphaAt(a,e.$getConcatenatedAlpha()),p=D.Matrix.create().copyFrom(e.$getConcatenatedMatrix()),e.$getConcatenatedMatrixAt(a,p),r.$preMultiplyInto(p,p),t.setTransform(p.a,p.b,p.c,p.d,p.tx,p.ty),D.Matrix.release(p)):(d=s.renderAlpha,p=s.renderMatrix,t.setTransform(p.a,p.b,p.c,p.d,p.tx+r.tx,p.ty+r.ty)),t.globalAlpha=d,this.renderNode(s,t),s.needRedraw=!1}}if(n&&!a)return l;var f=e.$children;if(f)for(var g=f.length,v=0;v<g;v++){var y=f[v];if(!(!y.$visible||y.$alpha<=0||y.$maskedObject)){var m=y.$getFilters();m&&0<m.length?l+=this.drawWithFilter(y,t,i,r,o,a):0!==y.$blendMode||y.$mask&&(y.$mask.$parentDisplayList||a)?l+=this.drawWithClip(y,t,i,r,o,a):y.$scrollRect||y.$maskRect?l+=this.drawWithScrollRect(y,t,i,r,o,a):y.isFPS?(t.context.$drawWebGL(),t.$computeDrawCall=!1,this.drawDisplayObject(y,t,i,r,y.$displayList,o,a),t.context.$drawWebGL(),t.$computeDrawCall=!0):l+=this.drawDisplayObject(y,t,i,r,y.$displayList,o,a)}}return l},e.prototype.drawWithFilter=function(e,t,i,r,n,o){var a,s=0,l=e.$getFilters(),h=0!==e.$blendMode;if(h&&((a=A[e.$blendMode])||(a=M)),1==l.length&&"colorTransform"==l[0].type&&!e.$children)return h&&t.context.setGlobalCompositeOperation(a),t.context.$filter=l[0],s+=e.$mask&&(e.$mask.$parentDisplayList||o)?this.drawWithClip(e,t,i,r,n,o):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,t,i,r,n,o):this.drawDisplayObject(e,t,i,r,e.$displayList,n,o),t.context.$filter=null,h&&t.context.setGlobalCompositeOperation(M),s;var u,c=D.Matrix.create();c.copyFrom(e.$getConcatenatedMatrix()),o&&e.$getConcatenatedMatrixAt(o,c),u=D.sys.Region.create();var d=e.$getOriginalBounds();u.updateRegion(d,c);var p=this.createRenderBuffer(u.width,u.height);p.context.pushBuffer(p),p.setTransform(1,0,0,1,-u.minX,-u.minY);var f=D.Matrix.create().setTo(1,0,0,1,-u.minX,-u.minY);return s+=e.$mask&&(e.$mask.$parentDisplayList||o)?this.drawWithClip(e,p,i,f,u,o):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,p,i,f,u,o):this.drawDisplayObject(e,p,i,f,e.$displayList,u,o),D.Matrix.release(f),p.context.popBuffer(),0<s&&(h&&t.context.setGlobalCompositeOperation(a),s++,t.globalAlpha=1,t.setTransform(1,0,0,1,u.minX+r.tx,u.minY+r.ty),t.context.drawTargetWidthFilters(l,p),h&&t.context.setGlobalCompositeOperation(M)),$.push(p),D.sys.Region.release(u),D.Matrix.release(c),s},e.prototype.drawWithClip=function(e,t,i,r,n,o){var a,s=0,l=0!==e.$blendMode;l&&((a=A[e.$blendMode])||(a=M));var h=e.$scrollRect?e.$scrollRect:e.$maskRect,u=e.$mask;if(u){var c=u.$getRenderNode();if(c){var d=c.renderMatrix;if(0==d.a&&0==d.b||0==d.c&&0==d.d)return s}}var p,f,g,v=D.Matrix.create();if(v.copyFrom(e.$getConcatenatedMatrix()),e.$parentDisplayList){var y=e.$parentDisplayList.root;y!==e.$stage&&e.$getConcatenatedMatrixAt(y,v)}u&&(f=u.$getOriginalBounds(),p=D.sys.Region.create(),(C=D.Matrix.create()).copyFrom(u.$getConcatenatedMatrix()),p.updateRegion(f,C),D.Matrix.release(C));if(h&&(g=D.sys.Region.create()).updateRegion(h,v),g&&p?(g.intersect(p),D.sys.Region.release(p)):!g&&p&&(g=p),g){if(g.isEmpty()||n&&!n.intersects(g))return D.sys.Region.release(g),D.Matrix.release(v),s}else g=D.sys.Region.create(),f=e.$getOriginalBounds(),g.updateRegion(f,v);var m=!1;if(i){for(var x=i.length,b=0;b<x;b++)if(g.intersects(i[b])){m=!0;break}}else m=!0;if(!m)return D.sys.Region.release(g),D.Matrix.release(v),s;if(u||e.$children&&0!=e.$children.length){var w=this.createRenderBuffer(g.width,g.height);w.context.pushBuffer(w),w.setTransform(1,0,0,1,-g.minX,-g.minY);var T=D.Matrix.create().setTo(1,0,0,1,-g.minX,-g.minY);if(s+=this.drawDisplayObject(e,w,i,T,e.$displayList,g,o),u){var E=this.createRenderBuffer(g.width,g.height);E.context.pushBuffer(E),E.setTransform(1,0,0,1,-g.minX,-g.minY),T=D.Matrix.create().setTo(1,0,0,1,-g.minX,-g.minY),s+=this.drawDisplayObject(u,E,i,T,u.$displayList,g,o),E.context.popBuffer(),w.context.setGlobalCompositeOperation("destination-in"),w.setTransform(1,0,0,-1,0,E.height),w.globalAlpha=1;var S=E.rootRenderTarget.width,_=E.rootRenderTarget.height;w.context.drawTexture(E.rootRenderTarget.texture,0,0,S,_,0,0,S,_,S,_),w.context.setGlobalCompositeOperation("source-over"),$.push(E)}if(D.Matrix.release(T),w.context.setGlobalCompositeOperation(M),w.context.popBuffer(),0<s){if(s++,l&&t.context.setGlobalCompositeOperation(a),h){var C=v;w.setTransform(C.a,C.b,C.c,C.d,C.tx-g.minX,C.ty-g.minY),w.context.pushMask(h)}t.globalAlpha=1,t.setTransform(1,0,0,-1,g.minX+r.tx,g.minY+r.ty+w.height);var R=w.rootRenderTarget.width,L=w.rootRenderTarget.height;t.context.drawTexture(w.rootRenderTarget.texture,0,0,R,L,0,0,R,L,R,L),h&&w.context.popMask(),l&&t.context.setGlobalCompositeOperation(M)}return $.push(w),D.sys.Region.release(g),D.Matrix.release(v),s}if(h){C=v;t.setTransform(C.a,C.b,C.c,C.d,C.tx-g.minX,C.ty-g.minY),t.context.pushMask(h)}return l&&t.context.setGlobalCompositeOperation(a),s+=this.drawDisplayObject(e,t,i,r,e.$displayList,n,o),l&&t.context.setGlobalCompositeOperation(M),h&&t.context.popMask(),D.sys.Region.release(g),D.Matrix.release(v),s},e.prototype.drawWithScrollRect=function(e,t,i,r,n,o){var a=0,s=e.$scrollRect?e.$scrollRect:e.$maskRect;if(s.isEmpty())return a;var l=D.Matrix.create();if(l.copyFrom(e.$getConcatenatedMatrix()),o)e.$getConcatenatedMatrixAt(o,l);else if(e.$parentDisplayList){var h=e.$parentDisplayList.root;h!==e.$stage&&e.$getConcatenatedMatrixAt(h,l)}var u=D.sys.Region.create();if(u.updateRegion(s,l),u.isEmpty()||n&&!n.intersects(u))return D.sys.Region.release(u),D.Matrix.release(l),a;var c=!1;if(i){for(var d=i.length,p=0;p<d;p++)if(u.intersects(i[p])){c=!0;break}}else c=!0;if(!c)return D.sys.Region.release(u),D.Matrix.release(l),a;t.setTransform(l.a,l.b,l.c,l.d,l.tx+r.tx,l.ty+r.ty);var f=t.context,g=!1;if(t.$hasScissor||0!=l.b||0!=l.c)f.pushMask(s);else{var v=s.x,y=s.y,m=s.width,x=s.height;v=v*l.a+l.tx+r.tx,y=y*l.d+l.ty+r.ty,m*=l.a,x*=l.d,f.enableScissor(v,-y-x+t.height,m,x),g=!0}return a+=this.drawDisplayObject(e,t,i,r,e.$displayList,u,o),t.setTransform(l.a,l.b,l.c,l.d,l.tx+r.tx,l.ty+r.ty),g?f.disableScissor():f.popMask(),D.sys.Region.release(u),D.Matrix.release(l),a},e.prototype.drawNodeToBuffer=function(e,t,i,r){var n=t;n.context.pushBuffer(n),n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(e,t,r),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},e.prototype.renderNode=function(e,t,i){switch(e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,i);break;case 4:this.renderGroup(e,t);break;case 6:t.globalAlpha=e.drawData[0];break;case 7:this.renderMesh(e,t)}},e.prototype.renderBitmap=function(e,t){var i=e.image;if(i){var r,n=e.drawData,o=n.length,a=0,s=e.matrix,l=e.blendMode,h=e.alpha;if(s&&(t.saveTransform(),t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty)),l&&t.context.setGlobalCompositeOperation(A[l]),h==h&&(r=t.globalAlpha,t.globalAlpha*=h),e.filter){for(t.context.$filter=e.filter;a<o;)t.context.drawImage(i,n[a++],n[a++],n[a++],n[a++],n[a++],n[a++],n[a++],n[a++],e.imageWidth,e.imageHeight);t.context.$filter=null}else for(;a<o;)t.context.drawImage(i,n[a++],n[a++],n[a++],n[a++],n[a++],n[a++],n[a++],n[a++],e.imageWidth,e.imageHeight);l&&t.context.setGlobalCompositeOperation(M),h==h&&(t.globalAlpha=r),s&&t.restoreTransform()}},e.prototype.renderMesh=function(e,t){var i=e.image,r=e.drawData,n=r.length,o=0,a=e.matrix;for(a&&(t.saveTransform(),t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty));o<n;)t.context.drawMesh(i,r[o++],r[o++],r[o++],r[o++],r[o++],r[o++],r[o++],r[o++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);a&&t.restoreTransform()},e.prototype.renderText=function(e,t){var i=e.width-e.x,r=e.height-e.y;if(0!=e.drawData.length&&(this.canvasRenderBuffer&&this.canvasRenderBuffer.context?e.dirtyRender&&this.canvasRenderBuffer.resize(i,r):(this.canvasRenderer=new D.CanvasRenderer,this.canvasRenderBuffer=new h.CanvasRenderBuffer(i,r)),this.canvasRenderBuffer.context)){if((e.x||e.y)&&(e.dirtyRender&&this.canvasRenderBuffer.context.translate(-e.x,-e.y),t.transform(1,0,0,1,e.x,e.y)),e.dirtyRender){var n=this.canvasRenderBuffer.surface;this.canvasRenderer.renderText(e,this.canvasRenderBuffer.context);var o=e.$texture;o?t.context.updateTexture(o,n):(o=t.context.createTexture(n),e.$texture=o),e.$textureWidth=n.width,e.$textureHeight=n.height}var a=e.$textureWidth,s=e.$textureHeight;t.context.drawTexture(e.$texture,0,0,a,s,0,0,a,s,a,s),(e.x||e.y)&&(e.dirtyRender&&this.canvasRenderBuffer.context.translate(e.x,e.y),t.transform(1,0,0,1,-e.x,-e.y)),e.dirtyRender=!1}},e.prototype.renderGraphics=function(e,t,i){var r=e.width,n=e.height;if(!(r<=0||n<=0)&&r&&n&&0!=e.drawData.length&&(this.canvasRenderBuffer&&this.canvasRenderBuffer.context?(e.dirtyRender||i)&&this.canvasRenderBuffer.resize(r,n):(this.canvasRenderer=new D.CanvasRenderer,this.canvasRenderBuffer=new h.CanvasRenderBuffer(r,n)),this.canvasRenderBuffer.context)){(e.x||e.y)&&((e.dirtyRender||i)&&this.canvasRenderBuffer.context.translate(-e.x,-e.y),t.transform(1,0,0,1,e.x,e.y));var o=this.canvasRenderBuffer.surface;if(i){this.canvasRenderer.renderGraphics(e,this.canvasRenderBuffer.context,!0),D.WebGLUtils.deleteWebGLTexture(o);var a=t.context.getWebGLTexture(o);t.context.drawTexture(a,0,0,r,n,0,0,r,n,o.width,o.height)}else{if(e.dirtyRender)this.canvasRenderer.renderGraphics(e,this.canvasRenderBuffer.context),(a=e.$texture)?t.context.updateTexture(a,o):(a=t.context.createTexture(o),e.$texture=a),e.$textureWidth=o.width,e.$textureHeight=o.height;var s=e.$textureWidth,l=e.$textureHeight;t.context.drawTexture(e.$texture,0,0,s,l,0,0,s,l,s,l)}(e.x||e.y)&&((e.dirtyRender||i)&&this.canvasRenderBuffer.context.translate(e.x,e.y),t.transform(1,0,0,1,-e.x,-e.y)),i||(e.dirtyRender=!1)}},e.prototype.renderGroup=function(e,t){var i=e.matrix;i&&(t.saveTransform(),t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty));for(var r=e.drawData,n=r.length,o=0;o<n;o++){var a=r[o];this.renderNode(a,t)}i&&t.restoreTransform()},e.prototype.createRenderBuffer=function(e,t){var i=$.pop();return i?i.resize(e,t):(i=new h.WebGLRenderBuffer(e,t)).$computeDrawCall=!1,i},e}(),h.WebGLRenderer=e,__reflect(e.prototype,"egret.web.WebGLRenderer",["egret.sys.SystemRenderer"])}(egret||(egret={}));
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d,egret3d;!function(t){var e=function(){function t(){this.averageFPS=0,this.averageDelay=0,this.delayNumber=0,this.countFrame=30}return t.prototype.update=function(t,e){return this.delayNumber+=e-1,0==this.countFrame--&&(this.countFrame=30,this.averageDelay=Math.floor(this.delayNumber/this.countFrame),this.averageFPS=Math.floor(1e3/this.averageDelay),this.averageFPS=Math.min(this.averageFPS,60),this.delayNumber=0)," "+this.averageFPS.toString()+" fps/"+this.averageDelay.toString()+" delay"},t.fps=16.6666,t}(),i=function(){function a(){}return a.initState=function(){a.use=!0,a._info=document.createElement("div"),a._time=document.createElement("div"),a._dataInfo=document.createElement("div"),a._info.style.fontSize="14px",a._info.style.backgroundColor="rgba(158,158,158,0.3)",a._info.style.width="200px",a._info.style.fontFamily="Corbel",a._dataInfo.style.fontFamily="12px",a._dataInfo.style.fontSize="12px",a._dataInfo.style.backgroundColor="rgba(158,158,158,0.3)",a._dataInfo.style.width="200px",a._dataInfo.style.fontFamily="Corbel",a._info.onselect=null,a._time.onselect=null,a._dataInfo.onselect=null,document.body.appendChild(a._info),document.body.appendChild(a._time),document.body.appendChild(a._dataInfo),a._info.style.color="lightblue",a._time.style.color="lightblue",a._dataInfo.style.color="lightblue",a._info.innerText=" Egret3D Graphics "},a.showTime=function(t,e){a.use||a.initState(),a._time.innerText=a.fpsInfo.update(t,e)},a.showDataInfo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i;for(i in a.use||a.initState(),t)t[i]&&(this.info+=t[i].toString()+"\r\t")},a.show=function(){a._dataInfo.innerText=this.info,this.info=" "},a.use=!1,a.fpsInfo=new e,a}();t.Egret3DState=i}(egret3d||(egret3d={})),function(t){var e,i;(e=t.TextureMethodType||(t.TextureMethodType={}))[e.diffuse=0]="diffuse",e[e.normal=1]="normal",e[e.specular=2]="specular",e[e.color=3]="color",e[e.shadow=4]="shadow",t.TextureMethodType,(i=t.ShaderPhaseType||(t.ShaderPhaseType={}))[i.start_vertex=0]="start_vertex",i[i.local_vertex=1]="local_vertex",i[i.global_vertex=2]="global_vertex",i[i.end_vertex=3]="end_vertex",i[i.start_fragment=4]="start_fragment",i[i.materialsource_fragment=5]="materialsource_fragment",i[i.diffuse_fragment=6]="diffuse_fragment",i[i.normal_fragment=7]="normal_fragment",i[i.matCap_fragment=8]="matCap_fragment",i[i.specular_fragment=9]="specular_fragment",i[i.shadow_fragment=10]="shadow_fragment",i[i.lighting_fragment=11]="lighting_fragment",i[i.multi_end_fragment=12]="multi_end_fragment",i[i.end_fragment=13]="end_fragment",t.ShaderPhaseType}(egret3d||(egret3d={})),function(t){var e=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.u=0,this.v=0,this.u=t,this.v=e};(egret3d||(egret3d={})).UV=e}(),function(t){var e=function(){function e(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Object.defineProperty(e.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},e.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},e.prototype.normalize=function(t){if(void 0===t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,void(this.y*=e)}throw"Cannot divide by zero length."},e.prototype.offset=function(t,e){this.x+=t,this.y+=e},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.toString=function(){return"[Point] (x="+this.x+", y="+this.y+")"},e.distance=function(t,e){var i=e.x-t.x,a=e.y-t.y;return Math.sqrt(i*i+a*a)},e}();t.Point=e}(egret3d||(egret3d={})),function(t){var e=function(){function h(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=i,this.w=a}return Object.defineProperty(h.prototype,"a",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"r",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"g",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"b",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),h.prototype.add=function(t){return new h(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},h.prototype.clone=function(){return new h(this.x,this.y,this.z,this.w)},h.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},h.prototype.crossProduct=function(t){return new h(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,1)},h.prototype.decrementBy=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},h.distance=function(t,e){var i=t.x-e.x,a=t.y-e.y,r=t.z-e.z;return Math.sqrt(i*i+a*a+r*r)},h.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},h.prototype.equals=function(t,e){return void 0===e&&(e=!1),this.x==t.x&&this.y==t.y&&this.z==t.z&&(!e||this.w==t.w)},h.prototype.incrementBy=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},h.prototype.divide=function(t){return t instanceof h?new h(this.x/t.x,this.y/t.y,this.z/t.z):(this.x=this.x/t,this.y=this.y/t,this.z=this.z/t,this)},h.prototype.negate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},h.prototype.normalize=function(t){if(void 0===t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,this.y*=e,void(this.z*=e)}},h.prototype.scaleBy=function(t){this.x*=t,this.y*=t,this.z*=t},h.prototype.setTo=function(t,e,i,a){void 0===a&&(a=1),this.x=t,this.y=e,this.z=i,this.w=a},h.prototype.subtract=function(t,e){return void 0===e&&(e=null),e||(e=new h),e.setTo(this.x-t.x,this.y-t.y,this.z-t.z),e},h.prototype.multiply=function(t,e){void 0===e&&(e=null),e||(e=new h);var i=this.x,a=this.y,r=this.z,n=t.x,o=t.y,s=t.z;return e.setTo(i*n,a*o,r*s),e},h.prototype.divided=function(t,e){void 0===e&&(e=null),e||(e=new h);var i=this.x,a=this.y,r=this.z,n=t.x,o=t.y,s=t.z;return e.setTo(i/n,a/o,r/s),e},h.prototype.lerp=function(t,e,i){var a=t.x,r=t.y,n=t.z,o=t.w,s=e.x,h=e.y,l=e.z,u=e.w;this.x=(s-a)*i+a,this.y=(h-r)*i+r,this.z=(l-n)*i+n,this.w=(u-o)*i+o},h.prototype.toString=function(){return"<"+this.x+", "+this.y+", "+this.z+">"},h.prototype.parsing=function(t){var e=t.split(" ");e.length<3||(this.x=parseFloat(e[0]),this.y=parseFloat(e[1]),this.z=parseFloat(e[2]))},h.X_AXIS=new h(1,0,0),h.Y_AXIS=new h(0,1,0),h.Z_AXIS=new h(0,0,1),h}();t.Vector3D=e}(egret3d||(egret3d={})),function(t){var e=function(){function t(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=32),void 0===a&&(a=32),this.x=0,this.y=0,this.width=0,this.height=0,this.x=t,this.y=e,this.width=i,this.height=a}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.inner=function(t,e){return!(t<this.x||t>this.x+this.width||e<this.y||e>this.y+this.height)},t}();t.Rectangle=e}(egret3d||(egret3d={})),function(d){var t=function(){function n(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=a}return Object.defineProperty(n.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),n.prototype.multiply=function(t,e){var i=t.w,a=t.x,r=t.y,n=t.z,o=e.w,s=e.x,h=e.y,l=e.z;this.w=i*o-a*s-r*h-n*l,this.x=i*s+a*o+r*l-n*h,this.y=i*h-a*l+r*o+n*s,this.z=i*l+a*h-r*s+n*o},n.prototype.multiplyVector=function(t,e){void 0===e&&(e=null),null===e&&(e=new n);var i=t.x,a=t.y,r=t.z;return e.w=-this.x*i-this.y*a-this.z*r,e.x=this.w*i+this.y*r-this.z*a,e.y=this.w*a-this.x*r+this.z*i,e.z=this.w*r+this.x*a-this.y*i,e},n.prototype.fromAxisAngle=function(t,e){var i=.5*(e*=Math.PI/180),a=Math.sin(i);this.w=Math.cos(i),this.x=t.x*a,this.y=t.y*a,this.z=t.z*a,this.normalize()},n.prototype.toAxisAngle=function(t){var e=this.x*this.x+this.y*this.y+this.z*this.z,i=0;return 0<e?(i=2*Math.acos(this.w),e=1/Math.sqrt(e),t.x=this.x*e,t.y=this.y*e,t.z=this.z*e):(i=0,t.x=1,t.y=0,t.z=0),i/(Math.PI/180)},n.prototype.slerp=function(t,e,i){var a=t.w,r=t.x,n=t.y,o=t.z,s=e.w,h=e.x,l=e.y,u=e.z,c=a*s+r*h+n*l+o*u;if(c<0&&(c=-c,s=-s,h=-h,l=-l,u=-u),c<.95){var d=Math.acos(c),p=1/Math.sin(d),_=Math.sin(d*(1-i))*p,f=Math.sin(d*i)*p;this.w=a*_+s*f,this.x=r*_+h*f,this.y=n*_+l*f,this.z=o*_+u*f}else{this.w=a+i*(s-a),this.x=r+i*(h-r),this.y=n+i*(l-n),this.z=o+i*(u-o);var m=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=m,this.x*=m,this.y*=m,this.z*=m}},n.prototype.lerp=function(t,e,i){var a,r=t.w,n=t.x,o=t.y,s=t.z,h=e.w,l=e.x,u=e.y,c=e.z;r*h+n*l+o*u+s*c<0&&(h=-h,l=-l,u=-u,c=-c),this.w=r+i*(h-r),this.x=n+i*(l-n),this.y=o+i*(u-o),this.z=s+i*(c-s),a=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z),this.w*=a,this.x*=a,this.y*=a,this.z*=a},n.prototype.fromEulerAngles=function(t,e,i){var a=.5*(t*=d.MathUtil.DEGREES_TO_RADIANS),r=.5*(e*=d.MathUtil.DEGREES_TO_RADIANS),n=.5*(i*=d.MathUtil.DEGREES_TO_RADIANS),o=Math.cos(a),s=Math.sin(a),h=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n);return this.w=o*h*u+s*l*c,this.x=s*h*u-o*l*c,this.y=o*l*u+s*h*c,this.z=o*h*c-s*l*u,this},n.prototype.toEulerAngles=function(t){void 0===t&&(t=null),null===t&&(t=new d.Vector3D),t.x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y));var e=2*(this.w*this.y-this.z*this.x);return e=d.MathUtil.clampf(e,-1,1),t.y=Math.asin(e),t.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z)),t.x/=d.MathUtil.DEGREES_TO_RADIANS,t.y/=d.MathUtil.DEGREES_TO_RADIANS,t.z/=d.MathUtil.DEGREES_TO_RADIANS,t},n.prototype.normalize=function(t){void 0===t&&(t=1);var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e,this.y*=e,this.z*=e,this.w*=e},n.prototype.toString=function(){return"{x:"+this.x+" y:"+this.y+" z:"+this.z+" w:"+this.w+"}"},n.prototype.toMatrix3D=function(t){void 0===t&&(t=null);var e=d.MathUtil.RAW_DATA_CONTAINER,i=2*this.x*this.y,a=2*this.x*this.z,r=2*this.x*this.w,n=2*this.y*this.z,o=2*this.y*this.w,s=2*this.z*this.w,h=this.x*this.x,l=this.y*this.y,u=this.z*this.z,c=this.w*this.w;return e[0]=h-l-u+c,e[4]=i-s,e[8]=a+o,e[12]=0,e[1]=i+s,e[5]=-h+l-u+c,e[9]=n-r,e[13]=0,e[2]=a-o,e[6]=n+r,e[10]=-h-l+u+c,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,t?(t.copyRawDataFrom(e),t):new d.Matrix4_4(new Float32Array(e))},n.prototype.fromMatrix=function(t){var e=t.decompose(d.Orientation3D.QUATERNION)[1];this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w},n.prototype.inverse=function(t){void 0===t&&(t=null),t||(t=new n);var e=this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z;if(0<e){var i=1/e;t.w=this.w*i,t.x=-this.x*i,t.y=-this.y*i,t.z=-this.z*i}return t},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.transformVector=function(t,e){void 0===e&&(e=null);var i,a,r,n,o=t.x,s=t.y,h=t.z;return null===e&&(e=new d.Vector3D),n=-this.x*o-this.y*s-this.z*h,i=this.w*o+this.y*h-this.z*s,a=this.w*s-this.x*h+this.z*o,r=this.w*h+this.x*s-this.y*o,e.x=-n*this.x+i*this.w-a*this.z+r*this.y,e.y=-n*this.y+i*this.z+a*this.w-r*this.x,e.z=-n*this.z-i*this.y+a*this.x+r*this.w,e},n.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},n}();d.Quaternion=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){}return t.AXIS_ANGLE="axisAngle",t.EULER_ANGLES="eulerAngles",t.QUATERNION="quaternion",t}();t.Orientation3D=e}(egret3d||(egret3d={})),function(a){var t=function(){function t(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=a}return t.prototype.setTo=function(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=a},t.prototype.fromPoints=function(t,e,i){var a=e.x-t.x,r=e.y-t.y,n=e.z-t.z,o=i.x-t.x,s=i.y-t.y,h=i.z-t.z;this.a=r*h-n*s,this.b=n*o-a*h,this.c=a*s-r*o,this.d=-(this.a*t.x+this.b*t.y+this.c*t.z)},t.prototype.fromNormalAndPoint=function(t,e){this.a=t.x,this.b=t.y,this.c=t.z,this.d=-(this.a*e.x+this.b*e.y+this.c*e.z)},t.prototype.normalize=function(){var t=Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);if(0<t){var e=1/t;this.a*=e,this.b*=e,this.c*=e,this.d*=e}return t},t.prototype.distance=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},t.prototype.classifyPoint=function(t,e){void 0===e&&(e=.01);var i=this.distance(t);return i<-e?a.PlaneClassification.BACK:e<i?a.PlaneClassification.FRONT:a.PlaneClassification.INTERSECT},t.prototype.toString=function(){return"Plane3D [a:"+this.a+", b:"+this.b+", c:"+this.c+", d:"+this.d+"]"},t.ALIGN_ANY=0,t.ALIGN_XY_AXIS=1,t.ALIGN_YZ_AXIS=2,t.ALIGN_XZ_AXIS=3,t}();a.Plane3D=t}(egret3d||(egret3d={})),function(u){var t=function(){function c(t){void 0===t&&(t=null),this.rawData=t||new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return c.prototype.lookAt=function(t,e,i){var a=e.subtract(t);a.normalize();var r=i.crossProduct(a);r.normalize();var n=a.crossProduct(r);this.rawData[0]=r.x,this.rawData[1]=n.x,this.rawData[2]=a.x,this.rawData[3]=0,this.rawData[4]=r.y,this.rawData[5]=n.y,this.rawData[6]=a.y,this.rawData[7]=0,this.rawData[8]=r.z,this.rawData[9]=n.z,this.rawData[10]=a.z,this.rawData[11]=0,this.rawData[12]=-r.dotProduct(t),this.rawData[13]=-n.dotProduct(t),this.rawData[14]=-a.dotProduct(t),this.rawData[15]=1},c.prototype.multiply=function(t){var e=this.rawData,i=t.rawData,a=c.helpMatrix;a[0]=e[0]*i[0]+e[1]*i[4]+e[2]*i[8]+e[3]*i[12],a[1]=e[0]*i[1]+e[1]*i[5]+e[2]*i[9]+e[3]*i[13],a[2]=e[0]*i[2]+e[1]*i[6]+e[2]*i[10]+e[3]*i[14],a[3]=e[0]*i[3]+e[1]*i[7]+e[2]*i[11]+e[3]*i[15],a[4]=e[4]*i[0]+e[5]*i[4]+e[6]*i[8]+e[7]*i[12],a[5]=e[4]*i[1]+e[5]*i[5]+e[6]*i[9]+e[7]*i[13],a[6]=e[4]*i[2]+e[5]*i[6]+e[6]*i[10]+e[7]*i[14],a[7]=e[4]*i[3]+e[5]*i[7]+e[6]*i[11]+e[7]*i[15],a[8]=e[8]*i[0]+e[9]*i[4]+e[10]*i[8]+e[11]*i[12],a[9]=e[8]*i[1]+e[9]*i[5]+e[10]*i[9]+e[11]*i[13],a[10]=e[8]*i[2]+e[9]*i[6]+e[10]*i[10]+e[11]*i[14],a[11]=e[8]*i[3]+e[9]*i[7]+e[10]*i[11]+e[11]*i[15],a[12]=e[12]*i[0]+e[13]*i[4]+e[14]*i[8]+e[15]*i[12],a[13]=e[12]*i[1]+e[13]*i[5]+e[14]*i[9]+e[15]*i[13],a[14]=e[12]*i[2]+e[13]*i[6]+e[14]*i[10]+e[15]*i[14],a[15]=e[12]*i[3]+e[13]*i[7]+e[14]*i[11]+e[15]*i[15];for(var r=0;r<16;r++)this.rawData[r]=a[r]},c.prototype.perspectiveB=function(t,e,i,a){var r=Math.tan(t*Math.PI/360)*i,n=r*e;return this.frustum(-n,n,-r,r,i,a)},c.prototype.frustum=function(t,e,i,a,r,n){var o=this.rawData;return o[0]=2*r/(e-t),o[1]=0,o[2]=(e+t)/(e-t),o[3]=0,o[4]=0,o[5]=2*r/(a-i),o[6]=(a+i)/(a-i),o[7]=0,o[8]=0,o[9]=0,o[10]=-(n+r)/(n-r),o[11]=-2*n*r/(n-r),o[12]=0,o[13]=0,o[14]=-1,o[15]=0,this},c.prototype.perspective=function(t,e,i,a){var r=t*(Math.PI/180),n=Math.tan((Math.PI-r)/2),o=n/e;this.rawData[0]=o,this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=n,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=a/(a-i),this.rawData[11]=1,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=-i*a/(a-i),this.rawData[15]=0},c.prototype.ortho=function(t,e,i,a){this.rawData[0]=2/t,this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=2/e,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=1/(a-i),this.rawData[11]=0,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=i/(i-a),this.rawData[15]=1},c.prototype.orthoOffCenter=function(t,e,i,a,r,n){this.rawData[0]=2/(e-1),this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=2/(a-i),this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=1/(n-r),this.rawData[11]=0,this.rawData[12]=(1+e)/(1-e),this.rawData[13]=(a+i)/(i-a),this.rawData[14]=r/(r-n),this.rawData[15]=1},c.prototype.append=function(t){var e=this.rawData[0],i=this.rawData[4],a=this.rawData[8],r=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],_=this.rawData[7],f=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],D=t.rawData[1],b=t.rawData[5],w=t.rawData[9],T=t.rawData[13],P=t.rawData[2],S=t.rawData[6],C=t.rawData[10],A=t.rawData[14],E=t.rawData[3],L=t.rawData[7],M=t.rawData[11],F=t.rawData[15];this.rawData[0]=e*g+n*v+l*y+p*x,this.rawData[1]=e*D+n*b+l*w+p*T,this.rawData[2]=e*P+n*S+l*C+p*A,this.rawData[3]=e*E+n*L+l*M+p*F,this.rawData[4]=i*g+o*v+u*y+_*x,this.rawData[5]=i*D+o*b+u*w+_*T,this.rawData[6]=i*P+o*S+u*C+_*A,this.rawData[7]=i*E+o*L+u*M+_*F,this.rawData[8]=a*g+s*v+c*y+f*x,this.rawData[9]=a*D+s*b+c*w+f*T,this.rawData[10]=a*P+s*S+c*C+f*A,this.rawData[11]=a*E+s*L+c*M+f*F,this.rawData[12]=r*g+h*v+d*y+m*x,this.rawData[13]=r*D+h*b+d*w+m*T,this.rawData[14]=r*P+h*S+d*C+m*A,this.rawData[15]=r*E+h*L+d*M+m*F},c.prototype.add=function(t){var e=this.rawData[0],i=this.rawData[4],a=this.rawData[8],r=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],_=this.rawData[7],f=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],D=t.rawData[1],b=t.rawData[5],w=t.rawData[9],T=t.rawData[13],P=t.rawData[2],S=t.rawData[6],C=t.rawData[10],A=t.rawData[14],E=t.rawData[3],L=t.rawData[7],M=t.rawData[11],F=t.rawData[15];return this.rawData[0]=e+g,this.rawData[1]=n+D,this.rawData[2]=l+P,this.rawData[3]=p+E,this.rawData[4]=i+v,this.rawData[5]=o+b,this.rawData[6]=u+S,this.rawData[7]=_+L,this.rawData[8]=a+y,this.rawData[9]=s+w,this.rawData[10]=c+C,this.rawData[11]=f+M,this.rawData[12]=r+x,this.rawData[13]=h+T,this.rawData[14]=d+A,this.rawData[15]=m+F,this},c.prototype.sub=function(t){var e=this.rawData[0],i=this.rawData[4],a=this.rawData[8],r=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],_=this.rawData[7],f=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],D=t.rawData[1],b=t.rawData[5],w=t.rawData[9],T=t.rawData[13],P=t.rawData[2],S=t.rawData[6],C=t.rawData[10],A=t.rawData[14],E=t.rawData[3],L=t.rawData[7],M=t.rawData[11],F=t.rawData[15];return this.rawData[0]=e-g,this.rawData[1]=n-D,this.rawData[2]=l-P,this.rawData[3]=p-E,this.rawData[4]=i-v,this.rawData[5]=o-b,this.rawData[6]=u-S,this.rawData[7]=_-L,this.rawData[8]=a-y,this.rawData[9]=s-w,this.rawData[10]=c-C,this.rawData[11]=f-M,this.rawData[12]=r-x,this.rawData[13]=h-T,this.rawData[14]=d-A,this.rawData[15]=m-F,this},c.prototype.mult=function(t){return this.rawData[0]*=t,this.rawData[1]*=t,this.rawData[2]*=t,this.rawData[3]*=t,this.rawData[4]*=t,this.rawData[5]*=t,this.rawData[6]*=t,this.rawData[7]*=t,this.rawData[8]*=t,this.rawData[9]*=t,this.rawData[10]*=t,this.rawData[11]*=t,this.rawData[12]*=t,this.rawData[13]*=t,this.rawData[14]*=t,this.rawData[15]*=t,this},c.prototype.rotation=function(t,e,i){this.appendRotation(t,u.Vector3D.X_AXIS),this.appendRotation(e,u.Vector3D.Y_AXIS),this.appendRotation(i,u.Vector3D.Z_AXIS)},c.prototype.appendRotation=function(t,e){var i,a,r=(c.getAxisRotation(e.x,e.y,e.z,t),u.MathUtil.CALCULATION_MATRIX),n=t*u.MathUtil.DEGREES_TO_RADIANS;i=Math.sin(n),a=Math.cos(n),1==e.x&&(r.rawData[0]=1,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=0,r.rawData[4]=0,r.rawData[5]=a,r.rawData[6]=i,r.rawData[7]=0,r.rawData[8]=0,r.rawData[9]=-i,r.rawData[10]=a,r.rawData[7]=0,r.rawData[12]=0,r.rawData[13]=0,r.rawData[14]=0,r.rawData[15]=1),1==e.y&&(r.rawData[0]=a,r.rawData[1]=0,r.rawData[2]=-i,r.rawData[3]=0,r.rawData[4]=0,r.rawData[5]=1,r.rawData[6]=0,r.rawData[7]=0,r.rawData[8]=i,r.rawData[9]=0,r.rawData[10]=a,r.rawData[11]=0,r.rawData[12]=0,r.rawData[13]=0,r.rawData[14]=0,r.rawData[15]=1),1==e.z&&(r.rawData[0]=a,r.rawData[1]=i,r.rawData[2]=0,r.rawData[3]=0,r.rawData[4]=-i,r.rawData[5]=a,r.rawData[6]=0,r.rawData[7]=0,r.rawData[8]=0,r.rawData[9]=0,r.rawData[10]=1,r.rawData[11]=0,r.rawData[12]=0,r.rawData[13]=0,r.rawData[14]=0,r.rawData[15]=1),this.append(r)},c.prototype.appendScale=function(t,e,i){this.rawData[0]=t,this.rawData[1]=0,this.rawData[2]=0,this.rawData[4]=0,this.rawData[5]=e,this.rawData[6]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=i},c.prototype.appendTranslation=function(t,e,i){this.rawData[12]+=t,this.rawData[13]+=e,this.rawData[14]+=i},c.prototype.clone=function(){var t=new c;return t.copyFrom(this),t},c.prototype.copyColumnFrom=function(t,e){switch(t){case 0:this.rawData[0]=e.x,this.rawData[1]=e.y,this.rawData[2]=e.z,this.rawData[3]=e.w;break;case 1:this.rawData[4]=e.x,this.rawData[5]=e.y,this.rawData[6]=e.z,this.rawData[7]=e.w;break;case 2:this.rawData[8]=e.x,this.rawData[9]=e.y,this.rawData[10]=e.z,this.rawData[11]=e.w;break;case 3:this.rawData[12]=e.x,this.rawData[13]=e.y,this.rawData[14]=e.z,this.rawData[15]=e.w}},c.prototype.copyRowTo=function(t,e){switch(t){case 0:e.x=this.rawData[0],e.y=this.rawData[1],e.z=this.rawData[2],e.w=this.rawData[3];break;case 1:e.x=this.rawData[4],e.y=this.rawData[5],e.z=this.rawData[6],e.w=this.rawData[7];break;case 2:e.x=this.rawData[8],e.y=this.rawData[9],e.z=this.rawData[10],e.w=this.rawData[11];break;case 3:e.x=this.rawData[12],e.y=this.rawData[13],e.z=this.rawData[14],e.w=this.rawData[15]}},c.prototype.copyFrom=function(t){for(var e=t.rawData.length,i=0;i<e;i++)this.rawData[i]=t.rawData[i];return this},c.prototype.copyRawDataFrom=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),i&&this.transpose();for(var a=t.length-e,r=0;r<a;r++)this.rawData[r]=t[r+e];i&&this.transpose()},c.prototype.copyRawDataTo=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),i&&this.transpose();for(var a=this.rawData.length,r=0;r<a;r++)t[r+e]=this.rawData[r];i&&this.transpose()},c.prototype.copyColFrom=function(t,e){switch(t){case 0:this.rawData[0]=e.x,this.rawData[4]=e.y,this.rawData[8]=e.z,this.rawData[12]=e.w;break;case 1:this.rawData[1]=e.x,this.rawData[5]=e.y,this.rawData[9]=e.z,this.rawData[13]=e.w;break;case 2:this.rawData[2]=e.x,this.rawData[6]=e.y,this.rawData[10]=e.z,this.rawData[14]=e.w;break;case 3:this.rawData[3]=e.x,this.rawData[7]=e.y,this.rawData[11]=e.z,this.rawData[15]=e.w;break;default:new Error("no more raw!")}},c.prototype.copyColTo=function(t,e){switch(t){case 0:e.x=this.rawData[0],e.y=this.rawData[4],e.z=this.rawData[8],e.w=this.rawData[12];break;case 1:e.x=this.rawData[1],e.y=this.rawData[5],e.z=this.rawData[9],e.w=this.rawData[13];break;case 2:e.x=this.rawData[2],e.y=this.rawData[6],e.z=this.rawData[10],e.w=this.rawData[14];break;case 3:e.x=this.rawData[3],e.y=this.rawData[7],e.z=this.rawData[11],e.w=this.rawData[15];break;default:new Error("no more raw!")}},c.prototype.copyToMatrix3D=function(t){t.rawData=this.rawData.slice(0)},c.prototype.decompose=function(t,e){void 0===t&&(t="eulerAngles"),void 0===e&&(e=null);var i=u.MathUtil.CALCULATION_QUATERNION,a=e||[new u.Vector3D,new u.Vector3D,new u.Vector3D];this.copyRawDataTo(c.helpMatrix.rawData);var r=c.helpMatrix.rawData,n=a[0];n.x=r[12],n.y=r[13],n.z=r[14],r[12]=0,r[13]=0,r[14]=0;var o=a[2];o.x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),o.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),o.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),r[0]*(r[5]*r[10]-r[6]*r[9])-r[1]*(r[4]*r[10]-r[6]*r[8])+r[2]*(r[4]*r[9]-r[5]*r[8])<0&&(o.z=-o.z),r[0]/=o.x,r[1]/=o.x,r[2]/=o.x,r[4]/=o.y,r[5]/=o.y,r[6]/=o.y,r[8]/=o.z,r[9]/=o.z,r[10]/=o.z;var s=a[1];switch(t){case u.Orientation3D.AXIS_ANGLE:s.w=Math.acos((r[0]+r[5]+r[10]-1)/2);var h=Math.sqrt((r[6]-r[9])*(r[6]-r[9])+(r[8]-r[2])*(r[8]-r[2])+(r[1]-r[4])*(r[1]-r[4]));s.x=(r[6]-r[9])/h,s.y=(r[8]-r[2])/h,s.z=(r[1]-r[4])/h;break;case u.Orientation3D.QUATERNION:0<(l=r[0]+r[5]+r[10])?(s.w=Math.sqrt(1+l)/2,s.x=(r[6]-r[9])/(4*s.w),s.y=(r[8]-r[2])/(4*s.w),s.z=(r[1]-r[4])/(4*s.w)):r[0]>r[5]&&r[0]>r[10]?(s.x=Math.sqrt(1+r[0]-r[5]-r[10])/2,s.w=(r[6]-r[9])/(4*s.x),s.y=(r[1]+r[4])/(4*s.x),s.z=(r[8]+r[2])/(4*s.x)):r[5]>r[10]?(s.y=Math.sqrt(1+r[5]-r[0]-r[10])/2,s.x=(r[1]+r[4])/(4*s.y),s.w=(r[8]-r[2])/(4*s.y),s.z=(r[6]+r[9])/(4*s.y)):(s.z=Math.sqrt(1+r[10]-r[0]-r[5])/2,s.x=(r[8]+r[2])/(4*s.z),s.y=(r[6]+r[9])/(4*s.z),s.w=(r[1]-r[4])/(4*s.z));break;case u.Orientation3D.EULER_ANGLES:var l;0<(l=r[0]+r[5]+r[10])?(i.w=Math.sqrt(1+l)/2,i.x=(r[6]-r[9])/(4*i.w),i.y=(r[8]-r[2])/(4*i.w),i.z=(r[1]-r[4])/(4*i.w)):r[0]>r[5]&&r[0]>r[10]?(i.x=Math.sqrt(1+r[0]-r[5]-r[10])/2,i.w=(r[6]-r[9])/(4*i.x),i.y=(r[1]+r[4])/(4*i.x),i.z=(r[8]+r[2])/(4*i.x)):r[5]>r[10]?(s.y=Math.sqrt(1+r[5]-r[0]-r[10])/2,i.x=(r[1]+r[4])/(4*i.y),i.w=(r[8]-r[2])/(4*i.y),i.z=(r[6]+r[9])/(4*i.y)):(i.z=Math.sqrt(1+r[10]-r[0]-r[5])/2,i.x=(r[8]+r[2])/(4*i.z),i.y=(r[6]+r[9])/(4*i.z),i.w=(r[1]-r[4])/(4*i.z)),i.toEulerAngles(s)}return a.push(n),a.push(s),a.push(o),a},c.prototype.deltaTransformVector=function(t,e){void 0===e&&(e=null),e||(e=new u.Vector3D);var i=t.x,a=t.y,r=t.z;return e.x=i*this.rawData[0]+a*this.rawData[4]+r*this.rawData[8],e.y=i*this.rawData[1]+a*this.rawData[5]+r*this.rawData[9],e.z=i*this.rawData[2]+a*this.rawData[6]+r*this.rawData[10],e.w=i*this.rawData[3]+a*this.rawData[7]+r*this.rawData[11],e},c.prototype.identity=function(){this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[11]=0,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=0,this.rawData[0]=1,this.rawData[5]=1,this.rawData[10]=1,this.rawData[15]=1},c.prototype.fill=function(t){this.rawData[1]=t,this.rawData[2]=t,this.rawData[3]=t,this.rawData[4]=t,this.rawData[6]=t,this.rawData[7]=t,this.rawData[8]=t,this.rawData[9]=t,this.rawData[11]=t,this.rawData[12]=t,this.rawData[13]=t,this.rawData[14]=t,this.rawData[0]=t,this.rawData[5]=t,this.rawData[10]=t,this.rawData[15]=t},c.prototype.invers33=function(){var t=this.rawData[5]*this.rawData[10]-this.rawData[9]*this.rawData[6],e=this.rawData[8]*this.rawData[6]-this.rawData[4]*this.rawData[10],i=this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5],a=this.rawData[9]*this.rawData[2]-this.rawData[1]*this.rawData[10],r=this.rawData[0]*this.rawData[10]-this.rawData[8]*this.rawData[2],n=this.rawData[8]*this.rawData[1]-this.rawData[0]*this.rawData[9],o=this.rawData[1]*this.rawData[6]-this.rawData[5]*this.rawData[2],s=this.rawData[4]*this.rawData[2]-this.rawData[0]*this.rawData[6],h=this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1],l=this.rawData[0]*t+this.rawData[4]*a+this.rawData[8]*o;if(1e-11<Math.abs(l)){var u=1/l;this.rawData[0]=u*t,this.rawData[4]=u*e,this.rawData[8]=u*i,this.rawData[1]=u*a,this.rawData[5]=u*r,this.rawData[9]=u*n,this.rawData[2]=u*o,this.rawData[6]=u*s,this.rawData[10]=u*h}},c.prototype.invert=function(){var t=this.determinant,e=1e-11<Math.abs(t);if(e){t=1/t;var i=this.rawData[0],a=this.rawData[4],r=this.rawData[8],n=this.rawData[12],o=this.rawData[1],s=this.rawData[5],h=this.rawData[9],l=this.rawData[13],u=this.rawData[2],c=this.rawData[6],d=this.rawData[10],p=this.rawData[14],_=this.rawData[3],f=this.rawData[7],m=this.rawData[11],g=this.rawData[15];this.rawData[0]=t*(s*(d*g-p*m)-h*(c*g-p*f)+l*(c*m-d*f)),this.rawData[1]=-t*(o*(d*g-p*m)-h*(u*g-p*_)+l*(u*m-d*_)),this.rawData[2]=t*(o*(c*g-p*f)-s*(u*g-p*_)+l*(u*f-c*_)),this.rawData[3]=-t*(o*(c*m-d*f)-s*(u*m-d*_)+h*(u*f-c*_)),this.rawData[4]=-t*(a*(d*g-p*m)-r*(c*g-p*f)+n*(c*m-d*f)),this.rawData[5]=t*(i*(d*g-p*m)-r*(u*g-p*_)+n*(u*m-d*_)),this.rawData[6]=-t*(i*(c*g-p*f)-a*(u*g-p*_)+n*(u*f-c*_)),this.rawData[7]=t*(i*(c*m-d*f)-a*(u*m-d*_)+r*(u*f-c*_)),this.rawData[8]=t*(a*(h*g-l*m)-r*(s*g-l*f)+n*(s*m-h*f)),this.rawData[9]=-t*(i*(h*g-l*m)-r*(o*g-l*_)+n*(o*m-h*_)),this.rawData[10]=t*(i*(s*g-l*f)-a*(o*g-l*_)+n*(o*f-s*_)),this.rawData[11]=-t*(i*(s*m-h*f)-a*(o*m-h*_)+r*(o*f-s*_)),this.rawData[12]=-t*(a*(h*p-l*d)-r*(s*p-l*c)+n*(s*d-h*c)),this.rawData[13]=t*(i*(h*p-l*d)-r*(o*p-l*u)+n*(o*d-h*u)),this.rawData[14]=-t*(i*(s*p-l*c)-a*(o*p-l*u)+n*(o*c-s*u)),this.rawData[15]=t*(i*(s*d-h*c)-a*(o*d-h*u)+r*(o*c-s*u))}return e},c.prototype.makeTransform=function(t,e,i){i.toMatrix3D(u.MathUtil.CALCULATION_MATRIX),this.rawData[0]=u.MathUtil.CALCULATION_MATRIX.rawData[0]*e.x,this.rawData[1]=u.MathUtil.CALCULATION_MATRIX.rawData[1]*e.y,this.rawData[2]=u.MathUtil.CALCULATION_MATRIX.rawData[2]*e.z,this.rawData[3]=0,this.rawData[4]=u.MathUtil.CALCULATION_MATRIX.rawData[4]*e.x,this.rawData[5]=u.MathUtil.CALCULATION_MATRIX.rawData[5]*e.y,this.rawData[6]=u.MathUtil.CALCULATION_MATRIX.rawData[6]*e.z,this.rawData[7]=0,this.rawData[8]=u.MathUtil.CALCULATION_MATRIX.rawData[8]*e.x,this.rawData[9]=u.MathUtil.CALCULATION_MATRIX.rawData[9]*e.y,this.rawData[10]=u.MathUtil.CALCULATION_MATRIX.rawData[10]*e.z,this.rawData[11]=0,this.rawData[12]=t.x,this.rawData[13]=t.y,this.rawData[14]=t.z,this.rawData[15]=1},c.prototype.recompose=function(t){return u.MathUtil.CALCULATION_QUATERNION.fromEulerAngles(t[1].x,t[1].y,t[1].z),this.makeTransform(t[0],t[2],u.MathUtil.CALCULATION_QUATERNION),!0},c.prototype.transformVector=function(t,e){void 0===e&&(e=null),e||(e=new u.Vector3D);var i=t.x,a=t.y,r=t.z;return e.x=i*this.rawData[0]+a*this.rawData[4]+r*this.rawData[8]+this.rawData[12],e.y=i*this.rawData[1]+a*this.rawData[5]+r*this.rawData[9]+this.rawData[13],e.z=i*this.rawData[2]+a*this.rawData[6]+r*this.rawData[10]+this.rawData[14],e.w=i*this.rawData[3]+a*this.rawData[7]+r*this.rawData[11]+this.rawData[15],e},c.prototype.transformVector4=function(t,e){void 0===e&&(e=null),e||(e=new u.Vector3D);var i=t.x,a=t.y,r=t.z,n=t.w;return e.x=i*this.rawData[0]+a*this.rawData[4]+r*this.rawData[8]+n*this.rawData[12],e.y=i*this.rawData[1]+a*this.rawData[5]+r*this.rawData[9]+n*this.rawData[13],e.z=i*this.rawData[2]+a*this.rawData[6]+r*this.rawData[10]+n*this.rawData[14],e.w=i*this.rawData[3]+a*this.rawData[7]+r*this.rawData[11]+n*this.rawData[15],e},c.prototype.mat3TransformVector=function(t,e){void 0===e&&(e=null),e||(e=new u.Vector3D);var i=t.x,a=t.y,r=t.z;return e.x=i*this.rawData[0]+a*this.rawData[4]+r*this.rawData[8],e.y=i*this.rawData[1]+a*this.rawData[5]+r*this.rawData[9],e.z=i*this.rawData[2]+a*this.rawData[6]+r*this.rawData[10],e},c.prototype.transformPlane=function(t){var e=new c;e.copyFrom(this),e.invert(),e.transpose();var i=new u.Vector3D(t.a,t.b,t.c,t.d);i.copyFrom(e.transformVector(i));var a=new u.Plane3D;return a.a=i.x,a.b=i.y,a.c=i.z,a.d=i.w/Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z),a},c.prototype.transpose=function(){for(var t=0;t<c.helpMatrix.rawData.length;t++)c.helpMatrix.rawData[t]=this.rawData[t];this.rawData[1]=c.helpMatrix.rawData[4],this.rawData[2]=c.helpMatrix.rawData[8],this.rawData[3]=c.helpMatrix.rawData[12],this.rawData[4]=c.helpMatrix.rawData[1],this.rawData[6]=c.helpMatrix.rawData[9],this.rawData[7]=c.helpMatrix.rawData[13],this.rawData[8]=c.helpMatrix.rawData[2],this.rawData[9]=c.helpMatrix.rawData[6],this.rawData[11]=c.helpMatrix.rawData[14],this.rawData[12]=c.helpMatrix.rawData[3],this.rawData[13]=c.helpMatrix.rawData[7],this.rawData[14]=c.helpMatrix.rawData[11]},c.getAxisRotation=function(t,e,i,a){var r,n,o=new c,s=a*(Math.PI/180),h=Math.cos(s),l=Math.sin(s),u=1-h;return o.rawData[0]=h+t*t*u,o.rawData[5]=h+e*e*u,o.rawData[10]=h+i*i*u,r=t*e*u,n=i*l,o.rawData[1]=r+n,o.rawData[4]=r-n,r=t*i*u,n=e*l,o.rawData[8]=r+n,o.rawData[2]=r-n,r=e*i*u,n=t*l,o.rawData[9]=r-n,o.rawData[6]=r+n,o},Object.defineProperty(c.prototype,"determinant",{get:function(){return(this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15]-this.rawData[14]*this.rawData[11])-(this.rawData[0]*this.rawData[9]-this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15]-this.rawData[14]*this.rawData[7])+(this.rawData[0]*this.rawData[13]-this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11]-this.rawData[10]*this.rawData[7])+(this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15]-this.rawData[14]*this.rawData[3])-(this.rawData[4]*this.rawData[13]-this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11]-this.rawData[10]*this.rawData[3])+(this.rawData[8]*this.rawData[13]-this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7]-this.rawData[6]*this.rawData[3])},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"position",{get:function(){return new u.Vector3D(this.rawData[12],this.rawData[13],this.rawData[14])},set:function(t){this.rawData[12]=t.x,this.rawData[13]=t.y,this.rawData[14]=t.z},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{get:function(){return new u.Vector3D(this.rawData[0],this.rawData[5],this.rawData[10])},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return"matrix3d("+Math.round(1e3*this.rawData[0])/1e3+","+Math.round(1e3*this.rawData[1])/1e3+","+Math.round(1e3*this.rawData[2])/1e3+","+Math.round(1e3*this.rawData[3])/1e3+","+Math.round(1e3*this.rawData[4])/1e3+","+Math.round(1e3*this.rawData[5])/1e3+","+Math.round(1e3*this.rawData[6])/1e3+","+Math.round(1e3*this.rawData[7])/1e3+","+Math.round(1e3*this.rawData[8])/1e3+","+Math.round(1e3*this.rawData[9])/1e3+","+Math.round(1e3*this.rawData[10])/1e3+","+Math.round(1e3*this.rawData[11])/1e3+","+Math.round(1e3*this.rawData[12])/1e3+","+Math.round(1e3*this.rawData[13])/1e3+","+Math.round(1e3*this.rawData[14])/1e3+","+Math.round(1e3*this.rawData[15])/1e3+")"},c.prototype.lerp=function(t,e,i){this.copyFrom(e).sub(t).mult(i).add(t)},c.helpMatrix=new c,c}();u.Matrix4_4=t}(egret3d||(egret3d={})),function(i){var t=function(){function t(){this.eyeSpace=1,this.eyePosition=new i.Vector3D,this.eyeRotation=new i.Vector3D(0,1,0),this.eyeFocalLength=180,this.leftPos=new i.Vector3D,this.rightPos=new i.Vector3D,this.targetPos=new i.Vector3D(0,0,this.eyeFocalLength),this.lookAtPos=new i.Vector3D,this.quaternion=new i.Quaternion,this.dir=new i.Vector3D,this.leftEyeMatrix=new i.Matrix4_4,this.rightEyeMatrix=new i.Matrix4_4}return t.prototype.update=function(t){t.globalOrientation.transformVector(i.Vector3D.X_AXIS,this.dir),this.dir.normalize(),this.leftEyeMatrix.copyFrom(t.modelMatrix),this.rightEyeMatrix.copyFrom(t.modelMatrix);var e=.5*this.eyeSpace;this.leftEyeMatrix.appendTranslation(-this.dir.x*e,-this.dir.y*e,-this.dir.z*e),this.rightEyeMatrix.appendTranslation(this.dir.x*e,this.dir.y*e,this.dir.z*e)},t}();i.EyesMatrix=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){}return t.BACK=0,t.FRONT=1,t.IN=0,t.OUT=1,t.INTERSECT=2,t}();t.PlaneClassification=e}(egret3d||(egret3d={})),function(g){var t=function(){function m(){}return m.quaternion2matrix=function(t,e){void 0===e&&(e=null);var i=t.x,a=t.y,r=t.z,n=t.w,o=i*i,s=i*a,h=i*r,l=i*n,u=a*a,c=a*r,d=a*n,p=r*r,_=r*n,f=m.RAW_DATA_CONTAINER;return f[0]=1-2*(u+p),f[1]=2*(s+_),f[2]=2*(h-d),f[4]=2*(s-_),f[5]=1-2*(o+p),f[6]=2*(c+l),f[8]=2*(h+d),f[9]=2*(c-l),f[10]=1-2*(o+u),f[3]=f[7]=f[11]=f[12]=f[13]=f[14]=0,f[15]=1,e?(e.copyRawDataFrom(f),e):new g.Matrix4_4(new Float32Array(f))},m.getForward=function(t,e){return void 0===e&&(e=null),null===e&&(e=new g.Vector3D(0,0,0)),t.copyRowTo(2,e),e.normalize(),e},m.getUp=function(t,e){return void 0===e&&(e=null),null===e&&(e=new g.Vector3D(0,0,0)),t.copyRowTo(1,e),e.normalize(),e},m.getRight=function(t,e){return void 0===e&&(e=null),null===e&&(e=new g.Vector3D(0,0,0)),t.copyRowTo(0,e),e.normalize(),e},m.compare=function(t,e){var i=m.RAW_DATA_CONTAINER,a=e.rawData;t.copyRawDataTo(i);for(var r=0;r<16;++r)if(i[r]!=a[r])return!1;return!0},m.reflection=function(t,e){void 0===e&&(e=null),null===e&&(e=new g.Matrix4_4);var i=t.a,a=t.b,r=t.c,n=t.d,o=m.RAW_DATA_CONTAINER,s=-2*i*a,h=-2*i*r,l=-2*a*r;return o[0]=1-2*i*i,o[4]=s,o[8]=h,o[12]=-2*i*n,o[1]=s,o[5]=1-2*a*a,o[9]=l,o[13]=-2*a*n,o[2]=h,o[6]=l,o[10]=1-2*r*r,o[14]=-2*r*n,o[3]=0,o[7]=0,o[11]=0,o[15]=1,e.copyRawDataFrom(o),e},m.getTranslation=function(t,e){return void 0===e&&(e=null),e||(e=new g.Vector3D),t.copyRowTo(3,e),e},m.clampf=function(t,e,i){if(i<e){var a=e;e=i,i=a}return t<e?e:t<i?t:i},m.ScreenToPosition=function(t,e,i){return(t+.5*e)/i*2-1},m.PositionToScreen=function(t,e,i){return.5*(t+1)*i-.5*e},m.RADIANS_TO_DEGREES=180/Math.PI,m.DEGREES_TO_RADIANS=Math.PI/180,m.RAW_DATA_CONTAINER=new Float32Array(16),m.CALCULATION_MATRIX=new g.Matrix4_4,m.CALCULATION_QUATERNION=new g.Quaternion,m.CALCULATION_VECTOR3D=new g.Vector3D,m}();g.MathUtil=t}(egret3d||(egret3d={})),function(P){var t=function(){function t(t,e){void 0===t&&(t=new P.Vector3D),void 0===e&&(e=new P.Vector3D),this.origin=new P.Vector3D,this.dir=new P.Vector3D,this.invViewMat=new P.Matrix4_4,this.origin.copyFrom(t),this.dir.copyFrom(e)}return t.prototype.IntersectTriangle=function(t,e,i,a){void 0===a&&(a=null);var r,n=e.subtract(t),o=i.subtract(t),s=this.dir.crossProduct(o),h=n.dotProduct(s);if(0<h?r=this.origin.subtract(t):(r=t.subtract(this.origin),h=-h),h<1e-4)return!1;var l=r.dotProduct(s);if(null!=a&&(a[1]=l),l<0||h<l)return!1;var u=r.crossProduct(n),c=this.dir.dotProduct(u);if(null!=a&&(a[2]=c),c<0||h<l+c)return!1;var d=o.dotProduct(u),p=1/h;return d*=p,l*=p,c*=p,null!=a&&(a[0]=d,a[1]=l,a[2]=c),!(d<0)},t.prototype.IntersectMeshEx=function(t,e,i){return this.IntersectMesh(t.geometry.verticesData,t.geometry.indexData,t.geometry.vertexAttLength,t.geometry.indexData.length/3,e,t.modelMatrix,i)},t.prototype.IntersectMesh=function(t,e,i,a,r,n,o){var s=new Array;s.push(new P.Vector3D),s.push(new P.Vector3D),s.push(new P.Vector3D);var h=new Array;h.push(new P.Vector3D),h.push(new P.Vector3D),h.push(new P.Vector3D);var l=new Array,u=new P.Vector3D,c=new P.Vector3D,d=new P.Vector3D;l.push(u),l.push(c),l.push(d);var p=new P.Vector3D,_=new P.Point,f=new Array;f.push(0),f.push(0),f.push(0);for(var m=-1,g=Number.MAX_VALUE,v=0,y=0,x=0;x<a;++x){for(var D=0;D<3;++D){var b=e[3*x+D];p.setTo(t[i*b+0],t[i*b+1],t[i*b+2]),p.copyFrom(n.transformVector(p)),l[D].x=p.x,l[D].y=p.y,l[D].z=p.z}this.IntersectTriangle(u,c,d,f)&&f[0]<g&&(m=x,g=f[0],v=f[1],y=f[2])}if(m<a&&0<=m){for(x=0;x<3;++x){b=e[3*m+x];p.setTo(t[i*b+0],t[i*b+1],t[i*b+2]),s[x].copyFrom(p),0<r&&(_.x=t[i*b+0+r],_.y=t[i*b+1+r],h[x].x=_.x,h[x].y=_.y),p.copyFrom(n.transformVector(p)),l[x].x=p.x,l[x].y=p.y,l[x].z=p.z}var w=c.subtract(u);w.scaleBy(v);var T=d.subtract(u);return T.scaleBy(y),o.globalPosition.copyFrom(u.add(w.add(T))),(w=s[1].subtract(s[0])).scaleBy(v),(T=s[2].subtract(s[0])).scaleBy(y),o.localPosition.copyFrom(s[0].add(w.add(T))),0<r&&((w=h[1].subtract(h[0])).scaleBy(v),(T=h[2].subtract(h[0])).scaleBy(y),o.uv.copyFrom(h[0].add(w.add(T)))),!0}return!1},t.prototype.CalculateAndTransformRay=function(t,e,i,a,r,n){this.reset(),this.dir.x=(2*r/t-1)/a.rawData[0],this.dir.y=(-2*n/e+1)/a.rawData[5],this.dir.z=1,this.invViewMat.copyFrom(i),this.origin.copyFrom(this.invViewMat.transformVector(this.origin)),this.dir.copyFrom(this.invViewMat.deltaTransformVector(this.dir)),this.dir.normalize()},t.prototype.reset=function(){this.origin.setTo(0,0,0),this.dir.setTo(0,0,0)},t}();P.Ray=t}(egret3d||(egret3d={})),function(e){var t=function(){function i(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=255),this.a=255,this.r=255,this.g=255,this.b=255,this.a=a,this.r=t,this.g=e,this.b=i}return i.white=function(){return new i(255,255,255,255)},i.black=function(){return new i(0,0,0,255)},i.red=function(){return new i(255,0,0,255)},i.green=function(){return new i(0,255,0,255)},i.blue=function(){return new i(0,0,255,255)},i.prototype.getColor=function(t){return void 0===t&&(t=e.ContextConfig.ColorFormat_RGBA8888),t==e.ContextConfig.ColorFormat_RGB565?0:t==e.ContextConfig.ColorFormat_RGBA5551?0:t==e.ContextConfig.ColorFormat_RGBA4444?0:this.r<<24|this.g<<16|this.b<<8|this.a},i.prototype.lerp=function(t,e,i){this.a=i*(e.a-t.a)+t.a,this.r=i*(e.r-t.r)+t.r,this.g=i*(e.g-t.g)+t.g,this.b=i*(e.b-t.b)+t.b,this.a=Math.floor(this.a),this.r=Math.floor(this.r),this.g=Math.floor(this.g),this.b=Math.floor(this.b)},i.prototype.copyFrom=function(t){this.a=t.a,this.r=t.r,this.g=t.g,this.b=t.b},i.prototype.setTo=function(t,e,i,a){void 0===t&&(t=255),void 0===e&&(e=255),void 0===i&&(i=255),void 0===a&&(a=255),this.a=t,this.r=e,this.g=i,this.b=a},i.createColor=function(t){var e=new i;return e.setColorARGB(t),e},i.prototype.setColorARGB=function(t){this.a=t/16777216,this.a>>=0,this.r=16711680&t,this.r>>=16,this.g=65280&t,this.g>>=8,this.b=255&t},i.prototype.randomColor=function(t,e,i){if(void 0===i&&(i=!1),i){var a=Math.random();this.a=t.a+(e.a-t.a)*a,this.r=t.r+(e.r-t.r)*a,this.g=t.g+(e.g-t.g)*a,this.b=t.b+(e.b-t.b)*a}else this.a=t.a+(e.a-t.a)*Math.random(),this.r=t.r+(e.r-t.r)*Math.random(),this.g=t.g+(e.g-t.g)*Math.random(),this.b=t.b+(e.b-t.b)*Math.random();this.a=Math.floor(this.a),this.r=Math.floor(this.r),this.g=Math.floor(this.g),this.b=Math.floor(this.b)},i}();e.Color=t}(egret3d||(egret3d={})),function(r){var t=function(){function t(){this.colors=[],this.times=[]}return t.prototype.lerpColor=function(t,e){void 0===e&&(e=null),t<0?t=0:1<t&&(t=1),null==e&&(e=new r.Color);for(var i=0,a=this.times.length-1;i<a;i++)if(t>=this.times[i]&&t<this.times[i+1]){t=(t-this.times[i])/(this.times[i+1]-this.times[i]),e.lerp(this.colors[i],this.colors[i+1],t);break}return e},t}();r.ColorGradients=t}(egret3d||(egret3d={})),function(i){var t=function(){function e(t){this.vexData=new Array,this.indexData=new Array,this.vexLength=3,this.matrix=new i.Matrix4_4,this.temp=new i.Vector3D,this.owner=t}return Object.defineProperty(e.prototype,"transform",{get:function(){return this.owner?this.owner.modelMatrix:this.matrix},enumerable:!0,configurable:!0}),e.prototype.pointIntersect=function(t){return!1},e.prototype.intersect=function(t,e){return void 0===e&&(e=null),!0},e.prototype.clone=function(){var t=new e(this.owner);return t.copyVertex(this),t},e.prototype.calculateTransform=function(){for(var t=0;t<this.vexData.length;t+=3)this.temp.setTo(this.vexData[t],this.vexData[t+1],this.vexData[t+2]),this.transform.transformVector(this.temp,this.temp),this.vexData[t+0]=this.temp.x,this.vexData[t+1]=this.temp.y,this.vexData[t+2]=this.temp.z},e.prototype.copyVertex=function(t){for(var e=0;e<t.vexData.length;++e)this.vexData[e]=t.vexData[e];for(e=0;e<t.indexData.length;++e)this.indexData[e]=t.indexData[e];this.vexLength=t.vexLength},e.prototype.createChild=function(){this.childBound=new e(this.owner)},e.prototype.inBound=function(t){return!0},e.prototype.updateAABB=function(){},e}();i.Bound=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(t){void 0===t&&(t=!1),this.data=[],this.list=new Array,t&&(this.list=new Array)}return t.prototype.isHas=function(t){return!!this.data[t]},t.prototype.getValue=function(t){return this.data[t]},t.prototype.getList=function(){return this.list},t.prototype.add=function(t,e){this.data[t]=e,this.list&&this.list.push(e)},t.prototype.remove=function(t){if(this.list){var e=this.list.indexOf(this.data[t]);-1!=e&&this.list.splice(e)}delete this.data[t]},t.prototype.dispose=function(){delete this.data,delete this.list},t}();t.HashMap=e}(egret3d||(egret3d={})),function(r){var t=function(a){function i(t,e,i){void 0===t&&(t=null),void 0===e&&(e=new r.Vector3D),void 0===i&&(i=new r.Vector3D),a.call(this,t),this.min=new r.Vector3D,this.max=new r.Vector3D,this.width=0,this.heigth=0,this.depth=0,this.volume=0,this.center=new r.Vector3D,this.radius=0,this.min.copyFrom(e),this.max.copyFrom(i),this.calculateBox()}return __extends(i,a),i.prototype.copyFrom=function(t){this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.calculateBox()},i.prototype.fillBox=function(t,e){this.min.copyFrom(t),this.max.copyFrom(e),this.calculateBox()},i.prototype.pointIntersect=function(t){return t.x<=this.max.x&&t.x>=this.min.x&&t.y<=this.max.y&&t.y>=this.min.y&&t.z<=this.max.z&&t.z>=this.min.z},i.prototype.intersectAABBs=function(t,e){return void 0===e&&(e=null),!(this.min.x>t.max.x)&&(!(this.max.x<t.min.x)&&(!(this.min.y>t.max.y)&&(!(this.max.y<t.min.y)&&(!(this.min.z>t.max.z)&&(!(this.max.z<t.min.z)&&(null!=e&&(e.min.x=Math.max(this.min.x,t.min.x),e.max.x=Math.min(this.max.x,t.max.x),e.min.y=Math.max(this.min.y,t.min.y),e.max.y=Math.min(this.max.y,t.max.y),e.min.z=Math.max(this.min.z,t.min.z),e.max.z=Math.min(this.max.z,t.max.z),e.calculateBox()),!0))))))},i.prototype.intersect=function(t,e){return void 0===e&&(e=null),this._box0?(this._box0.copyVertex(this),this._box0.owner=this.owner):this._box0=this.clone(),this._box0.calculateTransform(),this._box0.updateAABB(),this._box1?(this._box1.copyVertex(this),this._box1.owner=t.owner):this._box1=t.clone(),this._box1.calculateTransform(),this._box1.updateAABB(),this._box0.intersectAABBs(this._box1,e)},i.prototype.toString=function(){return"BoundBox [min:("+this.min.x+", "+this.min.y+", "+this.min.z+") max:("+this.max.x+", "+this.max.y+", "+this.max.z+")]"},i.prototype.calculateBox=function(){this.vexData.length=0,this.indexData.length=0;var t=this.max.subtract(this.min);this.vexData.push(this.min.x),this.vexData.push(this.min.y),this.vexData.push(this.min.z),this.vexData.push(this.min.x),this.vexData.push(this.min.y),this.vexData.push(this.min.z+t.z),this.vexData.push(this.min.x+t.x),this.vexData.push(this.min.y),this.vexData.push(this.min.z+t.z),this.vexData.push(this.min.x+t.x),this.vexData.push(this.min.y),this.vexData.push(this.min.z),this.vexData.push(this.max.x-t.x),this.vexData.push(this.max.y),this.vexData.push(this.max.z-t.z),this.vexData.push(this.max.x-t.x),this.vexData.push(this.max.y),this.vexData.push(this.max.z),this.vexData.push(this.max.x),this.vexData.push(this.max.y),this.vexData.push(this.max.z),this.vexData.push(this.max.x),this.vexData.push(this.max.y),this.vexData.push(this.max.z-t.z),this.indexData.push(0,4,7,0,7,3,2,6,5,2,5,1,4,5,6,4,6,7,0,3,2,0,2,1,0,1,5,0,5,4,3,7,6,3,6,2),this.width=this.max.x-this.min.x,this.heigth=this.max.y-this.min.y,this.depth=this.max.z-this.min.z,this.volume=this.width*this.heigth*this.depth;var e=this.max.subtract(this.min);e.scaleBy(.5),this.radius=e.length,this.center.copyFrom(this.min);var i=this.center.add(e);this.center.copyFrom(i)},i.prototype.inBound=function(t){return t.inBox(this)},i.prototype.updateAABB=function(){this.min.copyFrom(new r.Vector3D(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this.max.copyFrom(new r.Vector3D(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE));for(var t=0;t<this.vexData.length;t+=this.vexLength)this.max.x<this.vexData[t]&&(this.max.x=this.vexData[t]),this.max.y<this.vexData[t+1]&&(this.max.y=this.vexData[t+1]),this.max.z<this.vexData[t+2]&&(this.max.z=this.vexData[t+2]),this.min.x>this.vexData[t]&&(this.min.x=this.vexData[t]),this.min.y>this.vexData[t+1]&&(this.min.y=this.vexData[t+1]),this.min.z>this.vexData[t+2]&&(this.min.z=this.vexData[t+2])},i.prototype.createChild=function(){this.childBound=new i(this.owner);var t=new r.Vector3D,e=new r.Vector3D;t.x=this.center.x+this.width/4,t.y=this.center.y+this.heigth/4,t.z=this.center.z+this.depth/4,e.x=this.center.x-this.width/4,e.y=this.center.y-this.heigth/4,e.z=this.center.z-this.depth/4,this.childBound.fillBox(e,t)},i.prototype.clone=function(){var t=new i(this.owner);return t.copyVertex(this),t.width=this.width,t.heigth=this.heigth,t.depth=this.depth,t.min.copyFrom(this.min),t.max.copyFrom(this.max),t.volume=this.volume,t.center.copyFrom(this.center),t.radius=this.radius,t},i}(r.Bound);r.BoundBox=t}(egret3d||(egret3d={})),function(i){var t=function(){function t(){}return t.prototype.calcBezierY=function(t,e,i){for(var a,r,n,o,s=0;s<3;s++)if(i>=t[s].x&&i<=t[s+1].x){a=t[s],r=e[s],n=t[s+1],o=e[s+1];break}return i=(i-a.x)/(n.x-a.x),this.cubic_bezier(a.y,r.y,o.y,n.y,i)},t.prototype.calcBezierX=function(t,e,i){for(var a,r,n,o,s=0;s<3;s++)if(i>=t[s].x&&i<=t[s+1].x){a=t[s],r=e[s],n=t[s+1],o=e[s+1];break}return i=(i-a.x)/(n.x-a.x),this.cubic_bezier(a.x,r.x,o.x,n.x,i)},t.prototype.cubic_bezier=function(t,e,i,a,r){return t=this.mix(t,e,r),e=this.mix(e,i,r),i=this.mix(i,a,r),t=this.mix(t,e,r),e=this.mix(e,i,r),this.mix(t,e,r)},t.prototype.cubic_bezier2=function(t,e,i,a,r){var n=1-r,o=n*n,s=r*r;return t*(o*n)+3*e*r*o+3*i*s*n+a*(s*r)},t.prototype.mix=function(t,e,i){return t*(1-i)+e*i},t}();i.BezierCurve=t;var e=function(){function f(){this.posPoints=[],this.ctrlPoints=[]}return f.prototype.calc=function(t){return f.calc.calcBezierY(this.posPoints,this.ctrlPoints,t)},f.prototype.merge=function(){for(var t=new Float32Array(4*f.SegCount*2),e=0,i=2*f.SegCount;e<i;e++)t[4*e+0]=this.posPoints[e].x,t[4*e+1]=this.posPoints[e].y,t[4*e+2]=this.ctrlPoints[e].x,t[4*e+3]=this.ctrlPoints[e].y;return t},f.prototype.scaleBy=function(t){if(0!=this.posPoints.length){if(this.posPoints)for(var e=0,i=this.posPoints.length;e<i;e++)this.posPoints[e].y*=t;if(this.ctrlPoints)for(e=0,i=this.ctrlPoints.length;e<i;e++)this.ctrlPoints[e].y*=t}},f.prototype.trySampler=function(){for(var t=0,e=this.posPoints.length;t<e;t++)if(0!=this.posPoints[t].y||0!=this.ctrlPoints[t].y)return this.doSampler();return null},f.prototype.sampler=function(){return this.doSampler()},f.prototype.pushSameValue=function(t){for(var e=new Float32Array(10*f.SegCount+2+1),i=0,a=f.SegCount*f.SegCount+2;i<a;i++)e[i]=t;return e[a+2]=1,e},f.prototype.doSampler=function(){var t,e,i=[],a=[],r=0;for(e=0,s=f.SegCount;e<s;e++){i.push(this.posPoints[2*e].y),r=this.posPoints[2*e].x,t=(this.posPoints[2*e+1].x-r)/9,a.push(t);for(var n=1;n<9;n++)i.push(this.calc(r+t*n));i.push(this.posPoints[2*e+1].y)}var o=new Float32Array(i.length+a.length);for(e=0,s=i.length;e<s;e++)o[e]=i[e];n=0;for(var s=a.length;n<s;e++,n++)o[e]=a[n];return o},f.prototype.validate=function(){null==this.posPoints&&(this.posPoints=[]),null==this.ctrlPoints&&(this.ctrlPoints=[]);var t=0,e=0;for(t=this.posPoints.length/2,e=f.SegCount;t<e;t++)this.posPoints.push(new i.Point(0,0)),this.posPoints.push(new i.Point(1,0));for(t=this.ctrlPoints.length/2,e=f.SegCount;t<e;t++)this.ctrlPoints.push(new i.Point(0,0)),this.ctrlPoints.push(new i.Point(1,0))},f.compressFloats=function(t,e){t.length%2==1&&t.push(0);var i=0;i+=5*f.SegCount,i+=2,i+=1,i+=f.SegCount;var a,r=new Float32Array(i),n=[];n.length=t.length;var o,s=-Number.MAX_VALUE,h=Number.MAX_VALUE;for(a=0,_=t.length;a<_;a++)o=n[a]=t[a],s=Math.max(o,s),h=Math.min(o,h);var l=s-h;if(0<l){var u,c,d=0;for(a=0,_=n.length;a<_;a++)d=n[a],d-=h,d/=l,d*=4095,n[a]=Math.floor(d);for(a=0,_=n.length/2;a<_;a++)u=n[2*a],c=n[2*a+1],r[a]=u+c/4096;r[a]=h,r[++a]=l,r[++a]=0,a++}else{for(a=0,_=n.length/2;a<_;a++)r[a]=h;r[a]=h,r[++a]=l,r[++a]=1,a++}for(var p=0,_=f.SegCount;p<_;a++,p++)r[a]=e[p];return r},f.SegCount=2,f.calc=new t,f}();i.BezierData=e}(egret3d||(egret3d={})),function(e){var t=function(){function t(){this.m44=new e.Matrix4_4,this.vec4=new Float32Array(4)}return t.prototype.reset=function(){this.m44.identity(),this.vec4.fill(0)},t}();e.ColorTransform=t}(egret3d||(egret3d={})),function(t){var e=function(){this.localPosition=new t.Vector3D,this.globalPosition=new t.Vector3D,this.uv=new t.Vector3D};t.PickResult=e}(egret3d||(egret3d={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.time=0,this.delay=0,this.eventType=t,this.data=e}return t.ENTER_FRAME="enter_frame",t.RESIZE="resize",t}();t.Event3D=e}(egret3d||(egret3d={})),function(t){var e=function(i){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),i.call(this,t,e)}return __extends(t,i),t.EVENT_PLAY_COMPLETE="event_play_complete",t}(t.Event3D);t.PropertyAnimEvent3D=e}(egret3d||(egret3d={})),function(t){var e=function(i){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),i.call(this,t,e)}return __extends(t,i),t.EVENT_PLAY_COMPLETE="event_play_complete",t.EVENT_FRAME_CHANGE="event_frame_change",t}(t.Event3D);t.SkeletonAnimationEvent3D=e}(egret3d||(egret3d={})),function(t){var e;(e=t.MouseCode||(t.MouseCode={}))[e.Mouse_Left=0]="Mouse_Left",e[e.Mouse_Mid=1]="Mouse_Mid",e[e.Mouse_Right=2]="Mouse_Right";var i=(t.MouseCode,function(t){function e(){t.apply(this,arguments),this.mouseCode=0}return __extends(e,t),e.MOUSE_CLICK="onMouseClick",e.MOUSE_DOWN="onMouseDown",e.MOUSE_UP="onMouseUp",e.MOUSE_MOVE="onMouseMove",e.MOUSE_OVER="onMouseOver",e.MOUSE_WHEEL="onMouseWheel",e}(t.Event3D));t.MouseEvent3D=i}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.TOUCH_MOVE="onTouchMove",e.TOUCH_START="onTouchStart",e.TOUCH_END="onTouchEnd",e}(t.Event3D);t.TouchEvent3D=e}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.PICK_CLICK="onPickClick",e.PICK_DOWN="onPickDown",e.PICK_UP="onPickUp",e.PICK_MOVE="onPickMove",e.PICK_WHEEL="onPickWheel",e}(t.Event3D);t.PickEvent3D=e}(egret3d||(egret3d={})),function(t){var e;(e=t.KeyCode||(t.KeyCode={}))[e.Key_BackSpace=8]="Key_BackSpace",e[e.Key_Tab=9]="Key_Tab",e[e.Key_Clear=12]="Key_Clear",e[e.Key_Enter=13]="Key_Enter",e[e.Key_Shift_L=16]="Key_Shift_L",e[e.Key_Control_L=17]="Key_Control_L",e[e.Key_Alt_L=18]="Key_Alt_L",e[e.Key_Pause=19]="Key_Pause",e[e.Key_CapsLock=20]="Key_CapsLock",e[e.Key_Escape=21]="Key_Escape",e[e.Key_Space=32]="Key_Space",e[e.Key_Prior=33]="Key_Prior",e[e.Key_Next=34]="Key_Next",e[e.Key_End=35]="Key_End",e[e.Key_Home=36]="Key_Home",e[e.Key_Left=37]="Key_Left",e[e.Key_Up=38]="Key_Up",e[e.Key_Right=39]="Key_Right",e[e.Key_Down=40]="Key_Down",e[e.Key_Select=41]="Key_Select",e[e.Key_Print=42]="Key_Print",e[e.Key_Execute=43]="Key_Execute",e[e.Key_Insert=45]="Key_Insert",e[e.Key_Delete=46]="Key_Delete",e[e.Key_Help=47]="Key_Help",e[e.Key_0=48]="Key_0",e[e.Key_1=49]="Key_1",e[e.Key_2=50]="Key_2",e[e.Key_3=51]="Key_3",e[e.Key_4=52]="Key_4",e[e.Key_5=53]="Key_5",e[e.Key_6=54]="Key_6",e[e.Key_7=55]="Key_7",e[e.Key_8=56]="Key_8",e[e.Key_9=57]="Key_9",e[e.Key_A=65]="Key_A",e[e.Key_B=66]="Key_B",e[e.Key_C=67]="Key_C",e[e.Key_D=68]="Key_D",e[e.Key_E=69]="Key_E",e[e.Key_F=70]="Key_F",e[e.Key_G=71]="Key_G",e[e.Key_H=72]="Key_H",e[e.Key_I=73]="Key_I",e[e.Key_J=74]="Key_J",e[e.Key_K=75]="Key_K",e[e.Key_L=76]="Key_L",e[e.Key_M=77]="Key_M",e[e.Key_N=78]="Key_N",e[e.Key_O=79]="Key_O",e[e.Key_P=80]="Key_P",e[e.Key_Q=81]="Key_Q",e[e.Key_R=82]="Key_R",e[e.Key_S=83]="Key_S",e[e.Key_T=84]="Key_T",e[e.Key_U=85]="Key_U",e[e.Key_V=86]="Key_V",e[e.Key_W=87]="Key_W",e[e.Key_X=88]="Key_X",e[e.Key_Y=89]="Key_Y",e[e.Key_Z=90]="Key_Z",e[e.Key_KP_0=96]="Key_KP_0",e[e.Key_KP_1=97]="Key_KP_1",e[e.Key_KP_2=98]="Key_KP_2",e[e.Key_KP_3=99]="Key_KP_3",e[e.Key_KP_4=100]="Key_KP_4",e[e.Key_KP_5=101]="Key_KP_5",e[e.Key_KP_6=102]="Key_KP_6",e[e.Key_KP_7=103]="Key_KP_7",e[e.Key_KP_8=104]="Key_KP_8",e[e.Key_KP_9=105]="Key_KP_9",e[e.Key_Multiply=106]="Key_Multiply",e[e.Key_Add=107]="Key_Add",e[e.Key_Separator=108]="Key_Separator",e[e.Key_Subtract=109]="Key_Subtract",e[e.Key_Decimal=110]="Key_Decimal",e[e.Key_Divide=111]="Key_Divide",e[e.Key_F1=112]="Key_F1",e[e.Key_F2=113]="Key_F2",e[e.Key_F3=114]="Key_F3",e[e.Key_F4=115]="Key_F4",e[e.Key_F5=116]="Key_F5",e[e.Key_F6=117]="Key_F6",e[e.Key_F7=118]="Key_F7",e[e.Key_F8=119]="Key_F8",e[e.Key_F9=120]="Key_F9",e[e.Key_F10=121]="Key_F10",e[e.Key_F11=122]="Key_F11",e[e.Key_F12=123]="Key_F12",e[e.Key_F13=124]="Key_F13",e[e.Key_F14=125]="Key_F14",e[e.Key_F15=126]="Key_F15",e[e.Key_F16=127]="Key_F16",e[e.Key_F17=128]="Key_F17",e[e.Key_F18=129]="Key_F18",e[e.Key_F19=130]="Key_F19",e[e.Key_F20=131]="Key_F20",e[e.Key_F21=132]="Key_F21",e[e.Key_F22=133]="Key_F22",e[e.Key_F23=134]="Key_F23",e[e.Key_F24=135]="Key_F24",e[e.Key_Num_Lock=136]="Key_Num_Lock",e[e.Key_Scroll_Lock=137]="Key_Scroll_Lock";var i=(t.KeyCode,function(t){function e(){t.apply(this,arguments),this.keyCode=0}return __extends(e,t),e.KEY_CLICK="onKeyClick",e.KEY_DOWN="onKeyDown",e.KEY_UP="onKeyUp",e}(t.Event3D));t.KeyEvent3D=i}(egret3d||(egret3d={})),function(t){var e;(e=t.Orientation||(t.Orientation={}))[e.Portrait_Primary=0]="Portrait_Primary",e[e.Portrait_Secondary=180]="Portrait_Secondary",e[e.Landscape_Primary=-90]="Landscape_Primary",e[e.Landscape_Secondary=90]="Landscape_Secondary";var i=(t.Orientation,function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"orientation",{get:function(){return window.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accelerationIncludingGravity",{get:function(){return this._accelerationIncludingGravity},set:function(t){this._accelerationIncludingGravity=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationRate",{get:function(){return this._rotationRate},set:function(t){this._rotationRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"absolute",{get:function(){return this._absolute},set:function(t){this._absolute=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"beta",{get:function(){return this._beta},set:function(t){this._beta=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gamma",{get:function(){return this._gamma},set:function(t){this._gamma=t},enumerable:!0,configurable:!0}),e.ORIENTATION_CHANGE="onOrientationChange",e.DEVICE_MOTION="onDeviceMotion",e.DEVICE_ORIENTATION="onDeviceOrientation",e}(t.Event3D));t.OrientationEvent3D=i}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.LOADER_COMPLETE="onLoadComplete",e.LOADER_PROGRESS="onLoadProgress",e.LOADER_ERROR="onLoadError",e}(t.Event3D);t.LoaderEvent3D=e}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.PARSER_COMPLETE="onParserComplete",e}(t.Event3D);t.ParserEvent3D=e}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.EMIT_PARTICLE_BIRTH="EMIT_PARTICLE_BIRTH",e.EMIT_PARTICLE_DEATH="EMIT_PARTICLE_DEATH",e}(t.Event3D);t.ParticleEvent3D=e}(egret3d||(egret3d={})),function(t){var e=function(){function t(){this.listeners={}}return t.prototype.dispatchEvent=function(t){var e=this.listeners[t.eventType];if(null!=e){e=e.slice();for(var i=0;i<e.length;i++){var a=e[i];try{a.handler.call(a.thisObject,t)}catch(t){window.console&&console.error(t.stack)}}}},t.prototype.addEventListener=function(t,e,i,a){void 0===a&&(a=0),null==this.listeners[t]&&(this.listeners[t]=[]);var r=new n(t,i,e,a);return r.id=++n.event_id_count,this.listeners[t].push(r),this.listeners[t].sort(function(t,e){return e.priolity-t.priolity}),r.id},t.prototype.removeEventListener=function(t,e,i){if(this.hasEventListener(t,i,e))for(var a=0;a<this.listeners[t].length;a++){var r=this.listeners[t][a];if(r.equalCurrentListener(t,i,e))return r.handler=null,r.thisObject=null,void this.listeners[t].splice(a,1)}},t.prototype.removeEventListenerAt=function(t){for(var e in this.listeners)for(var i=0;i<this.listeners[e].length;i++){var a=this.listeners[e][i];if(a.id==t)return a.handler=null,a.thisObject=null,void this.listeners[e].splice(i,1)}},t.prototype.clearEventListener=function(){this.listeners={}},t.prototype.containEventListener=function(t){return null!=this.listeners[t]&&0<this.listeners[t].length},t.prototype.hasEventListener=function(t,e,i){if(null==this.listeners[t])return!1;for(var a=0;a<this.listeners[t].length;a++){if(this.listeners[t][a].equalCurrentListener(t,e,i))return!0}return!1},t}();t.EventDispatcher=e;var n=function(){function t(t,e,i,a){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===a&&(a=0),this.type=t,this.thisObject=e,this.handler=i,this.priolity=a}return t.prototype.equalCurrentListener=function(t,e,i){return this.type==t&&this.thisObject==e&&this.handler==i},t.event_id_count=0,t}()}(egret3d||(egret3d={})),function(f){var t=function(){function t(t){this._retRenderList=new Array,this._canvas=t,this._pickEvent3d=new f.PickEvent3D,f.Input.addEventListener(f.MouseEvent3D.MOUSE_CLICK,this.onMouseClick,this),f.Input.addEventListener(f.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),f.Input.addEventListener(f.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),f.Input.addEventListener(f.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),f.Input.addEventListener(f.TouchEvent3D.TOUCH_START,this.onTouchDown,this),f.Input.addEventListener(f.TouchEvent3D.TOUCH_END,this.onTouchUp,this),f.Input.addEventListener(f.TouchEvent3D.TOUCH_MOVE,this.onTouchMove,this)}return Object.defineProperty(t.prototype,"_view3ds",{get:function(){return this._canvas.view3Ds},enumerable:!0,configurable:!0}),t.prototype.onClear=function(){this._canvas=null},t.prototype.onClearListeners=function(){},t.prototype.sendEvent=function(t,e,i){var a=this._canvas;if(a)for(var r=0;r<this._view3ds.length;r++){var n=this._view3ds[r];if(n.entityCollect&&n.entityCollect.mousePickList){var o=n.entityCollect.mousePickList,s=f.Picker.pickObject3DList(a,n,o,!1,this._retRenderList),h=s.length;if(!(h<=0)){for(var l=null,u=Number.MAX_VALUE,c=0,d=null,p=!1,_=0;_<h;_++)d=s[_],(c=f.Vector3D.distance(d.globalPosition,n.camera3D.globalPosition))<u&&(u=c,l=s[_]),d.mouseChilder&&(p=d.mouseChilder);if(0<s.length)if(1==s.length&&l)l.dispatchEvent(i.call(this,e,t,l));else if(p)if(s=f.Picker.pickObject3DList(a,n,s,!0,this._retRenderList),u=Number.MAX_VALUE,(h=s.length)<=0)l&&l.dispatchEvent(i.call(this,e,t,l));else{l=null;for(_=0;_<h;_++)d=s[_],(c=f.Vector3D.distance(d.globalPosition,n.camera3D.globalPosition))<u&&(u=c,l=s[_]);l&&l.dispatchEvent(i.call(this,e,t,l))}else l&&l.dispatchEvent(i.call(this,e,t,l))}}}},t.prototype.initPickEvent3D=function(t,e,i){return this._pickEvent3d.eventType=t,this._pickEvent3d.target=i,this._pickEvent3d.data=e,this._pickEvent3d.pickResult=i.pickResult,this._pickEvent3d},t.prototype.onTouchMove=function(t){this.sendEvent(t,f.PickEvent3D.PICK_MOVE,this.initPickEvent3D)},t.prototype.onTouchUp=function(t){this.sendEvent(t,f.PickEvent3D.PICK_UP,this.initPickEvent3D)},t.prototype.onTouchDown=function(t){this.sendEvent(t,f.PickEvent3D.PICK_DOWN,this.initPickEvent3D)},t.prototype.onMouseClick=function(t){this.sendEvent(t,f.PickEvent3D.PICK_CLICK,this.initPickEvent3D)},t.prototype.onMouseDown=function(t){this.sendEvent(t,f.PickEvent3D.PICK_DOWN,this.initPickEvent3D)},t.prototype.onMouseUp=function(t){this.sendEvent(t,f.PickEvent3D.PICK_UP,this.initPickEvent3D)},t.prototype.onMouseMove=function(t){this.sendEvent(t,f.PickEvent3D.PICK_MOVE,this.initPickEvent3D)},t}();f.EventManager=t}(egret3d||(egret3d={})),function(e){var t=function(){function t(t){this.index=0,this.shadersName=new Array,this.endShadername="",this.stateChange=!1,this.maxBone=0,this.shaderType=-1,this.shaderType=t}return t.prototype.addUseShaderName=function(t){this.shadersName.push(t)},t.prototype.addEndShaderName=function(t){this.endShadername=t},t.prototype.getShader=function(t){""!=this.endShadername&&(-1==this.shadersName.indexOf(this.endShadername)&&this.shadersName.push(this.endShadername));return e.ShaderUtil.instance.fillShaderContent(this,this.shadersName,t)},t}();e.ShaderBase=t}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(){function e(){this.varName="",this.name="",this.key="",this.valueType="",this.value="",this.activeTextureIndex=-1,this.index=-1,this.level="",this.size=0,this.dataType=0,this.normalized=!1,this.stride=0,this.offset=0,this.offsetIndex=0,this.offsetBytes=0}return e.prototype.var=function(t){return this.level+" "+this.valueType+" "+name+"."+t},e.prototype.use=function(t){return void 0===t&&(t=""),""!=t?this.name+"."+t:this.name},e.prototype.clone=function(){var t=new e;return t.name=this.name,t.valueType=this.valueType,t.level=this.level,t.varName=this.varName,t.value=this.value,t},e.prototype.computeVarName=function(){var t=this.name.indexOf("[");this.varName=0<=t?this.name.substr(0,t):this.name},e}(),e.VarRegister=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(i){function t(t,e){i.call(this),this.name=t,this.computeVarName(),this.key="attribute",this.valueType=e}return __extends(t,i),t}(e.VarRegister),e.Attribute=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(){function t(){}return t.int="int",t.float="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t}(),e.AttributeType=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(a){function t(t,e,i){a.call(this),this.name=t,this.computeVarName(),this.key="const",this.valueType=e,this.value=i}return __extends(t,a),t}(e.VarRegister),e.ConstVar=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(e){function t(t){e.call(this),this.name=t,this.computeVarName(),this.key="sampler2D"}return __extends(t,e),t}(e.VarRegister),e.Sampler2D=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(e){function t(t){e.call(this),this.name=t,this.computeVarName(),this.key="samplerCube"}return __extends(t,e),t}(e.VarRegister),e.Sampler3D=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(i){function t(t,e){i.call(this),this.name=t,this.computeVarName(),this.key="",this.valueType=e}return __extends(t,i),t}(e.VarRegister),e.TmpVar=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(i){function t(t,e){i.call(this),this.name=t,this.computeVarName(),this.key="uniform",this.valueType=e}return __extends(t,i),t}(e.VarRegister),e.Uniform=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(){function t(){}return t.bool="bool",t.int="int",t.float="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.bvec2="bvec2",t.bvec3="bvec3",t.bvec4="bvec4",t.ivec2="ivec2",t.ivec3="ivec3",t.ivec4="ivec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t.sampler2D="sampler2D",t.sampleCube="sampleCube",t}(),e.UniformType=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(){function t(){}return t.attribute_position="attribute_position",t.attribute_normal="attribute_normal",t.attribute_tangent="attribute_tangent",t.attribute_vertexColor="attribute_vertexColor",t.attribute_uv0="attribute_uv0",t.attribute_uv1="attribute_uv1",t.varying_pos="varying_pos",t.varying_normal="varying_normal",t.varying_tangent="varying_tangent",t.varying_color="varying_color",t.varying_uv0="varying_uv0",t.varying_uv1="varying_uv1",t.varying_globalPos="varying_globalPos",t.varying_lightDir="varying_lightDir",t.varying_eye="varying_eye",t.uniform_floatv_0="uniform_floatv_0",t.uniform_floatv_1="uniform_floatv_1",t.uniform_floatv_2="uniform_floatv_2",t.uniform_iv_0="uniform_iv_0",t.uniform_iv_1="uniform_iv_1",t.uniform_iv_2="uniform_iv_2",t.uniform_bv_0="uniform_bv_0",t.uniform_bv_1="uniform_bv_1",t.uniform_bv_2="uniform_bv_2",t.uniform_vec2fv_0="uniform_vec2fv_0",t.uniform_vec2fv_1="uniform_vec2fv_1",t.uniform_vec2fv_2="uniform_vec2fv_2",t.uniform_vec3fv_0="uniform_vec3fv_0",t.uniform_vec3fv_1="uniform_vec3fv_1",t.uniform_vec3fv_2="uniform_vec3fv_2",t.uniform_vec4fv_0="uniform_vec4fv_0",t.uniform_vec4fv_1="uniform_vec4fv_1",t.uniform_vec4fv_2="uniform_vec4fv_2",t.uniform_vec2iv_0="uniform_vec2iv_0",t.uniform_vec2iv_1="uniform_vec2iv_1",t.uniform_vec2iv_2="uniform_vec2iv_2",t.uniform_vec3iv_0="uniform_vec3iv_0",t.uniform_vec3iv_1="uniform_vec3iv_1",t.uniform_vec3iv_2="uniform_vec3iv_2",t.uniform_vec4iv_0="uniform_vec4iv_0",t.uniform_vec4iv_1="uniform_vec4iv_1",t.uniform_vec4iv_2="uniform_vec4iv_2",t.uniform_vec2bv_0="uniform_vec2bv_0",t.uniform_vec2bv_1="uniform_vec2bv_1",t.uniform_vec2bv_2="uniform_vec2bv_2",t.uniform_vec3bv_0="uniform_vec3bv_0",t.uniform_vec3bv_1="uniform_vec3bv_1",t.uniform_vec3bv_2="uniform_vec3bv_2",t.uniform_vec4bv_0="uniform_vec4bv_0",t.uniform_vec4bv_1="uniform_vec4bv_1",t.uniform_vec4bv_2="uniform_vec4bv_2",t.uniform_modelMatrix="uniform_modelMatrix",t.uniform_projectionMatrix="uniform_projectionMatrix",t.uniform_normalMatrix="uniform_normalMatrix",t.uniform_eye="uniform_eye",t.uniform_lightDir="uniform_lightDir",t.texture2D_0="texture2D_0",t.texture2D_1="texture2D_1",t.texture2D_2="texture2D_2",t.texture2D_3="texture2D_3",t.texture2D_4="texture2D_4",t}(),e.VarConstName=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(i){function t(t,e){i.call(this),this.name=t,this.computeVarName(),this.key="varying",this.valueType=e}return __extends(t,i),t}(e.VarRegister),e.Varying=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(e){function t(t){e.call(this),this.name=t,this.computeVarName(),this.key="#extension"}return __extends(t,e),t}(e.VarRegister),e.Extension=i}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(){function t(){}return t.bool="bool",t.int="int",t.float="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.bvec2="bvec2",t.bvec3="bvec3",t.bvec4="bvec4",t.ivec2="ivec2",t.ivec3="ivec3",t.ivec4="ivec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t.sampler2D="sampler2D",t.sampleCube="sampleCube",t}(),e.VaryingType=i}(egret3d||(egret3d={})),function(t){var e=function(){function t(){}return t.lib={alphaMask_fs:"uniform sampler2D maskTexture ; \nvoid main(void){ \nfloat maskAlpha = texture2D( maskTexture , uv_0 ).x; \nif(maskAlpha * diffuseColor.w < 0.001){ \ndiscard; \n} \nmaterialSource.alpha *= maskAlpha; \n} \n",AOMap_fs:"uniform sampler2D aoTexture ; \nuniform float aoPower ; \nvoid main(void){ \nfloat ao = texture2D( aoTexture , varying_uv1 ).x ; \ndiffuseColor.xyz *= (ao * aoPower) ; \n} \n",baseShadowPass_fs:"varying vec2 varying_uv0; \nvarying vec4 varying_ViewPose; \nvarying vec4 varying_color; \nvec4 outColor ; \nvec2 uv_0; \nvoid main() { \nuv_0 = varying_uv0; \n} \n",baseShadowPass_vs:"attribute vec3 attribute_position; \nattribute vec2 attribute_uv0; \nattribute vec4 attribute_color; \nuniform mat4 uniform_ModelViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec4 varying_ViewPose; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nvec4 outPosition ; \nvoid main(void){ \ne_position = attribute_position; \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0; \n} \n",base_fs:"#extension GL_OES_standard_derivatives : enable \nvarying vec3 varying_eyeNormal  ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_ViewPose; \nvarying vec4 varying_color; \nvarying vec3 varying_ViewDir ; \nuniform mat4 uniform_ViewMatrix ; \nvec4 outColor ; \nvec4 diffuseColor ; \nvec4 specularColor ; \nvec4 ambientColor; \nvec4 light ; \nvec3 normal; \nvec2 uv_0; \nvec3 flatNormals(vec3 pos) { \nvec3 fdx = dFdx(pos); \nvec3 fdy = dFdy(pos); \nreturn normalize(cross(fdx, fdy)); \n} \nvoid main() { \ndiffuseColor  = vec4(1.0,1.0,1.0,1.0); \nspecularColor = vec4(0.0,0.0,0.0,0.0); \nambientColor  = vec4(0.0,0.0,0.0,0.0); \nlight         = vec4(1.0,1.0,1.0,1.0); \nnormal = normalize(varying_eyeNormal) ; \nuv_0 = varying_uv0; \n} \n",base_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nuniform mat4 uniform_ModelViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nuniform vec3 uniform_eyepos ; \nvarying vec4 varying_ViewPose; \nvarying vec3 varying_eyeNormal  ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvarying vec3 varying_ViewDir ; \nvec4 outPosition ; \nvoid main(void){ \ne_position = attribute_position; \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0; \n} \n",bezier:"vec2 quadratic_bezier(vec2 A, vec2 B, vec2 C, float t) \n{ \nvec2 D = mix(A, B, t); \nvec2 E = mix(B, C, t); \nreturn mix(D, E, t); \n} \nvec2 cubic_bezier(vec2 A, vec2 B, vec2 C, vec2 D, float t) \n{ \nvec2 E = mix(A, B, t); \nvec2 F = mix(B, C, t); \nvec2 G = mix(C, D, t); \nreturn quadratic_bezier(E, F, G, t); \n} \n",bloom_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat dx = 1.0/float(1024.0); \nfloat dy = 1.0/float(1024.0); \nvec4 outColor ; \nvec4 color = outColor = texture2D(diffuseTexture,uv.xy); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,0.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy*2.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy*2.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy*3.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy*3.0)); \ncolor /= 8.0; \nvec4 cout = vec4(0.0,0.0,0.0,0.0); \nfloat lum = color.x * 0.3 + color.y *0.59 + color.z * 0.11; \nvec4 p = color*(lum/0.1); \np /= vec4(vec4(1.0,1.0,1.0,0.0)+p); \nfloat luml = (p.x+p.y+p.z)/3.0; \nif (luml > 0.8) \n{ \ncout = color ; \n} \ngl_FragColor = cout ; \n} \n",colorGradients_fs:"varying vec4 varying_pos; \nuniform float uniform_colorGradientsSource[10] ; \nvoid main(void){ \nvec3 posStart = vec3(uniform_colorGradientsSource[0], uniform_colorGradientsSource[1], uniform_colorGradientsSource[2]); \nvec3 posEnd = vec3(uniform_colorGradientsSource[3], uniform_colorGradientsSource[4], uniform_colorGradientsSource[5]); \nvec4 color = vec4(uniform_colorGradientsSource[6], uniform_colorGradientsSource[7], uniform_colorGradientsSource[8], uniform_colorGradientsSource[9]); \ncolor.w = color.w * clamp((varying_pos.y - posStart.y) / (posEnd.y - posStart.y), 0.0, 1.0); \ndiffuseColor.xyz = clamp(diffuseColor.xyz / diffuseColor.w,0.0,1.0); \ndiffuseColor.xyz = diffuseColor.xyz * (1.0 - color.w) + color.xyz * color.w; \n} \n  \n",colorTransform_fs:"uniform vec4 uniform_colorTransformVec4 ; \nuniform mat4 uniform_colorTransformM44 ; \nvoid main(){ \ndiffuseColor = uniform_colorTransformM44 * diffuseColor; \ndiffuseColor = diffuseColor + uniform_colorTransformVec4; \n} \n",color_fragment:"vec4 diffuseColor ; \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ndiffuseColor = vec4(1.0, 1.0, 1.0, 1.0); \nif( diffuseColor.w <= materialSource.cutAlpha ){ \ndiscard; \n}else \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",combin_fs:"uniform sampler2D colorTexture; \nvoid main(void){ \n} \n",cube_fragment:"uniform samplerCube diffuseTexture ; \nvarying vec3 varying_pos; \nvec4 diffuseColor ; \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \nvec3 uvw = normalize(varying_pos.xyz); \ndiffuseColor = vec4(textureCube(diffuseTexture, uvw.xyz)); \nif( diffuseColor.w <= materialSource.cutAlpha ){ \ndiscard; \n}else \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",cube_vertex:"varying vec3 varying_pos; \nvoid main(void){ \nvarying_pos =  e_position; \n}  \n",detail_Bending_vs:"uniform float uniformTime[4] ; \nvoid main(void){ \ne_position = attribute_position; \nvarying_uv0 = attribute_uv0; \nvarying_color = attribute_color; \nvec4 curve = SmoothTriangleWave(vec4(sin(uniformTime[0]*0.001),1.0,1.0,1.0)); \ne_position.xyz += curve.x * vec3(1.0,0.5,0.0) * ( attribute_color.xyz) ; \n} \n",diffuseShadowPass_fs:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor = varying_color ; \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \nif( diffuseColor.w <= 0.3 ){ \ndiscard; \n} \n} \n",diffuse_fragment:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \nif( diffuseColor.w <= materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",diffuse_vertex:"attribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nvarying vec3 varying_ViewDir ; \nuniform mat4 uniform_NormalMatrix; \nvoid main(void){ \nmat3 normalMatrix = mat3(uniform_NormalMatrix); \nvarying_eyeNormal = normalize(normalMatrix * -attribute_normal); \nvarying_ViewPose = vec4(normalMatrix*e_position, 1.0) ; \nvarying_ViewDir = normalize(normalMatrix * (uniform_eyepos.xyz - e_position)) ; \noutPosition = uniform_ModelViewMatrix * vec4(e_position, 1.0) ; \nvarying_color = attribute_color; \n} \n",directLight_fragment:"const int max_directLight = 0 ; \nuniform float uniform_directLightSource[6*max_directLight] ; \nvarying vec3 varying_ViewDir; \nuniform mat4 uniform_NormalMatrix; \nstruct DirectLight{ \nvec3 direction; \nvec3 diffuse; \n}; \nvoid calculateDirectLight( MaterialSource materialSource ){ \nfloat lambertTerm , specular ; \nvec3 N = normal; \nfor(int i = 0 ; i < max_directLight ; i++){ \nDirectLight directLight ; \ndirectLight.direction = vec3(uniform_directLightSource[i*6+0],uniform_directLightSource[i*6+1],uniform_directLightSource[i*6+2]); \ndirectLight.diffuse = vec3(uniform_directLightSource[i*6+3],uniform_directLightSource[i*6+4],uniform_directLightSource[i*6+5]); \nvec3 lightDir = -normalize(directLight.direction); \nlight += LightingBlinnPhong(normalize(lightDir),vec3(1.0,1.0,1.0),normal,-varying_ViewDir,0.5); \n} \n} \nvoid main() { \ncalculateDirectLight( materialSource ); \n} \n",endShadowPass_fs:"void main() { \nif(varying_color.w<=0.0){ \ndiscard; \n} \noutColor.x =  outColor.y = outColor.z = varying_ViewPose.z/varying_ViewPose.w  ; \noutColor.w = 1.0 ; \ngl_FragColor = outColor ; \n} \n",endShadowPass_vs:"void main() { \noutPosition = uniform_ProjectionMatrix * outPosition ; \nvarying_ViewPose = outPosition ; \ngl_Position = outPosition ; \n} \n                       \n",end_fs:"vec4 diffuseColor ; \nvec4 specularColor ; \nvec4 ambientColor; \nvec4 light ; \nvoid main() { \noutColor.xyz = light.xyz * diffuseColor.xyz * materialSource.diffuse * varying_color.xyz; \noutColor.w = materialSource.alpha * diffuseColor.w * varying_color.w; \noutColor.xyz *= outColor.w; \ngl_FragColor = outColor; \n} \n",end_vs:"vec4 endPosition ; \nuniform float uniform_materialSource[20]; \nvoid main() { \ngl_PointSize = 50.0; \ngl_PointSize = uniform_materialSource[18]; \ngl_Position = uniform_ProjectionMatrix * outPosition ; \n} \n                       \n",environmentDiffuse_vertex:"void main(){ \n} \n",environmentMapping_fragment:"uniform samplerCube environmentMapTex ; \nuniform float reflectValue; \nvoid main(){ \nvec3 r = reflect(-normalize(varying_ViewDir),  normal  ); \nvec4 reflectiveColor = textureCube(environmentMapTex,r.xyz); \ndiffuseColor.xyz = mix( diffuseColor.xyz,reflectiveColor.xyz, specularColor.y + reflectValue ); \n} \n          \n",expFog_fs:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nvec3 distance ; \n}; \nvarying vec4 varying_pos; \nuniform float uniform_globalFog[7]; \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.distance = vec2(uniform_globalFog[4], uniform_globalFog[5]); \nfloat d = distance(uniform_eyepos,varying_pos.xyz); \nfloat distFog = max( 0.0 , d - fog.distance.x )* fog.distance.y; \nfloat fogFactor = (1.0-exp( -distFog * 0.000001 * fog.globalDensity )) ; \ndiffuseColor.xyz = mix( diffuseColor.xyz  , fog.fogColor , min(fogFactor,1.0) ); \n} \n  \n",expHeightFog_fs:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nfloat fogStartDistance ; \nfloat fogHeightStart ; \nfloat fogAlpha ; \n}; \nvarying vec4 varying_pos; \nuniform float uniform_globalFog[7]; \nvec3 applyFog( float yDistance, vec3  vpos , Fog fog ) \n{ \nfloat d = distance(uniform_eyepos,varying_pos.xyz); \nfloat distFog = max( 0.0 , d - fog.fogStartDistance ) ; \nfloat yFog = max(0.0, (vpos.y - fog.fogHeightStart - yDistance) )  ; \nfloat fogAmount =  1.0-(exp(-distFog * fog.globalDensity )) + (exp(-yFog * fog.globalDensity )); \nreturn mix( diffuseColor.xyz,fog.fogColor, clamp(fogAmount,0.0,fog.fogAlpha) ); \n} \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.fogStartDistance = uniform_globalFog[4] ; \nfog.fogHeightStart = uniform_globalFog[5] ; \nfog.fogAlpha = uniform_globalFog[6] ; \nfloat yd = uniform_eyepos.y - varying_pos.y ; \ndiffuseColor.xyz = applyFog( yd , varying_pos.xyz , fog ); \n} \n  \n",flatNormal_fs:"#extension GL_OES_standard_derivatives : enable \nvec3 flatNormal(vec3 pos){ \nvec3 fdx = dFdx(pos); \nvec3 fdy = dFdy(pos); \nreturn normalize(cross(fdx, fdy)); \n} \n",gamma_fs:"const float gamma = 2.2; \nfloat toLinear_float_v1(float v) { \nreturn pow(v, gamma); \n} \nvec2 toLinear_vec2_v1(vec2 v) { \nreturn pow(v, vec2(gamma)); \n} \nvec3 toLinear_vec3_v1(vec3 v) { \nreturn pow(v, vec3(gamma)); \n} \nvec4 toLinear_vec4_v1(vec4 v) { \nreturn vec4(toLinear_vec3_v1(v.rgb), v.a); \n} \nfloat toGamma_float_v2(float v) { \nreturn pow(v, 1.0 / gamma); \n} \nvec2 toGamma_vec2_v2(vec2 v) { \nreturn pow(v, vec2(1.0 / gamma)); \n} \nvec3 toGamma_vec3_v2(vec3 v) { \nreturn pow(v, vec3(1.0 / gamma)); \n} \nvec4 toGamma_vec4_v2(vec4 v) { \nreturn vec4(toGamma_vec3_v2(v.rgb), v.a); \n} \nvec4 textureLinear(sampler2D uTex, vec2 uv) { \nreturn toLinear_vec4_v1(texture2D(uTex, uv)); \n} \n",gaussian_H_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat d = 1.0/float(1024.0); \nvec4 color = vec4(0.0,0.0,0.0,0.0); \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-8.0*d,0.0))* 0.001; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-7.0*d,0.0))* 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-6.0*d,0.0))* 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-5.0*d,0.0))* 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-4.0*d,0.0))* 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-3.0*d,0.0))* 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-2.0*d,0.0))* 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-1.0*d,0.0))* 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy) * 1.0; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(1.0*d,0.0)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(2.0*d,0.0)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(3.0*d,0.0)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(4.0*d,0.0)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(5.0*d,0.0)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(6.0*d,0.0)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(7.0*d,0.0)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(8.0*d,0.0)) * 0.001; \ncolor /= 8.0; \ngl_FragColor = color ; \n} \n",gaussian_V_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nuniform sampler2D colorTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat d = 1.0/float(1024.0); \nvec4 color = vec4(0.0,0.0,0.0,0.0); \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-8.0*d)) * 0.001; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-7.0*d)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-6.0*d)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-5.0*d)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-4.0*d)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-3.0*d)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-2.0*d)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-1.0*d)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy) * 1.0; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 1.0*d)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 2.0*d)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 3.0*d)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 4.0*d)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 5.0*d)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 6.0*d)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 7.0*d)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 8.0*d)) * 0.001; \ncolor /= 8.0; \ngl_FragColor = color + texture2D(colorTexture,uv.xy); \n} \n",hud_cull_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nuniform vec2 uv_scale; \nvoid main(void) { \nvec2 uv_0 = varying_uv0; \nuv_0 *= uv_scale; \nvec4 color = texture2D(diffuseTexture, varying_uv0); \nfloat mask = 1.0; \nfloat f = uv_scale.y - varying_uv0.y; \nif (varying_uv0.y < uv_scale.y){ \nif(f < 0.03 && f > 0.0){ \nmask =1.0 - (f / 0.03 * 0.9 + 0.1); \n} \nelse{ \nmask = 0.1; \n} \n} \ncolor.xyz *= mask; \ngl_FragColor  = color; \n} \n",hud_H_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main(void) { \nvec2 uv = vec2(varying_uv0.x ,1.0-varying_uv0.y); \nvec4 color = texture2D(diffuseTexture, uv); \ngl_FragColor  = color; \n} \n",hud_vs:"attribute vec3 attribute_position; \nattribute vec2 attribute_uv0; \nvarying  vec2 varying_uv0; \nuniform  mat4 uniform_ViewProjectionMatrix; \nvoid main(void) { \nvec4 pos = vec4(attribute_position, 1.0); \ngl_Position = uniform_ViewProjectionMatrix * pos; \nvarying_uv0 = attribute_uv0; \n} \n",hud_V_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main(void) { \nvec4 color = texture2D(diffuseTexture, varying_uv0); \ngl_FragColor  = color; \n} \n",lightingBase_fs:"vec4 LightingBlinnPhong(vec3 lightDir, vec3 lightColor , vec3 normal , vec3 viewDir, float atten){ \nvec3 ambient = materialSource.ambient ; \nfloat NdotL = clamp(dot (normal, lightDir),0.0,1.0); \nvec3 diffuse = lightColor.xyz * NdotL ; \nvec3 h = normalize (lightDir + normalize(viewDir)); \nfloat nh = clamp(dot (normal, h),0.0,1.0); \nfloat specPower = pow (nh, materialSource.shininess ) * materialSource.specularScale ; \nvec3 specular = lightColor.xyz * specPower * materialSource.specular ; \nspecularColor.xyz += specular; \nvec4 c; \nc.rgb = (diffuse+specular+ambient) * (atten * 2.0 ); \nc.a = materialSource.alpha + (specPower * atten); \nreturn c; \n} \nvoid main(void) { \nlight.xyzw = vec4(0.0,0.0,0.0,1.0) ; \n} \n",lightMapSpecularPower_fs:"uniform sampler2D lightTexture ; \nvarying vec2 varying_uv1 ; \nvec4 decode_hdr( vec4 data ){ \nvec4 res = data ; \nres.xyz *= pow(2.0,data.w * 256.0 - 128.0); \nreturn res ; \n} \nvoid main(void){ \nvec4 lightmap = texture2D( lightTexture , varying_uv1 ); \nlightmap.xyz = decode_hdr(lightmap).xyz; \nlightmap.xyz = pow( 1.0 * lightmap.xyz, vec3(0.80)) ; \ndiffuseColor.xyz *= lightmap.xyz ; \nspecularColor.xyz *= lightmap.xyz ; \n} \n",lightMap_fs:"uniform sampler2D lightTexture ; \nvarying vec2 varying_uv1 ; \nvec4 decode_hdr( vec4 data ){ \nvec4 res = data ; \nres.xyz *= pow(2.0,data.w * 256.0 - 128.0); \nreturn res ; \n} \nvoid main(void){ \nvec4 lightmap = texture2D( lightTexture , varying_uv1 ); \nlightmap.xyz = decode_hdr(lightmap).xyz; \nlightmap.xyz = pow( 1.0 * lightmap.xyz, vec3(0.80)) ; \ndiffuseColor.xyz *= lightmap.xyz ; \n} \n",lineFog:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nfloat fogStartDistance ; \nfloat fogFarDistance ; \nfloat fogAlpha ; \n}; \nvarying vec4 varying_pos; \nuniform float uniform_globalFog[7]; \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.fogStartDistance = uniform_globalFog[4] ; \nfog.fogFarDistance = uniform_globalFog[5] ; \nfog.fogAlpha = uniform_globalFog[6] ; \nfloat d = varying_pos.z ; \nfloat distFog = max( 0.0 , d -  fog.fogStartDistance ) ; \ndiffuseColor.xyz = mix( diffuseColor.xyz,fog.fogColor, clamp(distFog/fog.fogFarDistance,0.0,1.0) * fog.fogAlpha ) ; \n} \n",matCapPass_vs:"varying vec2 capCoord ; \nvoid main(void){ \ncapCoord.x = dot(normalMatrix[0].xyz,normal); \ncapCoord.y = dot(normalMatrix[1].xyz,normal); \ncapCoord = capCoord * 0.5 + 0.5; \nambientColor.xyz +=  + capCoord.xyz * 2.0 - 1.0 ; \n} \n",matCap_TextureAdd_fs:"uniform sampler2D matcapTexture; \nuniform mat4 uniform_NormalMatrix; \nvoid main() { \nvec4 capCoord ; \ncapCoord.x = -normal.x; \ncapCoord.y = normal.y; \ncapCoord.xy = capCoord.xy * 0.5 + 0.5; \ncapCoord = texture2D(matcapTexture , capCoord.xy ) * 2.0 - 1.0 ; \nambientColor.xyz += capCoord.xyz ; \n} \n",matCap_TextureMult_fs:"uniform sampler2D matcapTexture; \nuniform mat4 uniform_NormalMatrix; \nvoid main() { \nvec4 capCoord ; \ncapCoord.x = -normal.x; \ncapCoord.y = normal.y; \ncapCoord.xy = capCoord.xy * 0.5 + 0.5; \ncapCoord = texture2D(matcapTexture , capCoord.xy ) ; \ndiffuseColor.xyz *= capCoord.xyz * 2.0 ; \n} \n",materialSource_fs:"struct MaterialSource{ \nvec3 diffuse; \nvec3 ambient; \nvec3 specular; \nfloat alpha; \nfloat cutAlpha; \nfloat shininess; \nfloat roughness; \nfloat albedo; \nvec4 uvRectangle; \nfloat specularScale; \nfloat normalScale; \n}; \nuniform float uniform_materialSource[20] ; \nMaterialSource materialSource ; \nvoid main(){ \nmaterialSource.diffuse.x = uniform_materialSource[0]; \nmaterialSource.diffuse.y = uniform_materialSource[1]; \nmaterialSource.diffuse.z = uniform_materialSource[2]; \nmaterialSource.ambient.x = uniform_materialSource[3]; \nmaterialSource.ambient.y = uniform_materialSource[4]; \nmaterialSource.ambient.z = uniform_materialSource[5]; \nmaterialSource.specular.x = uniform_materialSource[6]; \nmaterialSource.specular.y = uniform_materialSource[7]; \nmaterialSource.specular.z = uniform_materialSource[8]; \nmaterialSource.alpha = uniform_materialSource[9]; \nmaterialSource.cutAlpha = uniform_materialSource[10]; \nmaterialSource.shininess = uniform_materialSource[11]; \nmaterialSource.specularScale = uniform_materialSource[12]; \nmaterialSource.albedo = uniform_materialSource[13]; \nmaterialSource.uvRectangle.x = uniform_materialSource[14]; \nmaterialSource.uvRectangle.y = uniform_materialSource[15]; \nmaterialSource.uvRectangle.z = uniform_materialSource[16]; \nmaterialSource.uvRectangle.w = uniform_materialSource[17]; \nmaterialSource.normalScale = uniform_materialSource[19]; \nuv_0 = varying_uv0.xy * materialSource.uvRectangle.zw + materialSource.uvRectangle.xy ; \n} \n",mulUvRoll_fs:"uniform float mulUvRoll[4] ; \nuniform sampler2D diffuseTexture; \nuniform sampler2D diffuseTexture1; \nvec4 diffuseColor ; \nvec2 uv_1; \nvoid main() { \nuv_1 = varying_uv0; \nuv_0.xy += vec2(mulUvRoll[0],mulUvRoll[1]); \nuv_1.xy += vec2(mulUvRoll[2],mulUvRoll[3]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ) * texture2D(diffuseTexture1 , uv_1 ); \ndiffuseColor.xyz = clamp(diffuseColor.xyz / diffuseColor.w,0.0,1.0); \n} \n",normalMap_fragment:"uniform sampler2D normalTexture; \nvarying vec2 varying_uv0        ; \nmat3 TBN ; \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 tbn(vec3 map, vec3 N, vec3 V, vec2 texcoord) { \nmat3 TBN = cotangentFrame(N, -V, texcoord); \nreturn normalize(TBN * map); \n} \nvoid main(){ \nvec3 normalTex = texture2D(normalTexture,uv_0).xyz *2.0 - 1.0; \nnormalTex.y *= -1.0; \nnormal.xyz = tbn( normalTex.xyz , normal.xyz , normalize(varying_ViewPose.xyz) , uv_0 ) ; \n} \n",particle_bezier:"vec2 bzData[20]; \nconst float Tiny = 0.0001; \nvoid dcpBezier(float bezierData[22], float tTotal) \n{ \nfloat timeNow = 0.0; \nfloat time1 = bezierData[20] * tTotal; \nfloat time2 = bezierData[21] * tTotal; \nfor(int i = 0; i < 20; i ++){ \nbzData[i].x = timeNow; \nbzData[i].y = bezierData[i]; \nif(i <= 9){ \ntimeNow += time1; \n}else if(i >= 11){ \ntimeNow += time2; \n} \n} \nbzData[10].x = bzData[9].x; \n} \nfloat calcBezierArea(float tCurrent){ \nfloat res = 0.0; \nfloat v0; \nfloat v1; \nfloat t0; \nfloat t1; \nfloat deltaTime = 0.0; \nfloat a_deltaTime; \nfor(int i = 0; i < 19; i ++){ \nv0 = bzData[i].y; \nv1 = bzData[i + 1].y; \nt0 = bzData[i].x; \nt1 = bzData[i + 1].x; \ndeltaTime = t1 - t0; \nif(deltaTime > Tiny) \n{ \na_deltaTime = 0.5 * (v1 - v0); \nif(tCurrent >= t1){ \nres += deltaTime * (v0 + a_deltaTime); \n}else{ \ndeltaTime = tCurrent - t0; \nres += deltaTime * (v0 + a_deltaTime); \nbreak; \n} \n} \n} \nreturn res; \n} \nfloat calcOneBezierArea(float bezierData[22], float tCurrent, float tTotal){ \ndcpBezier(bezierData, tTotal); \nreturn calcBezierArea(tCurrent); \n} \nfloat calcBezierSize(float tCurrent){ \nfloat res = 0.0; \nfloat y0; \nfloat y1; \nfloat t0; \nfloat t1; \nfloat deltaTime = 0.0; \nfloat v; \nfor(int i = 0; i < 19; i ++){ \ny0 = bzData[i].y; \ny1 = bzData[i + 1].y; \nt0 = bzData[i].x; \nt1 = bzData[i + 1].x; \ndeltaTime = t1 - t0; \nif(deltaTime > Tiny) \n{ \nif(tCurrent <= t1){ \nv = (y1 - y0) / deltaTime; \ndeltaTime = tCurrent - t0; \nres = y0 + v * deltaTime; \nbreak; \n} \n} \n} \nreturn res; \n} \nfloat calcOneBezierSize(float bezierData[22], float tCurrent, float tTotal){ \ndcpBezier(bezierData, tTotal); \nreturn calcBezierSize(tCurrent); \n} \n",particle_color_fs:"uniform float uniform_colorTransform[40]; \nvec3 unpack_color(float rgb_data) \n{ \nvec3 res; \nres.z = fract( rgb_data ); \nrgb_data -= res.z; \nrgb_data = rgb_data/256.0; \nres.y = fract( rgb_data ); \nrgb_data -= res.y; \nres.x = rgb_data/256.0; \nreturn res; \n} \nvoid main() { \nfloat startColor ; \nfloat startSegment ; \nfloat nextColor ; \nfloat nextSegment ; \nfloat startAlpha; \nfloat nextAlpha; \nfloat progress = varying_particleData.x/varying_particleData.y; \nconst int maxColorCount = 20; \nfor( int i = 1 ; i < maxColorCount ; i++ ){ \nif( progress >= fract(uniform_colorTransform[i+maxColorCount-1]) ){ \nstartColor = uniform_colorTransform[i-1] ; \nstartSegment = fract(uniform_colorTransform[i+maxColorCount-1]) ; \nnextColor = uniform_colorTransform[i]; \nnextSegment = fract(uniform_colorTransform[i+maxColorCount]) ; \nstartAlpha = uniform_colorTransform[i+maxColorCount-1] - startSegment; \nnextAlpha = uniform_colorTransform[i+maxColorCount] - nextSegment; \n}else{ \nbreak; \n} \n} \nfloat len = nextSegment - startSegment ; \nfloat ws = ( progress - startSegment ) / len ; \nglobalColor = mix(vec4(unpack_color(startColor).xyz,startAlpha / 256.0),vec4(unpack_color(nextColor).xyz, nextAlpha / 256.0),ws) ; \nglobalColor.w = clamp(globalColor.w,0.0,1.0); \n} \n",particle_color_vs:"float particle(  ParticleData curParticle ){ \n} \n",particle_diffuse_fragment:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvec4 globalColor = vec4(1.0, 1.0, 1.0, 1.0); \nvoid calcUVCoord(){ \n} \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ncalcUVCoord(); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \nif( diffuseColor.w <= materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",particle_end:"float particle( ParticleData curParticle ){ \nreturn 1.0 ; \n} \nmat4 buildModelMatrix(vec4 quat, vec3 scale, vec3 position) \n{ \nmat4 ret = mat4( \nvec4(scale.x, 0.0, 0.0, 0.0), \nvec4(0.0, scale.y, 0.0, 0.0), \nvec4(0.0, 0.0, scale.z, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \nret = buildMat4Quat(quat) * ret; \nret[3][0] = position.x; \nret[3][1] = position.y; \nret[3][2] = position.z; \nreturn ret; \n} \nvec3 calcParticleMove(vec3 distanceXYZ){ \nif(velocityLimitVec2.y > TrueOrFalse){ \nvec3 temp = distanceXYZ * distanceXYZ; \nfloat distanceCurrent = sqrt(temp.x + temp.y + temp.z); \nfloat distanceLimit = velocityLimitVec2.x; \nif(distanceLimit < 0.0001){ \nreturn vec3(0.0); \n} \nif(distanceCurrent > distanceLimit){ \ndistanceXYZ *= distanceLimit / distanceCurrent; \n} \n} \nreturn distanceXYZ; \n} \nmat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix){ \nreturn cameraMatrix; \n} \nvoid updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \n} \nvoid main(void) { \nif(discard_particle > TrueOrFalse){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \nvec3 position_emitter = attribute_offsetPosition; \nvec3 velocityLocalVec3 = velocityBaseVec3 * currentTime; \nvec3 velocityWorldVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityMultiVec3 = vec3(0.0,0.0,0.0); \nif(particleStateData.velocityOverWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityOverVec3; \n}else{ \nvelocityWorldVec3 += velocityOverVec3; \n} \nif(particleStateData.velocityForceWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityForceVec3; \n}else{ \nvelocityWorldVec3 += velocityForceVec3; \n} \nif(particleStateData.worldSpace > TrueOrFalse){ \n}else{ \nfollowTargetPosition.x = particleStateData.positionX; \nfollowTargetPosition.y = particleStateData.positionY; \nfollowTargetPosition.z = particleStateData.positionZ; \nfollowTargetRotation.x = particleStateData.rotationX; \nfollowTargetRotation.y = particleStateData.rotationY; \nfollowTargetRotation.z = particleStateData.rotationZ; \nfollowTargetRotation.w = particleStateData.rotationW; \n} \nmat4 followRotQuat = buildMat4Quat(followTargetRotation); \nvelocityLocalVec3 = (followRotQuat * vec4(velocityLocalVec3, 1.0)).xyz; \nmat4 modelMatrix = buildModelMatrix(followTargetRotation, followTargetScale, followTargetPosition); \nposition_emitter = (modelMatrix * vec4(position_emitter, 1.0)).xyz; \nvelocityMultiVec3 = velocityLocalVec3 + velocityWorldVec3; \nvelocityMultiVec3 = calcParticleMove(velocityMultiVec3); \nvelocityMultiVec3.y -= 4.9 * currentTime * currentTime * particleStateData.gravity; \nvec3 origPosition = position_emitter; \nposition_emitter += velocityMultiVec3; \nupdateStretchedBillBoard(vec4(origPosition, 1.0), vec4(position_emitter, 1.0)); \nmat4 billboardMatrix = getRenderModeMatrix(uniform_cameraMatrix, modelMatrix); \noutPosition = billboardMatrix * localPosition; \noutPosition.xyz += position_emitter.xyz; \noutPosition = uniform_ViewMatrix * outPosition; \n} \nvarying_posZ = outPosition.z; \ngl_Position = uniform_ProjectionMatrix * outPosition ; \n} \n\t \n",particle_end_fs:"uniform float uniform_particleFsData[3]; \nvoid main() { \nfloat blendMode = uniform_particleFsData[2]; \noutColor.xyz = diffuseColor.xyz * materialSource.diffuse * varying_color.xyz * globalColor.xyz; \noutColor.w = materialSource.alpha * diffuseColor.w * varying_color.w * globalColor.w; \noutColor.xyz *= outColor.w; \noutColor = clamp(outColor, 0.0, 1.0); \ngl_FragColor = outColor; \n} \n",particle_end_vs:"float particle( ParticleData curParticle ){ \nreturn 1.0 ; \n} \nmat4 buildModelMatrix(vec4 quat, vec3 scale, vec3 position) \n{ \nmat4 ret = mat4( \nvec4(scale.x, 0.0, 0.0, 0.0), \nvec4(0.0, scale.y, 0.0, 0.0), \nvec4(0.0, 0.0, scale.z, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \nret = buildMat4Quat(quat) * ret; \nret[3][0] = position.x; \nret[3][1] = position.y; \nret[3][2] = position.z; \nreturn ret; \n} \nvec3 calcParticleMove(vec3 distanceXYZ){ \nif(velocityLimitVec2.y > TrueOrFalse){ \nvec3 temp = distanceXYZ * distanceXYZ; \nfloat distanceCurrent = sqrt(temp.x + temp.y + temp.z); \nfloat distanceLimit = velocityLimitVec2.x; \nif(distanceLimit < Tiny){ \nreturn vec3(0.0); \n} \nif(distanceCurrent > distanceLimit){ \ndistanceXYZ *= distanceLimit / distanceCurrent; \n} \n} \nreturn distanceXYZ; \n} \nmat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix){ \nreturn cameraMatrix; \n} \nfloat updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \nreturn 1.0; \n} \nvoid main(void) { \nif(discard_particle > TrueOrFalse){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \nvec3 position_emitter = attribute_offsetPosition; \nvec3 velocityLocalVec3 = velocityBaseVec3 * currentTime; \nvec3 velocityWorldVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityMultiVec3 = vec3(0.0,0.0,0.0); \nif(particleStateData.velocityOverWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityOverVec3; \n}else{ \nvelocityWorldVec3 += velocityOverVec3; \n} \nif(particleStateData.velocityForceWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityForceVec3; \n}else{ \nvelocityWorldVec3 += velocityForceVec3; \n} \nif(particleStateData.worldSpace > TrueOrFalse){ \n}else{ \nfollowTargetPosition.x = particleStateData.positionX; \nfollowTargetPosition.y = particleStateData.positionY; \nfollowTargetPosition.z = particleStateData.positionZ; \nfollowTargetRotation.x = particleStateData.rotationX; \nfollowTargetRotation.y = particleStateData.rotationY; \nfollowTargetRotation.z = particleStateData.rotationZ; \nfollowTargetRotation.w = particleStateData.rotationW; \n} \nmat4 followRotQuat = buildMat4Quat(followTargetRotation); \nvelocityLocalVec3 = (followRotQuat * vec4(velocityLocalVec3, 1.0)).xyz; \nmat4 modelMatrix = buildModelMatrix(followTargetRotation, followTargetScale, followTargetPosition); \nposition_emitter = (modelMatrix * vec4(position_emitter, 1.0)).xyz; \nvelocityMultiVec3 = velocityLocalVec3 + velocityWorldVec3; \nvelocityMultiVec3 = calcParticleMove(velocityMultiVec3); \nvelocityMultiVec3.y -= 4.9 * currentTime * currentTime * particleStateData.gravity; \nvec3 origPosition = position_emitter; \nposition_emitter += velocityMultiVec3; \nfloat dirEnable = updateStretchedBillBoard(vec4(origPosition, 1.0), vec4(position_emitter, 1.0)); \nif(dirEnable > TrueOrFalse){ \nmat4 billboardMatrix = getRenderModeMatrix(uniform_cameraMatrix, modelMatrix); \noutPosition = billboardMatrix * localPosition; \noutPosition.xyz += position_emitter.xyz; \noutPosition = uniform_ViewMatrix * outPosition; \n}else{ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n} \n} \ngl_Position = uniform_ProjectionMatrix * outPosition ; \n} \n\t \n",particle_follow_vs:"attribute vec3 attribute_followPosition ; \nattribute vec4 attribute_followRotation ; \nattribute vec3 attribute_followScale; \nfloat particle(  ParticleData curParticle ){ \nfollowTargetPosition = attribute_followPosition; \nfollowTargetRotation = attribute_followRotation; \n} \n\t \n",particle_fs:"uniform vec2 uniform_fadeOutParticleData; \nvarying float varying_posZ; \nvoid fadeOutParticleByZ(){ \nif(varying_posZ > uniform_fadeOutParticleData.x){ \ndiscard; \n} \nfloat fadeAlpha = (uniform_fadeOutParticleData.x - varying_posZ) / uniform_fadeOutParticleData.x; \nfadeAlpha = clamp(fadeAlpha, 0.0, 1.0); \nfadeAlpha *= fadeAlpha; \noutColor.w *= fadeAlpha; \nif( diffuseColor.w <= materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",particle_rm_billboard:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nmat4 matrix = mat4( \ncameraMatrix[0], \ncameraMatrix[1], \ncameraMatrix[2], \nvec4(0.0, 0.0, 1.0, 1.0)); \nreturn matrix; \n} \n",particle_rm_mesh:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nreturn mat4( \nvec4(1.0, 0.0, 0.0, 0.0), \nvec4(0.0, 1.0, 0.0, 0.0), \nvec4(0.0, 0.0, 1.0, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \n} \n",particle_rm_stretched:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nmat4 matrix = mat4( \ncameraMatrix[0], \ncameraMatrix[1], \ncameraMatrix[2], \nvec4(0.0, 0.0, 1.0, 1.0)); \nreturn matrix; \n} \nfloat updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \nvec3 dirVector = newPos.xyz - startPos.xyz; \nfloat lengthScale = particleStateData.lengthScale; \nfloat speedScale = dirVector.x * dirVector.x + dirVector.y * dirVector.y + dirVector.z * dirVector.z; \nspeedScale = sqrt(speedScale) * 0.01 / currentTime; \nlocalPosition.x *= particleStateData.lengthScale + speedScale * particleStateData.speedScale; \nmat4 temp = uniform_ViewMatrix; \nstartPos = temp * startPos; \nnewPos = temp * newPos; \nfloat scaleBefore = dirVector.x * dirVector.x + dirVector.y * dirVector.y + dirVector.z * dirVector.z; \nscaleBefore = sqrt(scaleBefore); \nif(scaleBefore < Tiny){ \nreturn 0.0; \n} \nfloat scaleAfter = dirVector.x * dirVector.x + dirVector.y * dirVector.y; \nscaleAfter = sqrt(scaleAfter); \nscaleAfter = scaleAfter / scaleBefore; \nlocalPosition.x *= scaleAfter; \nstartPos.xyz /= startPos.z; \nnewPos.xyz /= newPos.z; \ndirVector = newPos.xyz - startPos.xyz; \ndirVector = normalize(dirVector); \nvec3 dirStartVector = vec3(0.0, 1.0, 0.0); \nfloat added = -0.5 * PI; \nif(dirVector.x > 0.0){ \ndirVector.xy *= -1.0; \nadded += PI; \n} \nfloat acosValue = dot(dirStartVector, dirVector); \nfloat angle = acos(acosValue) + added; \ntemp = buildRotMat4(vec3(0.0, 0.0, angle)); \nlocalPosition = temp * localPosition; \nreturn 1.0; \n} \n",particle_rotationConst:"attribute float attribute_rotationZ ; \nfloat particle(  ParticleData curParticle ){ \nfloat rot = currentTime * attribute_rotationZ * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n",particle_rotationOneBezier:"uniform float uniform_rotationBezier[22]; \nfloat particle(  ParticleData curParticle ){ \nif(discard_particle < TrueOrFalse){ \nfloat rot = calcOneBezierSize(uniform_rotationBezier, currentTime, curParticle.life); \nrot = currentTime * rot * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n} \n",particle_rotationTwoBezier:"attribute float attribute_rotationRandomSeed; \nuniform float uniform_rotationBezier[22]; \nuniform float uniform_rotationBezier2[22]; \nfloat particle(  ParticleData curParticle ){ \nif(discard_particle < TrueOrFalse){ \nvec2 rotationTwoBezier = vec2(0.0); \nrotationTwoBezier.x = calcOneBezierArea(uniform_rotationBezier, currentTime, curParticle.life); \nrotationTwoBezier.y = calcOneBezierArea(uniform_rotationBezier2, currentTime, curParticle.life); \nfloat rot = mix(rotationTwoBezier.x, rotationTwoBezier.y, attribute_rotationRandomSeed); \nrot = currentTime * rot * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n} \n",particle_size_vs:"uniform float uniform_bezierSize[22]; \nvoid main() { \nfloat bezierSize = calcOneBezierSize(uniform_bezierSize, currentTime, curParticle.life); \nlocalPosition.xyz *= bezierSize; \n} \n",particle_textureSheetConst:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nframe = clamp(frame, uniform_textureSheet[3], uniform_textureSheet[4]); \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheetOneBezier:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nuniform float uniform_frameBezier[22]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nfloat currentTime = varying_particleData.x * uniform_textureSheet[2]; \ncurrentTime = mod(currentTime, varying_particleData.y); \nfloat bezierFrame = calcOneBezierSize(uniform_frameBezier, currentTime, varying_particleData.y); \nbezierFrame = clamp(bezierFrame, uniform_textureSheet[3], uniform_textureSheet[4]); \nframe += bezierFrame; \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheetTwoBezier:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nuniform float uniform_frameBezier1[22]; \nuniform float uniform_frameBezier2[22]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nfloat currentTime = varying_particleData.x * uniform_textureSheet[2]; \ncurrentTime = mod(currentTime, varying_particleData.y); \nfloat b1 = calcOneBezierSize(uniform_frameBezier1, currentTime2, varying_particleData.y); \nfloat b2 = calcOneBezierSize(uniform_frameBezier2, currentTime2, varying_particleData.y); \nfloat bezierFrame = mix(b1, b2, varying_particleData.z); \nbezierFrame = clamp(bezierFrame, uniform_textureSheet[3], uniform_textureSheet[4]); \nframe += bezierFrame; \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheet_vs:"attribute vec3 attribute_textureSheetData; \nvarying vec3 varying_textureSheetData; \nfloat particle(  ParticleData curParticle ){ \nvarying_textureSheetData = attribute_textureSheetData; \n} \n\t \n",particle_time_fs:"varying vec3 varying_particleData; \nvoid main(void) { \n} \n",particle_time_vs:"attribute vec3 attribute_time ; \nfloat currentTime = 0.0; \nvarying vec3 varying_particleData; \nstruct ParticleData{ \nfloat bornTime; \nfloat life; \nfloat index; \n}; \nfloat particle( ParticleData curParticle ){ \nfloat time = particleStateData.time - particleStateData.delay; \nif(time <= curParticle.bornTime){ \nreturn currentTime = 0.0; \n} \nif(particleStateData.loop < TrueOrFalse){ \nfloat emitterDuring = particleStateData.duration - particleStateData.delay; \nif(curParticle.bornTime >= emitterDuring) \n{ \nreturn currentTime = 0.0; \n} \nif(time >= curParticle.life + curParticle.bornTime) \n{ \nreturn currentTime = 0.0; \n} \n} \ncurrentTime = time - curParticle.bornTime; \ncurrentTime = mod(currentTime, particleStateData.loopTime); \nif(currentTime >= curParticle.life){ \nreturn currentTime = 0.0; \n} \nif( currentTime <= 0.0 ) \nreturn currentTime = 0.0; \n} \nvoid main(void) { \nParticleData curParticle ; \ncurParticle.bornTime = attribute_time.x ; \ncurParticle.life = attribute_time.y ; \ncurParticle.index = attribute_time.z ; \nfloat active = particle( curParticle ) ; \nvarying_particleData.x = currentTime; \nvarying_particleData.y = curParticle.life ; \nvarying_particleData.z = curParticle.index; \nif( active < TrueOrFalse ){ \ne_discard(); \n}else{ \n} \n} \n",particle_uv_roll_fs:"uniform float uniform_particleUVRoll[2]; \nvoid calcUVCoord() { \nuv_0.xy += vec2(varying_particleData.x * uniform_particleUVRoll[0], varying_particleData.x * uniform_particleUVRoll[1]); \n} \n",particle_velocity:"attribute vec3 attribute_velocity; \nfloat particle(  ParticleData curParticle ){ \nvelocityBaseVec3 = attribute_velocity; \n} \n",particle_velocityForceConst:"attribute vec3 attribute_velocityForceConst ; \nfloat particle(   ParticleData curParticle ){ \nvelocityForceVec3 = 0.5 * attribute_velocityForceConst * currentTime * currentTime; \n} \n",particle_velocityForceOneBezier:"vec3 velocityForceOneBezier = vec3(0.0); \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nvelocityForceVec3.xyz = velocityForceOneBezier.xyz; \ncalcVelocityForceBezier(currentTime, curParticle.life); \n} \n} \n",particle_velocityForceOneBezierX:"uniform float uniform_velocityForceX[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.x = calcOneBezierArea(uniform_velocityForceX, curTime, totalTime); \n} \n",particle_velocityForceOneBezierY:"uniform float uniform_velocityForceY[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.y = calcOneBezierArea(uniform_velocityForceY, curTime, totalTime); \n} \n",particle_velocityForceOneBezierZ:"uniform float uniform_velocityForceZ[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.z = calcOneBezierArea(uniform_velocityForceZ, curTime, totalTime); \n} \n",particle_velocityForceTwoBezier:"attribute float attribute_velocityForceRandomSeed; \nvec3 velocityForceTwoBezier1 = vec3(0.0); \nvec3 velocityForceTwoBezier2 = vec3(0.0); \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityForceBezier(currentTime, curParticle.life); \nvelocityForceVec3.x = mix(velocityForceTwoBezier1.x, velocityForceTwoBezier2.x, attribute_velocityForceRandomSeed); \nvelocityForceVec3.y = mix(velocityForceTwoBezier1.y, velocityForceTwoBezier2.y, attribute_velocityForceRandomSeed); \nvelocityForceVec3.z = mix(velocityForceTwoBezier1.z, velocityForceTwoBezier2.z, attribute_velocityForceRandomSeed); \n} \n} \n",particle_velocityForceTwoBezierX1:"uniform float uniform_velocityForceX1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.x = calcOneBezierArea(uniform_velocityForceX1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierX2:"uniform float uniform_velocityForceX2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.x = calcOneBezierArea(uniform_velocityForceX2, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierY1:"uniform float uniform_velocityForceY1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.y = calcOneBezierArea(uniform_velocityForceY1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierY2:"uniform float uniform_velocityForceY2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.y = calcOneBezierArea(uniform_velocityForceY2, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierZ1:"uniform float uniform_velocityForceZ1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.z = calcOneBezierArea(uniform_velocityForceZ1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierZ2:"uniform float uniform_velocityForceZ2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.z = calcOneBezierArea(uniform_velocityForceZ2, curTime, totalTime); \n} \n",particle_velocityLimitConst:"attribute float attribute_velocityLimit; \nfloat particle(  ParticleData curParticle ){ \nvelocityLimitVec2.x = attribute_velocityLimit * currentTime; \nif(velocityLimitVec2.x < 0.0){ \nvelocityLimitVec2.x = 0.0; \n} \nvelocityLimitVec2.y = 1.0; \n} \n",particle_velocityLimitOneBezier:"uniform float uniform_velocityLimit[22]; \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nvelocityLimitVec2.x = calcOneBezierArea(uniform_velocityLimit, currentTime, curParticle.life); \nvelocityLimitVec2.y = 1.0; \n} \n} \n",particle_velocityLimitTwoBezier:"uniform float uniform_velocityLimit[22]; \nuniform float uniform_velocityLimit2[22]; \nattribute float attribute_velocityLimitRandomSeed; \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nfloat velocity2Limit1 = calcOneBezierArea(uniform_velocityLimit, currentTime, curParticle.life); \nfloat velocity2Limit2 = calcOneBezierArea(uniform_velocityLimit2, currentTime, curParticle.life); \nvelocityLimitVec2.x = mix(velocity2Limit1, velocity2Limit1, attribute_velocityLimitRandomSeed); \nif(velocityLimitVec2.x < 0.0){ \nvelocityLimitVec2.x = 0.0; \n} \nvelocityLimitVec2.y = 1.0; \n} \n} \n",particle_velocityOverConst:"attribute vec3 attribute_velocityOverConst; \nfloat particle(  ParticleData curParticle ){ \nvelocityOverVec3 = attribute_velocityOverConst * currentTime; \n} \n",particle_velocityOverOneBezier:"vec3 velocityTwoBezier = vec3(0.0); \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityOverBezier(currentTime, curParticle.life); \nvelocityOverVec3.xyz = velocityTwoBezier.xyz; \n} \n} \n",particle_velocityOverOneBezierX:"uniform float uniform_velocityOverX[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.x = calcOneBezierArea(uniform_velocityOverX, curTime, totalTime); \n} \n",particle_velocityOverOneBezierY:"uniform float uniform_velocityOverY[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.y = calcOneBezierArea(uniform_velocityOverY, curTime, totalTime); \n} \n",particle_velocityOverOneBezierZ:"uniform float uniform_velocityOverZ[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.z = calcOneBezierArea(uniform_velocityOverZ, curTime, totalTime); \n} \n",particle_velocityOverTwoBezier:"attribute float attribute_velocityOverRandomSeed; \nvec3 velocityOverTwoBezier1 = vec3(0.0); \nvec3 velocityOverTwoBezier2 = vec3(0.0); \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityOverBezier(currentTime, curParticle.life); \nvelocityOverVec3.x = mix(velocityOverTwoBezier1.x, velocityOverTwoBezier2.x, attribute_velocityOverRandomSeed); \nvelocityOverVec3.y = mix(velocityOverTwoBezier1.y, velocityOverTwoBezier2.y, attribute_velocityOverRandomSeed); \nvelocityOverVec3.z = mix(velocityOverTwoBezier1.z, velocityOverTwoBezier2.z, attribute_velocityOverRandomSeed); \n} \n} \n",particle_velocityOverTwoBezierX1:"uniform float uniform_velocityOverX1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.x = calcOneBezierArea(uniform_velocityOverX1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierX2:"uniform float uniform_velocityOverX2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.x = calcOneBezierArea(uniform_velocityOverX2, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierY1:"uniform float uniform_velocityOverY1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.y = calcOneBezierArea(uniform_velocityOverY1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierY2:"uniform float uniform_velocityOverY2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.y = calcOneBezierArea(uniform_velocityOverY2, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierZ1:"uniform float uniform_velocityOverZ1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.z = calcOneBezierArea(uniform_velocityOverZ1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierZ2:"uniform float uniform_velocityOverZ2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.z = calcOneBezierArea(uniform_velocityOverZ2, curTime, totalTime); \n} \n",particle_vs:"attribute vec4 attribute_color; \nattribute vec3 attribute_offsetPosition; \nuniform mat4 uniform_cameraMatrix; \nuniform float uniform_particleState[22]; \nuniform mat4 uniform_ViewMatrix; \nconst float PI = 3.1415926 ; \nfloat currentTime = 0.0; \nfloat totalTime = 0.0; \nconst float TrueOrFalse = 0.5; \nconst float Tiny = 0.0001; \nvec4 localPosition = vec4(0.0,0.0,0.0,1.0); \nvec3 velocityBaseVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityOverVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityForceVec3 = vec3(0.0,0.0,0.0); \nvec2 velocityBezierWeightVec2 = vec2(1.0, 1.0); \nvec2 velocityLimitVec2 = vec2(0.0,0.0); \nvec3 followTargetPosition = vec3(0.0,0.0,0.0); \nvec3 followTargetScale = vec3(1.0,1.0,1.0); \nvec4 followTargetRotation = vec4(0.0,0.0,0.0,0.0); \nvarying vec3 varyingViewDir ; \nfloat discard_particle = 0.0; \nParticleStateData particleStateData; \nvoid e_discard(){ \ndiscard_particle = 1.0; \n} \nstruct ParticleStateData{ \nfloat time; \nfloat loop; \nfloat worldSpace; \nfloat scaleX; \nfloat scaleY; \nfloat scaleZ; \nfloat rotationX; \nfloat rotationY; \nfloat rotationZ; \nfloat rotationW; \nfloat positionX; \nfloat positionY; \nfloat positionZ; \nfloat loopTime; \nfloat delay; \nfloat duration; \nfloat gravity; \nfloat velocityOverWorldSpace; \nfloat velocityForceWorldSpace; \nfloat cameraScale; \nfloat speedScale; \nfloat lengthScale; \n}; \nmat4 buildRotMat4(vec3 rot) \n{ \nfloat s; \nfloat c; \ns = sin(rot.x); \nc = cos(rot.x); \nmat4 ret = mat4( \nvec4(1.0, 0.0, 0.0, 0.0), \nvec4(0.0, c, s, 0.0), \nvec4(0.0, -s, c, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \ns = sin(rot.y); \nc = cos(rot.y); \nret = mat4( \nvec4(c, 0.0, -s, 0.0), \nvec4(0.0, 1.0, 0.0, 0.0), \nvec4(s, 0.0, c, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n) * ret; \ns = sin(rot.z); \nc = cos(rot.z); \nret = mat4( \nvec4(c, s, 0.0, 0.0), \nvec4(-s, c, 0.0, 0.0), \nvec4(0.0, 0.0, 1.0, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n) * ret; \nreturn ret; \n} \nmat4 buildMat4Quat(vec4 quat){ \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),\t\t2.0 * (xy + zw),\t\t2.0 * (xz - yw),\t\t0, \n2.0 * (xy - zw),\t\t\t\t1.0 - 2.0 * (xx + zz),\t2.0 * (yz + xw),\t\t0, \n2.0 * (xz + yw),\t\t\t\t2.0 * (yz - xw),\t\t1.0 - 2.0 * (xx + yy),\t0, \n0.0,\t\t\t\t\t\t\t0.0,\t\t\t\t\t0.0,\t\t\t\t\t1 \n); \n} \nvoid main(void) { \nparticleStateData.time\t\t\t\t\t\t\t= uniform_particleState[0]; \nparticleStateData.loop\t\t\t\t\t\t\t= uniform_particleState[1]; \nparticleStateData.worldSpace\t\t\t\t\t= uniform_particleState[2]; \nparticleStateData.scaleX\t\t\t\t\t\t= uniform_particleState[3]; \nparticleStateData.scaleY\t\t\t\t\t\t= uniform_particleState[4]; \nparticleStateData.scaleZ\t\t\t\t\t\t= uniform_particleState[5]; \nparticleStateData.rotationX\t\t\t\t\t\t= uniform_particleState[6]; \nparticleStateData.rotationY\t\t\t\t\t\t= uniform_particleState[7]; \nparticleStateData.rotationZ\t\t\t\t\t\t= uniform_particleState[8]; \nparticleStateData.rotationW\t\t\t\t\t\t= uniform_particleState[9]; \nparticleStateData.positionX\t\t\t\t\t\t= uniform_particleState[10]; \nparticleStateData.positionY\t\t\t\t\t\t= uniform_particleState[11]; \nparticleStateData.positionZ\t\t\t\t\t\t= uniform_particleState[12]; \nparticleStateData.loopTime\t\t\t\t\t\t= uniform_particleState[13]; \nparticleStateData.delay\t\t\t\t\t\t\t= uniform_particleState[14]; \nparticleStateData.duration\t\t\t\t\t\t= uniform_particleState[15]; \nparticleStateData.gravity\t\t\t\t\t\t= uniform_particleState[16]; \nparticleStateData.velocityOverWorldSpace\t\t= uniform_particleState[17]; \nparticleStateData.velocityForceWorldSpace\t\t= uniform_particleState[18]; \nparticleStateData.cameraScale\t\t\t\t\t= uniform_particleState[19]; \nparticleStateData.speedScale\t\t\t\t\t= uniform_particleState[20]; \nparticleStateData.lengthScale\t\t\t\t\t= uniform_particleState[21]; \nmat4 modeViewMatrix = uniform_ModelViewMatrix ; \noutPosition = localPosition = vec4(e_position, 1.0); \n} \n",pointLight_fragment:"const int max_pointLight = 0 ; \nuniform float uniform_pointLightSource[6*max_pointLight] ; \nuniform mat4 uniform_NormalMatrix; \nstruct PointLight{ \nvec3 position ; \nvec3 diffuse ; \n}; \nvoid calculatePointLight(MaterialSource materialSource){ \nvec3 N = normal; \nfor(int i = 0 ; i < max_pointLight ; i++){ \nPointLight pointLight; \npointLight.position = vec3(uniform_pointLightSource[i*6],uniform_pointLightSource[i*6+1],uniform_pointLightSource[i*6+2]); \npointLight.diffuse = vec3(uniform_pointLightSource[i*6+3],uniform_pointLightSource[i*6+4],uniform_pointLightSource[i*6+5]); \nvec3 viewDir = normalize(varying_ViewPose.xyz/varying_ViewPose.w); \nvec4 lightVirePos = uniform_NormalMatrix * vec4(pointLight.position.xyz,1.0) ; \nvec3 lightDir = varying_ViewPose.xyz - lightVirePos.xyz ; \nfloat lightDist = length( lightDir ); \nfloat attenuation = 1.0 / (3.0 + 0.001 * lightDist +  0.00009 * lightDist * lightDist); \nlight += LightingBlinnPhong(normalize(lightDir),vec3(1.0,1.0,1.0),normal,-varying_ViewDir,attenuation); \n}; \n} \nvoid main() { \ncalculatePointLight(materialSource); \n} \n",secondaryUV_vs:"attribute vec2 attribute_uv1; \nvarying vec2 varying_uv1 ; \nvoid main(void){ \nvarying_uv1 = attribute_uv1 ; \n} \n",shadowMapping_fs:"uniform sampler2D shadowMapTexture; \nuniform vec3 uniform_ShadowColor; \nvarying vec4 varying_ShadowCoord; \nfloat unpackDepth(vec4 rgbaDepth){ \nvec4 bitShift = vec4( 1.0 , 1.0/256.0 , 1.0/(256.0*256.0) , 1.0/(256.0*256.0*256.0) ); \nfloat depth = dot(rgbaDepth,bitShift); \nreturn depth ; \n} \nvoid main() { \nvec3 shadowColor = vec3(1.0,1.0,1.0); \nfloat shadow = 0.0; \nif (varying_ShadowCoord.w > 0.0) { \nvec3 shadowDepth = varying_ShadowCoord.xyz / varying_ShadowCoord.w * 0.5 + 0.5; \nvec2 sample = clamp(shadowDepth.xy,0.0,1.0); \nfloat sampleDepth = texture2D(shadowMapTexture, sample).z; \nif(sampleDepth > shadowDepth.z) \nshadowColor = uniform_ShadowColor; \n} \ndiffuseColor.xyz = diffuseColor.xyz * shadowColor; \n} \n",shadowMapping_vs:"uniform mat4 uniform_ShadowMatrix; \nuniform mat4 uniform_ModelMatrix; \nvarying vec4 varying_ShadowCoord; \nvoid main() { \nvarying_ShadowCoord = uniform_ShadowMatrix * uniform_ModelMatrix * vec4(e_position, 1.0); \n} \n",skeletonShadowPass_vs:"attribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nattribute vec4 attribute_color; \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),\t\t2.0 * (xy + zw),\t\t2.0 * (xz - yw),\t\t0, \n2.0 * (xy - zw),\t\t\t\t1.0 - 2.0 * (xx + zz),\t2.0 * (yz + xw),\t\t0, \n2.0 * (xz + yw),\t\t\t\t2.0 * (yz - xw),\t\t1.0 - 2.0 * (xx + yy),\t0, \ntranslation.x,\t\t\t\ttranslation.y,\t\t\ttranslation.z,\t\t\t1 \n); \n} \nvoid main(void){ \nvarying_color = attribute_color; \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \noutPosition = uniform_ModelViewMatrix * outPosition; \n} \n",skeleton_vs:"attribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nuniform mat4 uniform_NormalMatrix ; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xy2 = 2.0 * quat.x * quat.y; \nfloat xz2 = 2.0 * quat.x * quat.z; \nfloat xw2 = 2.0 * quat.x * quat.w; \nfloat yz2 = 2.0 * quat.y * quat.z; \nfloat yw2 = 2.0 * quat.y * quat.w; \nfloat zw2 = 2.0 * quat.z * quat.w; \nfloat xx = quat.x * quat.x; \nfloat yy = quat.y * quat.y; \nfloat zz = quat.z * quat.z; \nfloat ww = quat.w * quat.w; \nmat4 matrix = mat4( \nxx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0, \nxy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0, \nxz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0, \ntranslation.x, translation.y, translation.z, 1 \n); \nreturn matrix; \n} \nvoid main(void){ \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nvec4 temp_normal = vec4(attribute_normal, 0.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \nvec4 temp_n ; \ntemp_n = m0 * temp_normal * e_boneWeight.x; \ntemp_n += m1 * temp_normal * e_boneWeight.y; \ntemp_n += m2 * temp_normal * e_boneWeight.z; \ntemp_n += m3 * temp_normal * e_boneWeight.w; \nmat3 normalMatrix = mat3(uniform_NormalMatrix); \nvarying_eyeNormal = normalize(normalMatrix * -temp_n.xyz); \nvarying_ViewPose = vec4(normalMatrix*outPosition.xyz, 1.0) ; \noutPosition = uniform_ModelViewMatrix * outPosition; \n} \n",specularMap_fragment:"uniform sampler2D specularTexture; \nvoid main(void){ \nspecularColor.xyz *= texture2D( specularTexture , uv_0 ).xyz ; \n} \n",staticShadowPass_vs:"attribute vec4 attribute_color; \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nvoid main(void){ \nvarying_color = attribute_color; \noutPosition = vec4(attribute_position, 1.0) ; \ne_position = outPosition.xyz; \noutPosition = uniform_ModelViewMatrix * outPosition; \n} \n",tangent_vs:"attribute vec3 attribute_tangent; \nvoid main(void){ \n}  \n",terrainRGBA_fragment:"uniform sampler2D blendMaskTexture ; \nuniform sampler2D splat_0Tex ; \nuniform sampler2D splat_1Tex ; \nuniform sampler2D splat_2Tex ; \nuniform sampler2D splat_3Tex ; \nuniform float uvs[8]; \nvoid main() { \nvec4 splat_control = texture2D ( blendMaskTexture , varying_uv0 ); \nvec4 cc = vec4(0.0,0.0,0.0,1.0); \nvec2 uv = varying_uv0 ; \ncc.xyz = splat_control.x * texture2D (splat_0Tex, uv * vec2(uvs[0],uvs[1])).xyz ; \ncc.xyz += splat_control.y * texture2D (splat_1Tex, uv * vec2(uvs[2],uvs[3]) ).xyz; \ncc.xyz += splat_control.z * vec4(texture2D (splat_2Tex, uv* vec2(uvs[4],uvs[5]))).xyz; \ncc.xyz += (1.0-length(splat_control.xyz)) * vec4(texture2D (splat_3Tex, uv* vec2(uvs[6],uvs[7]))).xyz; \ndiffuseColor.xyz = cc.xyz ; \n} \n",uvRoll_fs:"uniform float uvRoll[2] ; \nuniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \nuv_0.xy += vec2(uvRoll[0],uvRoll[1]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \n} \n",uvSpriteSheet_fs:"uniform float uvSpriteSheet[4] ; \nuniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \nuv_0.xy *= vec2(uvSpriteSheet[2],uvSpriteSheet[3]); \nuv_0.xy += vec2(uvSpriteSheet[0],uvSpriteSheet[1]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \n} \n",uvStreamerRoll_fs:"uniform float uvRoll[3] ; \nuniform sampler2D diffuseTexture; \nuniform sampler2D streamerTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor = texture2D(diffuseTexture , varying_uv0 ); \nvec2 rollUV = varying_uv0 + vec2(uvRoll[0],uvRoll[1]) + vec2(normal.xz) * 0.5 ; \ndiffuseColor.xyz += texture2D(streamerTexture , rollUV ).xyz * uvRoll[2] ; \n} \n",varyingViewDir_vs:"varying vec3 varying_ViewDir; \nuniform vec3 uniform_eyepos; \nuniform mat4 uniform_NormalMatrix; \nvoid main(void){ \nvarying_ViewDir = (uniform_eyepos.xyz - e_position) ; \n} \n",vertexPos_vs:"varying vec4 varying_pos; \nvoid main() { \nvarying_pos = uniform_ModelViewMatrix * vec4(e_position, 1.0) ; \n} \n                       \n",waterDiffuse_fs:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",waterNormal_fs:"uniform vec2 waterNormalData[4]; \nuniform float time ; \nuniform sampler2D normalTextureA; \nuniform sampler2D normalTextureB; \nvarying vec2 varying_uv0        ; \nmat3 TBN ; \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 tbn(vec3 map, vec3 N, vec3 V, vec2 texcoord) { \nmat3 TBN = cotangentFrame(N, -V, texcoord); \nreturn normalize(TBN * map); \n} \nvoid main(void){ \nfloat tempTime = mod(time,100000.0); \nvec2 uvA = uv_0 * waterNormalData[3].x + waterNormalData[0] * tempTime ; \nvec2 uvB = uv_0 * waterNormalData[3].y + waterNormalData[1] * tempTime  ; \nvec3 normalTex_0 = texture2D(normalTextureA,uvA * 2.0 + normal.x*waterNormalData[2].x ).xyz *2.0 - 1.0; \nvec3 normalTex_1 = texture2D(normalTextureB,uvB * 2.0 + normal.z*waterNormalData[2].y ).xyz *2.0 - 1.0; \nnormalTex_0.y *= -1.0; \nnormalTex_1.y *= -1.0; \nvec3 normalTex_A = tbn( normalTex_0 , normal , -(varying_ViewDir) , uv_0 ); \nvec3 normalTex_B = tbn( normalTex_1 , normal , -(varying_ViewDir) , uv_0 ); \nnormal.xyz = normalize( normalTex_A + normalTex_B ) ; \n}  \n",wave_fs:"uniform sampler2D diffuseTexture; \nuniform vec3 uniform_eyepos; \nuniform vec4 waveFSData[2]; \nuniform mat4 uniform_NormalMatrix; \nvec4 diffuseColor ; \nvoid main(void){ \nvec3 ViewDir = (mat3(uniform_NormalMatrix)*(uniform_eyepos.xyz - varying_ViewPose.xyz)) ; \ndiffuseColor.xyz = vec3(1.0,1.0,1.0) ; \nvec3 shallowWaterColor = waveFSData[0].xyz * waveFSData[0].w ; \nvec3 deepWaterColor = waveFSData[1].xyz * waveFSData[1].w; \nfloat facing = clamp(dot( -normalize(ViewDir),normal),0.0,1.0); \nvec3 waterColor = mix(shallowWaterColor,deepWaterColor,facing); \ndiffuseColor.xyz *= waterColor ; \n}  \n",wave_vs:"#define VERTEX_TEXTURES \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nvarying vec3 varying_ViewDir ; \nuniform mat4 uniform_NormalMatrix; \nuniform vec3 waveVSData[4]; \nuniform float time ; \nstruct wave{ \nvec3 wave_xyz_intensity_0 ; \nvec3 wave_xyz_intensity_1 ; \nvec3 wave_xyz_speed_0 ; \nvec3 wave_xyz_speed_1 ; \n}; \nconst float pi = 3.14 ; \nvec3 calcWave2( float t , vec3 x, float amplitude, float waveLength ,float angularVelocity ,  vec3 waveDir ){ \nangularVelocity = angularVelocity * 0.1; \nvec3 waveVector = waveDir ; \nfloat waveNumber = pi / waveLength; \nwaveVector *= waveNumber ; \nvec3 temp ; \nfloat kDotX0SubWt = dot(waveVector , x ) - angularVelocity * t  * 0.001; \nfloat A = amplitude * sin(kDotX0SubWt) ; \ntemp.xz = waveDir.xz * A ; \ntemp.y += amplitude * cos(kDotX0SubWt); \ntemp = x - temp ; \nreturn temp ; \n} \nvoid main(void){ \nwave wa ; \nwa.wave_xyz_intensity_0 = vec3(waveVSData[0]) ; \nwa.wave_xyz_intensity_1 = vec3(waveVSData[1]) ; \nwa.wave_xyz_speed_0 = vec3(waveVSData[2]) ; \nwa.wave_xyz_speed_1 = vec3(waveVSData[3]) ; \nfloat tempTime = mod( time , 1000000.0 ); \nvec3 newPose1 = calcWave2(tempTime,e_position,60.0, 500.0, 20.0,vec3(1.0,0.0,1.0)); \nnewPose1 += calcWave2(tempTime,e_position,130.0, 50.0, 20.0,vec3(1.0,0.0,-0.5)); \nnewPose1 += calcWave2(tempTime,e_position,90.0, 80.0, 20.0,vec3(1.0,0.0,-1.5)); \ne_position = newPose1 ; \nmat3 normalMatrix = mat3(uniform_NormalMatrix); \nvarying_eyeNormal = normalize(-attribute_normal); \nvarying_ViewPose = vec4(e_position, 1.0) ; \nvarying_ViewDir = ((uniform_eyepos.xyz - e_position)) ; \noutPosition = uniform_ModelViewMatrix * vec4(e_position, 1.0) ; \nvarying_color = attribute_color ; \n}  \n"},t}();t.ShaderLib=e}(egret3d||(egret3d={})),function(r){var t=function(){function t(){}return t.register=function(t){this.context=t},t.getGPUShader=function(t,e,i){var a=this.vsShaderHashMap.getValue(e);return a||(a=this.fsShaderHashMap.getValue(e)),a||(t==r.Shader.vertex?((a=this.context.creatVertexShader(i)).id=e,this.vsShaderHashMap.add(e,a)):t==r.Shader.fragment&&((a=this.context.creatFragmentShader(i)).id=e,this.fsShaderHashMap.add(e,a))),a},t.getProgram=function(t,e){var i,a=this.vsShaderHashMap.getValue(t),r=this.fsShaderHashMap.getValue(e),n=a.id+"_"+r.id;return this.programlib.isHas(n)?i=this.programlib.getValue(n):(i=this.registerProgram(a,r),this.programlib.add(n,i)),this.programlib.getValue(n)},t.unRegisterShader=function(t){},t.registerProgram=function(t,e){return this.context.creatProgram(t,e)},t.unRegisterProgram=function(t,e){},t.programlib=new r.HashMap,t.vsShaderHashMap=new r.HashMap,t.fsShaderHashMap=new r.HashMap,t}();r.ShaderPool=t}(egret3d||(egret3d={})),function(t){var e,i;e=t.GLSL||(t.GLSL={}),i=function(){function a(){this.name="",this.source="",this.funcNames=new Array,this.funcDict={},this.structDict={},this.structNames=new Array,this.attributeList=new Array,this.varyingList=new Array,this.uniformList=new Array,this.constList=new Array,this.tempList=new Array,this.sampler2DList=new Array,this.sampler3DList=new Array,this.extensionList=new Array}return a.prototype.addVar=function(t){"attribute"==t.key?this.attributeList.push(t):"varying"==t.key?this.varyingList.push(t):"uniform"==t.key?this.uniformList.push(t):"const"==t.key?this.constList.push(t):"sampler2D"==t.key?this.sampler2DList.push(t):"samplerCube"==t.key?this.sampler3DList.push(t):"#extension"==t.key?this.extensionList.push(t):this.tempList.push(t)},a.prototype.addFunc=function(t,e){if(this.funcDict[t]){var i=this.mergeMainFunc(this.funcDict[t],e);this.funcDict[t]=i}else this.funcDict[t]=e,this.funcNames.push(t);if(this.funcDict.main){var a=this.funcNames.indexOf("main");this.funcNames.splice(a,1),this.funcNames.push("main")}},a.prototype.addStruct=function(t,e){this.structDict[t]?console.log("<"+t+">struct重复"):(this.structDict[t]=e,this.structNames.push(t))},a.prototype.addContent=function(t){for(var e=0;e<t.structNames.length;++e)this.addStruct(t.structNames[e],t.structDict[t.structNames[e]]);for(e=0;e<t.funcNames.length;++e)this.addFunc(t.funcNames[e],t.funcDict[t.funcNames[e]]);for(e=0;e<t.attributeList.length;++e){for(var i=!0,a=0;a<this.attributeList.length;++a)if(t.attributeList[e].name==this.attributeList[a].name){t.attributeList[e].valueType!=this.attributeList[a].valueType||(t.attributeList[e].key,this.attributeList[a].key),i=!1;break}i&&this.attributeList.push(t.attributeList[e].clone())}for(e=0;e<t.varyingList.length;++e){for(i=!0,a=0;a<this.varyingList.length;++a)if(t.varyingList[e].name==this.varyingList[a].name){t.varyingList[e].valueType!=this.varyingList[a].valueType||(t.varyingList[e].key,this.varyingList[a].key),i=!1;break}i&&this.varyingList.push(t.varyingList[e].clone())}for(e=0;e<t.uniformList.length;++e){for(i=!0,a=0;a<this.uniformList.length;++a)if(t.uniformList[e].name==this.uniformList[a].name){t.uniformList[e].valueType!=this.uniformList[a].valueType||(t.uniformList[e].key,this.uniformList[a].key),i=!1;break}i&&this.uniformList.push(t.uniformList[e].clone())}for(e=0;e<t.constList.length;++e){for(i=!0,a=0;a<this.constList.length;++a)if(t.constList[e].name==this.constList[a].name){t.constList[e].valueType!=this.constList[a].valueType||(t.constList[e].key,this.constList[a].key),i=!1;break}i&&this.constList.push(t.constList[e].clone())}for(e=0;e<t.tempList.length;++e){for(i=!0,a=0;a<this.tempList.length;++a)if(t.tempList[e].name==this.tempList[a].name){t.tempList[e].valueType!=this.tempList[a].valueType||(t.tempList[e].key,this.tempList[a].key),i=!1;break}i&&this.tempList.push(t.tempList[e].clone())}for(e=0;e<t.sampler2DList.length;++e){for(i=!0,a=0;a<this.sampler2DList.length;++a)if(t.sampler2DList[e].name==this.sampler2DList[a].name){t.sampler2DList[e].valueType!=this.sampler2DList[a].valueType||(t.sampler2DList[e].key,this.sampler2DList[a].key),i=!1;break}i&&this.sampler2DList.push(t.sampler2DList[e].clone())}for(e=0;e<t.sampler3DList.length;++e){for(i=!0,a=0;a<this.sampler3DList.length;++a)if(t.sampler3DList[e].name==this.sampler3DList[a].name){t.sampler2DList[e].valueType!=this.sampler3DList[a].valueType||(t.sampler3DList[e].key,this.sampler3DList[a].key),i=!1;break}i&&this.sampler3DList.push(t.sampler3DList[e].clone())}for(e=0;e<t.extensionList.length;++e){for(i=!0,a=0;a<this.extensionList.length;++a)if(t.extensionList[e].name==this.extensionList[a].name){i=!1;break}i&&this.extensionList.push(t.extensionList[e].clone())}},a.prototype.mergeMainFunc=function(t,e){var i,a=t,r=e.indexOf("{"),n=e.lastIndexOf("}");r++,i=e.slice(r,n),r=a.lastIndexOf("}");var o=a.substr(0,r),s=a.substr(r,a.length-r);a=o,a+=i;return(a+="")+s},a.prototype.clone=function(){var t=new a;t.name=this.name,t.source=this.source;for(var e=0;e<this.funcNames.length;++e)t.funcNames.push(this.funcNames[e]);for(var i in this.funcDict)t.funcDict[i]=this.funcDict[i];for(e=0;e<this.structNames.length;++e)t.structNames.push(this.structNames[e]);for(var i in this.structDict)t.structDict[i]=this.structDict[i];for(e=0;e<this.attributeList.length;++e)t.attributeList.push(this.attributeList[e].clone());for(e=0;e<this.varyingList.length;++e)t.varyingList.push(this.varyingList[e].clone());for(e=0;e<this.uniformList.length;++e)t.uniformList.push(this.uniformList[e].clone());for(e=0;e<this.constList.length;++e)t.constList.push(this.constList[e].clone());for(e=0;e<this.tempList.length;++e)t.tempList.push(this.tempList[e].clone());for(e=0;e<this.sampler2DList.length;++e)t.sampler2DList.push(this.sampler2DList[e].clone());for(e=0;e<this.sampler3DList.length;++e)t.sampler3DList.push(this.sampler3DList[e].clone());for(e=0;e<this.attributeList.length;++e)t.attributeList.push(this.attributeList[e].clone());for(e=0;e<this.extensionList.length;++e)t.extensionList.push(this.extensionList[e].clone());return t},a}(),e.ShaderContent=i}(egret3d||(egret3d={})),function(v){var t=function(){function u(){this._shaderContentDict=[],this.vs_begin="##define vs begin##",this.vs_end="##define vs end##",this.fs_begin="##define fs begin##",this.fs_end="##define fs end##"}return Object.defineProperty(u,"instance",{get:function(){return this._instance||(this._instance=new u),this._instance},enumerable:!0,configurable:!0}),u.prototype.load=function(){var t=[],e=[];for(var i in v.ShaderLib.lib){var a=v.ShaderLib.lib[i].indexOf(this.vs_begin),r=v.ShaderLib.lib[i].indexOf(this.vs_end),n=!1;-1!=a&&(n=!0,a+=this.vs_begin.length,t.push(i),e[i+"vs"]=v.ShaderLib.lib[i].substr(a,r-a)),a=v.ShaderLib.lib[i].indexOf(this.fs_begin),r=v.ShaderLib.lib[i].indexOf(this.fs_end),-1!=a&&(a+=this.fs_begin.length,n&&t.push(i),e[i+"fs"]=v.ShaderLib.lib[i].substr(a,r-a))}for(var i in t)delete v.ShaderLib.lib[t[i]];for(var i in e)v.ShaderLib.lib[i]=e[i];for(var i in v.ShaderLib.lib){var o=this.readShader(v.ShaderLib.lib[i]);(this._shaderContentDict[i]=o).name=i}},u.prototype.readShader=function(t){for(var e=new v.GLSL.ShaderContent,i=v.StringUtil.processShaderFile(t),a=v.StringUtil.parseContent(i).concat();0<a.length;){var r=a[0];a.shift();var n=v.StringUtil.getLineType(r);if(-1==n.indexOf("struct"))if(-1==n.indexOf("function"))if(-1==n.indexOf("unknown"));else{var o=v.StringUtil.parseLines(r),s=v.StringUtil.getVarKey(o),h=v.StringUtil.getVarType(o);if("sampler2D"==h){var l=v.StringUtil.getSampler2D(r);l&&e.addVar(l)}else if("samplerCube"==h){var u=v.StringUtil.getSampler3D(r);u&&e.addVar(u)}else if("attribute"==s){var c=v.StringUtil.getAttribute(r);c&&e.addVar(c)}else if("varying"==s){var d=v.StringUtil.getVarying(r);d&&e.addVar(d)}else if("uniform"==s){var p=v.StringUtil.getUniform(r);p&&e.addVar(p)}else if("const"==s){var _=v.StringUtil.getConst(r);_&&e.addVar(_)}else if("#extension"==s){var f=v.StringUtil.getExtension(r);f&&e.addVar(f)}else e.addVar(v.StringUtil.getTemper(r))}else{o=n.split(" ");var m=r;e.addFunc(o[1],m)}else{o=n.split(" ");var g=r;e.addStruct(o[1],g),v.StringUtil.processStruct(o[1],g,e)}}return e},u.prototype.fillShaderContent=function(t,e,i){var a,r,n=0,o="";for(n=0;n<e.length;++n)""!=o&&(o+="/"),o+=e[n];if(o+="/d"+i.maxDirectLight,o+="/s"+i.maxSpotLight,o+="/p"+i.maxPointLight,o+="/b"+i.maxBone,this._shaderContentDict[o])a=this._shaderContentDict[o].clone();else for((a=new v.GLSL.ShaderContent).name=o,n=0;n<e.length;++n){var s=this._shaderContentDict[e[n]];a.addContent(s)}for(n=0;n<a.attributeList.length;n++)i[o=a.attributeList[n].varName]=a.attributeList[n];for(n=0;n<a.varyingList.length;n++)i[o=a.varyingList[n].varName]||(i[o]=a.varyingList[n]);for(n=0;n<a.tempList.length;n++)i[o=a.tempList[n].varName]=a.tempList[n];for(n=0;n<a.uniformList.length;n++)i[o=a.uniformList[n].varName]=a.uniformList[n];for(n=0;n<a.constList.length;n++)switch(o=a.constList[n].varName,r=a.constList[n],i[o]=r,o){case"max_directLight":r.value=i.maxDirectLight;break;case"max_spotLight":r.value=i.maxSpotLight;break;case"max_pointLight":r.value=i.maxPointLight;break;case"bonesNumber":t.maxBone=i.maxBone,r.value=i.maxBone}for(n=0;n<a.sampler2DList.length;n++){var h=a.sampler2DList[n];h.index=n,i.sampler2DList.push(h),h.activeTextureIndex=u.getTexture2DIndex(n)}for(n=0;n<a.sampler3DList.length;n++){var l=a.sampler3DList[n];l.activeTextureIndex=u.getTexture2DIndex(a.sampler2DList.length+n),l.index=a.sampler2DList.length+n,i.sampler3DList.push(l)}return this.synthesisShader(a,t),v.ShaderPool.getGPUShader(t.shaderType,a.name,a.source)},u.prototype.synthesisShader=function(t,e){var i,a="";for(i=0;i<t.extensionList.length;i++)a+=u.connectExtension(t.extensionList[i]);for(a+="precision highp float;            \t\n",i=0;i<t.attributeList.length;i++)a+=u.connectAtt(t.attributeList[i]);for(i=0;i<t.structNames.length;i++)a+=u.connectStruct(t.structDict[t.structNames[i]]);for(i=0;i<t.varyingList.length;i++)a+=u.connectVarying(t.varyingList[i]);for(i=0;i<t.tempList.length;i++)a+=u.connectTemp(t.tempList[i]);for(i=0;i<t.constList.length;i++)a+=u.connectConst(t.constList[i]);for(i=0;i<t.uniformList.length;i++)a+=u.connectUniform(t.uniformList[i]);for(i=0;i<t.sampler2DList.length;i++){var r=t.sampler2DList[i];a+=u.connectSampler(r)}for(i=0;i<t.sampler3DList.length;i++){var n=t.sampler3DList[i];a+=u.connectSampler3D(n)}for(i=0;i<t.funcNames.length;i++)a+=t.funcDict[t.funcNames[i]];t.source=a},u.connectAtt=function(t){return"attribute "+t.valueType+" "+t.name+"; \r\n"},u.connectTemp=function(t){return""!=t.value?t.valueType+" "+t.name+" = "+t.value+"; \r\n":t.valueType+" "+t.name+"; \r\n"},u.connectStruct=function(t){return t+" \r\n"},u.connectConst=function(t){return"const "+t.valueType+" "+t.name+" = "+t.value+"; \r\n"},u.connectVarying=function(t){return"varying "+t.valueType+" "+t.name+"; \r\n"},u.connectUniform=function(t){return"uniform "+t.valueType+" "+t.name+"; \r\n"},u.connectSampler=function(t){return"uniform sampler2D "+t.name+"; \r\n"},u.connectSampler3D=function(t){return"uniform samplerCube "+t.name+"; \r\n"},u.connectExtension=function(t){return"#extension "+t.name+":"+t.value+"\r\n"},u.getTexture2DIndex=function(t){switch(t){case 0:return v.ContextSamplerType.TEXTURE_0;case 1:return v.ContextSamplerType.TEXTURE_1;case 2:return v.ContextSamplerType.TEXTURE_2;case 3:return v.ContextSamplerType.TEXTURE_3;case 4:return v.ContextSamplerType.TEXTURE_4;case 5:return v.ContextSamplerType.TEXTURE_5;case 6:return v.ContextSamplerType.TEXTURE_6;case 7:return v.ContextSamplerType.TEXTURE_7;case 8:return v.ContextSamplerType.TEXTURE_8}throw new Error("texture not big then 8")},u._shaderLibs={},u._methodLibs={},u}();v.ShaderUtil=t}(egret3d||(egret3d={})),function(i){var t=function(){function t(){this.distance=2e3,this.dir=new i.Vector3D(0,-1,-1),this.init()}return Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.enableShadow=function(t){this._enable=t},t.prototype.init=function(){this.shadowRender=[]},t.prototype.castShadowLight=function(){this.shadowRender.push(new i.MultiRender(i.PassType.shadowPass)),this.shadowCamera=new i.Camera3D,this.shadowCamera.lookAt(new i.Vector3D(0,1e3,-1e3),new i.Vector3D(0,0,0)),this.shadowRender[this.shadowRender.length-1].setRenderToTexture(512,512)},t.prototype.calculateCamera=function(t,e){i.MathUtil.CALCULATION_VECTOR3D.copyFrom(this.dir),i.MathUtil.CALCULATION_VECTOR3D.normalize(),i.MathUtil.CALCULATION_VECTOR3D.negate(),i.MathUtil.CALCULATION_VECTOR3D.scaleBy(this.distance),e.lookAt(i.MathUtil.CALCULATION_VECTOR3D,t.position)},t._enable=!1,t}();i.ShadowCast=t}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.apply(this,arguments),this.vertex_ShaderName={},this.fragment_ShaderName={},this.attributes=new Array}return __extends(e,t),e.prototype.build=function(t,e){},e.prototype.initNode=function(t,e){},e.prototype.update=function(t,e,i){},e.prototype.activeState=function(t,e,i,a,r,n,o){},e.prototype.upload=function(){},e}(t.EventDispatcher);t.AnimationNode=e}(egret3d||(egret3d={})),function(t){var e=function(){};(egret3d||(egret3d={})).AnimationCurve=e}(),function(e){var t=function(t){function a(){t.call(this),this._timeEvent=new e.Event3D,this._times=new Array,this._processTimes=new Array,this._timer=0,this._start=!1}return __extends(a,t),a.prototype.start=function(){this._timer=0,this._start=!0;for(var t=this._processTimes.length=0;t<this._times.length;++t)this._processTimes[t]=this._times[t]},a.prototype.addTimerAxis=function(t){this._times.push(t)},a.prototype.clearTimerAxis=function(){this._times.length=0,this._processTimes.length=0},a.prototype.reset=function(){this._processTimes.length=0,this._timer=0,this._start=!1;for(var t=0;t<this._times.length;++t)this._processTimes[t]=this._times[t]},a.prototype.update=function(t,e){if(this._start){this._timer+=t,console.log(this._timer+"update");for(var i=0;i<this._processTimes.length;++i)if(this._timer>=this._processTimes[i]){this._timeEvent.eventType=a.TIME_EVENT,this._timeEvent.data=this._processTimes[i],this.dispatchEvent(this._timeEvent),this._processTimes.splice(i,1);break}}},a.TIME_EVENT="TimeEvent",a}(e.EventDispatcher);e.TimerAxis=t}(egret3d||(egret3d={})),function(e){var t;(t=e.CurveType||(e.CurveType={}))[t.Line=0]="Line",t[t.BesselCurve=1]="BesselCurve";var i=e.CurveType,a=function(){function t(){this.type=i.Line,this.start=new e.Point,this.end=new e.Point,this.c1=new e.Point,this.c2=new e.Point,this.cache=null,this.useCache=!1}return t.prototype.calculateValue=function(t){if(t<this.start.x||t>this.end.x)return 0;if(this.useCache)return this.cache[Math.floor(t-this.start.x)];switch(this.type){case i.Line:return this.valueFromLine(t);case i.BesselCurve:return this.valueFromBesselCurve(t)}return 0},t.prototype.valueFromLine=function(t){var e=(t-this.start.x)/(this.end.x-this.start.x);return this.start.y+e*(this.end.y-this.start.y)},t.prototype.valueFromBesselCurve=function(t){var e=(t-this.start.x)/(this.end.x-this.start.x),i=1-e,a=i*i,r=a*i;return this.start.y*r+3*this.c1.y*e*a+3*this.c2.x*e*e*i+this.end.y*e*e*e},t.prototype.cacheCurveData=function(){this.cache=[];for(var t=this.start.x;t<this.end.x;t++)this.cache.push(this.calculateValue(t));this.useCache=!0},t}();e.AnimCurve=a}(egret3d||(egret3d={})),function(h){var t=function(t){function e(){t.call(this),this.speed=1,this.isLoop=!0,this._propertyArray=[],this._play=!1,this._timePosition=0,this._totalTime=0,this._changeFrameTime=0,this._oldFrameIndex=0,this._event3D=new h.Event3D}return __extends(e,t),e.prototype.IsExist=function(t){for(var e=0;e<this._propertyArray.length;e++)if(this._propertyArray[e].property==t)return!0;return!1},e.prototype.addAnimCurve=function(t,e){if(this.IsExist(t))return!1;if(null==e||e.length<=0)return!1;var i=new r;i.keyFrames=e,i.property=t,i.target=this._target,i.isLoop=!0,i.timePosition=0,this._propertyArray.push(i);for(var a=0;a<e.length;a++)e[a].end.x>this._totalTime&&(this._totalTime=e[a].end.x,e[a].cacheCurveData());this.updateBindData(i)},e.prototype.removeAnimCurve=function(t){for(var e=null,i=0;i<this._propertyArray.length;i++)if(this._propertyArray[i].property==t)return e=this._propertyArray[i],this._propertyArray.splice(i,1),e.keyFrames},e.prototype.setPropertyLoop=function(t,e){for(var i=0;i<this._propertyArray.length;i++)if(this._propertyArray[i].property==t){this._propertyArray[i].isLoop=e;break}},e.prototype.bindObject3D=function(t){this._target=t;for(var e=0;e<this._propertyArray.length;e++)this.updateBindData(this._propertyArray[e])},e.prototype.updateBindData=function(t){if(this._target){t.target=this._target;for(var e=t.property.split("."),i=0;i<e.length-1;i++)t.target=t.target[e[i]];t.name=e[e.length-1]}},e.prototype.play=function(){if(!this._play){this._play=!0;for(var t=this._timePosition=0;t<this._propertyArray.length;t++)this._propertyArray[t].timePosition=0}},e.prototype.stop=function(){this._play=!1},Object.defineProperty(e.prototype,"timePosition",{get:function(){return this._timePosition},set:function(t){if(t!=this._timePosition){var e=t-this._timePosition;if(this._timePosition=t,this.isLoop?(this._timePosition=t%this._totalTime,this._timePosition<0&&(this._timePosition+=this._totalTime)):this._timePosition<0?(this._timePosition=0,this._event3D.eventType=h.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,(this._event3D.target=this).dispatchEvent(this._event3D),this.stop()):this._timePosition>this._totalTime&&(this._timePosition=this._totalTime,this._event3D.eventType=h.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,(this._event3D.target=this).dispatchEvent(this._event3D),this.stop()),this._target)for(var i,a,r=0;r<this._propertyArray.length;r++){a=(i=this._propertyArray[r]).keyFrames;var n=i.timePosition+e;if(n!=i.timePosition){var o=a[a.length-1].end.x;if(i.timePosition=n,i.isLoop)i.timePosition=t%o,i.timePosition<0&&(i.timePosition+=o);else{if(i.timePosition<0){i.timePosition=0;continue}if(i.timePosition>o){i.timePosition=o;continue}}for(var s=0;s<a.length-1;s++)if(a[s].start.x<=i.timePosition&&a[s].end.x>i.timePosition){i.target[i.name]=a[s].calculateValue(i.timePosition);break}}}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalTime",{get:function(){return this._totalTime},enumerable:!0,configurable:!0}),e.prototype.update=function(t){if(this._play){var e=this.timePosition;this.timePosition+=t*this.speed,this.timePosition<e&&(this._event3D.eventType=h.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,(this._event3D.target=this).dispatchEvent(this._event3D))}},e.prototype.clone=function(){var t=new e;return t._propertyArray=this._propertyArray,t._totalTime=this._totalTime,t},e}(h.EventDispatcher);h.PropertyAnim=t;var r=function(){}}(egret3d||(egret3d={})),function(a){var t=function(){function e(t){this.parent=null,this.name=t,this.parentIndex=-1,this.scale=new a.Vector3D(1,1,1),this.orientation=new a.Quaternion,this.translation=new a.Vector3D,this.localMatrix=new a.Matrix4_4,this.worldMatrix=new a.Matrix4_4,this.worldMatrixValid=!1}return e.prototype.clone=function(){var t=new e(this.name);return t.parent=this.parent,t.parentIndex=this.parentIndex,t.scale.copyFrom(this.scale),t.orientation.copyFrom(this.orientation),t.translation.copyFrom(this.translation),t.localMatrix.copyFrom(this.localMatrix),t.worldMatrix.copyFrom(this.worldMatrix),t.worldMatrixValid=this.worldMatrixValid,t},e.prototype.buildLocalMatrix=function(t,e,i){this.scale.copyFrom(t),this.translation.copyFrom(i),e instanceof a.Vector3D?this.orientation.fromEulerAngles(e.x,e.y,e.z):this.orientation.copyFrom(e),this.localMatrix.makeTransform(this.translation,this.scale,this.orientation)},e.prototype.buildInverseMatrix=function(t,e,i){this.inverseMatrix||(this.inverseMatrix=new a.Matrix4_4),e instanceof a.Vector3D?this.inverseMatrix.recompose([i,e,t]):this.inverseMatrix.makeTransform(i,t,e)},e}();a.Joint=t}(egret3d||(egret3d={})),function(t){var e=function(){function i(){this.joints=[]}return i.prototype.clone=function(){for(var t=new i,e=0;e<this.joints.length;e++)t.joints.push(this.joints[e].clone());return t},Object.defineProperty(i.prototype,"jointNum",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),i.prototype.findJoint=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return this.joints[e];return null},i.prototype.findJointIndex=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return e;return-1},i}();t.Skeleton=e}(egret3d||(egret3d={})),function(u){var t=function(){function l(){this.joints=[]}return l.prototype.clone=function(){var t=new l;t.frameTime=this.frameTime;for(var e=0;e<this.joints.length;e++)t.joints.push(this.joints[e].clone());return t},l.prototype.lerp=function(t,e,i){this.joints=[],this.frameTime=(e.frameTime-t.frameTime)*i+t.frameTime;for(var a=0;a<t.joints.length;++a){var r=t.joints[a],n=e.joints[a],o=new u.Joint(r.name);if(o.name=r.name,o.parent=r.parent,o.parentIndex=r.parentIndex,o.scale.lerp(r.scale,n.scale,i),o.orientation.lerp(r.orientation,n.orientation,i),o.translation.lerp(r.translation,n.translation,i),o.buildLocalMatrix(o.scale,o.orientation,o.translation),o.worldMatrixValid=r.worldMatrixValid,o.worldMatrixValid){var s=r.worldMatrix.decompose(u.Orientation3D.QUATERNION,l._temp_matrixDecomposeA),h=n.worldMatrix.decompose(u.Orientation3D.QUATERNION,l._temp_matrixDecomposeB);l._temp_v0.lerp(s[0],h[0],i),l._temp_q1.x=s[1].x,l._temp_q1.y=s[1].y,l._temp_q1.z=s[1].z,l._temp_q1.w=s[1].w,l._temp_q2.x=h[1].x,l._temp_q2.y=h[1].y,l._temp_q2.z=h[1].z,l._temp_q2.w=h[1].w,l._temp_q0.lerp(l._temp_q1,l._temp_q2,i),l._temp_v1.lerp(s[2],h[2],i),o.worldMatrix.makeTransform(l._temp_v0,l._temp_v1,l._temp_q0)}this.joints.push(o)}return this},l.prototype.calculateJointWorldMatrix=function(){for(var t=0;t<this.joints.length;++t)this.calculateAbsoluteMatrix(t)},l.prototype.calculateAbsoluteMatrix=function(t){var e=this.joints[t];0<=e.parentIndex&&this.calculateAbsoluteMatrix(e.parentIndex),e.worldMatrixValid||(e.worldMatrix.copyFrom(e.localMatrix),0<=e.parentIndex&&e.worldMatrix.append(this.joints[e.parentIndex].worldMatrix),e.worldMatrixValid=!0)},l.prototype.updateGPUCacheData=function(t,e,i){for(var a=0;a<t.joints.length;++a)for(var r=0;r<this.joints.length;++r)if(t.joints[a].name==this.joints[r].name){l._temp_jointMatrix.copyFrom(t.joints[a].inverseMatrix),l._temp_jointMatrix.append(this.joints[r].worldMatrix);var n=l._temp_jointMatrix.decompose(u.Orientation3D.QUATERNION,l._temp_matrixDecomposeA);e[8*a+0]=n[1].x,e[8*a+1]=n[1].y,e[8*a+2]=n[1].z,e[8*a+3]=n[1].w,e[8*a+4]=n[0].x-i.x,e[8*a+5]=n[0].y-i.y,e[8*a+6]=n[0].z-i.z,e[8*a+7]=1;break}return e},l.prototype.findJoint=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return this.joints[e];return null},l.prototype.findJointIndex=function(t){if(""==t)return-1;for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return e;return-1},l.prototype.resetWorldMatrix=function(){for(var t=0;t<this.joints.length;t++)this.joints[t].worldMatrixValid=!1},l._temp_v0=new u.Vector3D,l._temp_v1=new u.Vector3D,l._temp_v2=new u.Vector3D,l._temp_q0=new u.Quaternion,l._temp_q1=new u.Quaternion,l._temp_q2=new u.Quaternion,l._temp_jointMatrix=new u.Matrix4_4,l._temp_matrixDecomposeA=[new u.Vector3D,new u.Vector3D,new u.Vector3D],l._temp_matrixDecomposeB=[new u.Vector3D,new u.Vector3D,new u.Vector3D],l}();u.SkeletonPose=t}(egret3d||(egret3d={})),function(n){var t=function(){function e(){this.poseArray=[],this.animationName="",this.sampling=0,this.boneCount=0,this.frameDataOffset=0,this.sourceData=null,this._frameCount=0,this._timeLength=0,this._skeletonPose=null,this._temp_scale=new n.Vector3D,this._temp_translation=new n.Vector3D,this._temp_orientation=new n.Quaternion}return Object.defineProperty(e.prototype,"currentSkeletonPose",{get:function(){return this._skeletonPose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameCount",{get:function(){return 0<this.poseArray.length?this.poseArray.length:this._frameCount},enumerable:!0,configurable:!0}),e.prototype.findJointIndex=function(t){return this._skeletonPose?this._skeletonPose.findJointIndex(t):this.poseArray.length<=0?-1:this.poseArray[0].findJointIndex(t)},e.prototype.addSkeletonPose=function(t){this.poseArray.push(t)},e.prototype.buildInitialSkeleton=function(t,e,i){if(!this._skeletonPose){this._frameCount=i,this._skeletonPose=new n.SkeletonPose;for(var a=0;a<this.boneCount;a++){var r=new n.Joint(t[a]);r.parent=e[a],r.parentIndex=this._skeletonPose.findJointIndex(r.parent),this._skeletonPose.joints.push(r)}this.sourceData.position=this.frameDataOffset+(40*this.boneCount+4)*(this.frameCount-1),this._timeLength=this.sourceData.readInt()/60/80*1e3}},e.prototype.getSkeletonPose=function(t){return 0<this.poseArray.length?this.poseArray[t]:t<0||t>=2*this.frameCount?null:(t=Math.floor(t/2),this.readSkeletonPose(t,this._skeletonPose))},e.prototype.readSkeletonPose=function(t,e){this.sourceData.position=this.frameDataOffset+(40*this.boneCount+4)*t,e.frameTime=this.sourceData.readInt()/60/80*1e3;for(var i=0;i<this.boneCount;i++)this._temp_orientation.x=this.sourceData.readFloat(),this._temp_orientation.y=this.sourceData.readFloat(),this._temp_orientation.z=this.sourceData.readFloat(),this._temp_orientation.w=this.sourceData.readFloat(),this._temp_scale.x=this.sourceData.readFloat(),this._temp_scale.y=this.sourceData.readFloat(),this._temp_scale.z=this.sourceData.readFloat(),this._temp_translation.x=this.sourceData.readFloat(),this._temp_translation.y=this.sourceData.readFloat(),this._temp_translation.z=this.sourceData.readFloat(),e.joints[i].worldMatrixValid=!1,e.joints[i].buildLocalMatrix(this._temp_scale,this._temp_orientation,this._temp_translation);return e.calculateJointWorldMatrix(),e},Object.defineProperty(e.prototype,"timeLength",{get:function(){return 0<this.poseArray.length?this.poseArray[this.poseArray.length-1].frameTime:this._timeLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jointNum",{get:function(){return 0<this.poseArray.length?this.poseArray[0].joints.length:this.boneCount},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e;return t.animationName=this.animationName,t.poseArray=this.poseArray,t.sampling=this.sampling,t.boneCount=this.boneCount,t.frameCount=this.frameCount,t.frameDataOffset=this.frameDataOffset,t.sourceData=this.sourceData,t._timeLength=this._timeLength,t._skeletonPose=this._skeletonPose,this._skeletonPose&&(t._skeletonPose=this._skeletonPose.clone()),t},e}();n.SkeletonAnimationClip=t}(egret3d||(egret3d={})),function(s){var t=function(){function e(t){this.name="",this.weight=1,this._skeleton=null,this._timeLength=0,this._timePosition=0,this._skeletonAnimation=null,this._skeletonAnimationClip=null,this.name=t}return Object.defineProperty(e.prototype,"skeleton",{get:function(){return this._skeleton},set:function(t){this._skeleton=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skeletonAnimation",{get:function(){return this._skeletonAnimation},set:function(t){this._skeletonAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skeletonAnimationClip",{get:function(){return this._skeletonAnimationClip},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeLength",{get:function(){return this._timeLength},enumerable:!0,configurable:!0}),e.prototype.addAnimationClip=function(t){if(t.sourceData)this._skeletonAnimationClip=t,this._timeLength=this._skeletonAnimationClip.timeLength;else{if(this._skeletonAnimationClip?this._skeletonAnimationClip.poseArray=[]:this._skeletonAnimationClip=new s.SkeletonAnimationClip,t.poseArray.length<2)this._skeletonAnimationClip.poseArray=t.poseArray;else{var e=t.poseArray[0],i=t.poseArray[1],a=Math.round((i.frameTime-e.frameTime)/s.SkeletonAnimation.fps);if(a<=1)this._skeletonAnimationClip.poseArray=t.poseArray;else{for(var r=1;r<t.poseArray.length;++r){e=t.poseArray[r-1],i=t.poseArray[r];for(var n=0;n<a;n++){var o=new s.SkeletonPose;o.lerp(e,i,n/a),this._skeletonAnimationClip.poseArray.push(o)}}this._skeletonAnimationClip.poseArray.push(t.poseArray[t.poseArray.length-1].clone())}}this._timeLength=this._skeletonAnimationClip.poseArray[this._skeletonAnimationClip.poseArray.length-1].frameTime}},Object.defineProperty(e.prototype,"timePosition",{get:function(){return this._timePosition},set:function(t){t!=this._timePosition&&(this._timePosition=t,this._skeletonAnimation.isLoop?(this._timePosition=t%this._timeLength,this._timePosition<0&&(this._timePosition+=this._timeLength)):this._timePosition<0?(this._timePosition=0,this.name==this._skeletonAnimation.currentAnimName&&(this._skeletonAnimation.stop(),this._skeletonAnimation.event3D.target=this._skeletonAnimation,this._skeletonAnimation.event3D.eventType=s.SkeletonAnimationEvent3D.EVENT_PLAY_COMPLETE,this._skeletonAnimation.dispatchEvent(this._skeletonAnimation.event3D))):this._timePosition>this._timeLength&&(this._timePosition=this._timeLength,this.name==this._skeletonAnimation.currentAnimName&&(this._skeletonAnimation.stop(),this._skeletonAnimation.event3D.target=this._skeletonAnimation,this._skeletonAnimation.event3D.eventType=s.SkeletonAnimationEvent3D.EVENT_PLAY_COMPLETE,this._skeletonAnimation.dispatchEvent(this._skeletonAnimation.event3D))))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentSkeletonPose",{get:function(){return this._skeletonAnimationClip.getSkeletonPose(this.currentFrameIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameIndex",{get:function(){return Math.floor(this._timePosition/s.SkeletonAnimation.fps)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameNum",{get:function(){return this._skeletonAnimationClip?this._skeletonAnimationClip.frameCount:0},enumerable:!0,configurable:!0}),e.prototype.getSkeletonPose=function(t){return this._skeletonAnimationClip.getSkeletonPose(t)},e.prototype.clone=function(){var t=new e(this.name);return t._skeleton=this._skeleton,t._timeLength=this._timeLength,t._skeletonAnimation=this._skeletonAnimation,t._skeletonAnimationClip=this._skeletonAnimationClip,t},e}();s.SkeletonAnimationState=t}(egret3d||(egret3d={})),function(h){var t=function(i){function s(t){i.call(this),this.speed=1,this.event3D=new h.Event3D,this.isLoop=!0,this._isPlay=!1,this._animTime=0,this._skeleton=null,this._animStateNames=[],this._animStates=[],this._skeletonMatrixData=null,this._blendSpeed=300,this._blendSkeleton=null,this._blendList=[],this._bindList={},this._temp_quat=new h.Quaternion,this._temp_vec3=new h.Vector3D,this._currentFrame=0,this._changeFrameTime=0,this._oldFrameIndex=0,this._movePosIndex=-1,this._movePosObject3D=null,this._movePosition=new h.Vector3D,this._resetMovePos=!0,this._isPlay=!1,this._skeleton=t,this._skeletonMatrixData=new Float32Array(8*this._skeleton.jointNum);for(var e=0;e<this._skeleton.jointNum;++e)this._skeletonMatrixData[8*e+3]=1,this._skeletonMatrixData[8*e+7]=1}return __extends(s,i),s.prototype.addSkeletonAnimationClip=function(t){var e=new h.SkeletonAnimationState(t.animationName);e.skeletonAnimation=this,e.skeleton=this._skeleton,e.addAnimationClip(t),this.addAnimState(e)},Object.defineProperty(s.prototype,"skeletonAnimationController",{get:function(){return this},enumerable:!0,configurable:!0}),s.prototype.addAnimState=function(t){for(var e=0;e<this._animStates.length;e++)if(this._animStates[e].name==t.name)return;t.skeleton=this._skeleton,this._animStates.push(t),this._animStateNames.push(t.name)},s.prototype.removeAnimState=function(t){for(var e=0;e<this._animStates.length;e++)if(this._animStates[e].name==t.name)return t.skeleton=null,this._animStates.slice(e,1),void this._animStateNames.slice(e,1)},s.prototype.play=function(t,e,i,a){if(void 0===e&&(e=1),void 0===i&&(i=!0),void 0===a&&(a=!0),!(this._animStates.length<=0)){t||(t=this._animStates[0].name);for(var r=null,n=0;n<this._animStates.length;n++)if(this._animStates[n].name==t){r=this._animStates[n];break}r&&(this._currentAnimName=t,this._blendList.push(r),r.weight=1<this._blendList.length?0:1,i&&(this._animTime=r.timePosition=0),this._changeFrameTime=r.timePosition,this._oldFrameIndex=Math.floor(this._changeFrameTime/s.fps),this.speed=e,this._isPlay=!0,this._resetMovePos=!0,-1!=this._movePosIndex&&this._movePosition.copyFrom(r.getSkeletonPose(0).joints[this._movePosIndex].worldMatrix.position))}},s.prototype.pause=function(){this._isPlay=!1},s.prototype.stop=function(){this._isPlay=!1},s.prototype.update=function(t,e,i){if(this._isPlay&&!(this._blendList.length<=0)){var a=this._blendList[this._blendList.length-1],r=e*this.speed;this._changeFrameTime+=r;for(var n=Math.floor(Math.abs(this._changeFrameTime/s.fps)),o=0;o<n;++o)this.event3D.eventType=h.SkeletonAnimationEvent3D.EVENT_FRAME_CHANGE,this.event3D.target=this,r<0?(this.event3D.data=(this._oldFrameIndex-1-o)%a.frameNum,this.event3D.data<0&&(this.event3D.data+=a.frameNum)):this.event3D.data=(this._oldFrameIndex+1+o)%a.frameNum,this.dispatchEvent(this.event3D),this._changeFrameTime+=0<r?-s.fps:s.fps;this._oldFrameIndex=this.event3D.data,this.animTime+=e*this.speed}},s.prototype.activeState=function(t,e,i,a,r,n,o){i.uniform_time&&r.uniform1f(i.uniform_time.uniformIndex,this.animTime),r.uniform4fv(i.uniform_PoseMatrix.uniformIndex,this._skeletonMatrixData)},s.prototype.clone=function(){var t=new s(this._skeleton);t._blendSpeed=this._blendSpeed,t.isLoop=this.isLoop,t._animStateNames=this._animStateNames.concat([]);for(var e=0;e<this._animStates.length;e++)t._animStates.push(this._animStates[e].clone());return t},Object.defineProperty(s.prototype,"jointNum",{get:function(){return this._skeleton.joints.length},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animStateNames",{get:function(){return this._animStateNames},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animStates",{get:function(){return this._animStates},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animTime",{get:function(){return this._animTime},set:function(t){if(!(this._blendList.length<=0)&&this._blendList[this._blendList.length-1].timePosition!=t){var e=t-this._animTime;if(this._blendSpeed<=0)1<this._blendList.length&&this._blendList.splice(0,this._blendList.length-1),this._blendList[0].weight=1,this._blendList[0].timePosition+=e;else{for(var i=Math.abs(e/this._blendSpeed),a=0;a<this._blendList.length;++a){var r=this._blendList[a];if(a!=this._blendList.length-1){if(r.weight=Math.max(0,r.weight-i),r.weight<=0){this._blendList.splice(a,1),--a;continue}}else r.weight=Math.min(1,r.weight+i)}this._blendList[this._blendList.length-1].timePosition+=e}this._animTime=this._blendList[this._blendList.length-1].timePosition;var n=this._blendList[0].currentSkeletonPose;if(this._blendList.length<=1)this.updateBindList(n),this.updateMovePos(n),n.updateGPUCacheData(this._skeleton,this._skeletonMatrixData,this._movePosition);else{var o=this._blendList[1],s=o.currentSkeletonPose;this._blendSkeleton||(this._blendSkeleton=n.clone()),this._blendSkeleton.lerp(n,s,o.weight),this._blendSkeleton.resetWorldMatrix(),this._blendSkeleton.calculateJointWorldMatrix(),this.updateBindList(this._blendSkeleton),this.updateMovePos(this._blendSkeleton),this._blendSkeleton.updateGPUCacheData(this._skeleton,this._skeletonMatrixData,this._movePosition)}}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"timeLength",{get:function(){return this._blendList.length<=0?0:this._blendList[this._blendList.length-1].timeLength},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"frameIndex",{get:function(){return this.animTime/s.fps},set:function(t){this.animTime=t*s.fps},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"blendSpeed",{get:function(){return this._blendSpeed},set:function(t){this._blendSpeed=Math.max(t,0)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentAnimName",{get:function(){return this._currentAnimName},enumerable:!0,configurable:!0}),s.prototype.isPlay=function(){return this._isPlay},s.prototype.bindToJointPose=function(t,e){var i=this._animStates[0].skeletonAnimationClip.findJointIndex(t);if(i<0)return!1;var a=null;return this._bindList[i]?a=this._bindList[i]:(a=new Array,this._bindList[i]=a),a.push(e),!0},s.prototype.setMovePosJointName=function(t,e){var i=this._animStates[0].skeletonAnimationClip.findJointIndex(t);return!(i<0)&&(this._movePosIndex=i,this._movePosObject3D=e,this._resetMovePos=!0)},s.prototype.updateBindList=function(t){var e=null,i=null,a=null;for(var r in this._bindList)if(!((e=this._bindList[r]).length<=0)&&(i=t.joints[r]))for(var n=0;n<e.length;n++)a=e[n],this._temp_quat.fromMatrix(i.worldMatrix),this._temp_quat.toEulerAngles(this._temp_vec3),a.rotationX=this._temp_vec3.x,a.rotationY=this._temp_vec3.y,a.rotationZ=this._temp_vec3.z,a.x=i.worldMatrix.position.x,a.y=i.worldMatrix.position.y,a.z=i.worldMatrix.position.z},s.prototype.updateMovePos=function(t){var e=null;-1!=this._movePosIndex&&(e=t.joints[this._movePosIndex],this._resetMovePos?this._resetMovePos=!1:this._movePosObject3D&&(this._movePosition.x=e.worldMatrix.position.x-this._movePosition.x,this._movePosition.y=0,this._movePosition.z=e.worldMatrix.position.z-this._movePosition.z,this._movePosObject3D.orientation.transformVector(this._movePosition,this._movePosition),this._movePosObject3D.x-=this._movePosition.x,this._movePosObject3D.z-=this._movePosition.z),this._movePosition.copyFrom(e.worldMatrix.position))},s.fps=1e3/60,s}(h.EventDispatcher);h.SkeletonAnimation=t}(egret3d||(egret3d={})),function(i){var t=function(){function t(t,e){this.volume=1,this.loop=!1,this.pitch=1,(e=e||{}).volume&&(this.volume=e.volume),e.loop&&(this.loop=e.loop),e.pitch&&(this.pitch=e.pitch),this.sound=t,this.paused=!1,i.AudioManager.instance.hasAudioContext()?(this.context=i.AudioManager.instance.context,this.startTime=0,this.startOffset=0,this.source=null,this.gain=this.context.createGain()):i.AudioManager.instance.hasAudio()&&this.sound.audio&&(this.source=this.sound.audio.cloneNode(!1),this.source.pause())}return t.prototype.play=function(){if(i.AudioManager.instance.hasAudioContext()){if(this.source)throw new Error("Call stop() before calling play()");if(this.createSource(),!this.source)return;this.startTime=this.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration)}else i.AudioManager.instance.hasAudio&&(this.paused=!1,this.source.play());this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch)},t.prototype.pause=function(){i.AudioManager.instance.hasAudioContext()?this.source&&(this.startOffset+=this.context.currentTime-this.startTime,this.source.stop(0),this.source=null):i.AudioManager.instance.hasAudio()&&this.source&&this.source.pause(),this.paused=!0},t.prototype.unpause=function(){if(i.AudioManager.instance.hasAudioContext()){if(this.source||!this.paused)throw new Error("Call pause() before unpausing.");if(this.createSource(),!this.source)return;this.startTime=this.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration),this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch)}else i.AudioManager.instance.hasAudio()&&this.source.play();this.paused=!1},t.prototype.stop=function(){i.AudioManager.instance.hasAudioContext()?this.source&&(this.source.stop(0),this.startOffset=0,this.source=null):i.AudioManager.instance.hasAudio()&&this.source&&(this.source.pause(),this.source.currentTime=0)},t.prototype.setLoop=function(t){this.source&&(this.source.loop=t)},t.prototype.setVolume=function(t){this.gain?this.gain.gain.value=t*i.AudioManager.instance.volume:this.source&&(this.source.volume=t*i.AudioManager.instance.volume)},t.prototype.setPitch=function(t){i.AudioManager.instance.hasAudioContext()?this.source&&(this.source.playbackRate.value=t):i.AudioManager.instance.hasAudio()&&this.source&&(this.source.playbackRate=t)},t.prototype.isPlaying=function(){return i.AudioManager.instance.hasAudioContext()?!this.paused:i.AudioManager.instance.hasAudio()?!this.source.paused:void 0},t.prototype.getDuration=function(){if(i.AudioManager.instance.hasAudioContext()){if(this.source)return this.source.buffer.duration}else if(i.AudioManager.instance.hasAudio()&&this.source){var t=this.source.duration;if(t==t)return t}return 0},t.prototype.createSource=function(){var t=this;this.sound.buffer&&(this.source=this.context.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this.gain),this.gain.connect(this.context.destination),this.loop&&(this.source.onended=function(){return t.play()}))},t}();i.Channel=t}(egret3d||(egret3d={})),function(o){var t=function(i){function t(t,e){i.call(this,t,e),this._position=new o.Vector3D,this._velocity=new o.Vector3D,o.AudioManager.instance.hasAudioContext()&&(this._panner=this.context.createPanner()),this._maxDistance=1e4,this._minDistance=1,this._rollOffFactor=1,this._listener=new o.Vector3D}return __extends(t,i),Object.defineProperty(t.prototype,"listener",{get:function(){return this._listener},set:function(t){if(this._listener.copyFrom(t),o.AudioManager.instance.hasAudio()&&this.source){var e=this.fallOff(this._listener,this.position,this.minDistance,this.maxDistance,this.rollOffFactor);this.source.volume=this.volume*e}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){if(this._position.copyFrom(t),o.AudioManager.instance.hasAudioContext()&&this._panner.setPosition(t.x,t.y,t.z),o.AudioManager.instance.hasAudio()&&this.source){var e=this.fallOff(this._listener,this.position,this.minDistance,this.maxDistance,this.rollOffFactor);this.source.volume=this.volume*e}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity.copyFrom(t),o.AudioManager.instance.hasAudioContext()&&this._panner.setVelocity(t.x,t.y,t.z)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t,o.AudioManager.instance.hasAudioContext()&&(this._panner.maxDistance=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},set:function(t){this._minDistance=t,o.AudioManager.instance.hasAudioContext()&&(this._panner.refDistance=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rollOffFactor",{get:function(){return this._rollOffFactor},set:function(t){this._rollOffFactor=t,this._panner&&(this._panner.rolloffFactor=t)},enumerable:!0,configurable:!0}),t.prototype.createSource=function(){this.sound.buffer&&(this.source=this.context.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this._panner),this._panner.connect(this.gain),this.gain.connect(this.context.destination))},t.prototype.fallOff=function(t,e,i,a,r){var n=o.Vector3D.distance(t,e);return n<i?1:a<n?0:1-n/(a-i)},t}(o.Channel);o.Channel3d=t}(egret3d||(egret3d={})),function(o){var t=function(r){function n(t,e,i){var a=this;if(void 0===e&&(e=null),void 0===i&&(i=null),r.call(this),this.audio=null,this._event=new o.Event3D,this._success=e,this._error=i,this.isLoaded=!1,o.AudioManager.instance.hasAudioContext())o.AudioManager.instance.isSupported(t,this.audio)?(console.warn("Audio format not supported"),this._event.eventType=n.SOUND_ERROR,(this._event.target=this).dispatchEvent(this._event),i(this)):o.AudioManager.instance.context&&this.loadAudioFile(t);else if(o.AudioManager.instance.hasAudio()){try{this.audio=new Audio}catch(t){return console.warn("No support for Audio element"),this._event.eventType=n.SOUND_ERROR,(this._event.target=this).dispatchEvent(this._event),void(i&&i(this))}o.AudioManager.instance.isSupported(t,this.audio)?(console.warn("Audio format not supported"),this._event.eventType=n.SOUND_ERROR,(this._event.target=this).dispatchEvent(this._event),i&&i(this)):(this.audio.src=t,this.audio.addEventListener("canplaythrough",function(t){return a.oncanplaythrough(t)}),this.audio.addEventListener("ended",function(t){return a.onended(t)}),this.audio.load())}}return __extends(n,r),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),n.prototype.loadAudioFile=function(t){var e=this;null==this.xhr&&(this.xhr=new XMLHttpRequest),this.xhr.open("GET",t,!0),this.xhr.responseType="arraybuffer",this.xhr.onload=function(t){return e.audioLoadend(t)},this.xhr.send()},n.prototype.audioLoadend=function(t){var e=this;o.AudioManager.instance.context.decodeAudioData(this.xhr.response,function(t){return e.decodeSuccessCallback(t)})},n.prototype.decodeSuccessCallback=function(t){this._buffer=t,this._event.eventType=n.SOUND_SUCCESS,(this._event.target=this)._event.data=t,this.dispatchEvent(this._event),this._success&&this._success(this)},n.prototype.onended=function(t){},n.prototype.oncanplaythrough=function(t){this.isLoaded||(this.isLoaded=!0,this._event.eventType=n.SOUND_SUCCESS,(this._event.target=this)._event.data=t,this.dispatchEvent(this._event),this._success&&this._success(this))},n.SOUND_SUCCESS="SoundSuccess",n.SOUND_ERROR="SoundError",n}(o.EventDispatcher);o.Sound=t}(egret3d||(egret3d={})),function(r){var t=function(){function t(){this.volume=1,this.codecs={},this.hasAudioContext()&&"undefined"!=typeof AudioContext&&(this.context=new AudioContext)}return t.prototype.hasAudio=function(){return"undefined"!=typeof Audio},t.prototype.hasAudioContext=function(){return!("undefined"==typeof AudioContext)},t.prototype.isSupported=function(t,e){null==this.codecs&&(null==e&&(e=new Audio),this.codecs={mp3:!!e.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var i=t.match(/^data:audio\/([^;,]+);/i);return i||(i=t.split("?",1)[0].match(/\.([^.]+)$/)),i&&(i=i[1].toLowerCase()),this.codecs[i]},t.prototype.createSound=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),new r.Sound(t,e,i)},t.prototype.playSound=function(t,e){e=e||{};var i=new r.Channel(t,e);return i.play(),i},t.prototype.playSound3d=function(t,e,i){i=i||{};var a=new r.Channel3d(t,i);return a.position=e,i.volume&&(a.volume=i.volume),i.loop&&(a.loop=i.loop),i.maxDistance&&(a.maxDistance=i.maxDistance),i.minDistance&&(a.minDistance=i.minDistance),i.rollOffFactor&&(a.rollOffFactor=i.rollOffFactor),a.play(),a},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t}();r.AudioManager=t}(egret3d||(egret3d={})),function(i){var t=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this._autoUpdate=!0,this._origin=new i.Vector3D(0,0,0),this._target=t,this._lookAtObject=e}return Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(t){this._target!=t&&(this._target=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate!=t&&(this._autoUpdate=t)},enumerable:!0,configurable:!0}),t.prototype.notifyUpdate=function(){},t.prototype.update=function(){},t}();i.ControllerBase=t}(egret3d||(egret3d={})),function(n){var t=function(r){function t(t,e,i,a){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=!1),void 0===a&&(a=!1),r.call(this,t),this._origin=new n.Vector3D(0,0,0),this._lookAtPosition=new n.Vector3D,this._eyesPos=new n.Vector3D,this._up=n.Vector3D.Y_AXIS,this._eyesLength=0,this._rotaEyesLine=new n.Vector3D(0,0,1),this._rotaAngle=new n.Vector3D,this._matRot=new n.Matrix4_4,this._quaRot=new n.Quaternion,this._tempVec=new n.Vector3D,this._matTemp=new n.Matrix4_4,this._mouseDown=!1,this._mouseRightDown=!1,this._screenMoveStartDetail=new n.Point,this._screenMoveDelay=new n.Point,this._isUpdate=!1,this._elapsed=0,this._speed=3,this._xAngle=0,this._ctl=!1,this._alt=!1,this._shift=!1,this._needctl=!1,this._needalt=!1,this._needshift=!1,this._keyArray=new Array,this.lookAtOffset=new n.Vector3D(0,0,0),this.firstCamera=!1,this._needctl=i,this._needalt=a,this._keyArray.push(!1),this._keyArray.push(!1),this._keyArray.push(!1),this._keyArray.push(!1),e?this.lookAtObject=e:this.lookAtPosition=new n.Vector3D,this._eyesPos.copyFrom(t.position),this._lookAtPosition.copyFrom(e.position.add(this.lookAtOffset)),this._target.lookAt(this._eyesPos,this._lookAtPosition),n.Input.addEventListener(n.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),n.Input.addEventListener(n.MouseEvent3D.MOUSE_WHEEL,this.mouseWheel,this),n.Input.addEventListener(n.MouseEvent3D.MOUSE_UP,this.mouseUp,this),n.Input.addEventListener(n.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),n.Input.addEventListener(n.KeyEvent3D.KEY_UP,this.keyUp,this),n.Input.addEventListener(n.KeyEvent3D.KEY_DOWN,this.keyDown,this),n.Input.addEventListener(n.TouchEvent3D.TOUCH_END,this.touchUp,this),n.Input.addEventListener(n.TouchEvent3D.TOUCH_START,this.touchDown,this),n.Input.addEventListener(n.TouchEvent3D.TOUCH_MOVE,this.touchMove,this)}return __extends(t,r),t.prototype.scaleSpeed=function(t){this._speed*=t},t.prototype.mouseMove=function(t){this._mouseDown&&(!this._needctl||this._ctl)&&(this._rotaAngle.y+=n.Input.mouseOffsetX,this._rotaAngle.x+=n.Input.mouseOffsetY,this._rotaAngle.y%=360,this._rotaAngle.x%=360)},t.prototype.mouseWheel=function(t){this.distance=this._eyesLength-.1*n.Input.wheelDelta},t.prototype.mouseUp=function(t){switch(t.mouseCode){case n.MouseCode.Mouse_Left:this._mouseDown=!1;break;case n.MouseCode.Mouse_Right:this._mouseRightDown=!1}},t.prototype.mouseDown=function(t){switch(t.mouseCode){case n.MouseCode.Mouse_Left:this._mouseDown=!0;break;case n.MouseCode.Mouse_Right:this._mouseRightDown=!0}},t.prototype.touchMove=function(t){1==t.targetTouches.length?this.mouseMove(null):this.mouseWheel(null)},t.prototype.touchUp=function(t){this._mouseDown=!1},t.prototype.touchDown=function(t){this._mouseDown=!0},t.prototype.keyDown=function(t){switch(t.keyCode){case n.KeyCode.Key_W:this._keyArray[0]=!0;break;case n.KeyCode.Key_A:this._keyArray[1]=!0;break;case n.KeyCode.Key_S:this._keyArray[2]=!0;break;case n.KeyCode.Key_D:this._keyArray[3]=!0;break;case n.KeyCode.Key_Q:this._keyArray[4]=!0;break;case n.KeyCode.Key_E:this._keyArray[5]=!0;break;case n.KeyCode.Key_Control_L:this._ctl=!0;break;case n.KeyCode.Key_Alt_L:this._alt=!0}},t.prototype.keyUp=function(t){switch(t.keyCode){case n.KeyCode.Key_W:this._keyArray[0]=!1;break;case n.KeyCode.Key_A:this._keyArray[1]=!1;break;case n.KeyCode.Key_S:this._keyArray[2]=!1;break;case n.KeyCode.Key_D:this._keyArray[3]=!1;break;case n.KeyCode.Key_Q:this._keyArray[4]=!1;break;case n.KeyCode.Key_E:this._keyArray[5]=!1;break;case n.KeyCode.Key_Control_L:this._ctl=!1;break;case n.KeyCode.Key_Alt_L:this._alt=!1}},Object.defineProperty(t.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},set:function(t){this._lookAtObject&&(this._lookAtObject=null),this._lookAtPosition.copyFrom(t.add(this.lookAtOffset)),this.notifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lookAtObject",{get:function(){return this._lookAtObject},set:function(t){this._lookAtObject!=t&&(this._lookAtObject=t,this._lookAtPosition.copyFrom(this._lookAtObject.position.add(this.lookAtOffset)),this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._eyesLength},set:function(t){this._eyesLength=t,this._eyesLength<1&&(this._eyesLength=1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationX",{get:function(){return this._rotaAngle.x},set:function(t){this._rotaAngle.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotaAngle.y},set:function(t){this._rotaAngle.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationZ",{get:function(){return this._rotaAngle.z},set:function(t){this._rotaAngle.z=t},enumerable:!0,configurable:!0}),t.prototype.update=function(){if(this._target){if(0==this._target.isController)return;this._keyArray[0]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[1]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._matTemp.identity(),this._matTemp.appendRotation(90,n.Vector3D.Y_AXIS),this._tempVec.copyFrom(this._matTemp.transformVector(this._tempVec)),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[2]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[3]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._matTemp.identity(),this._matTemp.appendRotation(90,n.Vector3D.Y_AXIS),this._tempVec.copyFrom(this._matTemp.transformVector(this._tempVec)),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[4]&&(this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._tempVec.copyFrom(this._quaRot.transformVector(n.Vector3D.Y_AXIS)),this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[5]&&(this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._tempVec.copyFrom(this._quaRot.transformVector(n.Vector3D.Y_AXIS)),this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._rotaEyesLine.copyFrom(this._quaRot.transformVector(n.Vector3D.Z_AXIS)),this._rotaEyesLine.normalize(),this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.scaleBy(this._eyesLength),this._eyesPos.copyFrom(this._lookAtPosition.subtract(this._tempVec)),this._lookAtObject&&this._lookAtPosition.copyFrom(this._lookAtObject.position.add(this.lookAtOffset)),this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,this._rotaAngle.z),this._tempVec.copyFrom(this._up),this._tempVec.copyFrom(this._quaRot.transformVector(this._tempVec)),this._tempVec.normalize(),this.firstCamera&&(this._lookAtObject.rotationY=this._rotaAngle.y,this._lookAtObject.rotationX=this._rotaAngle.x),this._target.lookAt(this._eyesPos,this._lookAtPosition,this._tempVec)}},t}(n.ControllerBase);n.LookAtController=t}(egret3d||(egret3d={})),function(p){var t=function(d){function t(t,e,i,a,r,n,o,s,h,l,u,c){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=0),void 0===a&&(a=90),void 0===r&&(r=100),void 0===n&&(n=-90),void 0===o&&(o=90),void 0===s&&(s=NaN),void 0===h&&(h=NaN),void 0===l&&(l=8),void 0===u&&(u=2),void 0===c&&(c=!1),d.call(this,t,e),this._currentPanAngle=0,this._currentTiltAngle=90,this._panAngle=0,this._tiltAngle=90,this._distance=1e3,this._minPanAngle=-1/0,this._maxPanAngle=1/0,this._minTiltAngle=-90,this._maxTiltAngle=90,this._maxDistance=5e3,this._minDistance=-5e3,this._steps=8,this._yFactor=2,this._wrapPanAngle=!1,this._lookAtPosition=new p.Vector3D(0,0,0),this._mouseDown=!1,this._mouseRightDown=!1,this._keyArray=new Array,this.distance=r,this.panAngle=i,this.tiltAngle=a,this.minPanAngle=s||-1/0,this.maxPanAngle=h||1/0,this.minTiltAngle=n,this.maxTiltAngle=o,this.steps=l,this.yFactor=u,this.wrapPanAngle=c,this._currentPanAngle=this._panAngle,this._currentTiltAngle=this._tiltAngle,p.Input.addEventListener(p.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),p.Input.addEventListener(p.MouseEvent3D.MOUSE_WHEEL,this.mouseWheel,this),p.Input.addEventListener(p.MouseEvent3D.MOUSE_UP,this.mouseUp,this),p.Input.addEventListener(p.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),p.Input.addEventListener(p.KeyEvent3D.KEY_UP,this.keyUp,this),p.Input.addEventListener(p.KeyEvent3D.KEY_DOWN,this.keyDown,this),p.Input.addEventListener(p.TouchEvent3D.TOUCH_END,this.touchUp,this),p.Input.addEventListener(p.TouchEvent3D.TOUCH_START,this.touchDown,this),p.Input.addEventListener(p.TouchEvent3D.TOUCH_MOVE,this.touchMove,this)}return __extends(t,d),t.prototype.mouseMove=function(t){this._mouseDown&&(this._tiltAngle+=.1*p.Input.mouseOffsetY,this._tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)),this._panAngle+=.1*p.Input.mouseOffsetX,this._panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},t.prototype.mouseWheel=function(t){this._distance-=.1*p.Input.wheelDelta,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance))},t.prototype.mouseUp=function(t){switch(t.mouseCode){case p.MouseCode.Mouse_Left:this._mouseDown=!1;break;case p.MouseCode.Mouse_Right:this._mouseRightDown=!1}},t.prototype.mouseDown=function(t){switch(t.mouseCode){case p.MouseCode.Mouse_Left:this._mouseDown=!0;break;case p.MouseCode.Mouse_Right:this._mouseRightDown=!0}},t.prototype.touchMove=function(t){1==t.targetTouches.length?this.mouseMove(null):this.mouseWheel(null)},t.prototype.touchUp=function(t){this._mouseDown=!1},t.prototype.touchDown=function(t){this._mouseDown=!0},t.prototype.keyDown=function(t){switch(t.keyCode){case p.KeyCode.Key_W:this._keyArray[0]=!0;break;case p.KeyCode.Key_A:this._keyArray[1]=!0;break;case p.KeyCode.Key_S:this._keyArray[2]=!0;break;case p.KeyCode.Key_D:this._keyArray[3]=!0}},t.prototype.keyUp=function(t){switch(t.keyCode){case p.KeyCode.Key_W:this._keyArray[0]=!1;break;case p.KeyCode.Key_A:this._keyArray[1]=!1;break;case p.KeyCode.Key_S:this._keyArray[2]=!1;break;case p.KeyCode.Key_D:this._keyArray[3]=!1}},Object.defineProperty(t.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},set:function(t){this._lookAtPosition=t,this.notifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"steps",{get:function(){return this._steps},set:function(t){t=t<1?1:t,this._steps!=t&&(this._steps=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){t=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,t)),this._panAngle!=t&&(this._panAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!=t&&(this._tiltAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance!=t&&(this._distance=this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,t)),this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(t){this._minPanAngle!=t&&(this._minPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(t){this._maxPanAngle!=t&&(this._maxPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!=t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!=t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance!=t&&(this._maxDistance=t,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._maxDistance},set:function(t){this._minDistance!=t&&(this._minDistance=t,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yFactor",{get:function(){return this._yFactor},set:function(t){this._yFactor!=t&&(this._yFactor=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!=t&&(this._wrapPanAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),t.prototype.update=function(t){void 0===t&&(t=!0),(this._tiltAngle!=this._currentTiltAngle||this._panAngle!=this._currentPanAngle)&&(this.notifyUpdate(),this._wrapPanAngle&&(this._panAngle<0?this._panAngle=this._panAngle%360+360:this._panAngle=this._panAngle%360,this._panAngle-this._currentPanAngle<-180?this._currentPanAngle-=360:180<this._panAngle-this._currentPanAngle&&(this._currentPanAngle+=360)),t?(this._currentTiltAngle+=(this._tiltAngle-this._currentTiltAngle)/(this.steps+1),this._currentPanAngle+=(this._panAngle-this._currentPanAngle)/(this.steps+1)):(this._currentPanAngle=this._panAngle,this._currentTiltAngle=this._tiltAngle),Math.abs(this._tiltAngle-this._currentTiltAngle)<.01&&Math.abs(this._panAngle-this._currentPanAngle)<.01&&(this._currentTiltAngle=this._tiltAngle,this._currentPanAngle=this._panAngle));var e=this._lookAtObject?this._lookAtObject.position:this._lookAtPosition?this._lookAtPosition:this._origin,i=new p.Vector3D;i.x=e.x+this.distance*Math.sin(this._currentPanAngle*p.MathUtil.DEGREES_TO_RADIANS)*Math.cos(this._currentTiltAngle*p.MathUtil.DEGREES_TO_RADIANS),i.z=e.z+this.distance*Math.cos(this._currentPanAngle*p.MathUtil.DEGREES_TO_RADIANS)*Math.cos(this._currentTiltAngle*p.MathUtil.DEGREES_TO_RADIANS),i.y=e.y+this.distance*Math.sin(this._currentTiltAngle*p.MathUtil.DEGREES_TO_RADIANS)*this.yFactor,this._target&&this._lookAtPosition&&this._target.lookAt(i,this._lookAtPosition)},t}(p.ControllerBase);p.HoverController=t}(egret3d||(egret3d={})),function(t){var e,i,a,r;(e=t.InternalFormat||(t.InternalFormat={}))[e.PixelArray=0]="PixelArray",e[e.CompressData=1]="CompressData",e[e.ImageData=2]="ImageData",t.InternalFormat,(i=t.FrameBufferType||(t.FrameBufferType={}))[i.shadowFrameBufrfer=0]="shadowFrameBufrfer",i[i.defaultFrameBuffer=1]="defaultFrameBuffer",i[i.positionFrameBuffer=2]="positionFrameBuffer",i[i.normalFrameBuffer=3]="normalFrameBuffer",i[i.specularFrameBuffer=4]="specularFrameBuffer",i[i.leftEyeFrameBuffer=5]="leftEyeFrameBuffer",i[i.rightEyeFrameBuffer=6]="rightEyeFrameBuffer",i[i.nextFrameBuffer=7]="nextFrameBuffer",t.FrameBufferType,(a=t.FrameBufferFormat||(t.FrameBufferFormat={}))[a.FLOAT_RGB=0]="FLOAT_RGB",a[a.FLOAT_RGBA=1]="FLOAT_RGBA",a[a.UNSIGNED_BYTE_RGB=2]="UNSIGNED_BYTE_RGB",a[a.UNSIGNED_BYTE_RGBA=3]="UNSIGNED_BYTE_RGBA",t.FrameBufferFormat,(r=t.BlendMode||(t.BlendMode={}))[r.ALPHA=0]="ALPHA",r[r.LAYER=1]="LAYER",r[r.NORMAL=2]="NORMAL",r[r.MULTIPLY=3]="MULTIPLY",r[r.ADD=4]="ADD",r[r.SUB=5]="SUB",r[r.DIV=6]="DIV",r[r.SCREEN=7]="SCREEN",r[r.SOFT_ADD=8]="SOFT_ADD";var n=(t.BlendMode,function(){});t.ContextSamplerType=n;var o=function(){};t.DrawMode=o;var s=function(){function t(){}return t.Direct3D_Opengl_Auto="Direct3D_Opengl_Auto",t.Direct3D_9_0="Direct3D_9_0",t.Direct3D_10_0="Direct3D_10_0",t.Direct3D_11_0="Direct3D_11_0",t.OpenGLES_2_0="OpenGLES_2_0",t.OpenGLES_3_0="OpenGLES_3_0",t.OpenGL="OpenGL",t.ColorFormat_DXT1_RGB=0,t.ColorFormat_DXT1_RGBA=0,t.ColorFormat_DXT3_RGBA=0,t.ColorFormat_DXT5_RGBA=0,t}();t.ContextConfig=s}(egret3d||(egret3d={})),function(l){var t=function(){function h(){this.isLost=!1,this.DEPTH_TEST=!1,this.CULL_FACE=!1,this.BLEND=!1,this.blend_Factors_src=-1,this.blend_Factors_dst=-1,this.cullingMode=-1,this.depthCompareMode=-1,this.vertexFormat=-1}return h.prototype.register=function(){var t;h.gl.getExtension("WEBGL_depth_texture")||h.gl.getExtension("MOZ_WEBGL_depth_texture")||h.gl.getExtension("WEBKIT_WEBGL_depth_texture"),h.gl.getExtension("EXT_texture_filter_anisotropic")||h.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),h.gl.getExtension("WEBGL_compressed_texture_s3tc")||h.gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||h.gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),h.gl.getExtension("WEBGL_compressed_texture_pvrtc")||h.gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),h.gl.getExtension("WEBGL_compressed_texture_etc1"),h.gl.getExtension("OES_element_index_uint"),h.gl.getExtension("WEBGL_compressed_texture_s3tc"),h.gl.getExtension("OES_texture_float_linear"),h.gl.getExtension("OES_texture_float"),h.gl.getExtension("OES_texture_half_float"),h.gl.getExtension("OES_texture_half_float_linear"),h.gl.getExtension("OES_standard_derivatives"),h.gl.getExtension("GL_OES_standard_derivatives"),h.gl.getExtension("WEBGL_draw_buffers"),h.gl.getExtension("WEBGL_depth_texture"),t=h.gl.getExtension("WEBGL_lose_context"),l.ContextConfig.BLEND=h.gl.BLEND,l.DrawMode.TRIANGLES=h.gl.TRIANGLES,l.DrawMode.POINTS=h.gl.POINTS,l.DrawMode.LINES=h.gl.LINES,l.DrawMode.LINE_STRIP=h.gl.LINE_STRIP,l.ContextConfig.FLOAT=h.gl.FLOAT,l.ContextConfig.VERTEX_SHADER=h.gl.VERTEX_SHADER,l.ContextConfig.FRAGMENT_SHADER=h.gl.FRAGMENT_SHADER,l.ContextConfig.FRONT=h.gl.FRONT,l.ContextConfig.BACK=h.gl.BACK,l.ContextConfig.FRONT_AND_BACK=h.gl.FRONT_AND_BACK,l.ContextConfig.DEPTH_BUFFER_BIT=h.gl.DEPTH_BUFFER_BIT,l.ContextConfig.ELEMENT_ARRAY_BUFFER=h.gl.ELEMENT_ARRAY_BUFFER,l.ContextConfig.UNSIGNED_SHORT=h.gl.UNSIGNED_SHORT,l.ContextConfig.NEAREST=h.gl.NEAREST,l.ContextConfig.REPEAT=h.gl.REPEAT,l.ContextConfig.ONE=h.gl.ONE,l.ContextConfig.ZERO=h.gl.ZERO,l.ContextConfig.SRC_ALPHA=h.gl.SRC_ALPHA,l.ContextConfig.ONE_MINUS_SRC_ALPHA=h.gl.ONE_MINUS_SRC_ALPHA,l.ContextConfig.SRC_COLOR=h.gl.SRC_COLOR,l.ContextConfig.ONE_MINUS_SRC_COLOR=h.gl.ONE_MINUS_SRC_COLOR,l.ContextConfig.ColorFormat_RGB565=h.gl.RGB565,l.ContextConfig.ColorFormat_RGBA5551=h.gl.RGB5_A1,l.ContextConfig.ColorFormat_RGBA4444=h.gl.RGBA4,l.ContextConfig.ColorFormat_RGBA8888=h.gl.RGBA,l.ContextConfig.DEPTH_TEST=h.gl.DEPTH_TEST,l.ContextConfig.CULL_FACE=h.gl.CULL_FACE,l.ContextConfig.BLEND=h.gl.BLEND,l.ContextConfig.LEQUAL=h.gl.LEQUAL,t&&(l.ContextConfig.ColorFormat_DXT1_RGB=t.COMPRESSED_RGB_S3TC_DXT1_EXT,l.ContextConfig.ColorFormat_DXT1_RGBA=t.COMPRESSED_RGBA_S3TC_DXT1_EXT,l.ContextConfig.ColorFormat_DXT3_RGBA=t.COMPRESSED_RGBA_S3TC_DXT3_EXT,l.ContextConfig.ColorFormat_DXT5_RGBA=t.COMPRESSED_RGBA_S3TC_DXT5_EXT),l.ContextSamplerType.TEXTURE_0=h.gl.TEXTURE0,l.ContextSamplerType.TEXTURE_1=h.gl.TEXTURE1,l.ContextSamplerType.TEXTURE_2=h.gl.TEXTURE2,l.ContextSamplerType.TEXTURE_3=h.gl.TEXTURE3,l.ContextSamplerType.TEXTURE_4=h.gl.TEXTURE4,l.ContextSamplerType.TEXTURE_5=h.gl.TEXTURE5,l.ContextSamplerType.TEXTURE_6=h.gl.TEXTURE6,l.ContextSamplerType.TEXTURE_7=h.gl.TEXTURE7,l.ContextSamplerType.TEXTURE_8=h.gl.TEXTURE8,console.log("requst GPU Config",h.gl),l.ShaderPool.register(this)},h.prototype.viewPort=function(t,e,i,a){h.gl.viewport(t,l.ContextConfig.canvasRectangle.height-a-e,i,a)},h.prototype.creatProgram=function(t,e){var i=h.gl.createProgram();return h.gl.attachShader(i,t.shader),h.gl.attachShader(i,e.shader),h.gl.linkProgram(i),h.gl.getProgramParameter(i,h.gl.LINK_STATUS)||(alert("vsShader error"+h.gl.getShaderInfoLog(t.shader)),alert("fsShader error"+h.gl.getShaderInfoLog(e.shader))),new l.Program3D(i)},h.prototype.creatIndexBuffer=function(t){var e=new Int16Array(t),i=h.gl.createBuffer();h.gl.bindBuffer(h.gl.ELEMENT_ARRAY_BUFFER,i),h.gl.bufferData(h.gl.ELEMENT_ARRAY_BUFFER,e,h.gl.STATIC_DRAW);var a=new l.IndexBuffer3D(i);return a.arrayBuffer=e,a},h.prototype.uploadIndexBuffer=function(t){h.gl.bindBuffer(h.gl.ARRAY_BUFFER,t.buffer),h.gl.bufferData(h.gl.ARRAY_BUFFER,t.arrayBuffer,h.gl.DYNAMIC_DRAW)},h.prototype.creatVertexBuffer=function(t,e){void 0===e&&(e=h.gl.STATIC_DRAW);var i=new Float32Array(t),a=h.gl.createBuffer();h.gl.bindBuffer(h.gl.ARRAY_BUFFER,a),h.gl.bufferData(h.gl.ARRAY_BUFFER,i,e);var r=new l.VertexBuffer3D(a);return r.arrayBuffer=i,r},h.prototype.uploadVertexBuffer=function(t){h.gl.bindBuffer(h.gl.ARRAY_BUFFER,t.buffer),h.gl.bufferData(h.gl.ARRAY_BUFFER,t.arrayBuffer,h.gl.DYNAMIC_DRAW)},h.prototype.texParameteri=function(t,e,i){h.gl.texParameteri(t,e,i)},h.prototype.upLoadTextureData=function(t,e){h.gl.bindTexture(h.gl.TEXTURE_2D,e.texture2D.textureBuffer),e.texture2D.internalFormat==l.InternalFormat.ImageData?(h.gl.texImage2D(h.gl.TEXTURE_2D,0,h.gl.RGBA,h.gl.RGBA,e.texture2D.dataFormat,e.texture2D.imageData),delete e.texture2D.imageData):e.texture2D.internalFormat==l.InternalFormat.CompressData?this.upLoadCompressedTexture2D(t,e.texture2D):e.texture2D.internalFormat==l.InternalFormat.PixelArray&&h.gl.texImage2D(h.gl.TEXTURE_2D,t,e.texture2D.colorFormat,e.texture2D.mimapData[t].width,e.texture2D.mimapData[t].height,e.texture2D.border,e.texture2D.colorFormat,e.texture2D.dataFormat,e.texture2D.mimapData[t].data),e.useMipmap&&h.gl.generateMipmap(h.gl.TEXTURE_2D)},h.prototype.upLoadCompressedTexture2D=function(t,e){h.gl.compressedTexImage2D(h.gl.TEXTURE_2D,t,e.colorFormat,e.mimapData[t].width,e.mimapData[t].height,e.border,e.mimapData[t].data)},h.prototype.creatTexture2D=function(){var t=new l.Texture2D;return t.textureBuffer=h.gl.createTexture(),t},h.prototype.creatCubeTexture=function(){var t=new l.Texture3D;return t.texture=h.gl.createTexture(),t},h.prototype.uploadCubetexture=function(t){h.gl.bindTexture(h.gl.TEXTURE_CUBE_MAP,t.texture),t.image_right.mimapData&&0<t.image_right.mimapData.length?h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,h.gl.RGB,t.image_right.mimapData[0].width,t.image_right.mimapData[0].height,0,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_right.mimapData[0].data):h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,h.gl.RGB,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_right.imageData),t.image_left.mimapData&&0<t.image_left.mimapData.length?h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,h.gl.RGB,t.image_right.mimapData[0].width,t.image_right.mimapData[0].height,0,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_right.mimapData[0].data):h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,h.gl.RGB,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_left.imageData),t.image_left.mimapData&&0<t.image_left.mimapData.length?h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,h.gl.RGB,t.image_up.mimapData[0].width,t.image_up.mimapData[0].height,0,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_up.mimapData[0].data):h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,h.gl.RGB,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_up.imageData),t.image_left.mimapData&&0<t.image_left.mimapData.length?h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,h.gl.RGB,t.image_down.mimapData[0].width,t.image_down.mimapData[0].height,0,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_down.mimapData[0].data):h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,h.gl.RGB,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_down.imageData),t.image_left.mimapData&&0<t.image_left.mimapData.length?h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,h.gl.RGB,t.image_back.mimapData[0].width,t.image_back.mimapData[0].height,0,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_back.mimapData[0].data):h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,h.gl.RGB,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_back.imageData),t.image_left.mimapData&&0<t.image_left.mimapData.length?h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,h.gl.RGB,t.image_front.mimapData[0].width,t.image_front.mimapData[0].height,0,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_front.mimapData[0].data):h.gl.texImage2D(h.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,h.gl.RGB,h.gl.RGB,h.gl.UNSIGNED_BYTE,t.image_front.imageData),h.gl.texParameteri(h.gl.TEXTURE_CUBE_MAP,h.gl.TEXTURE_MAG_FILTER,h.gl.LINEAR),h.gl.texParameteri(h.gl.TEXTURE_CUBE_MAP,h.gl.TEXTURE_MIN_FILTER,h.gl.LINEAR),h.gl.texParameteri(h.gl.TEXTURE_CUBE_MAP,h.gl.TEXTURE_WRAP_S,h.gl.CLAMP_TO_EDGE),h.gl.texParameteri(h.gl.TEXTURE_CUBE_MAP,h.gl.TEXTURE_WRAP_T,h.gl.CLAMP_TO_EDGE)},h.prototype.createFramebuffer=function(t,e,i){var a=h.gl.createFramebuffer(),r=this.creatTexture2D(),n=h.gl.createRenderbuffer();h.gl.bindTexture(h.gl.TEXTURE_2D,r.textureBuffer);for(var o=new Float32Array(4096),s=0;s<1024;s++)o[s]=1,o[s+1]=1,o[s+2]=1,o[s+3]=1;switch(i){case l.FrameBufferFormat.UNSIGNED_BYTE_RGB:h.gl.texImage2D(h.gl.TEXTURE_2D,0,h.gl.RGB,t,e,0,h.gl.RGB,h.gl.UNSIGNED_BYTE,null);break;case l.FrameBufferFormat.UNSIGNED_BYTE_RGBA:h.gl.texImage2D(h.gl.TEXTURE_2D,0,h.gl.RGBA,t,e,0,h.gl.RGBA,h.gl.UNSIGNED_BYTE,null);break;case l.FrameBufferFormat.FLOAT_RGB:h.gl.texImage2D(h.gl.TEXTURE_2D,0,h.gl.RGB,t,e,0,h.gl.RGB,h.gl.FLOAT,o);break;case l.FrameBufferFormat.FLOAT_RGBA:h.gl.texImage2D(h.gl.TEXTURE_2D,0,h.gl.RGBA,t,e,0,h.gl.RGBA,h.gl.FLOAT,o)}return h.gl.texParameteri(h.gl.TEXTURE_2D,h.gl.TEXTURE_MAG_FILTER,h.gl.NEAREST),h.gl.texParameteri(h.gl.TEXTURE_2D,h.gl.TEXTURE_MIN_FILTER,h.gl.NEAREST),h.gl.texParameteri(h.gl.TEXTURE_2D,h.gl.TEXTURE_WRAP_S,h.gl.CLAMP_TO_EDGE),h.gl.texParameteri(h.gl.TEXTURE_2D,h.gl.TEXTURE_WRAP_T,h.gl.CLAMP_TO_EDGE),h.gl.bindFramebuffer(h.gl.FRAMEBUFFER,a),h.gl.framebufferTexture2D(h.gl.FRAMEBUFFER,h.gl.COLOR_ATTACHMENT0,h.gl.TEXTURE_2D,r.textureBuffer,0),h.gl.bindRenderbuffer(h.gl.RENDERBUFFER,n),h.gl.renderbufferStorage(h.gl.RENDERBUFFER,h.gl.DEPTH_COMPONENT16,t,e),r.width=t,r.height=e,r.frameBuffer=a,r.renderbuffer=n,h.gl.bindFramebuffer(h.gl.FRAMEBUFFER,null),h.gl.bindTexture(h.gl.TEXTURE_2D,null),h.gl.bindRenderbuffer(h.gl.RENDERBUFFER,null),r},h.prototype.setRenderToTexture=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=0),h.gl.viewport(0,0,t.width,t.height),h.gl.scissor(0,0,t.width,t.height),h.gl.bindFramebuffer(h.gl.FRAMEBUFFER,t.frameBuffer),h.gl.clearColor(0,0,0,1),h.gl.clear(h.gl.COLOR_BUFFER_BIT|h.gl.DEPTH_BUFFER_BIT),h.gl.framebufferTexture2D(h.gl.FRAMEBUFFER,h.gl.COLOR_ATTACHMENT0,h.gl.TEXTURE_2D,t.textureBuffer,0),h.gl.framebufferRenderbuffer(h.gl.FRAMEBUFFER,h.gl.DEPTH_ATTACHMENT,h.gl.RENDERBUFFER,t.renderbuffer)},h.prototype.setRenderToBackBuffer=function(){h.gl.bindTexture(h.gl.TEXTURE_2D,null),h.gl.bindFramebuffer(h.gl.FRAMEBUFFER,null),h.gl.bindRenderbuffer(h.gl.RENDERBUFFER,null)},h.prototype.creatVertexShader=function(t){var e=h.gl.createShader(h.gl.VERTEX_SHADER);h.gl.shaderSource(e,t),h.gl.compileShader(e);var i=new l.Shader(e);return i.id=(l.Shader.ID_COUNT++).toString(),i},h.prototype.creatFragmentShader=function(t){var e=h.gl.createShader(h.gl.FRAGMENT_SHADER);h.gl.shaderSource(e,t),h.gl.compileShader(e);var i=new l.Shader(e);return i.id=(l.Shader.ID_COUNT++).toString(),i},h.prototype.clear=function(t){h.gl.clear(t)},h.prototype.clearColor=function(t,e,i,a){h.gl.clearColor(t,e,i,a)},h.prototype.clearStencil=function(t){h.gl.clearStencil(t)},h.prototype.setProgram=function(t){this.programChange=!1,this.program!=t&&(this.programChange=!0,this.program=t,h.gl.useProgram(t.program))},h.prototype.getUniformLocation=function(t,e){return h.gl.getUniformLocation(t.program,e)},h.prototype.uniform1f=function(t,e){h.gl.uniform1f(t,e)},h.prototype.uniform1fv=function(t,e){h.gl.uniform1fv(t,e)},h.prototype.uniform1i=function(t,e){h.gl.uniform1i(t,e)},h.prototype.uniform1iv=function(t,e){h.gl.uniform1iv(t,e)},h.prototype.uniform2f=function(t,e,i){h.gl.uniform2f(t,e,i)},h.prototype.uniform2fv=function(t,e){h.gl.uniform2fv(t,e)},h.prototype.uniform2i=function(t,e,i){h.gl.uniform2i(t,e,i)},h.prototype.uniform2iv=function(t,e){h.gl.uniform2iv(t,e)},h.prototype.uniform3f=function(t,e,i,a){h.gl.uniform3f(t,e,i,a)},h.prototype.uniform3fv=function(t,e){h.gl.uniform3fv(t,e)},h.prototype.uniform3i=function(t,e,i,a){h.gl.uniform3i(t,e,i,a)},h.prototype.uniform3iv=function(t,e){h.gl.uniform3iv(t,e)},h.prototype.uniform4f=function(t,e,i,a,r){h.gl.uniform4f(t,e,i,a,r)},h.prototype.uniform4fv=function(t,e){h.gl.uniform4fv(t,e)},h.prototype.uniform4i=function(t,e,i,a,r){h.gl.uniform4i(t,e,i,a,r)},h.prototype.uniform4iv=function(t,e){h.gl.uniform4iv(t,e)},h.prototype.uniformMatrix2fv=function(t,e,i){h.gl.uniformMatrix2fv(t,e,i)},h.prototype.uniformMatrix3fv=function(t,e,i){h.gl.uniformMatrix3fv(t,e,i)},h.prototype.uniformMatrix4fv=function(t,e,i){h.gl.uniformMatrix4fv(t,e,i)},h.prototype.setBlendFactors=function(t,e){(this.blend_Factors_src!=t||this.blend_Factors_dst!=e)&&(this.blend_Factors_src=t,this.blend_Factors_dst=e,h.gl.blendFunc(t,e))},h.prototype.setCulling=function(t){this.cullingMode!=t&&(this.cullingMode=t,h.gl.cullFace(t))},h.prototype.enableDepth=function(){this.DEPTH_TEST||(this.DEPTH_TEST=!0,h.gl.enable(l.ContextConfig.DEPTH_TEST))},h.prototype.disableDepth=function(){this.DEPTH_TEST&&(this.DEPTH_TEST=!1,h.gl.disable(l.ContextConfig.DEPTH_TEST))},h.prototype.enableCullFace=function(){this.CULL_FACE||(this.CULL_FACE=!0,h.gl.enable(l.ContextConfig.CULL_FACE))},h.prototype.disableCullFace=function(){this.CULL_FACE&&(this.CULL_FACE=!1,h.gl.disable(l.ContextConfig.CULL_FACE))},h.prototype.enableBlend=function(){h.gl.enable(l.ContextConfig.BLEND)},h.prototype.disableBlend=function(){h.gl.disable(l.ContextConfig.BLEND)},h.prototype.depthFunc=function(t){void 0===t&&(t=0),this.depthCompareMode!=t&&(this.depthCompareMode=t,h.gl.depthFunc(t))},h.prototype.enableDepthTest=function(t,e){void 0===e&&(e=0),t&&h.gl.enable(h.gl.DEPTH_TEST)},h.prototype.getShaderAttribLocation=function(t,e){return h.gl.getAttribLocation(t.program,e)},h.prototype.vertexAttribPointer=function(t,e,i,a,r,n){h.gl.vertexAttribPointer(t,e,i,a,r,n),h.gl.enableVertexAttribArray(t)},h.prototype.clearVaPointer=function(t){h.gl.disableVertexAttribArray(t)},h.prototype.isActiveVertexFormat=function(t){return!1},h.prototype.activeVertexFormat=function(t){this.vertexFormat=t},h.prototype.unActiveVertexFormat=function(){this.vertexFormat=-1;for(var t=0;t<12;t++)this.clearVaPointer(t)},h.prototype.setVertexShaderConstData=function(t,e,i){h.gl.vertexAttrib4fv(e,t.subarray(e,i))},h.prototype.setFragmentShaderConstData=function(t,e,i){},h.prototype.setTexture2DAt=function(t,e,i,a){h.gl.activeTexture(t),h.gl.bindTexture(h.gl.TEXTURE_2D,a.textureBuffer),h.gl.uniform1i(e,i)},h.prototype.disableTexture2DAt=function(t,e,i){},h.prototype.setCubeTextureAt=function(t,e,i,a){a&&(h.gl.activeTexture(t),h.gl.bindTexture(h.gl.TEXTURE_CUBE_MAP,a.texture),h.gl.uniform1i(e,i))},h.prototype.setScissorRectangle=function(t,e,i,a){h.gl.scissor(t,l.ContextConfig.canvasRectangle.height-a-e,i,a)},h.prototype.setStencilReferenceValue=function(){},h.prototype.setStencilActions=function(t,e,i,a,r){},h.prototype.bindVertexBuffer=function(t){h.gl.bindBuffer(h.gl.ARRAY_BUFFER,t.buffer)},h.prototype.bindIndexBuffer=function(t){h.gl.bindBuffer(h.gl.ELEMENT_ARRAY_BUFFER,t.buffer)},h.prototype.drawArrays=function(t,e,i){h.gl.drawArrays(t,e,i)},h.prototype.drawElement=function(t,e,i){h.gl.drawElements(t,i,h.gl.UNSIGNED_SHORT,e)},h.prototype.flush=function(){h.gl.flush()},h}();l.Context3DProxy=t}(egret3d||(egret3d={})),function(t){var e=function(){};(egret3d||(egret3d={})).FrameBuffer=e}(),function(t){var e=function(t){this.buffer=t};(egret3d||(egret3d={})).IndexBuffer3D=e}(),function(t){var e=function(t){this.buffer=t};(egret3d||(egret3d={})).VertexBuffer3D=e}(),function(t){var e=function(t,e,i){this.data=t,this.width=e,this.height=i};(egret3d||(egret3d={})).MipmapData=e}(),function(t){var e=function(t){this.program=t};(egret3d||(egret3d={})).Program3D=e}(),function(t){var e=function(){this.border=0,this.imageData=null,this.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,this.dataFormat=t.Context3DProxy.gl.UNSIGNED_BYTE,this.internalFormat=t.InternalFormat.PixelArray,this.mimapData=new Array};t.Texture2D=e}(egret3d||(egret3d={})),function(t){var e=function(){function t(t){this._shader=t}return Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},enumerable:!0,configurable:!0}),t.vertex=0,t.fragment=1,t.ID_COUNT=0,t}();t.Shader=e}(egret3d||(egret3d={})),function(t){var e=function(){this.border=0,this.useMipmap=!0,this.colorformat=t.ContextConfig.ColorFormat_RGBA8888,this.internalformat=t.InternalFormat.PixelArray,this.mimapData=new Array};t.Texture3D=e}(egret3d||(egret3d={})),function(a){var t;(t=a.PickType||(a.PickType={}))[t.BoundPick=0]="BoundPick",t[t.PositionPick=1]="PositionPick",t[t.UVPick=2]="UVPick";var i=a.PickType,e=function(t){function e(){t.call(this),this._modelMatrix3D=new a.Matrix4_4,this._transformChange=!0,this._pos=new a.Vector3D,this._rot=new a.Vector3D,this._sca=new a.Vector3D(1,1,1),this._orientation=new a.Quaternion,this._axis=new a.Vector3D,this._angle=0,this._globalPos=new a.Vector3D,this._globalRot=new a.Vector3D,this._globalSca=new a.Vector3D(1,1,1),this._globalOrientation=new a.Quaternion,this._qut=new a.Quaternion,this._vec=new a.Vector3D,this._active=!1,this._isRoot=!0,this.canPick=!1,this.renderLayer=0,this.name="",this.id=0,this.layer=0,this.tag=new a.Tag,this.parent=null,this.childs=new Array,this.isController=!0,this.isDisable=!1,this.visible=!0,this.pickType=i.BoundPick,this.pickResult=new a.PickResult,this.enablePick=!1,this.mouseChilder=!1,this.enableCulling=!0,this.id=++e.s_id}return __extends(e,t),Object.defineProperty(e.prototype,"bound",{get:function(){return this._bound},set:function(t){this._bound=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentBound",{get:function(){return this.mouseChilder?this.bound.childBound:this.bound},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._pos},set:function(t){this.updateTransformChange(!0),this._pos.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rot},set:function(t){this._rot.x=t.x,this._rot.y=t.y,this._rot.z=t.z,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientation",{get:function(){return this._orientation},set:function(t){this._orientation.copyFrom(t),this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientationX",{set:function(t){this._orientation.x=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientationY",{set:function(t){this._orientation.y=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientationZ",{set:function(t){this._orientation.z=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientationW",{set:function(t){this._orientation.w=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._sca},set:function(t){this.updateTransformChange(!0),this._sca=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._pos.x},set:function(t){this.updateTransformChange(!0),this._pos.x!=t&&(this._pos.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._pos.y},set:function(t){this.updateTransformChange(!0),this._pos.y!=t&&(this._pos.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._pos.z},set:function(t){this.updateTransformChange(!0),this._pos.z!=t&&(this._pos.z=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this._rot.x},set:function(t){this.updateTransformChange(!0),this._rot.x!=t&&(this._rot.x=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this._rot.y},set:function(t){this.updateTransformChange(!0),this._rot.y!=t&&(this._rot.y=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._rot.z},set:function(t){this.updateTransformChange(!0),this._rot.z!=t&&(this._rot.z=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._sca.x},set:function(t){this.updateTransformChange(!0),this._sca.x!=t&&(this._sca.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._sca.y},set:function(t){this.updateTransformChange(!0),this._sca.y!=t&&(this._sca.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleZ",{get:function(){return this._sca.z},set:function(t){this.updateTransformChange(!0),this._sca.z!=t&&(this._sca.z=t)},enumerable:!0,configurable:!0}),e.prototype.setRotationFromAxisAngle=function(t,e){t.normalize(),this.updateTransformChange(!0),this._orientation.fromAxisAngle(t,e),this._orientation.toEulerAngles(this._rot),this._axis.copyFrom(t),this._angle=e},Object.defineProperty(e.prototype,"modelMatrix",{get:function(){return this._transformChange&&this.updateModelMatrix(),this._modelMatrix3D},set:function(t){var e=t.decompose(a.Orientation3D.QUATERNION);this.globalPosition=e[0],a.MathUtil.CALCULATION_QUATERNION.x=e[1].x,a.MathUtil.CALCULATION_QUATERNION.y=e[1].y,a.MathUtil.CALCULATION_QUATERNION.z=e[1].z,a.MathUtil.CALCULATION_QUATERNION.w=e[1].w,this.globalOrientation=a.MathUtil.CALCULATION_QUATERNION,this.globalScale=e[2]},enumerable:!0,configurable:!0}),e.prototype.updateModelMatrix=function(){if(null!=this.parent){var t=this.parent.globalOrientation;this._globalOrientation.multiply(t,this._orientation),this._globalOrientation.toEulerAngles(this._globalRot);var e=this.parent.globalScale;this._globalSca.copyFrom(e.multiply(this._sca)),t.transformVector(e.multiply(this._pos),this._globalPos),this._globalPos.copyFrom(this._globalPos.add(this.parent.globalPosition))}else this._globalOrientation.copyFrom(this._orientation),this._globalPos.copyFrom(this._pos),this._globalSca.copyFrom(this._sca),this._globalRot.copyFrom(this._rot);this.onMakeTransform(),this.onUpdateTransform(),this._transformChange=!1},e.prototype.onUpdateTransform=function(){},e.prototype.onMakeTransform=function(){this._modelMatrix3D.makeTransform(this._globalPos,this._globalSca,this._globalOrientation)},Object.defineProperty(e.prototype,"globalX",{get:function(){return this.globalPosition.x},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.x=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalY",{get:function(){return this.globalPosition.y},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.y=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalZ",{get:function(){return this.globalPosition.z},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.z=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalPosition",{get:function(){return this._transformChange&&this.modelMatrix,this._globalPos},set:function(t){this.parent?(this.parent.globalOrientation.inverse(this._qut),t.subtract(this.parent.globalPosition,this._vec),this._qut.transformVector(this._vec,this._vec),this._vec.divided(this.parent.globalScale,this._vec),this.position=this._vec):this.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalRotationX",{get:function(){return this.globalRotation.x},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.x=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalRotationY",{get:function(){return this.globalRotation.y},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.y=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalRotationZ",{get:function(){return this.globalRotation.z},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.z=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalRotation",{get:function(){return this._transformChange&&this.modelMatrix,this._globalRot},set:function(t){this._qut.fromEulerAngles(t.x,t.y,t.z),this.globalOrientation=this._qut},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalScale",{get:function(){return this._transformChange&&this.modelMatrix,this._globalSca},set:function(t){this.parent?(t.divided(this.parent.globalScale,this._vec),this.scale=this._vec):this.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalScaleX",{get:function(){return this.globalScale.x},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.x=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalScaleY",{get:function(){return this.globalScale.y},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.y=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalScaleZ",{get:function(){return this.globalScale.z},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.z=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalOrientation",{get:function(){return this._transformChange&&this.modelMatrix,this._globalOrientation},set:function(t){this.parent?(this.parent.globalOrientation.inverse(this._qut),this._qut.multiply(this._qut,t),this.orientation=this._qut):this.orientation=t},enumerable:!0,configurable:!0}),e.prototype.addChild=function(t){if(t.parent)throw Error("This object is already the other child object.");if(0<=this.childs.indexOf(t))throw Error("The same child object has been added.");return this.childs.push(t),e.renderListChange=!0,t.parent=this,t._isRoot=!1,t.updateTransformChange(!0),t},e.prototype.addChildAt=function(t,e){return e<0?this.childs.splice(0,0,t):e>=this.childs.length?this.childs.push(t):this.childs.splice(e,0,t),t.parent=this,t.updateTransformChange(!0),t},e.prototype.getChildAt=function(t){return t<0||t>=this.childs.length?null:this.childs[t]},e.prototype.getChildIndex=function(t){for(var e=0;e<this.childs.length;++e)if(this.childs[e]==t)return e;return-1},e.prototype.removeChild=function(t){for(var e=0;e<this.childs.length;++e)if(this.childs[e]==t)return t.parent=null,this.childs.splice(e,1),t;return t.updateTransformChange(!0),null},e.prototype.removeChildAt=function(t){if(t<0||t>=this.childs.length)return null;var e=this.childs[t];return e.parent=null,this.childs.splice(t,1),e.updateTransformChange(!0),e},e.prototype.setChildIndex=function(t,e){for(var i=0;i<this.childs.length;++i)if(this.childs[i]==t){if(i==e)return;if(i<e)for(var a=i;e<a;--a)this.childs[a]=this.childs[a-1];else if(e<i)for(a=i;a<e;++a)this.childs[a]=this.childs[a+1];return void(this.childs[e]=t)}},e.prototype.swapObject=function(t){for(var e=t.parent,i=new Array,a=0;a<t.childs.length;++a)i[a]=t.childs[a];if(this.parent){var r=this.parent.getChildIndex(this);this.parent.childs[r]=t}if(t.parent){r=t.parent.getChildIndex(t);t.parent.childs[r]=this}t.parent=this.parent,this.parent=e;for(a=t.childs.length=0;a<this.childs.length;++a)t.childs[a]=this.childs[a],t.childs[a].parent=t;for(a=this.childs.length=0;a<i.length;++a)this.childs[a]=i[a],this.childs[a].parent=this;this.updateTransformChange(!0),t.updateTransformChange(!0)},e.prototype.swapChildren=function(t,e){for(var i=0,a=0;i<this.childs.length;++i)if(this.childs[i]==t){for(;a<this.childs.length;++a)if(this.childs[a]==e){var r=this.childs[i];this.childs[i]=this.childs[a],this.childs[a]=r;break}return}},e.prototype.swapChildrenAt=function(t,e){if(!(t<0||t>=this.childs.length||e<0||e>=this.childs.length)){var i=this.childs[t];this.childs[t]=this.childs[e],this.childs[e]=i}},e.prototype.lookAt=function(t,e,i){void 0===i&&(i=a.Vector3D.Y_AXIS)},Object.defineProperty(e.prototype,"lookAtPosition",{get:function(){return new a.Vector3D},enumerable:!0,configurable:!0}),e.prototype.findObject3D=function(t){for(var e=null,i=0;i<this.childs.length;++i){if(this.childs[i].name==t)return this.childs[i];if(e=this.childs[i].findObject3D(t))return e}return e},e.prototype.findObject3DToID=function(t){for(var e=null,i=0;i<this.childs.length;++i){if(this.childs[i].id==t)return this.childs[i];if(e=this.childs[i].findObject3DToID(t))return e}return e},e.prototype.updateTransformChange=function(t){this._transformChange=t;for(var e=0;e<this.childs.length;++e)this.childs[e].updateTransformChange(t)},e.prototype.bindAnimation=function(t){this.proAnimation=t,this.proAnimation.bindObject3D(this)},e.prototype.update=function(t,e,i){this.proAnimation&&this.proAnimation.update(e)},e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this);for(var t=0;t<this.childs.length;t++)this.childs[t].dispose()},e.renderListChange=!0,e.s_id=0,e}(a.EventDispatcher);a.Object3D=e}(egret3d||(egret3d={})),function(t){var e=function(a){function t(){a.call(this),this.type="",this.multiMaterial={},this._materialCount=0,this.animation=null}return __extends(t,a),Object.defineProperty(t.prototype,"drawOrder",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype.update=function(t,e,i){a.prototype.update.call(this,t,e,i)},t}(t.Object3D);t.IRender=e}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.Object3D);t.Entity=e}(egret3d||(egret3d={})),function(r){var t=function(a){function i(t,e,i){void 0===i&&(i=null),a.call(this),this.type="mesh",this.geometry=t,i?this.animation=i:t&&this.geometry.vertexFormat&r.VertexFormat.VF_SKIN&&(this.animation=new r.SkeletonAnimation(this.geometry.skeleton)),this.material=e||new r.TextureMaterial,this.addSubMaterial(0,this.material),this.bound=this.buildBoundBox()}return __extends(i,a),i.prototype.setMaterialByID=function(){},Object.defineProperty(i.prototype,"aabb",{get:function(){return this._aabbBox},enumerable:!0,configurable:!0}),i.prototype.initAABB=function(){this._aabbBox=new r.QuadAABB;var t=this.bound;this._aabbBox.maxPosX=t.max.x,this._aabbBox.maxPosY=t.max.z,this._aabbBox.minPosX=t.min.x,this._aabbBox.minPosY=t.min.z},Object.defineProperty(i.prototype,"isTriangle",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.onUpdateTransform=function(){this._aabbBox.setOffset(this._pos)},Object.defineProperty(i.prototype,"lightGroup",{set:function(t){for(var e in this._lightGroup=t,this.multiMaterial)this.multiMaterial[e].lightGroup=this._lightGroup},enumerable:!0,configurable:!0}),i.prototype.addSubMaterial=function(t,e){this.multiMaterial[t]||this._materialCount++,(this.multiMaterial[t]=e).lightGroup=this._lightGroup},i.prototype.removeSubMaterial=function(t){this.multiMaterial[t]&&(delete this.multiMaterial[t],this._materialCount--)},i.prototype.getMaterial=function(t){return this.multiMaterial[t]},i.prototype.materialCount=function(){return this._materialCount},i.prototype.clone=function(){var t=null;this.animation&&(t=this.animation.clone());var e=new i(this.geometry,this.material,t);return e.multiMaterial=this.multiMaterial,e},i.prototype.update=function(t,e,i){a.prototype.update.call(this,t,e,i),this.isDisable||(this.animation&&this.animation.update(t,e,this.geometry),this.geometry.subGeometrys.length<=0&&this.geometry.buildDefaultSubGeometry())},i.prototype.buildBoundBox=function(){if(!this.geometry)return null;var t=new r.BoundBox(this);t.min.copyFrom(new r.Vector3D(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),t.max.copyFrom(new r.Vector3D(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE));for(var e=0;e<this.geometry.verticesData.length;e+=this.geometry.vertexAttLength)t.max.x<this.geometry.verticesData[e]&&(t.max.x=this.geometry.verticesData[e]),t.max.y<this.geometry.verticesData[e+1]&&(t.max.y=this.geometry.verticesData[e+1]),t.max.z<this.geometry.verticesData[e+2]&&(t.max.z=this.geometry.verticesData[e+2]),t.min.x>this.geometry.verticesData[e]&&(t.min.x=this.geometry.verticesData[e]),t.min.y>this.geometry.verticesData[e+1]&&(t.min.y=this.geometry.verticesData[e+1]),t.min.z>this.geometry.verticesData[e+2]&&(t.min.z=this.geometry.verticesData[e+2]);return t.fillBox(t.min,t.max),t.createChild(),this.bound=t,this.initAABB(),t},i}(r.IRender);r.Mesh=t}(egret3d||(egret3d={})),function(n){var t=function(r){function t(t,e,i,a){void 0===e&&(e=null),void 0===i&&(i=100),void 0===a&&(a=100),null==e&&(e=new n.PlaneGeometry(i,a,1,1,1,1,n.Vector3D.Z_AXIS)),r.call(this,e,t),this.bound||(this.bound=this.buildBoundBox())}return __extends(t,r),t.prototype.update=function(t,e,i){this.globalOrientation=i.globalOrientation},t}(n.Mesh);n.Billboard=t}(egret3d||(egret3d={})),function(r){var t=function(a){function t(t,e,i){void 0===i&&(i=null),a.call(this,t,e),this.camera=i,e.cullMode=r.ContextConfig.FRONT,e.ambientColor=16777215,this.bound||(this.bound=this.buildBoundBox())}return __extends(t,a),t.prototype.update=function(t,e,i){a.prototype.update.call(this,t,e,i),this.camera&&(this.position=this.camera.globalPosition)},t}(r.Mesh);r.Sky=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this,new i.Geometry,new i.ColorMaterial(16711680)),this.material.drawMode=i.DrawMode.LINES,this.geometry.vertexFormat=i.VertexFormat.VF_POSITION|i.VertexFormat.VF_NORMAL|i.VertexFormat.VF_COLOR|i.VertexFormat.VF_UV0}return __extends(e,t),e}(i.Mesh);i.Wireframe=t}(egret3d||(egret3d={})),function(i){var t;(t=i.LightType||(i.LightType={}))[t.pointlight=0]="pointlight",t[t.directlight=1]="directlight",t[t.spotLightlight=2]="spotLightlight";var e=(i.LightType,function(t){function e(){t.call(this),this.lightId=-1,this.lightType=-1,this._ambient=new i.Vector3D(0,0,0),this._diffuse=new i.Vector3D(1,1,1),this._specular=new i.Vector3D(1,1,1),this._halfVector=new i.Vector3D(1,1,1),this._intensity=1,this._radius=100,this._falloff=100,this._halfIntensity=0,this._spotExponent=1.1,this._spotCutoff=.7,this._spotCosCutoff=.1,this._constantAttenuation=.1,this._linearAttenuation=.1,this._quadraticAttenuation=.1,this._lightIndex=-1,this.len=25,this._change=!0,this.lightViewPos=new i.Vector3D}return __extends(e,t),Object.defineProperty(e.prototype,"intensity",{get:function(){return this._intensity},set:function(t){this._intensity!=t&&(this._intensity=t,this._change=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfIntensity",{get:function(){return this._halfIntensity},set:function(t){this._halfIntensity!=t&&(this._halfIntensity=t,this._change=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambient",{get:function(){return 0},set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuse",{get:function(){return 0},set:function(t){this._diffuse.w=(t>>24&255)/255,this._diffuse.x=(t>>16&255)/255,this._diffuse.y=(t>>8&255)/255,this._diffuse.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specular",{get:function(){return 0},set:function(t){this._specular.w=(t>>24&255)/255,this._specular.x=(t>>16&255)/255,this._specular.y=(t>>8&255)/255,this._specular.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.updateLightData=function(t,e,i){},e}(i.Object3D));i.LightBase=e}(egret3d||(egret3d={})),function(i){var t=function(e){function a(t){e.call(this),this.scenePosMat=new i.Matrix4_4,this.lightType=i.LightType.pointlight,this.diffuse=t}return __extends(a,e),Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"falloff",{get:function(){return this._falloff},set:function(t){this._falloff=t},enumerable:!0,configurable:!0}),a.prototype.updateLightData=function(t,e,i){i[e*a.stride]=this.globalPosition.x,i[e*a.stride+1]=this.globalPosition.y,i[e*a.stride+2]=this.globalPosition.z,i[e*a.stride+3]=this._diffuse.x*this._intensity,i[e*a.stride+4]=this._diffuse.y*this._intensity,i[e*a.stride+5]=this._diffuse.z*this._intensity},a.scenePos=new i.Vector3D,a.stride=6,a}(i.LightBase);i.PointLight=t}(egret3d||(egret3d={})),function(r){var t=function(e){function a(t){e.call(this),this.diffuse=t,this.lightType=r.LightType.spotLightlight}return __extends(a,e),Object.defineProperty(a.prototype,"spotCosCutoff",{get:function(){return this._spotCosCutoff},set:function(t){this._spotCosCutoff=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"spotExponent",{get:function(){return this._spotExponent},set:function(t){this._spotExponent=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"constantAttenuation",{get:function(){return this._constantAttenuation},set:function(t){this._constantAttenuation=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"linearAttenuation",{get:function(){return this._linearAttenuation},set:function(t){this._linearAttenuation=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"quadraticAttenuation",{get:function(){return this._quadraticAttenuation},set:function(t){this._quadraticAttenuation=t},enumerable:!0,configurable:!0}),a.prototype.updateLightData=function(t,e,i){i[e*a.stride]=this.globalPosition.x,i[e*a.stride+1]=this.globalPosition.y,i[e*a.stride+2]=this.globalPosition.z,i[e*a.stride+3]=this.globalRotation.x*r.MathUtil.DEGREES_TO_RADIANS,i[e*a.stride+4]=this.globalRotation.y*r.MathUtil.DEGREES_TO_RADIANS,i[e*a.stride+5]=this.globalRotation.z*r.MathUtil.DEGREES_TO_RADIANS,i[e*a.stride+6]=this._diffuse.x,i[e*a.stride+7]=this._diffuse.y,i[e*a.stride+8]=this._diffuse.z,i[e*a.stride+9]=this._spotExponent,i[e*a.stride+10]=this._spotCosCutoff,i[e*a.stride+11]=this._constantAttenuation,i[e*a.stride+12]=this._linearAttenuation,i[e*a.stride+13]=this._quadraticAttenuation},a.stride=14,a}(r.LightBase);r.SpotLight=t}(egret3d||(egret3d={})),function(i){var t=function(e){function a(t){e.call(this),t.normalize(),this.lightType=i.LightType.directlight,this._rot.x=t.x,this._rot.y=t.y,this._rot.z=t.z}return __extends(a,e),Object.defineProperty(a.prototype,"ambient",{set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),a.prototype.updateLightData=function(t,e,i){i[e*a.stride+0]=this._rot.x,i[e*a.stride+1]=this._rot.y,i[e*a.stride+2]=this._rot.z,i[e*a.stride+3]=this._diffuse.x*this._intensity,i[e*a.stride+4]=this._diffuse.y*this._intensity,i[e*a.stride+5]=this._diffuse.z*this._intensity},a.stride=6,a}(i.LightBase);i.DirectLight=t}(egret3d||(egret3d={})),function(i){var t=function(){function t(){this.lightNum=0,this.directLightList=new Array,this.spotLightList=new Array,this.pointLightList=new Array}return t.prototype.addLight=function(t){switch(t.lightType){case i.LightType.directlight:this.directLightList.push(t),this.lightNum++;break;case i.LightType.pointlight:this.pointLightList.push(t),this.lightNum++;break;case i.LightType.spotLightlight:this.spotLightList.push(t),this.lightNum++}},t.prototype.removeLight=function(t){switch(t.lightType){case i.LightType.directlight:0<=(e=this.directLightList.indexOf(t))&&e<this.directLightList.length&&(this.directLightList.splice(e,1),this.lightNum--);break;case i.LightType.pointlight:0<=(e=this.pointLightList.indexOf(t))&&e<this.pointLightList.length&&(this.pointLightList.splice(e,1),this.lightNum--);break;case i.LightType.spotLightlight:var e;0<=(e=this.spotLightList.indexOf(t))&&e<this.spotLightList.length&&(this.spotLightList.splice(e,1),this.lightNum--)}},t}();i.LightGroup=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){this._num=0,this._objDict={},this.renderList=new Array,this.mousePickList=new Array,this._nodes=new Array}return Object.defineProperty(t.prototype,"root",{get:function(){return this.rootScene},set:function(t){this.rootScene=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this.renderList=this._nodes,this.renderList.length=0,t.frustum.update(t)},t.prototype.findRenderObject=function(t){for(var e=0;e<this.renderList.length;++e)if(this.renderList[e]===t)return e;return-1},t}();t.CollectBase=e}(egret3d||(egret3d={})),function(s){var t=function(o){function t(){o.call(this),this.softRenderItems={},this.numberVertex=0,this.numberFace=0,this.numberDraw=0,this.numberSkin=0,this.numberAnimation=0,this.numberParticle=0}return __extends(t,o),t.prototype.applyRender=function(t,e){if(t.visible){t.material&&this.addRenderList(t,e);for(var i=0;i<t.childs.length;i++)this.applyRender(t.childs[i],e)}},t.prototype.addRenderList=function(t,e){if(!t.enableCulling||e.isVisibleToCamera(t)){if(t.material){if("normalObject"==t.tag.name&&t.material.materialData.alphaBlending)this.softRenderItems.alphaObject.push(t);else for(var i=0;i<s.Layer.layerNumber;i++)t.tag.name==s.Layer.layerType[i]&&this.softRenderItems[s.Layer.layerType[i]].push(t);s.Egret3DEngine.debug&&(this.numberFace+=t.geometry.faceCount,this.numberVertex+=t.geometry.vertexCount,this.numberDraw+=1,t.animation&&(this.numberSkin+=1),t.proAnimation&&(this.numberAnimation+=1),"particleEmit"==t.type&&(this.numberParticle+=1))}t.enablePick&&this.mousePickList.push(t)}},t.prototype.update=function(t){if(o.prototype.update.call(this,t),this.numberFace=0,this.numberVertex=0,this.numberDraw=0,this.numberSkin=0,this.numberAnimation=0,this.numberParticle=0,this.clearLayerList(),this.renderList.length=0,this.mousePickList.length=0,this.rootScene.quad){var e=t.frustum.box,i=this.rootScene.quad.getNodesByAABB(e.min.x,e.min.z,e.max.x,e.max.z);this.appendQuadList(i,t)}else this.applyRender(this.rootScene.root,t);for(var a,r=0;r<s.Layer.layerType.length;r++){a=this.softRenderItems[s.Layer.layerType[r]].length,this.softRenderItems[s.Layer.layerType[r]].sort(this.sortByOrder);for(var n=0;n<a;n++)this.renderList.push(this.softRenderItems[s.Layer.layerType[r]][n])}},t.prototype.appendQuadList=function(t,e){for(var i,a,r=0,n=t;r<n.length;r++)(a=n[r])instanceof s.Mesh&&((i=a)&&i.visible&&i.material&&this.addRenderList(i,e))},t.prototype.clearLayerList=function(){for(var t=0;t<s.Layer.layerType.length;t++)this.softRenderItems[s.Layer.layerType[t]]?this.softRenderItems[s.Layer.layerType[t]].length=0:this.softRenderItems[s.Layer.layerType[t]]=[]},t.prototype.sort=function(t,e,i){var a=s.Vector3D.distance(t.globalPosition,i.position),r=s.Vector3D.distance(e.globalPosition,i.position);return r<a?-1:a<r?1:0},t.prototype.sortByOrder=function(t,e){return e.drawOrder-t.drawOrder},t}(s.CollectBase);s.EntityCollect=t}(egret3d||(egret3d={})),function(o){var t=function(){function t(){this._vtxNum=8,this._planeNum=6,this._tempVector=new o.Vector3D,this._vertex=new Array;for(var t=0;t<this._vtxNum;++t)this._vertex.push(new o.Vector3D);this._pos=new o.Vector3D,this._plane=new Array;for(t=0;t<6;++t)this._plane.push(new o.Plane3D);this.box=new o.BoundBox(null,new o.Vector3D,new o.Vector3D),this.center=new o.Vector3D}return t.prototype.makeFrustum=function(t,e,i,a){var r=Math.tan(t/2*(Math.PI/180)),n=i*r,o=n*e,s=a*r,h=s*e;this._vertex[0].x=o,this._vertex[0].y=n,this._vertex[0].z=i,this._vertex[1].x=-o,this._vertex[1].y=n,this._vertex[1].z=i,this._vertex[2].x=-o,this._vertex[2].y=-n,this._vertex[2].z=i,this._vertex[3].x=o,this._vertex[3].y=-n,this._vertex[3].z=i,this._vertex[4].x=h,this._vertex[4].y=s,this._vertex[4].z=a,this._vertex[5].x=-h,this._vertex[5].y=s,this._vertex[5].z=a,this._vertex[6].x=-h,this._vertex[6].y=-s,this._vertex[6].z=a,this._vertex[7].x=h,this._vertex[7].y=-s,this._vertex[7].z=a},t.prototype.update=function(t){this.makeFrustum(t.fieldOfView,t.aspectRatio,t.near,t.far);var e=new Array,i=o.Matrix4_4.helpMatrix;i.copyFrom(t.modelMatrix),this._curVer=e;for(var a=0;a<this._vtxNum;++a)e.push(i.transformVector(this._vertex[a]));this.box.max.x=this.box.max.y=this.box.max.z=-Number.MAX_VALUE,this.box.min.x=this.box.min.y=this.box.min.z=Number.MAX_VALUE;for(a=0;a<e.length;++a)this.box.max.x<e[a].x&&(this.box.max.x=e[a].x),this.box.max.y<e[a].y&&(this.box.max.y=e[a].y),this.box.max.z<e[a].z&&(this.box.max.z=e[a].z),this.box.min.x>e[a].x&&(this.box.min.x=e[a].x),this.box.min.y>e[a].y&&(this.box.min.y=e[a].y),this.box.min.z>e[a].z&&(this.box.min.z=e[a].z);this.box.calculateBox(),this._plane[0].fromPoints(e[4],e[5],e[6]),this._plane[1].fromPoints(e[1],e[6],e[5]),this._plane[2].fromPoints(e[0],e[4],e[7]),this._plane[3].fromPoints(e[1],e[0],e[3]),this._plane[4].fromPoints(e[1],e[5],e[4]),this._plane[5].fromPoints(e[3],e[7],e[6]);for(a=0;a<this._planeNum;a++)this._plane[a].normalize();var r=new o.Vector3D;r.copyFrom(e[0].subtract(e[2])),r.scaleBy(.5),r.copyFrom(e[2].add(r));var n=new o.Vector3D;n.copyFrom(e[4].subtract(e[6])),n.scaleBy(.5),n.copyFrom(e[6].add(n)),this.center.copyFrom(n.subtract(r)),this.center.scaleBy(.5),this.center.copyFrom(r.add(this.center))},t.prototype.inPoint=function(t){for(var e=0;e<this._plane.length;++e)if(0<this._plane[e].distance(t))return!1;return!0},t.prototype.inSphere=function(t,e){for(var i=0;i<this._plane.length;++i)if(e<this._plane[i].distance(t))return!1;return!0},t.prototype.inBox=function(t){for(var e=this._plane.length,i=0;i<e;++i){for(var a=t.vexData.length/3,r=t.vexData.length,n=0;n<r;n+=3)this._tempVector.setTo(t.vexData[n],t.vexData[n+1],t.vexData[n+2]),this._tempVector.copyFrom(t.transform.transformVector(this._tempVector)),0<this._plane[i].distance(this._tempVector)&&a--;if(a<=0)return!1}return!0},t}();o.Frustum=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){}return t.layerType=["normalObject","normalAlphaObject","alphaObject","effect","gui"],t.layerTypeThan=[3,2,1,0],t.layerNumber=5,t}();t.Layer=e}(egret3d||(egret3d={})),function(t){var e=function(){this.name="normalObject",this.clearDepth=!1};(egret3d||(egret3d={})).Tag=e}(),function(d){var t=function(){function t(){}return t.pickObject3DList=function(t,e,i,a,r){void 0===a&&(a=!1),void 0===r&&(r=null),r||(r=new Array),r.length=0;var n=this.ray;if(d.Input.mouseX<e.x||d.Input.mouseX>o+e.width||d.Input.mouseY<e.y||d.Input.mouseY>s+e.height)return r;var o=d.Input.mouseX-e.x,s=d.Input.mouseY-e.y;n.CalculateAndTransformRay(e.width,e.height,e.camera3D.modelMatrix,e.camera3D.projectMatrix,o,s);for(var h=0;h<i.length;++h){var l=i[h];switch(new d.Vector3D,l.pickType){case d.PickType.BoundPick:if(null!=l.bound){var u=l.bound;a?(u=l.currentBound)&&n.IntersectMesh(u.vexData,u.indexData,u.vexLength,u.indexData.length/3,0,l.modelMatrix,l.pickResult)&&r.push(i[h]):n.IntersectMesh(u.vexData,u.indexData,u.vexLength,u.indexData.length/3,0,l.modelMatrix,l.pickResult)&&r.push(i[h])}break;case d.PickType.PositionPick:var c=0;l.geometry.vertexFormat&d.VertexFormat.VF_POSITION&&(c+=d.Geometry.positionSize),l.geometry.vertexFormat&d.VertexFormat.VF_NORMAL&&(c+=d.Geometry.normalSize),l.geometry.vertexFormat&d.VertexFormat.VF_TANGENT&&(c+=d.Geometry.tangentSize),l.geometry.vertexFormat&d.VertexFormat.VF_COLOR&&(c+=d.Geometry.colorSize),n.IntersectMeshEx(l,c,l.pickResult)&&r.push(i[h]);break;case d.PickType.UVPick:c=0;l.geometry.vertexFormat&d.VertexFormat.VF_POSITION&&(c+=d.Geometry.positionSize),l.geometry.vertexFormat&d.VertexFormat.VF_NORMAL&&(c+=d.Geometry.normalSize),l.geometry.vertexFormat&d.VertexFormat.VF_TANGENT&&(c+=d.Geometry.tangentSize),l.geometry.vertexFormat&d.VertexFormat.VF_COLOR&&(c+=d.Geometry.colorSize),n.IntersectMeshEx(l,c,l.pickResult)&&r.push(i[h])}}return r},t.ray=new d.Ray,t}();d.Picker=t}(egret3d||(egret3d={})),function(i){var t,e;(t=i.GeometryType||(i.GeometryType={}))[t.normal_geometry=0]="normal_geometry",t[t.skin_geometry=1]="skin_geometry",t[t.particle_geometry=2]="particle_geometry",i.GeometryType,(e=i.VertexFormat||(i.VertexFormat={}))[e.VF_POSITION=1]="VF_POSITION",e[e.VF_NORMAL=2]="VF_NORMAL",e[e.VF_TANGENT=4]="VF_TANGENT",e[e.VF_COLOR=8]="VF_COLOR",e[e.VF_UV0=16]="VF_UV0",e[e.VF_UV1=32]="VF_UV1",e[e.VF_SKIN=64]="VF_SKIN";var l=i.VertexFormat,a=function(){function h(){this.geomtryType=-1,this._vertexFormat=0,this.vertexAttLength=0,this.verticesData=new Array,this.indexData=new Array,this.source_positionData=new Array,this.source_normalData=new Array,this.source_tangentData=new Array,this.source_colorData=new Array,this.source_uvData=new Array,this.source_uv2Data=new Array,this.source_SkinData=new Array,this.faceOrBack=!1,this.subGeometrys=new Array,this._bufferDiry=!0,this._vertexCount=-1}return Object.defineProperty(h.prototype,"vertexCount",{get:function(){return this._vertexCount<0&&(this._vertexCount=this.verticesData.length/this.vertexAttLength),this._vertexCount},set:function(t){this._vertexCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"faceCount",{get:function(){return this.indexData.length/3},enumerable:!0,configurable:!0}),h.prototype.buildDefaultSubGeometry=function(){var t=new i.SubGeometry;t.matID=0,t.geometry=this,t.start=0,t.count=this.indexData?this.indexData.length:0,this.subGeometrys.push(t)},Object.defineProperty(h.prototype,"vertexFormat",{get:function(){return this._vertexFormat},set:function(t){this._vertexFormat=t,this.vertexFormat&l.VF_POSITION&&(this.vertexAttLength+=h.positionSize),this.vertexFormat&l.VF_NORMAL&&(this.vertexAttLength+=h.normalSize),this.vertexFormat&l.VF_TANGENT&&(this.vertexAttLength+=h.tangentSize),this.vertexFormat&l.VF_COLOR&&(this.vertexAttLength+=h.colorSize),this.vertexFormat&l.VF_UV0&&(this.vertexAttLength+=h.uvSize),this.vertexFormat&l.VF_UV1&&(this.vertexAttLength+=h.uv2Size),this.vertexFormat&l.VF_SKIN&&(this.vertexAttLength+=h.skinSize),this.vertexSizeInBytes=4*this.vertexAttLength},enumerable:!0,configurable:!0}),h.prototype.calculateVertexFormat=function(){this.vertexCount=this.source_positionData.length/h.positionSize;for(var t=0;t<this.vertexCount;++t)if(this.vertexFormat&l.VF_POSITION&&(this.verticesData.push(this.source_positionData[t*h.positionSize]),this.verticesData.push(this.source_positionData[t*h.positionSize+1]),this.verticesData.push(this.source_positionData[t*h.positionSize+2])),this.vertexFormat&l.VF_NORMAL&&(this.verticesData.push(this.source_normalData[t*h.normalSize]),this.verticesData.push(this.source_normalData[t*h.normalSize+1]),this.verticesData.push(this.source_normalData[t*h.normalSize+2])),this.vertexFormat&l.VF_TANGENT&&(this.verticesData.push(this.source_tangentData[t*h.tangentSize]),this.verticesData.push(this.source_tangentData[t*h.tangentSize+1]),this.verticesData.push(this.source_tangentData[t*h.tangentSize+2])),this.vertexFormat&l.VF_COLOR&&(this.verticesData.push(this.source_colorData[t*h.colorSize]),this.verticesData.push(this.source_colorData[t*h.colorSize+1]),this.verticesData.push(this.source_colorData[t*h.colorSize+2]),this.verticesData.push(this.source_colorData[t*h.colorSize+3])),this.vertexFormat&l.VF_UV0&&(this.verticesData.push(this.source_uvData[t*h.uvSize]),this.verticesData.push(this.source_uvData[t*h.uvSize+1])),this.vertexFormat&l.VF_UV1&&(this.verticesData.push(this.source_uv2Data[t*h.uv2Size]),this.verticesData.push(this.source_uv2Data[t*h.uv2Size+1])),this.vertexFormat&l.VF_SKIN)for(var e=0;e<h.skinSize;++e)this.verticesData.push(this.source_SkinData[t*h.skinSize+e])},h.prototype.activeState=function(t,e,i,a){this._bufferDiry&&(this._bufferDiry=!1,this.upload(i)),i.bindVertexBuffer(this.sharedVertexBuffer),i.bindIndexBuffer(this.sharedIndexBuffer)},h.prototype.upload=function(t,e){void 0===e&&(e=i.Context3DProxy.gl.STATIC_DRAW),this.sharedIndexBuffer||this.sharedVertexBuffer?(this.sharedVertexBuffer.arrayBuffer.set(this.verticesData),t.uploadVertexBuffer(this.sharedVertexBuffer)):(this.sharedIndexBuffer=t.creatIndexBuffer(this.indexData),this.sharedVertexBuffer=t.creatVertexBuffer(this.verticesData,e))},h.prototype.getVertexForIndex=function(t,e,i){if(void 0===i&&(i=null),i||(i=new Array),t<0||t>=this.verticesData.length)return i;var a=0;if(this.vertexFormat&l.VF_POSITION&&(e&l.VF_POSITION&&(i.push(this.verticesData[t*this.vertexAttLength+a+0]),i.push(this.verticesData[t*this.vertexAttLength+a+1]),i.push(this.verticesData[t*this.vertexAttLength+a+2])),a+=h.positionSize),this.vertexFormat&l.VF_NORMAL&&(e&l.VF_NORMAL&&(i.push(this.verticesData[t*this.vertexAttLength+a+0]),i.push(this.verticesData[t*this.vertexAttLength+a+1]),i.push(this.verticesData[t*this.vertexAttLength+a+2])),a+=h.normalSize),this.vertexFormat&l.VF_TANGENT&&(e&l.VF_TANGENT&&(i.push(this.verticesData[t*this.vertexAttLength+a+0]),i.push(this.verticesData[t*this.vertexAttLength+a+1]),i.push(this.verticesData[t*this.vertexAttLength+a+2])),a+=h.tangentSize),this.vertexFormat&l.VF_COLOR&&(e&l.VF_COLOR&&(i.push(this.verticesData[t*this.vertexAttLength+a+0]),i.push(this.verticesData[t*this.vertexAttLength+a+1]),i.push(this.verticesData[t*this.vertexAttLength+a+2]),i.push(this.verticesData[t*this.vertexAttLength+a+3])),a+=h.colorSize),this.vertexFormat&l.VF_UV0&&(e&l.VF_UV0&&(i.push(this.verticesData[t*this.vertexAttLength+a+0]),i.push(this.verticesData[t*this.vertexAttLength+a+1])),a+=h.uvSize),this.vertexFormat&l.VF_UV1&&(e&l.VF_UV1&&(i.push(this.verticesData[t*this.vertexAttLength+a+0]),i.push(this.verticesData[t*this.vertexAttLength+a+1])),a+=h.uv2Size),this.vertexFormat&l.VF_SKIN){if(e&l.VF_SKIN)for(var r=0;r<h.skinSize;++r)i.push(this.verticesData[t*this.vertexAttLength+a+r]);a+=h.skinSize}return i},h.prototype.setVerticesForIndex=function(t,e,i,a){void 0===a&&(a=1);for(var r=0,n=0,o=0;o<a;++o){if(r=0,this.vertexFormat&l.VF_POSITION&&(e&l.VF_POSITION?(this.verticesData[t*this.vertexAttLength+r+0]=i[n+0],this.verticesData[t*this.vertexAttLength+r+1]=i[n+1],this.verticesData[t*this.vertexAttLength+r+2]=i[n+2],n+=h.positionSize):(this.verticesData[t*this.vertexAttLength+r+0]=0,this.verticesData[t*this.vertexAttLength+r+1]=0,this.verticesData[t*this.vertexAttLength+r+2]=0),r+=h.positionSize),this.vertexFormat&l.VF_NORMAL&&(e&l.VF_NORMAL?(this.verticesData[t*this.vertexAttLength+r+0]=i[n+0],this.verticesData[t*this.vertexAttLength+r+1]=i[n+1],this.verticesData[t*this.vertexAttLength+r+2]=i[n+2],n+=h.normalSize):(this.verticesData[t*this.vertexAttLength+r+0]=0,this.verticesData[t*this.vertexAttLength+r+1]=0,this.verticesData[t*this.vertexAttLength+r+2]=0),r+=h.normalSize),this.vertexFormat&l.VF_TANGENT&&(e&l.VF_TANGENT?(this.verticesData[t*this.vertexAttLength+r+0]=i[n+0],this.verticesData[t*this.vertexAttLength+r+1]=i[n+1],this.verticesData[t*this.vertexAttLength+r+2]=i[n+2],n+=h.tangentSize):(this.verticesData[t*this.vertexAttLength+r+0]=0,this.verticesData[t*this.vertexAttLength+r+1]=0,this.verticesData[t*this.vertexAttLength+r+2]=0),r+=h.tangentSize),this.vertexFormat&l.VF_COLOR&&(e&l.VF_COLOR?(this.verticesData[t*this.vertexAttLength+r+0]=i[n+0],this.verticesData[t*this.vertexAttLength+r+1]=i[n+1],this.verticesData[t*this.vertexAttLength+r+2]=i[n+2],this.verticesData[t*this.vertexAttLength+r+3]=i[n+3],n+=h.colorSize):(this.verticesData[t*this.vertexAttLength+r+0]=1,this.verticesData[t*this.vertexAttLength+r+1]=1,this.verticesData[t*this.vertexAttLength+r+2]=1,this.verticesData[t*this.vertexAttLength+r+3]=1),r+=h.colorSize),this.vertexFormat&l.VF_UV0&&(e&l.VF_UV0?(this.verticesData[t*this.vertexAttLength+r+0]=i[n+0],this.verticesData[t*this.vertexAttLength+r+1]=i[n+1],n+=h.uvSize):(this.verticesData[t*this.vertexAttLength+r+0]=0,this.verticesData[t*this.vertexAttLength+r+1]=0),r+=h.uvSize),this.vertexFormat&l.VF_UV1&&(e&l.VF_UV1?(this.verticesData[t*this.vertexAttLength+r+0]=i[n+0],this.verticesData[t*this.vertexAttLength+r+1]=i[n+1],n+=h.uv2Size):(this.verticesData[t*this.vertexAttLength+r+0]=0,this.verticesData[t*this.vertexAttLength+r+1]=0),r+=h.uv2Size),this.vertexFormat&l.VF_SKIN){if(e&l.VF_SKIN){for(var s=0;s<h.skinSize;++s)this.verticesData[t*this.vertexAttLength+r+s]=i[n+s];n+=h.skinSize}else for(s=0;s<h.skinSize;++s)this.verticesData[t*this.vertexAttLength+r+s]=0;r+=h.skinSize}t++}},h.prototype.getVertexIndices=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=null),i||(i=new Array),-1==e&&(e=this.indexData.length);for(var a=0;a<e-t;++a)i[a]=this.indexData[a+t];return i},h.prototype.setVertexIndices=function(t,e){for(var i=0;i<e.length;++i)this.indexData[t+i]=e[i]},h.positionSize=3,h.normalSize=3,h.tangentSize=3,h.colorSize=4,h.uvSize=2,h.uv2Size=2,h.skinSize=8,h}();i.Geometry=a}(egret3d||(egret3d={})),function(V){var t=function(){function t(){this.vertexAttLength=17,this.vertLen=0,this.faces=0,this.source_indexData=new Array,this.source_vertexData=new Array,this.source_vertexColorData=new Array,this.source_normalData=new Array,this.source_tangtData=new Array,this.source_uvData=new Array,this.source_uv2Data=new Array,this.source_skinData=new Array,this.vertexIndex=0,this.indices=new Array,this.vertices=new Array,this.normals=new Array,this.tangts=new Array,this.verticesColor=new Array,this.uvs=new Array,this.uv2s=new Array,this.skinMesh=new Array,this.faceNormals=new Array,this.faceWeights=new Array,this.vertexIndices=new Array,this.uvIndices=new Array,this.uv2Indices=new Array,this.normalIndices=new Array,this.colorIndices=new Array,this.indexIds=new Array,this.matCount=0,this.material={}}return t.buildGeomtry=function(t,e){var i=new V.Geometry;i.vertexFormat=e,i.skeleton=t.skeleton;for(var a=new V.Vector3D,r=new V.Vector3D(1,1,1),n=new V.Vector3D(1,1,1,1),o=new V.UV(1,0),s=new V.UV(1,0),h=0,l=0;l<t.faces;l++){i.indexData.push(3*l+0,3*l+2,3*l+1);for(var u=0;u<3;u++)h=t.vertexIndices[3*l+u]*V.Geometry.positionSize,a.x=t.source_vertexData[h+0],a.y=t.source_vertexData[h+1],a.z=t.source_vertexData[h+2],t.normalIndices&&t.source_normalData&&0<t.source_normalData.length&&(h=t.normalIndices[3*l+u]*V.Geometry.normalSize,r.x=t.source_normalData[h+0],r.y=t.source_normalData[h+1],r.z=t.source_normalData[h+2]),t.colorIndices&&t.source_vertexColorData&&0<t.source_vertexColorData.length&&(h=t.colorIndices[3*l+u]*V.Geometry.colorSize,n.x=t.source_vertexColorData[h+0],n.y=t.source_vertexColorData[h+1],n.z=t.source_vertexColorData[h+2],n.w=t.source_vertexColorData[h+3]),t.uvIndices&&t.source_uvData&&0<t.source_uvData.length&&(h=t.uvIndices[3*l+u]*V.Geometry.uvSize,o.u=t.source_uvData[h+0],o.v=t.source_uvData[h+1]),t.uv2Indices&&t.source_uv2Data&&0<t.source_uv2Data.length&&(h=t.uv2Indices[3*l+u]*V.Geometry.uvSize,s.u=t.source_uv2Data[h+0],s.v=t.source_uv2Data[h+1]),e&V.VertexFormat.VF_POSITION&&(i.source_positionData.push(a.x),i.source_positionData.push(a.y),i.source_positionData.push(a.z)),e&V.VertexFormat.VF_NORMAL&&(i.source_normalData.push(r.x),i.source_normalData.push(r.y),i.source_normalData.push(r.z)),e&V.VertexFormat.VF_TANGENT&&(i.source_tangentData.push(0),i.source_tangentData.push(0),i.source_tangentData.push(0)),e&V.VertexFormat.VF_COLOR&&(i.source_colorData.push(n.x),i.source_colorData.push(n.y),i.source_colorData.push(n.z),i.source_colorData.push(n.w)),e&V.VertexFormat.VF_UV0&&(i.source_uvData.push(o.u),i.source_uvData.push(o.v)),e&V.VertexFormat.VF_UV1&&(i.source_uv2Data.push(s.u),i.source_uv2Data.push(s.v)),e&V.VertexFormat.VF_SKIN&&(null!=t.source_skinData&&0<t.source_skinData.length?(h=t.vertexIndices[3*l+u]*V.Geometry.skinSize,i.source_SkinData.push(t.source_skinData[h+0],t.source_skinData[h+2],t.source_skinData[h+4],t.source_skinData[h+6],t.source_skinData[h+1],t.source_skinData[h+3],t.source_skinData[h+5],t.source_skinData[h+7])):i.source_SkinData.push(0,0,0,0,0,0,0,0))}i.calculateVertexFormat();for(u=0;u<t.matCount;++u){var c=new V.SubGeometry;c.matID=u,c.geometry=i,c.start=3*t.material[u].start*Uint16Array.BYTES_PER_ELEMENT,c.count=3*t.material[u].count,c.textureDiffuse=t.material[u].textureDiffuse,c.textureNormal=t.material[u].textureNormal,c.textureSpecular=t.material[u].textureSpecular,i.subGeometrys.push(c)}return i},t.combinGeomtryData=function(t,e){void 0===e&&(e=!0);for(var i=0,a=0,r=0,n=0,o=0,s=0,h=0,l=t.vertexDatas;i<t.vertLen;)l[i++]=t.vertices[a++],l[i++]=t.vertices[a++],l[i++]=t.vertices[a++],t.normals&&t.normals.length?(l[i++]=t.normals[r++],l[i++]=t.normals[r++],l[i++]=t.normals[r++]):(l[i++]=0,l[i++]=0,l[i++]=0),t.tangts?(i++,i++,i++):(l[i++]=0,l[i++]=0,l[i++]=0),t.source_vertexColorData&&t.source_vertexColorData.length?(l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++]):(l[i++]=1,l[i++]=1,l[i++]=1,l[i++]=1),t.uvs&&t.uvs.length?(l[i++]=t.uvs[n++],l[i++]=t.uvs[n++],t.uv2s&&t.uv2s.length?(l[i++]=t.uv2s[o++],l[i++]=t.uv2s[o++]):(l[i++]=t.uvs[o++],l[i++]=t.uvs[o++])):(l[i++]=0,l[i++]=0,l[i++]=0,l[i++]=0),t.skinMesh&&t.skinMesh.length&&(l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++])},t.updateFaceNormals=function(t){for(var e,i,a,r,n,o,s,h,l,u,c,d,p,_,f,m,g,v,y,x=0,D=0,b=0,w=t.indices.length,T=t.vertexDatas;x<w;){i=T[e=3+17*t.indices[x++]],n=T[e+1],h=T[e+2],a=T[e=3+17*t.indices[x++]],o=T[e+1],l=T[e+2],r=T[e=3+17*t.indices[x++]],s=T[e+1],m=(d=T[e+2]-h)*(_=o-n)-(c=s-n)*(f=l-h),g=(u=r-i)*f-d*(p=a-i),v=c*p-u*_;var P=1e4*(y=Math.sqrt(m*m+g*g+v*v));P<1&&(P=1),t.faceWeights[b++]=P,y=1/y,t.faceNormals[D++]=m*y,t.faceNormals[D++]=g*y,t.faceNormals[D++]=v*y}},t.updateVertexNormals=function(t){this.updateFaceNormals(t);for(var e,i,a=0,r=1,n=2,o=(t.vertexDatas.length,17),s=0,h=0,l=t.indices.length;s<l;)i=t.faceWeights[h++],e=3+t.indices[s++]*o,t.vertexDatas[e]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,e=3+t.indices[s++]*o,t.vertexDatas[e]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,e=3+t.indices[s++]*o,t.vertexDatas[e]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,a+=3,r+=3,n+=3},t.updateFaceTangents=function(t){var e,i,a,r,n,o,s,h,l,u,c,d,p,_,f,m,g,v=0,y=t.indexData.length,x=t.verticesData,D=t.vertexAttLength,b=t.vertexAttLength,w=0;for(t.vertexFormat&V.VertexFormat.VF_TANGENT&&(w+=V.Geometry.positionSize+V.Geometry.normalSize+V.Geometry.tangentSize),t.vertexFormat&V.VertexFormat.VF_COLOR&&(w+=V.Geometry.colorSize);v<y;)e=t.indexData[v],i=t.indexData[v+1],a=t.indexData[v+2],n=x[w+e*b],o=x[w+i*b]-n,s=x[w+a*b]-n,l=x[r=0+e*D],u=x[r+1],c=x[r+2],d=x[r=0+i*D]-l,p=x[r+1]-u,_=x[r+2]-c,f=s*d-o*(x[r=0+a*D]-l),m=s*p-o*(x[r+1]-u),g=s*_-o*(x[r+2]-c),h=1/Math.sqrt(f*f+m*m+g*g),t.source_tangentData[v++]=h*f,t.source_tangentData[v++]=h*m,t.source_tangentData[v++]=h*g;var T,P=t.indexData.length,S=0,C=1,A=2,E=V.Geometry.positionSize+V.Geometry.normalSize,L=t.vertexAttLength;for(v=0;v<P;)1,T=E+t.indexData[v++]*L,t.verticesData[T++]+=1*t.source_tangentData[S],t.verticesData[T++]+=1*t.source_tangentData[C],t.verticesData[T]+=1*t.source_tangentData[A],T=E+t.indexData[v++]*L,t.verticesData[T++]+=1*t.source_tangentData[S],t.verticesData[T++]+=1*t.source_tangentData[C],t.verticesData[T]+=1*t.source_tangentData[A],T=E+t.indexData[v++]*L,t.verticesData[T++]+=1*t.source_tangentData[S],t.verticesData[T++]+=1*t.source_tangentData[C],t.verticesData[T]+=1*t.source_tangentData[A],S+=3,C+=3,A+=3;var M=t.verticesData.length;for(v=E;v<M;){var F=t.verticesData[v],z=t.verticesData[v+1],O=t.verticesData[v+2],N=1/Math.sqrt(F*F+z*z+O*O);t.verticesData[v]=F*N,t.verticesData[v+1]=z*N,t.verticesData[v+2]=O*N,v+=t.vertexAttLength}},t}();V.GeometryData=t}(egret3d||(egret3d={})),function(o){var t=function(){function t(){this.start=0,this.count=0,this.matID=0,this.preAttList=new Array}return t.prototype.upload=function(t,e){t.attributeDiry=!1;var i=0;t.attributeList=[],this.geometry.vertexFormat&o.VertexFormat.VF_POSITION&&(t.attribute_position&&(t.attribute_position.uniformIndex||(t.attribute_position.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_position.varName)),t.attribute_position.size=o.Geometry.positionSize,t.attribute_position.dataType=o.ContextConfig.FLOAT,t.attribute_position.normalized=!1,t.attribute_position.stride=this.geometry.vertexSizeInBytes,t.attribute_position.offsetBytes=i,t.attributeList.push(t.attribute_position)),i+=o.Geometry.positionSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&o.VertexFormat.VF_NORMAL&&(t.attribute_normal&&(t.attribute_normal.uniformIndex||(t.attribute_normal.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_normal.varName)),t.attribute_normal.size=o.Geometry.normalSize,t.attribute_normal.dataType=o.ContextConfig.FLOAT,t.attribute_normal.normalized=!1,t.attribute_normal.stride=this.geometry.vertexSizeInBytes,t.attribute_normal.offsetBytes=i,t.attributeList.push(t.attribute_normal)),i+=o.Geometry.normalSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&o.VertexFormat.VF_TANGENT&&(t.attribute_tangent&&(t.attribute_tangent.uniformIndex||(t.attribute_tangent.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_tangent.varName)),t.attribute_tangent.size=o.Geometry.tangentSize,t.attribute_tangent.dataType=o.ContextConfig.FLOAT,t.attribute_tangent.normalized=!1,t.attribute_tangent.stride=this.geometry.vertexSizeInBytes,t.attribute_tangent.offsetBytes=i,t.attributeList.push(t.attribute_tangent)),i+=o.Geometry.tangentSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&o.VertexFormat.VF_COLOR&&(t.attribute_color&&(t.attribute_color.uniformIndex||(t.attribute_color.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_color.varName)),t.attribute_color.size=o.Geometry.colorSize,t.attribute_color.dataType=o.ContextConfig.FLOAT,t.attribute_color.normalized=!1,t.attribute_color.stride=this.geometry.vertexSizeInBytes,t.attribute_color.offsetBytes=i,t.attributeList.push(t.attribute_color)),i+=o.Geometry.colorSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&o.VertexFormat.VF_UV0&&(t.attribute_uv0&&(t.attribute_uv0.uniformIndex||(t.attribute_uv0.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_uv0.varName)),t.attribute_uv0.size=o.Geometry.uvSize,t.attribute_uv0.dataType=o.ContextConfig.FLOAT,t.attribute_uv0.normalized=!1,t.attribute_uv0.stride=this.geometry.vertexSizeInBytes,t.attribute_uv0.offsetBytes=i,t.attributeList.push(t.attribute_uv0)),i+=o.Geometry.uvSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&o.VertexFormat.VF_UV1&&(t.attribute_uv1&&(t.attribute_uv1.uniformIndex||(t.attribute_uv1.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_uv1.varName)),t.attribute_uv1.size=o.Geometry.uv2Size,t.attribute_uv1.dataType=o.ContextConfig.FLOAT,t.attribute_uv1.normalized=!1,t.attribute_uv1.stride=this.geometry.vertexSizeInBytes,t.attribute_uv1.offsetBytes=i,t.attributeList.push(t.attribute_uv1)),i+=o.Geometry.uv2Size*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&o.VertexFormat.VF_SKIN&&(t.attribute_boneIndex&&(t.attribute_boneIndex.uniformIndex||(t.attribute_boneIndex.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_boneIndex.varName)),t.attribute_boneIndex.size=o.Geometry.skinSize/2,t.attribute_boneIndex.dataType=o.ContextConfig.FLOAT,t.attribute_boneIndex.normalized=!1,t.attribute_boneIndex.stride=this.geometry.vertexSizeInBytes,t.attribute_boneIndex.offsetBytes=i,t.attributeList.push(t.attribute_boneIndex)),i+=o.Geometry.skinSize/2*Float32Array.BYTES_PER_ELEMENT,t.attribute_boneWeight&&(t.attribute_boneWeight.uniformIndex||(t.attribute_boneWeight.uniformIndex=e.getShaderAttribLocation(t.program3D,t.attribute_boneWeight.varName)),t.attribute_boneWeight.size=o.Geometry.skinSize/2,t.attribute_boneWeight.dataType=o.ContextConfig.FLOAT,t.attribute_boneWeight.normalized=!1,t.attribute_boneWeight.stride=this.geometry.vertexSizeInBytes,t.attribute_boneWeight.offsetBytes=i,t.attributeList.push(t.attribute_boneWeight)),i+=o.Geometry.skinSize/2*Float32Array.BYTES_PER_ELEMENT);for(var a=0;a<this.preAttList.length;++a){var r=this.preAttList[a],n=t[r.name];n&&(n.uniformIndex||(n.uniformIndex=e.getShaderAttribLocation(t.program3D,n.varName),n.size=r.size,n.dataType=o.ContextConfig.FLOAT,n.normalized=!1,n.stride=this.geometry.vertexSizeInBytes,n.offsetBytes=i,t.attributeList.push(n))),i+=r.size*Float32Array.BYTES_PER_ELEMENT}},t.prototype.activeState=function(t,e,i,a){i.attributeDiry&&this.upload(i,a),a.unActiveVertexFormat();for(var r=0;r<i.attributeList.length;r++){var n=i.attributeList[r];0<=n.uniformIndex&&a.vertexAttribPointer(n.uniformIndex,n.size,n.dataType,n.normalized,n.stride,n.offsetBytes)}},t.prototype.deactiveState=function(t,e){},t.use=!1,t}();o.SubGeometry=t}(egret3d||(egret3d={})),function(e){var t=function(a){function t(t,e,i){void 0===t&&(t=80),void 0===e&&(e=80),void 0===i&&(i=80),a.call(this),this._width=80,this._height=80,this._depth=80,this._width=t,this._height=e,this._depth=i,this.buildGeomtry(!0)}return __extends(t,a),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depth",{get:function(){return this._depth},enumerable:!0,configurable:!0}),t.prototype.buildGeomtry=function(t){this.vertexFormat=e.VertexFormat.VF_POSITION|e.VertexFormat.VF_NORMAL|e.VertexFormat.VF_TANGENT|e.VertexFormat.VF_COLOR|e.VertexFormat.VF_UV0|e.VertexFormat.VF_UV1,this.verticesData=new Array,this.indexData=new Array,this.verticesData.push(.5*-this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*-this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*-this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*-this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),t?this.indexData.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34):this.indexData.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35),this.buildDefaultSubGeometry()},t}(e.Geometry);e.CubeGeometry=t}(egret3d||(egret3d={})),function(l){var t=function(i){function t(t,e){void 0===t&&(t=100),void 0===e&&(e=200),i.call(this),this._height=t,this._radius=e,this.buildGeomtry()}return __extends(t,i),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),t.prototype.buildGeomtry=function(){this.vertexFormat=l.VertexFormat.VF_POSITION|l.VertexFormat.VF_NORMAL|l.VertexFormat.VF_TANGENT|l.VertexFormat.VF_COLOR|l.VertexFormat.VF_UV0|l.VertexFormat.VF_UV1,this.verticesData=new Array,this.indexData=new Array;var t=20,e=2*Math.PI/20;for(t=0;t<=20;t++){var i=this._radius*Math.sin(t*e),a=this._radius*Math.cos(t*e);this.verticesData.push(i,0+this._height/2,a,i,0,a,1,0,0,1,1,1,1,1,0,0,0,i,0-this._height/2,a,i,0,a,1,0,0,1,1,1,1,1,0,0,0)}var r=this.verticesData.length/17,n=this.verticesData.length;this.verticesData.push(0,0+this._height/2,0,0,1,0,1,0,0,1,1,1,1,1,0,0,0);var o=this.verticesData.length;this.verticesData.push(0,0-this._height/2,0,0,-1,0,1,0,0,1,1,1,1,1,0,0,0);for(var s=0;s<r;s++)0!=(1&s)?this.indexData.push(s,r<=s+1?s+1-r:s+1,r<=s+2?s+2-r:s+2,n,s,r<=s+2?s+2-r:s+2):this.indexData.push(r<=s+1?s+1-r:s+1,s,r<=s+2?s+2-r:s+2,s,o,r<=s+2?s+2-r:s+2);var h=new l.SubGeometry;h.geometry=this,h.start=0,h.count=this.indexData.length,this.subGeometrys.push(h)},t}(l.Geometry);l.CylinderGeometry=t}(egret3d||(egret3d={})),function(p){var t=function(l){function t(t,e,i,a,r,n,o,s,h){void 0===t&&(t=500),void 0===e&&(e=500),void 0===i&&(i=1),void 0===a&&(a=1),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=p.Vector3D.Y_AXIS),void 0===s&&(s=!0),void 0===h&&(h=!0),l.call(this),this._segmentsW=1,this._segmentsH=1,this._width=500,this._height=500,this._scaleU=1,this._scaleV=1,this._width=t,this._height=e,this._segmentsW=i,this._segmentsH=a,this._scaleU=r,this._scaleV=n,this._wCenter=s,this._hCenter=h,this.buildGeometry(o)}return __extends(t,l),Object.defineProperty(t.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleU",{get:function(){return this._scaleU},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleV",{get:function(){return this._scaleV},enumerable:!0,configurable:!0}),t.prototype.buildGeometry=function(t){this.vertexFormat=p.VertexFormat.VF_POSITION|p.VertexFormat.VF_NORMAL|p.VertexFormat.VF_TANGENT|p.VertexFormat.VF_COLOR|p.VertexFormat.VF_UV0;var e,i,a,r,n=this._segmentsW+1,o=(this._segmentsH+1)*n,s=this.vertexAttLength,h=s-15;a=this._segmentsH*this._segmentsW*6,this.verticesData=new Array(o*s),this.indexData=new Array(a),a=0;for(var l=(new p.Vector3D,0),u=0;u<=this._segmentsH;++u)for(var c=0;c<=this._segmentsW;++c){switch(e=(c/this._segmentsW-.5)*this._width,i=(u/this._segmentsH-.5)*this._height,0==this._wCenter&&(e+=this._width/2),0==this._hCenter&&(i+=this._height/2),t){case p.Vector3D.Y_AXIS:this.verticesData[l++]=e,this.verticesData[l++]=0,this.verticesData[l++]=i,this.verticesData[l++]=0,this.verticesData[l++]=1,this.verticesData[l++]=0;break;case p.Vector3D.Z_AXIS:this.verticesData[l++]=e,this.verticesData[l++]=i,this.verticesData[l++]=0,this.verticesData[l++]=0,this.verticesData[l++]=0,this.verticesData[l++]=-1;break;case p.Vector3D.X_AXIS:this.verticesData[l++]=0,this.verticesData[l++]=e,this.verticesData[l++]=i,this.verticesData[l++]=1,this.verticesData[l++]=0,this.verticesData[l++]=0;break;default:this.verticesData[l++]=e,this.verticesData[l++]=0,this.verticesData[l++]=i,this.verticesData[l++]=0,this.verticesData[l++]=1,this.verticesData[l++]=0}if(this.verticesData[l++]=1,this.verticesData[l++]=0,this.verticesData[l++]=0,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=c/this._segmentsW*this._scaleU,this.verticesData[l++]=(1-u/this._segmentsH)*this._scaleV,l+=h,c!=this._segmentsW&&u!=this._segmentsH){r=c+u*n;this.indexData[a++]=1*r,this.indexData[a++]=1*(r+n+1),this.indexData[a++]=1*(r+n),this.indexData[a++]=1*r,this.indexData[a++]=1*(r+1),this.indexData[a++]=1*(r+n+1)}}var d=new p.SubGeometry;d.geometry=this,d.start=0,d.count=this.indexData.length,this.subGeometrys.push(d)},t}(p.Geometry);p.PlaneGeometry=t}(egret3d||(egret3d={})),function(S){var t=function(a){function t(t,e,i){void 0===t&&(t=100),void 0===e&&(e=15),void 0===i&&(i=15),a.call(this),this._segmentsW=50,this._segmentsH=50,this._radius=100,this._radius=t,this._segmentsW=e,this._segmentsH=i,this.buildSphere(!0)}return __extends(t,a),Object.defineProperty(t.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),t.prototype.buildSphere=function(t){void 0===t&&(t=!0),this.vertexFormat=S.VertexFormat.VF_POSITION|S.VertexFormat.VF_NORMAL|S.VertexFormat.VF_TANGENT|S.VertexFormat.VF_COLOR|S.VertexFormat.VF_UV0|S.VertexFormat.VF_UV1;var e=0,i=0,a=0,r=(this._segmentsH+1)*(this._segmentsW+1),n=(T=this.vertexAttLength)-9;this.verticesData=new Array(r*T),this.indexData=new Array((this._segmentsH-1)*this._segmentsW*6);var o=0,s=0,h=0,l=0,u=0,c=0;for(i=0;i<=this._segmentsH;++i){o=s;var d=Math.PI*i/this._segmentsH,p=-this._radius*Math.cos(d),_=this._radius*Math.sin(d);for(e=0;e<=this._segmentsW;++e){var f=2*Math.PI*e/this._segmentsW,m=_*Math.cos(f),g=_*Math.sin(f),v=1/Math.sqrt(m*m+g*g+p*p),y=Math.sqrt(g*g+m*m);if(u=0,c=.007<y?m/y:0,h=-p,l=g,e==this._segmentsW?(this.verticesData[s++]=this.verticesData[o],this.verticesData[s++]=this.verticesData[o+1],this.verticesData[s++]=this.verticesData[o+2],this.verticesData[s++]=m*v,this.verticesData[s++]=h*v,this.verticesData[s++]=l*v,this.verticesData[s++]=.007<y?-g/y:1,this.verticesData[s++]=u,this.verticesData[s++]=c,this.verticesData[s+0]=1):(this.verticesData[s++]=m,this.verticesData[s++]=h,this.verticesData[s++]=l,this.verticesData[s++]=m*v,this.verticesData[s++]=h*v,this.verticesData[s++]=l*v,this.verticesData[s++]=.007<y?-g/y:1,this.verticesData[s++]=u,this.verticesData[s++]=c,this.verticesData[s]=1),this.verticesData[s+1]=1,this.verticesData[s+2]=1,this.verticesData[s+3]=1,0<e&&0<i){var x=(this._segmentsW+1)*i+e,D=(this._segmentsW+1)*i+e-1,b=(this._segmentsW+1)*(i-1)+e-1,w=(this._segmentsW+1)*(i-1)+e;i==this._segmentsH?(this.verticesData[s-9]=this.verticesData[o],this.verticesData[s-8]=this.verticesData[o+1],this.verticesData[s-7]=this.verticesData[o+2],t?(this.indexData[a++]=x,this.indexData[a++]=w,this.indexData[a++]=b):(this.indexData[a++]=x,this.indexData[a++]=b,this.indexData[a++]=w)):1==i?t?(this.indexData[a++]=x,this.indexData[a++]=b,this.indexData[a++]=D):(this.indexData[a++]=x,this.indexData[a++]=D,this.indexData[a++]=b):t?(this.indexData[a++]=x,this.indexData[a++]=w,this.indexData[a++]=b,this.indexData[a++]=x,this.indexData[a++]=b,this.indexData[a++]=D):(this.indexData[a++]=x,this.indexData[a++]=b,this.indexData[a++]=w,this.indexData[a++]=x,this.indexData[a++]=D,this.indexData[a++]=b)}s+=n}}var T=17;this._segmentsH,this._segmentsW,n=T-2,s=13;for(i=0;i<=this._segmentsH;++i)for(e=0;e<=this._segmentsW;++e)this.verticesData[s++]=e/this._segmentsW,this.verticesData[s++]=i/this._segmentsH,s+=n;var P=new S.SubGeometry;P.geometry=this,P.start=0,P.count=this.indexData.length,this.subGeometrys.push(P)},t}(S.Geometry);S.SphereGeometry=t}(egret3d||(egret3d={})),function(i){var t=function(){function t(){}return t.createGeometry=function(t){void 0===t&&(t=i.VertexFormat.VF_POSITION|i.VertexFormat.VF_NORMAL|i.VertexFormat.VF_TANGENT|i.VertexFormat.VF_COLOR|i.VertexFormat.VF_UV0|i.VertexFormat.VF_UV1);var e=new i.Geometry;return e.vertexFormat=t,e},t.createGemetryForType=function(t,e){switch(t){case"CubeGeometry":return new i.CubeGeometry(e.width,e.height,e.depth);case"CylinderGeometry":return new i.CylinderGeometry(e.height,e.radius);case"ElevationGeometry":return new i.ElevationGeometry(e.heightmap,e.width,e.height,e.depth,e.segmentsW,e.segmentsH);case"PlaneGeometry":return new i.PlaneGeometry(e.width,e.height,e.segmentsW,e.segmentsH,e.uScale,e.vScale);case"SphereGeometry":return new i.SphereGeometry(e.r,e.segmentsW,e.segmentsH)}return null},t}();i.GeometryUtil=t}(egret3d||(egret3d={})),function(f){var t=function(l){function t(t,e,i,a,r,n,o,s){void 0===e&&(e=1e3),void 0===i&&(i=100),void 0===a&&(a=1e3),void 0===r&&(r=30),void 0===n&&(n=30),void 0===o&&(o=255),void 0===s&&(s=0),l.call(this),this._width=100,this._height=100,this._segmentsW=100,this._segmentsH=100,this._depth=100,this._minElevation=100,this._maxElevation=100,this._scaleU=1,this._scaleV=1,this._segmentsW=r,this._segmentsH=n,this._width=e,this._height=i,this._depth=a,this._minElevation=s,this._maxElevation=o,this._heightmap=t,this._canvas=document.createElement("canvas");var h=this._canvas.getContext("2d");this._canvas.width=t.imageData.width,this._canvas.height=t.imageData.height,h.drawImage(t.imageData,0,0,t.width,t.height),document.body.appendChild(this._canvas),this._canvas.hidden=!0,this.imageData=h.getImageData(0,0,this._heightmap.imageData.width,this._heightmap.imageData.height),document.body.removeChild(this._canvas),this.buildGeomtry(!0)}return __extends(t,l),t.prototype.buildGeomtry=function(t){this.vertexFormat=f.VertexFormat.VF_POSITION|f.VertexFormat.VF_NORMAL|f.VertexFormat.VF_TANGENT|f.VertexFormat.VF_COLOR|f.VertexFormat.VF_UV0|f.VertexFormat.VF_UV1;var e,i,a,r,n,o,s,h=this._segmentsW+1,l=(this._segmentsH+1)*h,u=(this._heightmap.width-1)/this._segmentsW,c=(this._heightmap.height-1)/this._segmentsH;this.verticesData=new Array(3*l),this.indexData=new Array(this._segmentsH*this._segmentsW*6);for(var d,p=a=l=0;p<=this._segmentsH;++p)for(var _=0;_<=this._segmentsW;++_)e=(_/this._segmentsW-.5)*this._width,i=(p/this._segmentsH-.5)*this._depth,n=Math.floor(_*u),o=Math.floor((this._segmentsH-p)*c),s=(d=255&this.getPixel(n,o))>this._maxElevation?this._maxElevation/255*this._height:d<this._minElevation?this._minElevation/255*this._height:d/255*this._height,this.verticesData[l++]=e,this.verticesData[l++]=s,this.verticesData[l++]=i,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=-1,this.verticesData[l++]=0,this.verticesData[l++]=0,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=1,this.verticesData[l++]=_/this._segmentsW*this._scaleU,this.verticesData[l++]=1-p/this._segmentsH*this._scaleV,this.verticesData[l++]=_/this._segmentsW,this.verticesData[l++]=1-p/this._segmentsH,_!=this._segmentsW&&p!=this._segmentsH&&(r=_+p*h,this.indexData[a++]=r,this.indexData[a++]=r+h+1,this.indexData[a++]=r+h,this.indexData[a++]=r,this.indexData[a++]=r+1,this.indexData[a++]=r+h+1);this.updateFaceNormals(),this.buildDefaultSubGeometry()},t.prototype.getPixel=function(t,e){var i=e*(4*this._heightmap.imageData.width)+4*t;return this.imageData.data[i+3]<<24|this.imageData.data[i+0]<<16|this.imageData.data[i+1]<<8|this.imageData.data[i+2]},t.prototype.getHeightBypos=function(t,e){var i=this.getPixel(t,e);return i>this._maxElevation?this._maxElevation/255*this._height:i<this._minElevation?this._minElevation/255*this._height:i/255*this._height},t.prototype.updateFaceNormals=function(){for(var t,e,i,a,r,n,o,s,h,l,u,c,d,p,_,f,m,g,v=0,y=0,x=this.indexData.length,D=this.verticesData,b=[];v<x;)e=D[t=0+17*this.indexData[v+0]],r=D[t+1],o=D[t+2],i=D[t=0+17*this.indexData[v+1]],n=D[t+1],s=D[t+2],a=D[t=0+17*this.indexData[v+2]],_=(u=s-o)*(d=D[t+1]-r)-(l=n-r)*(p=D[t+2]-o),f=(h=i-e)*p-u*(c=a-e),m=l*c-h*d,g=Math.sqrt(_*_+f*f+m*m),b[y++]=m*g,b[y++]=f*g,b[y++]=_*g,v+=3;for(var w=v=0,T=1,P=2,S=this.vertexAttLength;v<x;)t=3+this.indexData[v++]*S,this.verticesData[t++]=b[w],this.verticesData[t++]=b[T],this.verticesData[t++]=b[P],t=3+this.indexData[v++]*S,this.verticesData[t++]=b[w],this.verticesData[t++]=b[T],this.verticesData[t++]=b[P],t=3+this.indexData[v++]*S,this.verticesData[t++]=b[w],this.verticesData[t++]=b[T],this.verticesData[t++]=b[P],w+=3,T+=3,P+=3},t}(f.Geometry);f.ElevationGeometry=t}(egret3d||(egret3d={})),function(o){var t=function(t){function n(){var e=this;t.call(this),this._time=0,this._keyStatus={},this._mouseStatus={},this._isTouchStart=!1,this._mouseEvent3d=new o.MouseEvent3D,this._keyEvent3d=new o.KeyEvent3D,this._touchEvent3d=new o.TouchEvent3D,this._windowsEvent3d=new o.Event3D,this._orientationEvent3d=new o.OrientationEvent3D,this.onGamepadStick1=null,this.onGamepadStick2=null,this._gp=!1,this._oldPosition1=null,this._oldPosition2=null,window.addEventListener("click",function(t){return e.mouseClick(t)},!0),window.addEventListener("mousedown",function(t){return e.mouseStart(t)},!0),window.addEventListener("mouseup",function(t){return e.mouseEnd(t)},!0),window.addEventListener("mousewheel",function(t){return e.mouseWheel(t)},!0),window.addEventListener("mousemove",function(t){return e.mouseMove(t)},!0),window.addEventListener("mouseover",function(t){return e.mouseOver(t)},!0),window.addEventListener("keydown",function(t){return e.keyDown(t)},!0),window.addEventListener("keyup",function(t){return e.keyUp(t)},!0),this.canGame()&&(window.addEventListener("gamepadconnected",function(t){return e.ongamepadconnected(t)},!0),window.addEventListener("gamepaddisconnected",function(t){return e.ongamepaddisconnected(t)},!0)),window.addEventListener("touchstart",function(t){return e.touchStart(t)},!0),window.addEventListener("touchend",function(t){return e.touchEnd(t)},!0),window.addEventListener("touchmove",function(t){return e.touchMove(t)},!0),window.addEventListener("touchcancel",function(t){return e.touchEnd(t)},!0),window.addEventListener("resize",function(t){return e.onWindowsResize(t)},!0),window.addEventListener("orientationchange",function(t){return e.onOrientationChange(t)},!0),window.addEventListener("devicemotion",function(t){return e.onDeviceMotion(t)},!0),window.addEventListener("deviceorientation",function(t){return e.onDeviceOrientation(t)},!0)}return __extends(n,t),Object.defineProperty(n,"instance",{get:function(){return null==this._instance&&(this._instance=new n),this._instance},enumerable:!0,configurable:!0}),n.addEventListener=function(t,e,i){return n.instance.addEventListener(t,e,i)},n.removeEventListener=function(t,e,i){n.instance.removeEventListener(t,e,i)},n.removeEventListenerAt=function(t){n.instance.removeEventListenerAt(t)},n.prototype.ongamepaddisconnected=function(t){this._gp=!1},n.prototype.ongamepadconnected=function(t){this._gp=!0},n.prototype.getGamepadButtonState=function(t){return navigator.getGamepads()[0].buttons[t].pressed},n.prototype.getGamepadStick1=function(){return new o.Vector3D(navigator.getGamepads()[0].axes[0],navigator.getGamepads()[0].axes[1],0)},n.prototype.getGamepadStick2=function(){return new o.Vector3D(navigator.getGamepads()[0].axes[2],navigator.getGamepads()[0].axes[3],0)},n.prototype.canGame=function(){return"getGamepads"in navigator},n.reportOnGamepad=function(){n.instance.canGame()&&n.instance._gp&&(null!=n.instance.onGamepadStick1&&n.instance.onGamepadStick1(n.instance.getGamepadStick1()),null!=n.instance.onGamepadStick2&&n.instance.onGamepadStick2(n.instance.getGamepadStick2()))},n.prototype.printout=function(){navigator.getGamepads()[0].id;for(var t=navigator.getGamepads()[0].buttons.length,e=0;e<t;e++)"Button "+(e+1)+": ",this.getGamepadButtonState(e)&&" pressed","<br/>";var i=this.getGamepadStick1();i.x,i.y,(i=this.getGamepadStick2()).x,i.y},n.prototype.onPinch=function(t,e,i,a){this._oldPosition1=new o.Point(t,e),this._oldPosition2=new o.Point(i,a)},n.prototype.onSwipe=function(t,e){n.mouseX=t,n.mouseY=e,this._oldPosition1=null,this._oldPosition2=null,this._time=(new Date).getTime()},n.prototype.touchStart=function(t){if(this.deliverMessage()){t.preventDefault();var e=t.targetTouches[0].clientX-n.canvas.x+n.canvas.offsetX,i=t.targetTouches[0].clientY-n.canvas.y+n.canvas.offsetY;if(2==t.targetTouches.length){var a=t.targetTouches[1].clientX-n.canvas.x+n.canvas.offsetX,r=t.targetTouches[1].clientY-n.canvas.y+n.canvas.offsetY;this.onPinch(e,i,a,r)}else 1==t.targetTouches.length&&this.onSwipe(e,i);this._touchEvent3d.targetTouches=t.targetTouches,(this._touchEvent3d.target=this)._isTouchStart||(this._isTouchStart=!0,this._touchEvent3d.eventType=o.TouchEvent3D.TOUCH_START,this.dispatchEvent(this._touchEvent3d))}},n.prototype.touchEnd=function(t){if(1<t.targetTouches.length){var e=t.targetTouches[0].clientX-n.canvas.x+n.canvas.offsetX,i=t.targetTouches[0].clientY-n.canvas.y+n.canvas.offsetY,a=t.targetTouches[1].clientX-n.canvas.x+n.canvas.offsetX,r=t.targetTouches[1].clientY-n.canvas.y+n.canvas.offsetY;this.onPinch(e,i,a,r)}else 1==t.targetTouches.length?this.onSwipe(t.targetTouches[0].clientX-n.canvas.x+n.canvas.offsetX,t.targetTouches[0].clientY-n.canvas.y+n.canvas.offsetY):(this._oldPosition1=null,this._oldPosition2=null,this._time=0);this._isTouchStart=!1,this._touchEvent3d.targetTouches=t.targetTouches,(this._touchEvent3d.target=this)._touchEvent3d.eventType=o.TouchEvent3D.TOUCH_END,this.dispatchEvent(this._touchEvent3d)},n.prototype.touchMove=function(t){if(n.mouseLastX=n.mouseX,n.mouseLastY=n.mouseY,n.mouseX=t.targetTouches[0].clientX-n.canvas.x+n.canvas.offsetX,n.mouseY=t.targetTouches[0].clientY-n.canvas.y+n.canvas.offsetY,n.mouseOffsetX=n.mouseX-n.mouseLastX,n.mouseOffsetY=n.mouseY-n.mouseLastY,t.preventDefault(),1<t.targetTouches.length){var e=new o.Point(n.mouseX,n.mouseY),i=new o.Point(t.targetTouches[1].clientX-n.canvas.x+n.canvas.offsetX,t.targetTouches[1].clientY-n.canvas.y+n.canvas.offsetY);null==this._oldPosition1&&(this._oldPosition1=e),null==this._oldPosition2&&(this._oldPosition2=i),n.wheelDelta=this.isEnlarge(this._oldPosition1,this._oldPosition2,e,i)?120:-120,this._oldPosition1=e,this._oldPosition2=i}this._touchEvent3d.targetTouches=t.targetTouches,(this._touchEvent3d.target=this)._touchEvent3d.eventType=o.TouchEvent3D.TOUCH_MOVE,this.dispatchEvent(this._touchEvent3d)},n.prototype.mouseClick=function(t){this.deliverMessage()&&(this._mouseEvent3d.mouseCode=t.button,(this._mouseEvent3d.target=this)._mouseEvent3d.eventType=o.MouseEvent3D.MOUSE_CLICK,this.dispatchEvent(this._mouseEvent3d))},n.prototype.mouseEnd=function(t){this._mouseEvent3d.mouseCode=t.button,(this._mouseEvent3d.target=this)._mouseStatus[this._mouseEvent3d.mouseCode]=!1,this._mouseEvent3d.eventType=o.MouseEvent3D.MOUSE_UP,this.dispatchEvent(this._mouseEvent3d)},n.prototype.deliverMessage=function(){for(var t=n.canvas.view3Ds,e=0;e<t.length;++e)if(t[e].inView3D(n.mouseX,n.mouseY))return!0;return!1},n.prototype.mouseStart=function(t){this.deliverMessage()&&(this._mouseEvent3d.mouseCode=t.button,(this._mouseEvent3d.target=this)._mouseStatus[this._mouseEvent3d.mouseCode]||(this._mouseStatus[this._mouseEvent3d.mouseCode]=!0,this._mouseEvent3d.eventType=o.MouseEvent3D.MOUSE_DOWN,this.dispatchEvent(this._mouseEvent3d)))},n.prototype.mouseMove=function(t){n.mouseLastX=n.mouseX,n.mouseLastY=n.mouseY,n.mouseX=t.clientX-n.canvas.x+n.canvas.offsetX,n.mouseY=t.clientY-n.canvas.y+n.canvas.offsetY,n.mouseOffsetX=n.mouseX-n.mouseLastX,n.mouseOffsetY=n.mouseY-n.mouseLastY,(this._mouseEvent3d.target=this)._mouseEvent3d.eventType=o.MouseEvent3D.MOUSE_MOVE,this.dispatchEvent(this._mouseEvent3d)},n.prototype.mouseOver=function(t){(this._mouseEvent3d.target=this)._mouseEvent3d.eventType=o.MouseEvent3D.MOUSE_OVER,this.dispatchEvent(this._mouseEvent3d)},n.prototype.mouseWheel=function(t){n.wheelDelta=t.wheelDelta,(this._mouseEvent3d.target=this)._mouseEvent3d.eventType=o.MouseEvent3D.MOUSE_WHEEL,this.dispatchEvent(this._mouseEvent3d)},n.prototype.keyDown=function(t){this._keyEvent3d.keyCode=t.keyCode,(this._keyEvent3d.target=this)._keyStatus[t.keyCode]||(this._keyStatus[t.keyCode]=!0,this._keyEvent3d.eventType=o.KeyEvent3D.KEY_CLICK,this.dispatchEvent(this._keyEvent3d),this._keyEvent3d.eventType=o.KeyEvent3D.KEY_DOWN,this.dispatchEvent(this._keyEvent3d))},n.prototype.keyUp=function(t){this._keyEvent3d.keyCode=t.keyCode,(this._keyEvent3d.target=this)._keyStatus[t.keyCode]&&(this._keyEvent3d.eventType=o.KeyEvent3D.KEY_CLICK,this.dispatchEvent(this._keyEvent3d)),this._keyStatus[t.keyCode]=!1,this._keyEvent3d.eventType=o.KeyEvent3D.KEY_UP,this.dispatchEvent(this._keyEvent3d)},n.prototype.onWindowsResize=function(t){(this._windowsEvent3d.target=this)._windowsEvent3d.eventType=o.Event3D.RESIZE,this.dispatchEvent(this._windowsEvent3d)},n.prototype.onOrientationChange=function(t){(this._orientationEvent3d.target=this)._orientationEvent3d.eventType=o.OrientationEvent3D.ORIENTATION_CHANGE,this.dispatchEvent(this._orientationEvent3d)},n.prototype.onDeviceMotion=function(t){(this._orientationEvent3d.target=this)._orientationEvent3d.eventType=o.OrientationEvent3D.DEVICE_MOTION,this._orientationEvent3d.acceleration=t.acceleration,this._orientationEvent3d.accelerationIncludingGravity=t.accelerationIncludingGravity,this._orientationEvent3d.rotationRate=t.rotationRate,this.dispatchEvent(this._orientationEvent3d)},n.prototype.onDeviceOrientation=function(t){(this._orientationEvent3d.target=this)._orientationEvent3d.eventType=o.OrientationEvent3D.DEVICE_ORIENTATION,this._orientationEvent3d.absolute=t.absolute,this._orientationEvent3d.alpha=t.alpha,this._orientationEvent3d.beta=t.beta,this._orientationEvent3d.gamma=t.gamma,this.dispatchEvent(this._orientationEvent3d)},n.prototype.GetSlideAngle=function(t,e){return 180*Math.atan2(e,t)/Math.PI},n.prototype.GetSlideDirection=function(t,e,i,a){var r=e-a,n=i-t,o=0;if(Math.abs(n)<2&&Math.abs(r)<2)return o;var s=this.GetSlideAngle(n,r);return-45<=s&&s<45?o=4:45<=s&&s<135?o=1:-135<=s&&s<-45?o=2:(135<=s&&s<=180||-180<=s&&s<-135)&&(o=3),o},n.prototype.isEnlarge=function(t,e,i,a){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))<Math.sqrt((i.x-a.x)*(i.x-a.x)+(i.y-a.y)*(i.y-a.y))},n.mouseX=0,n.mouseY=0,n.wheelDelta=0,n.mouseOffsetX=0,n.mouseOffsetY=0,n.mouseLastX=0,n.mouseLastY=0,n._instance=null,n}(o.EventDispatcher);o.Input=t}(egret3d||(egret3d={})),function(f){var t=function(){function t(){this.orientation=new f.Vector3D,this.screenOrientation=0,this.openDebug=!1,this.offsetRotation=new f.Vector3D,this.fixOritation=new f.Vector3D,this.state=-1,this.degtorad=Math.PI/180,this.q=new f.Quaternion,this.q1=new f.Quaternion,this.outQ=new f.Quaternion,this.fix=new f.Vector3D,this.fixinterpolate=new f.Vector3D,this.fixAxis=new f.Vector3D,this.caheFixAxis=new f.Vector3D,this.steps=1,this.interpolate=!0,this.openDebug&&(this.accDiv=document.createElement("div"),this.accGravityDiv=document.createElement("div"),this.rotationRateDiv=document.createElement("div"),this.orientationRateDiv=document.createElement("div"),this.stateDiv=document.createElement("div"),this.accDiv.style.color="red",this.accGravityDiv.style.color="red",this.rotationRateDiv.style.color="red",this.orientationRateDiv.style.color="red",this.stateDiv.style.color="red",this.stateDiv.style.fontSize="52",document.body.appendChild(this.accDiv),document.body.appendChild(this.accGravityDiv),document.body.appendChild(this.rotationRateDiv),document.body.appendChild(this.orientationRateDiv),document.body.appendChild(this.stateDiv))}return t.prototype.start=function(){var e=this;this.orientationchangeHandler(),window.addEventListener("orientationchange",function(){return e.orientationchangeHandler()}),window.addEventListener("devicemotion",function(t){return e.motionHandler(t)}),window.addEventListener("deviceorientation",function(t){return e.orientationHandler(t)})},t.prototype.stop=function(){var e=this;window.removeEventListener("orientationchange",function(){return e.orientationchangeHandler()}),window.removeEventListener("devicemotion",function(t){return e.motionHandler(t)}),window.removeEventListener("deviceorientation",function(t){return e.orientationHandler(t)})},t.prototype.orientationchangeHandler=function(){null!=window.orientation&&(this.screenOrientation=window.orientation)},t.prototype.motionHandler=function(t){this.acc=t.acceleration,this.accGravity=t.accelerationIncludingGravity,this.rotationRate=t.rotationRate},t.prototype.orientationHandler=function(t){this.orientation.x=t.alpha,this.orientation.y=t.beta,this.orientation.z=t.gamma,this.openDebug&&this.debug()},t.prototype.debug=function(){this.accGravityDiv.innerHTML="<br><br> Gravity-x:"+this.orientation.x*f.MathUtil.RADIANS_TO_DEGREES+"<br>Gravity-y:"+this.orientation.y+"<br>Gravity-z:"+this.orientation.z,this.orientationRateDiv.innerHTML="<br> orientation-x:"+this.fixOritation.x+"<br>orientation-y:"+this.fixOritation.y+"<br>orientation-z:"+this.fixOritation.z,this.stateDiv.innerHTML="<br> state: "+this.state},t.prototype.getOrientation=function(){switch(window.screen.msOrientation){case"landscape-primary":return-90;case"landscape-secondary":return 90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return window.orientation||0},t.prototype.getQuaternion=function(t,e,i){var a=e?e*this.degtorad:0,r=i?i*this.degtorad:0,n=t?t*this.degtorad:0;a=Math.floor(100*a)/100,r=Math.floor(100*r)/100;var o=-this.getOrientation()*this.degtorad;this.state=this.getOrientation();var s=Math.cos(a/2),h=Math.cos(r/2),l=Math.cos(n/2),u=Math.sin(a/2),c=Math.sin(r/2),d=Math.sin(n/2);this.q.w=s*h*l-u*c*d,this.q.x=u*h*l-s*c*d,this.q.y=s*c*l+u*h*d,this.q.z=s*h*d+u*c*l;var p=new f.Vector3D(0,0,1),_=new f.Quaternion;return _.fromAxisAngle(p,o),this.q.multiply(this.q,_),p.setTo(-1,0,0),_.fromAxisAngle(p,90*this.degtorad),this.q.multiply(this.q,_),this.q},t.prototype.update=function(t){this.getBaseQuaternion(this.orientation.x,this.orientation.y,this.orientation.z),this.q.toEulerAngles(this.fixOritation),this.interpolate?(this.fixinterpolate.x=this.fixOritation.x-this.fix.x,this.fixinterpolate.y=this.fixOritation.y-this.fix.y,this.fixinterpolate.z=this.fixOritation.z-this.fix.z,this.caheFixAxis.x=this.fixOritation.x/Math.abs(this.fixOritation.x),this.caheFixAxis.y=this.fixOritation.y/Math.abs(this.fixOritation.y),this.caheFixAxis.z=this.fixOritation.z/Math.abs(this.fixOritation.z),this.fixAxis.x==this.caheFixAxis.x&&this.fixAxis.y==this.caheFixAxis.y&&this.fixAxis.z==this.caheFixAxis.z?(this.fix.x+=this.fixinterpolate.x/(this.steps+.01),this.fix.y+=this.fixinterpolate.y/(this.steps+.01),this.fix.z+=this.fixinterpolate.z/(this.steps+.01)):(this.fix.x=this.fixOritation.x,this.fix.y=this.fixOritation.y,this.fix.z=this.fixOritation.z,this.fixAxis.x=this.caheFixAxis.x,this.fixAxis.y=this.caheFixAxis.y,this.fixAxis.z=this.caheFixAxis.z),t.camera3D.rotationX=-this.fix.x,t.camera3D.rotationY=-this.fix.y,t.camera3D.rotationZ=this.fix.z):(t.camera3D.rotationX=-this.fixOritation.x,t.camera3D.rotationY=-this.fixOritation.y,t.camera3D.rotationZ=this.fixOritation.z)},t.prototype.getBaseQuaternion=function(t,e,i){var a=e?e*this.degtorad:0,r=i?i*this.degtorad:0,n=t?t*this.degtorad:0,o=Math.cos(a/2),s=Math.cos(r/2),h=Math.cos(n/2),l=Math.sin(a/2),u=Math.sin(r/2),c=Math.sin(n/2),d=o*s*h-l*u*c,p=l*s*h-o*u*c,_=o*u*h+l*s*c,f=o*s*c+l*u*h;return this.q.w=d,this.q.x=p,this.q.y=_,this.q.z=f,this.q},t}();f.OrientationController=t}(egret3d||(egret3d={})),function(r){var t=function(i){function a(t,e){void 0===t&&(t=null),void 0===e&&(e=null),i.call(this),this._event=new r.LoaderEvent3D,this._dataformat=null,this.url="",this.parentUrl="",this.resourceName="",this.data=null,t&&(e&&(this.dataformat=e),this.load(t))}return __extends(a,i),a.prototype.load=function(t){var e=this;if(this.data=null,this.url=t,null==this._dataformat&&(this._dataformat=a.DATAFORMAT_TEXT,this.url.lastIndexOf("."),this.url.lastIndexOf("/"),4<=this.url.length))switch(this.url.substr(this.url.length-4,4).toLowerCase()){case".dds":this._dataformat=a.DATAFORMAT_DDS;break;case".tga":this._dataformat=a.DATAFORMAT_TGA;break;case".bmp":case".png":case".jpg":this._dataformat=a.DATAFORMAT_BITMAP;break;case".hdr":this._dataformat=a.DATAFORMAT_HDR;break;case"glsl":this._dataformat=a.DATAFORMAT_TEXT;break;case".pvr":this._dataformat=a.DATAFORMAT_PVR;break;case".esm":this._dataformat=a.DATAFORMAT_ESM;break;case".eam":this._dataformat=a.DATAFORMAT_EAM;break;case".eca":this._dataformat=a.DATAFORMAT_ECA;break;case".epa":this._dataformat=a.DATAFORMAT_EPA}return null==this._xhr&&(this._xhr=this.getXHR()),null==this._xhr?void alert("Your browser does not support XMLHTTP."):(0<this._xhr.readyState&&this._xhr.abort(),this._xhr.open("GET",this.url,!0),this._xhr.addEventListener("progress",function(t){return e.onProgress(t)},!1),this._xhr.addEventListener("readystatechange",function(t){return e.onReadyStateChange(t)},!1),this._xhr.addEventListener("error",function(t){return e.onError(t)},!1),this.dataformat==a.DATAFORMAT_BITMAP?this._xhr.responseType="blob":this.dataformat!=a.DATAFORMAT_TEXT&&(this._xhr.responseType="arraybuffer"),void this._xhr.send())},Object.defineProperty(a.prototype,"dataformat",{get:function(){return this._dataformat},set:function(t){this._dataformat=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bytesLoaded",{get:function(){return this._progressEvent?this._progressEvent.loaded:0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bytesTotal",{get:function(){return this._progressEvent?this._progressEvent.total:0},enumerable:!0,configurable:!0}),a.prototype.onReadyStateChange=function(t){4==this._xhr.readyState&&(400<=this._xhr.status?console.log(this.url,"load fail"):this.loadComplete())},a.prototype.loadComplete=function(){var t=this;switch(this.dataformat){case a.DATAFORMAT_BINARY:this.data=new r.ByteArray(this._xhr.response);break;case a.DATAFORMAT_SOUND:this.data=this._xhr.responseBody;break;case a.DATAFORMAT_TEXT:this.data=this._xhr.responseText;break;case a.DATAFORMAT_BITMAP:var e=document.createElement("img");return null!=window.createObjectURL?e.src=window.createObjectURL(this._xhr.response):null!=window.URL?e.src=window.URL.createObjectURL(this._xhr.response):null!=window.webkitURL&&(e.src=window.webkitURL.createObjectURL(this._xhr.response)),void(e.onload=function(){return t.onLoad(e)});case a.DATAFORMAT_DDS:this.data=r.DDSParser.parse(this._xhr.response);break;case a.DATAFORMAT_TGA:this.data=r.TGAParser.parse(this._xhr.response);break;case a.DATAFORMAT_HDR:this.data=r.HDRParser.parse(this._xhr.response);break;case a.DATAFORMAT_ESM:this.data=r.ESMParser.parse(this._xhr.response);break;case a.DATAFORMAT_EAM:this.data=r.EAMParser.parse(this._xhr.response);break;case a.DATAFORMAT_ECA:this.data=r.ECAParser.parse(this._xhr.response);break;case a.DATAFORMAT_EPA:this.data=r.EPAParser.parse(this._xhr.response);break;case a.DATAFORMAT_PVR:break;default:this.data=this._xhr.responseText}this.doLoadComplete()},a.prototype.onProgress=function(t){this._event.eventType=r.LoaderEvent3D.LOADER_PROGRESS,((this._event.target=this)._event.loader=this)._progressEvent=t,this.dispatchEvent(this._event)},a.prototype.onError=function(t){this._event.eventType=r.LoaderEvent3D.LOADER_ERROR,((this._event.target=this)._event.loader=this).dispatchEvent(this._event),console.log("load error",t)},a.prototype.getXHR=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},a.prototype.onLoad=function(t){this.data=new r.ImageTexture(t),this.doLoadComplete()},a.prototype.doLoadComplete=function(){this.resourceName=r.StringUtil.getURLName(this.url),this._event.eventType=r.LoaderEvent3D.LOADER_COMPLETE,((this._event.target=this)._event.loader=this)._event.data=this.data,this.dispatchEvent(this._event)},a.DATAFORMAT_BINARY="binary",a.DATAFORMAT_TEXT="text",a.DATAFORMAT_SOUND="sound",a.DATAFORMAT_BITMAP="bitmap",a.DATAFORMAT_DDS="dds",a.DATAFORMAT_TGA="tga",a.DATAFORMAT_ESM="esm",a.DATAFORMAT_EAM="eam",a.DATAFORMAT_ECA="eca",a.DATAFORMAT_EPA="epa",a.DATAFORMAT_PVR="pvr",a.DATAFORMAT_HDR="hdr",a}(r.EventDispatcher);r.URLLoader=t}(egret3d||(egret3d={})),function(r){var o=function(){};r.AssetEvent=o;var t=function(){function t(){this._loaderDict={}}return t.prototype.findAsset=function(t){return this._loaderDict[t]},t.prototype.dispatchTask=function(t,e){if(void 0===e&&(e=null),!this._loaderDict[t]){var i=new r.URLLoader(t,e);i.addEventListener(r.LoaderEvent3D.LOADER_COMPLETE,this.onComplete,this),this._loaderDict[t]=i}return this._loaderDict[t]},t.prototype.dispatchEvent=function(t,e,i,a){var r=new o;r.callback=e,r.thisObject=i,r.param=a;var n=t.assetEventList;n||(n=new Array,t.assetEventList=n),n.push(r)},t.prototype.onComplete=function(t){t.loader.removeEventListener(r.LoaderEvent3D.LOADER_COMPLETE,this.onComplete,this);var e=t.loader.assetEventList;if(e){for(var i=0;i<e.length;++i){var a=e[i];a.callback.call(a.thisObject,t.loader,a.param)}e.length=0}},t}();r.AssetManager=t}(egret3d||(egret3d={})),function(P){var t;(t=P.DDSFormat||(P.DDSFormat={}))[t.RGB_S3TC_DXT1_FORMAT=2001]="RGB_S3TC_DXT1_FORMAT",t[t.RGBA_S3TC_DXT1_FORMAT=2002]="RGBA_S3TC_DXT1_FORMAT",t[t.RGBA_S3TC_DXT3_FORMAT=2003]="RGBA_S3TC_DXT3_FORMAT",t[t.RGBA_S3TC_DXT5_FORMAT=2003]="RGBA_S3TC_DXT5_FORMAT";var S=P.DDSFormat,e=function(){function T(){}return T.parse=function(t,e){void 0===e&&(e=!0);var i=T.fourCCToInt32("DXT1"),a=T.fourCCToInt32("DXT3"),r=T.fourCCToInt32("DXT5"),n=new Int32Array(t,0,31);if(542327876!==n[0])return console.error("DDSParser.parse: Invalid magic number in DDS header."),null;if(!(4&n[20]))return console.error("DDSParser.parse: Unsupported format, must contain a FourCC code."),null;var o,s,h,l,u,c=n[21],d=!1,p=1;switch(c){case i:o=8,s=S.RGB_S3TC_DXT1_FORMAT;break;case a:o=16,s=S.RGBA_S3TC_DXT3_FORMAT;break;case r:o=16,s=S.RGBA_S3TC_DXT5_FORMAT;break;default:if(!(32==n[22]&&16711680&n[23]&&65280&n[24]&&255&n[25]&&4278190080&n[26]))return console.error("DDSParser.parse: Unsupported FourCC code ",T.int32ToFourCC(c)),null;d=!0,o=64,s=1021}131072&n[2]&&!1!==e&&(p=Math.max(1,n[7])),h=!!(512&n[28]),l=n[4],u=n[3];var _=n[1]+4,f=h?6:1,m=new Array,g=!1;s==S.RGB_S3TC_DXT1_FORMAT&&0==P.ContextConfig.ColorFormat_DXT1_RGB?g=!0:s==S.RGBA_S3TC_DXT3_FORMAT&&0==P.ContextConfig.ColorFormat_DXT3_RGBA?g=!0:s==S.RGBA_S3TC_DXT5_FORMAT&&0==P.ContextConfig.ColorFormat_DXT5_RGBA&&(g=!0);var v=new P.MimapTexture;v.width=l,v.height=u;for(var y=0;y<f;y++){for(var x=0;x<p;x++){var D;if(d)var b=(D=T.loadARGBMip(t,_,l,u)).length;else{b=Math.max(4,l)/4*Math.max(4,u)/4*o;D=new Uint8Array(t,_,b),g&&(D=T.softSolutionDXT(l,u,s,D))}var w=new P.MipmapData(D,l,u);m.push(w),_+=b,l=Math.max(.5*l,1),u=Math.max(.5*u,1)}l=l,u=u}return g?(v.internalFormat=P.InternalFormat.PixelArray,v.colorFormat=P.ContextConfig.ColorFormat_RGBA8888):(v.internalFormat=P.InternalFormat.CompressData,i==c?v.colorFormat=P.ContextConfig.ColorFormat_DXT1_RGB:a==c?v.colorFormat=P.ContextConfig.ColorFormat_DXT3_RGBA:r==c&&(v.colorFormat=P.ContextConfig.ColorFormat_DXT5_RGBA)),v.mimapData=m,v},T.loadARGBMip=function(t,e,i,a){for(var r=i*a*4,n=new Uint8Array(t,e,r),o=new Uint8Array(r),s=0,h=0,l=0;l<a;l++)for(var u=0;u<i;u++){var c=n[h],d=n[++h],p=n[++h],_=n[++h];h++,o[s]=p,o[++s]=d,o[++s]=c,o[++s]=_,s++}return o},T.fourCCToInt32=function(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)},T.int32ToFourCC=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&65385)},T.softSolutionDXT=function(t,e,i,a){var r,n=new Uint8Array(t*e*4),o=[new P.Color,new P.Color,new P.Color,new P.Color],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];switch(i){case S.RGB_S3TC_DXT1_FORMAT:case S.RGBA_S3TC_DXT1_FORMAT:r=a.length/8;for(var h=0;h<r;h++){var l=a[8*h+0]|a[8*h+1]<<8,u=a[8*h+2]|a[8*h+3]<<8;o[0].r=l>>11&31,o[0].g=l>>5&63,o[0].b=31&l,o[0].a=255,o[1].r=u>>11&31,o[1].g=u>>5&63,o[1].b=31&u,o[1].a=255,u<l?(o[2].lerp(o[0],o[1],.33),o[3].lerp(o[0],o[1],.66)):o[2].lerp(o[0],o[1],.5);for(var c=0;c<4;c++)s[4*c+0]=3&a[8*h+4+c],s[4*c+1]=a[8*h+4+c]>>2&3,s[4*c+2]=a[8*h+4+c]>>4&3,s[4*c+3]=a[8*h+4+c]>>6&3;for(var d=0;d<o.length;d++)o[d].r=8*o[d].r,o[d].g=4*o[d].g,o[d].b=8*o[d].b;var p=h%(t/4)*4;(_=4*Math.floor(h/(t/4)))+0<e&&(p+0<t&&(n[(_+0)*(4*t)+4*(p+0)+0]=o[s[0]].r,n[(_+0)*(4*t)+4*(p+0)+1]=o[s[0]].g,n[(_+0)*(4*t)+4*(p+0)+2]=o[s[0]].b,n[(_+0)*(4*t)+4*(p+0)+3]=o[s[0]].a),p+1<t&&(n[(_+0)*(4*t)+4*(p+1)+0]=o[s[1]].r,n[(_+0)*(4*t)+4*(p+1)+1]=o[s[1]].g,n[(_+0)*(4*t)+4*(p+1)+2]=o[s[1]].b,n[(_+0)*(4*t)+4*(p+1)+3]=o[s[1]].a),p+2<t&&(n[(_+0)*(4*t)+4*(p+2)+0]=o[s[2]].r,n[(_+0)*(4*t)+4*(p+2)+1]=o[s[2]].g,n[(_+0)*(4*t)+4*(p+2)+2]=o[s[2]].b,n[(_+0)*(4*t)+4*(p+2)+3]=o[s[2]].a),p+3<t&&(n[(_+0)*(4*t)+4*(p+3)+0]=o[s[3]].r,n[(_+0)*(4*t)+4*(p+3)+1]=o[s[3]].g,n[(_+0)*(4*t)+4*(p+3)+2]=o[s[3]].b,n[(_+0)*(4*t)+4*(p+3)+3]=o[s[3]].a)),_+1<e&&(p+0<t&&(n[(_+1)*(4*t)+4*(p+0)+0]=o[s[4]].r,n[(_+1)*(4*t)+4*(p+0)+1]=o[s[4]].g,n[(_+1)*(4*t)+4*(p+0)+2]=o[s[4]].b,n[(_+1)*(4*t)+4*(p+0)+3]=o[s[4]].a),p+1<t&&(n[(_+1)*(4*t)+4*(p+1)+0]=o[s[5]].r,n[(_+1)*(4*t)+4*(p+1)+1]=o[s[5]].g,n[(_+1)*(4*t)+4*(p+1)+2]=o[s[5]].b,n[(_+1)*(4*t)+4*(p+1)+3]=o[s[5]].a),p+2<t&&(n[(_+1)*(4*t)+4*(p+2)+0]=o[s[6]].r,n[(_+1)*(4*t)+4*(p+2)+1]=o[s[6]].g,n[(_+1)*(4*t)+4*(p+2)+2]=o[s[6]].b,n[(_+1)*(4*t)+4*(p+2)+3]=o[s[6]].a),p+3<t&&(n[(_+1)*(4*t)+4*(p+3)+0]=o[s[7]].r,n[(_+1)*(4*t)+4*(p+3)+1]=o[s[7]].g,n[(_+1)*(4*t)+4*(p+3)+2]=o[s[7]].b,n[(_+1)*(4*t)+4*(p+3)+3]=o[s[7]].a)),_+2<e&&(p+0<t&&(n[(_+2)*(4*t)+4*(p+0)+0]=o[s[8]].r,n[(_+2)*(4*t)+4*(p+0)+1]=o[s[8]].g,n[(_+2)*(4*t)+4*(p+0)+2]=o[s[8]].b,n[(_+2)*(4*t)+4*(p+0)+3]=o[s[8]].a),p+1<t&&(n[(_+2)*(4*t)+4*(p+1)+0]=o[s[9]].r,n[(_+2)*(4*t)+4*(p+1)+1]=o[s[9]].g,n[(_+2)*(4*t)+4*(p+1)+2]=o[s[9]].b,n[(_+2)*(4*t)+4*(p+1)+3]=o[s[9]].a),p+2<t&&(n[(_+2)*(4*t)+4*(p+2)+0]=o[s[10]].r,n[(_+2)*(4*t)+4*(p+2)+1]=o[s[10]].g,n[(_+2)*(4*t)+4*(p+2)+2]=o[s[10]].b,n[(_+2)*(4*t)+4*(p+2)+3]=o[s[10]].a),p+3<t&&(n[(_+2)*(4*t)+4*(p+3)+0]=o[s[11]].r,n[(_+2)*(4*t)+4*(p+3)+1]=o[s[11]].g,n[(_+2)*(4*t)+4*(p+3)+2]=o[s[11]].b,n[(_+2)*(4*t)+4*(p+3)+3]=o[s[11]].a)),_+3<e&&(p+0<t&&(n[(_+3)*(4*t)+4*(p+0)+0]=o[s[12]].r,n[(_+3)*(4*t)+4*(p+0)+1]=o[s[12]].g,n[(_+3)*(4*t)+4*(p+0)+2]=o[s[12]].b,n[(_+3)*(4*t)+4*(p+0)+3]=o[s[12]].a),p+1<t&&(n[(_+3)*(4*t)+4*(p+1)+0]=o[s[13]].r,n[(_+3)*(4*t)+4*(p+1)+1]=o[s[13]].g,n[(_+3)*(4*t)+4*(p+1)+2]=o[s[13]].b,n[(_+3)*(4*t)+4*(p+1)+3]=o[s[13]].a),p+2<t&&(n[(_+3)*(4*t)+4*(p+2)+0]=o[s[14]].r,n[(_+3)*(4*t)+4*(p+2)+1]=o[s[14]].g,n[(_+3)*(4*t)+4*(p+2)+2]=o[s[14]].b,n[(_+3)*(4*t)+4*(p+2)+3]=o[s[14]].a),p+3<t&&(n[(_+3)*(4*t)+4*(p+3)+0]=o[s[15]].r,n[(_+3)*(4*t)+4*(p+3)+1]=o[s[15]].g,n[(_+3)*(4*t)+4*(p+3)+2]=o[s[15]].b,n[(_+3)*(4*t)+4*(p+3)+3]=o[s[15]].a))}break;case S.RGBA_S3TC_DXT3_FORMAT:r=a.length/16;for(h=0;h<r;h++){l=a[16*h+8]|a[16*h+9]<<8,u=a[16*h+10]|a[16*h+11]<<8;o[0].r=l>>11&31,o[0].g=l>>5&63,o[0].b=31&l,o[0].a=255,o[1].r=u>>11&31,o[1].g=u>>5&63,o[1].b=31&u,o[1].a=255,u<l?(o[2].lerp(o[0],o[1],.33),o[3].lerp(o[0],o[1],.66)):(o[2].lerp(o[0],o[1],.5),o[3].a=0);for(c=0;c<4;c++)s[4*c+0]=3&a[16*h+12+c],s[4*c+1]=a[16*h+12+c]>>2&3,s[4*c+2]=a[16*h+12+c]>>4&3,s[4*c+3]=a[16*h+12+c]>>6&3;for(d=0;d<o.length;d++)o[d].r=8*o[d].r,o[d].g=4*o[d].g,o[d].b=8*o[d].b;var _;p=h%(t/4)*4;(_=4*Math.floor(h/(t/4)))+0<e&&(p+0<t&&(n[(_+0)*(4*t)+4*(p+0)+0]=o[s[0]].r,n[(_+0)*(4*t)+4*(p+0)+1]=o[s[0]].g,n[(_+0)*(4*t)+4*(p+0)+2]=o[s[0]].b,n[(_+0)*(4*t)+4*(p+0)+3]=17*(15&a[16*h+0])),p+1<t&&(n[(_+0)*(4*t)+4*(p+1)+0]=o[s[1]].r,n[(_+0)*(4*t)+4*(p+1)+1]=o[s[1]].g,n[(_+0)*(4*t)+4*(p+1)+2]=o[s[1]].b,n[(_+0)*(4*t)+4*(p+1)+3]=17*(a[16*h+0]>>4&15)),p+2<t&&(n[(_+0)*(4*t)+4*(p+2)+0]=o[s[2]].r,n[(_+0)*(4*t)+4*(p+2)+1]=o[s[2]].g,n[(_+0)*(4*t)+4*(p+2)+2]=o[s[2]].b,n[(_+0)*(4*t)+4*(p+2)+3]=17*(15&a[16*h+1])),p+3<t&&(n[(_+0)*(4*t)+4*(p+3)+0]=o[s[3]].r,n[(_+0)*(4*t)+4*(p+3)+1]=o[s[3]].g,n[(_+0)*(4*t)+4*(p+3)+2]=o[s[3]].b,n[(_+0)*(4*t)+4*(p+3)+3]=17*(a[16*h+1]>>4&15))),_+1<e&&(p+0<t&&(n[(_+1)*(4*t)+4*(p+0)+0]=o[s[4]].r,n[(_+1)*(4*t)+4*(p+0)+1]=o[s[4]].g,n[(_+1)*(4*t)+4*(p+0)+2]=o[s[4]].b,n[(_+1)*(4*t)+4*(p+0)+3]=17*(15&a[16*h+2])),p+1<t&&(n[(_+1)*(4*t)+4*(p+1)+0]=o[s[5]].r,n[(_+1)*(4*t)+4*(p+1)+1]=o[s[5]].g,n[(_+1)*(4*t)+4*(p+1)+2]=o[s[5]].b,n[(_+1)*(4*t)+4*(p+1)+3]=17*(a[16*h+2]>>4&15)),p+2<t&&(n[(_+1)*(4*t)+4*(p+2)+0]=o[s[6]].r,n[(_+1)*(4*t)+4*(p+2)+1]=o[s[6]].g,n[(_+1)*(4*t)+4*(p+2)+2]=o[s[6]].b,n[(_+1)*(4*t)+4*(p+2)+3]=17*(15&a[16*h+3])),p+3<t&&(n[(_+1)*(4*t)+4*(p+3)+0]=o[s[7]].r,n[(_+1)*(4*t)+4*(p+3)+1]=o[s[7]].g,n[(_+1)*(4*t)+4*(p+3)+2]=o[s[7]].b,n[(_+1)*(4*t)+4*(p+3)+3]=17*(a[16*h+3]>>4&15))),_+2<e&&(p+0<t&&(n[(_+2)*(4*t)+4*(p+0)+0]=o[s[8]].r,n[(_+2)*(4*t)+4*(p+0)+1]=o[s[8]].g,n[(_+2)*(4*t)+4*(p+0)+2]=o[s[8]].b,n[(_+2)*(4*t)+4*(p+0)+3]=17*(15&a[16*h+4])),p+1<t&&(n[(_+2)*(4*t)+4*(p+1)+0]=o[s[9]].r,n[(_+2)*(4*t)+4*(p+1)+1]=o[s[9]].g,n[(_+2)*(4*t)+4*(p+1)+2]=o[s[9]].b,n[(_+2)*(4*t)+4*(p+1)+3]=17*(a[16*h+4]>>4&15)),p+2<t&&(n[(_+2)*(4*t)+4*(p+2)+0]=o[s[10]].r,n[(_+2)*(4*t)+4*(p+2)+1]=o[s[10]].g,n[(_+2)*(4*t)+4*(p+2)+2]=o[s[10]].b,n[(_+2)*(4*t)+4*(p+2)+3]=17*(15&a[16*h+5])),p+3<t&&(n[(_+2)*(4*t)+4*(p+3)+0]=o[s[11]].r,n[(_+2)*(4*t)+4*(p+3)+1]=o[s[11]].g,n[(_+2)*(4*t)+4*(p+3)+2]=o[s[11]].b,n[(_+2)*(4*t)+4*(p+3)+3]=17*(a[16*h+5]>>4&15))),_+3<e&&(p+0<t&&(n[(_+3)*(4*t)+4*(p+0)+0]=o[s[12]].r,n[(_+3)*(4*t)+4*(p+0)+1]=o[s[12]].g,n[(_+3)*(4*t)+4*(p+0)+2]=o[s[12]].b,n[(_+3)*(4*t)+4*(p+0)+3]=17*(15&a[16*h+6])),p+1<t&&(n[(_+3)*(4*t)+4*(p+1)+0]=o[s[13]].r,n[(_+3)*(4*t)+4*(p+1)+1]=o[s[13]].g,n[(_+3)*(4*t)+4*(p+1)+2]=o[s[13]].b,n[(_+3)*(4*t)+4*(p+1)+3]=17*(a[16*h+6]>>4&15)),p+2<t&&(n[(_+3)*(4*t)+4*(p+2)+0]=o[s[14]].r,n[(_+3)*(4*t)+4*(p+2)+1]=o[s[14]].g,n[(_+3)*(4*t)+4*(p+2)+2]=o[s[14]].b,n[(_+3)*(4*t)+4*(p+2)+3]=17*(15&a[16*h+7])),p+3<t&&(n[(_+3)*(4*t)+4*(p+3)+0]=o[s[15]].r,n[(_+3)*(4*t)+4*(p+3)+1]=o[s[15]].g,n[(_+3)*(4*t)+4*(p+3)+2]=o[s[15]].b,n[(_+3)*(4*t)+4*(p+3)+3]=17*(a[16*h+7]>>4&15)))}break;case S.RGBA_S3TC_DXT5_FORMAT:}return n},T}();P.DDSParser=e}(egret3d||(egret3d={})),function(t){var e=function(){};(egret3d||(egret3d={})).PVR=e}(),function(g){var t;(t=g.PVRFormat||(g.PVRFormat={}))[t.RGB_PVRTC_4BPPV1_Format=2100]="RGB_PVRTC_4BPPV1_Format",t[t.RGB_PVRTC_2BPPV1_Format=2101]="RGB_PVRTC_2BPPV1_Format",t[t.RGBA_PVRTC_4BPPV1_Format=2102]="RGBA_PVRTC_4BPPV1_Format",t[t.RGBA_PVRTC_2BPPV1_Format=2103]="RGBA_PVRTC_2BPPV1_Format";var _=g.PVRFormat,e=function(){function p(){}return p.parse=function(t){var e=new g.PVR,i=new Uint32Array(t,0,13),a={buffer:t,header:i};return 55727696===i[0]?e=p._parseV3(a):559044176===i[11]?e=p._parseV2(a):console.log("PVRParser unknow pvr format. PVRParser::parse"),e},p._parseV2=function(t){var e,i=t.header,a=i[0],r=i[1],n=i[2],o=i[3],s=i[4],h=(i[5],i[6]),l=(i[7],i[8],i[9],i[10]),u=(i[11],i[12]),c=255&s,d=0<l;if(25===c)e=d?_.RGBA_PVRTC_4BPPV1_Format:_.RGB_PVRTC_4BPPV1_Format,h=4;else{if(24!==c)throw new Error("pvrtc - unknown format "+c);e=d?_.RGBA_PVRTC_2BPPV1_Format:_.RGB_PVRTC_2BPPV1_Format,h=2}return t.dataPtr=a,t.bpp=h,t.format=e,t.width=n,t.height=r,t.numSurfaces=u,t.numMipmaps=o+1,t.isCubemap=6===u,p._extract(t)},p._parseV3=function(t){var e,i,a=t.header,r=a[12],n=a[2],o=a[6],s=a[7],h=(a[9],a[10]),l=a[11];switch(n){case 0:e=2,i=_.RGB_PVRTC_2BPPV1_Format;break;case 1:e=2,i=_.RGBA_PVRTC_2BPPV1_Format;break;case 2:e=4,i=_.RGB_PVRTC_4BPPV1_Format;break;case 3:e=4,i=_.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+n)}return t.dataPtr=52+r,t.bpp=e,t.format=i,t.width=s,t.height=o,t.numSurfaces=h,t.numMipmaps=l,t.isCubemap=6===h,p._extract(t)},p._extract=function(t){var e,i=new g.PVR,a=t.buffer,r=t.dataPtr,n=t.bpp,o=t.numSurfaces,s=0,h=0,l=0,u=0,c=0;e=(h=2===n?8:4)*(l=4)*n/8,i.mipmaps.length=t.numMipmaps*o;for(var d=0;d<t.numMipmaps;){var p=t.width>>d,_=t.height>>d;(u=p/h)<2&&(u=2),(c=_/l)<2&&(c=2),s=u*c*e;for(var f=0;f<o;f++){var m={data:new Uint8Array(a,r,s),width:p,height:_};i.mipmaps[f*t.numMipmaps+d]=m,r+=s}d++}return i},p}();g.PVRParser=e}(egret3d||(egret3d={})),function(w){var t=function(){function t(){}return t.parse=function(t){var e=0,i=1,a=2,r=3,n=9,o=10,s=11,c=48,d=4,p=0,_=1,f=2,m=3;t.byteLength<19&&console.error("TGAParser.parse: Not enough data to contain header.");var h=new Uint8Array(t),l=0,g={id_length:h[l++],colormap_type:h[l++],image_type:h[l++],colormap_index:h[l++]|h[l++]<<8,colormap_length:h[l++]|h[l++]<<8,colormap_size:h[l++],origin:[h[l++]|h[l++]<<8,h[l++]|h[l++]<<8],width:h[l++]|h[l++]<<8,height:h[l++]|h[l++]<<8,pixel_size:h[l++],flags:h[l++]};(function(t){switch(t.image_type){case i:case n:(256<t.colormap_length||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGAParser.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case a:case r:case o:case s:t.colormap_type&&console.error("TGAParser.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case e:console.error("TGAParser.parse.tgaCheckHeader: No data");break;default:console.error('TGAParser.parse.tgaCheckHeader: Invalid type " '+t.image_type+'"')}(t.width<=0||t.height<=0)&&console.error("TGAParser.parse.tgaCheckHeader: Invalid image size"),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGAParser.parse.tgaCheckHeader: Invalid pixel size "'+t.pixel_size+'"')})(g),g.id_length+l>t.byteLength&&console.error("TGAParser.parse: No data"),l+=g.id_length;var u=!1,v=!1,y=!1;switch(g.image_type){case n:v=u=!0;break;case i:v=!0;break;case o:u=!0;break;case a:break;case s:y=u=!0;break;case r:y=!0}var x=function(t,e,i,a,r){var n,o,s,h;if(o=i.pixel_size>>3,s=i.width*i.height*o,e&&(h=r.subarray(a,a+=i.colormap_length*(i.colormap_size>>3))),t){n=new Uint8Array(s);for(var l,u,c,d=0,p=new Uint8Array(o);d<s;)if(u=1+(127&(l=r[a++])),128&l){for(c=0;c<o;++c)p[c]=r[a++];for(c=0;c<u;++c)n.set(p,d+c*o);d+=o*u}else{for(u*=o,c=0;c<u;++c)n[d+c]=r[a++];d+=u}}else n=r.subarray(a,a+=e?i.width*i.height:s);return{pixel_data:n,palettes:h}}(u,v,g,l,h),D=function(t,e,i,a){var r,n,o,s,h,l,u=new Uint8Array(t*e*4);switch((g.flags&c)>>d){default:case f:h=t,n=r=0,s=o=1,l=e;break;case p:r=0,h=t,n=e-(o=1),l=s=-1;break;case m:r=t-1,h=o=-1,n=0,s=1,l=e;break;case _:r=t-1,n=e-1,l=s=h=o=-1}if(y)switch(g.pixel_size){case 8:!function(t,e,i,a,r,n,o,s){var h,l,u,c=0,d=g.width;for(u=e;u!==a;u+=i)for(l=r;l!==o;l+=n,c++)h=s[c],t[4*(l+d*u)+0]=h,t[4*(l+d*u)+1]=h,t[4*(l+d*u)+2]=h,t[4*(l+d*u)+3]=255}(u,n,s,l,r,o,h,i);break;case 16:!function(t,e,i,a,r,n,o,s){var h,l,u=0,c=g.width;for(l=e;l!==a;l+=i)for(h=r;h!==o;h+=n,u+=2)t[4*(h+c*l)+0]=s[u+0],t[4*(h+c*l)+1]=s[u+0],t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+3]=s[u+1]}(u,n,s,l,r,o,h,i);break;default:console.error("TGAParser.parse.getTgaRGBA: not support this format")}else switch(g.pixel_size){case 8:!function(t,e,i,a,r,n,o,s,h){var l,u,c,d=h,p=0,_=g.width;for(c=e;c!==a;c+=i)for(u=r;u!==o;u+=n,p++)l=s[p],t[4*(u+_*c)+3]=255,t[4*(u+_*c)+2]=d[3*l+0],t[4*(u+_*c)+1]=d[3*l+1],t[4*(u+_*c)+0]=d[3*l+2]}(u,n,s,l,r,o,h,i,a);break;case 16:!function(t,e,i,a,r,n,o,s){var h,l,u,c=0,d=g.width;for(u=e;u!==a;u+=i)for(l=r;l!==o;l+=n,c+=2)h=s[c+0]+(s[c+1]<<8),t[4*(l+d*u)+0]=(31744&h)>>7,t[4*(l+d*u)+1]=(992&h)>>2,t[4*(l+d*u)+2]=(31&h)>>3,t[4*(l+d*u)+3]=32768&h?0:255}(u,n,s,l,r,o,h,i);break;case 24:!function(t,e,i,a,r,n,o,s){var h,l,u=0,c=g.width;for(l=e;l!==a;l+=i)for(h=r;h!==o;h+=n,u+=3)t[4*(h+c*l)+3]=255,t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+1]=s[u+1],t[4*(h+c*l)+0]=s[u+2]}(u,n,s,l,r,o,h,i);break;case 32:!function(t,e,i,a,r,n,o,s){var h,l,u=0,c=g.width;for(l=e;l!==a;l+=i)for(h=r;h!==o;h+=n,u+=4)t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+1]=s[u+1],t[4*(h+c*l)+0]=s[u+2],t[4*(h+c*l)+3]=s[u+3]}(u,n,s,l,r,o,h,i);break;default:console.error("TGAParser.parse.getTgaRGBA: not support this format")}return u}(g.width,g.height,x.pixel_data,x.palettes),b=new w.MimapTexture;return b.width=g.width,b.height=g.height,b.internalFormat=w.InternalFormat.PixelArray,b.colorFormat=w.ContextConfig.ColorFormat_RGBA8888,b.mimapData=[new w.MipmapData(D,g.width,g.height)],b},t}();w.TGAParser=t}(egret3d||(egret3d={})),function(g){var t=function(){function m(){}return m.ldexp=function(t,e){return 1023<e?t*Math.pow(2,1023)*Math.pow(2,e-1023):e<-1074?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},m.readPixelsRawRLE=function(r,t,e,n,i,a){function o(t){for(var e=0;t[e++]=r[n],++n<f&&e<t.length;);return e}function s(t,e,i){for(var a=0;t[e+a++]=r[n],++n<f&&a<i;);return a}function h(t,e,i,a){var r=4*a,n=s(e,i,r);if(n<r)throw new Error("Error reading raw pixels: got "+n+" bytes, expected "+r)}for(var l,u,c,d=new Array(4),p=null,_=new Array(2),f=r.length;0<a;){if(o(d)<d.length)throw new Error("Error reading bytes: expected "+d.length);if(2!=d[0]||2!=d[1]||0!=(128&d[2]))return t[e++]=d[0],t[e++]=d[1],t[e++]=d[2],t[e++]=d[3],void h(0,t,e,i*a-1);if(((255&d[2])<<8|255&d[3])!=i)throw new Error("Wrong scanline width "+((255&d[2])<<8|255&d[3])+", expected "+i);null==p&&(p=new Array(4*i));for(var m=l=0;m<4;m++)for(u=(m+1)*i;l<u;){if(o(_)<_.length)throw new Error("Error reading 2-byte buffer");if(128<(255&_[0])){if(0==(c=(255&_[0])-128)||u-l<c)throw new Error("Bad scanline data");for(;0<c--;)p[l++]=_[1]}else{if(0==(c=255&_[0])||u-l<c)throw new Error("Bad scanline data");if(p[l++]=_[1],0<--c){if(s(p,l,c)<c)throw new Error("Error reading non-run data");l+=c}}}for(m=0;m<i;m++)t[e+0]=p[m],t[e+1]=p[m+i],t[e+2]=p[m+2*i],t[e+3]=p[m+3*i],e+=4;a--}},m.parse=function(i){function t(){var t="";do{var e=i[a];if(e==n){++a;break}t+=String.fromCharCode(e)}while(++a<r);return t}i instanceof ArrayBuffer&&(i=new Uint8Array(i));for(var a=0,r=i.length,n=10,e=0,o=0,s=!1,h=0;h<20;h++){var l,u=t();if(l=u.match(m.radiancePattern));else if(l=u.match(m.formatPattern))s=!0;else if(l=u.match(m.exposurePattern))Number(l[1]);else if(l=u.match(m.commentPattern));else if(l=u.match(m.widthHeightPattern)){o=Number(l[1]),e=Number(l[2]);break}}if(!s)throw new Error("File is not run length encoded!");var c=new Uint8Array(e*o*4),d=e,p=o;this.readPixelsRawRLE(i,c,0,a,d,p);var _=new g.MipmapData(c,e,o),f=new g.MimapTexture;return f.internalFormat=g.InternalFormat.PixelArray,f.colorFormat=g.ContextConfig.ColorFormat_RGBA8888,f.mimapData=[_],f.useMipmap=!1,f.width=e,f.height=o,f},m.radiancePattern="#\\?RADIANCE",m.commentPattern="#.*",m.gammaPattern="GAMMA=",m.exposurePattern="EXPOSURE=\\s*([0-9]*[.][0-9]*)",m.formatPattern="FORMAT=32-bit_rle_rgbe",m.widthHeightPattern="-Y ([0-9]+) \\+X ([0-9]+)",m}();g.HDRParser=t}(egret3d||(egret3d={})),function(r){var t=function(){function t(){}return t.parse=function(t){var e=new r.ByteArray(t),i=new r.ByteArray;e.readBytes(i,0,3);var a=e.readUnsignedInt();return r.EAMVersion.versionDictionary[a]?r.EAMVersion.versionDictionary[a](e):(console.log("egret3d engine not found "+a+" version"),null)},t}();r.EAMParser=t}(egret3d||(egret3d={})),function(p){var t=function(){function e(){}return e.parserVersion_1=function(t){var e=t.readUnsignedByte();if(t.readUnsignedByte(),e<=0)return null;for(var i=new p.SkeletonAnimationClip,a=new Array,r=new Array,n=0;n<e;n++)a.push(t.readUTF()),r.push(t.readUTF());var o=(t.readInt(),t.readInt()),s=new p.Quaternion,h=new p.Vector3D,l=new p.Vector3D;for(n=0;n<o;n++){var u=new p.SkeletonPose;u.frameTime=t.readInt()/60/80*1e3;for(var c=0;c<e;c++){var d=new p.Joint(a[c]);d.parent=r[c],d.parentIndex=u.findJointIndex(d.parent),s.fromEulerAngles(t.readFloat()*p.MathUtil.RADIANS_TO_DEGREES,t.readFloat()*p.MathUtil.RADIANS_TO_DEGREES,t.readFloat()*p.MathUtil.RADIANS_TO_DEGREES),h.x=t.readFloat(),h.y=t.readFloat(),h.z=t.readFloat(),l.x=t.readFloat(),l.y=t.readFloat(),l.z=t.readFloat(),d.buildLocalMatrix(h,s,l),u.joints.push(d)}u.calculateJointWorldMatrix(),i.addSkeletonPose(u)}return i},e.parserVersion_2=function(t){var e=t.readUnsignedByte();if(t.readUnsignedByte(),e<=0)return null;for(var i=new p.SkeletonAnimationClip,a=new Array,r=new Array,n=0;n<e;n++)a.push(t.readUTF()),r.push(t.readUTF());var o=(t.readInt(),t.readInt()),s=new p.Quaternion,h=new p.Vector3D,l=new p.Vector3D;for(n=0;n<o;n++){var u=new p.SkeletonPose;u.frameTime=t.readInt()/60/80*1e3;for(var c=0;c<e;c++){var d=new p.Joint(a[c]);d.parent=r[c],d.parentIndex=u.findJointIndex(d.parent),s.x=t.readFloat(),s.y=t.readFloat(),s.z=t.readFloat(),s.w=t.readFloat(),h.x=t.readFloat(),h.y=t.readFloat(),h.z=t.readFloat(),l.x=t.readFloat(),l.y=t.readFloat(),l.z=t.readFloat(),d.buildLocalMatrix(h,s,l),u.joints.push(d)}u.calculateJointWorldMatrix(),i.addSkeletonPose(u)}return i},e.parserVersion_3=function(t){return null},e.versionDictionary={1:function(t){return e.parserVersion_1(t)},2:function(t){return e.parserVersion_2(t)},3:function(t){return e.parserVersion_3(t)}},e}();p.EAMVersion=t}(egret3d||(egret3d={})),function(r){var t=function(){function t(){}return t.parse=function(t){var e=new r.ByteArray(t),i=new r.ByteArray;e.readBytes(i,0,3);var a=e.readUnsignedInt();return r.ECAVersion.versionDictionary[a]?r.ECAVersion.versionDictionary[a](e):(console.log("egret3d engine not found "+a+" version"),null)},t}();r.ECAParser=t}(egret3d||(egret3d={})),function(n){var t=function(){function e(){}return e.parserVersion_1=function(t){for(var e=new n.CameraAnimationController,i=t.readUnsignedInt(),a=null,r=new n.Vector3D(1,1,1,1);i--;)(a=new n.CameraAnimationFrame).time=t.readInt(),a.fov=t.readFloat(),a.rotation=new n.Vector3D(t.readFloat()*n.MathUtil.RADIANS_TO_DEGREES+90,t.readFloat()*n.MathUtil.RADIANS_TO_DEGREES,t.readFloat()*n.MathUtil.RADIANS_TO_DEGREES),a.translation=new n.Vector3D(t.readFloat(),t.readFloat(),t.readFloat()),a.matrix=new n.Matrix4_4,a.matrix.recompose([a.translation,a.rotation,r]),e.cameraAnimationFrames.push(a);return e},e.versionDictionary={1:function(t){return e.parserVersion_1(t)}},e}();n.ECAVersion=t}(egret3d||(egret3d={})),function(o){var t=function(){function t(){}return t.parse=function(t){var e=new o.ByteArray(t),i=new o.ByteArray;e.readBytes(i,0,3);var a=e.readUnsignedInt();if(!o.ESMVersion.versionDictionary[a])return console.log("egret3d engine not found "+a+" version"),null;var r=new o.GeometryData;o.ESMVersion.versionDictionary[a](e,r);var n=0;return n=0<r.source_skinData.length?o.VertexFormat.VF_POSITION|o.VertexFormat.VF_NORMAL|o.VertexFormat.VF_TANGENT|o.VertexFormat.VF_COLOR|o.VertexFormat.VF_UV0|o.VertexFormat.VF_SKIN:o.VertexFormat.VF_POSITION|o.VertexFormat.VF_NORMAL|o.VertexFormat.VF_TANGENT|o.VertexFormat.VF_COLOR|o.VertexFormat.VF_UV0|o.VertexFormat.VF_UV1,o.GeometryData.buildGeomtry(r,n)},t}();o.ESMParser=t}(egret3d||(egret3d={})),function(m){var t=function(){function i(){}return i.parserVersion_1=function(t,e){var i=t.readInt();e.matCount=t.readInt();for(var a=0;a<e.matCount;++a)e.material[a]={},e.material[a].matID=t.readInt(),e.material[a].start=t.readInt(),e.material[a].count=t.readInt(),e.material[a].textureDiffuse=t.readUTF(),e.material[a].textureNormal=t.readUTF(),e.material[a].textureSpecular=t.readUTF();if(i&m.VertexFormat.VF_POSITION){var r=t.readInt();for(a=0;a<r;a++)e.source_vertexData.push(t.readFloat()),e.source_vertexData.push(t.readFloat()),e.source_vertexData.push(t.readFloat())}if(i&m.VertexFormat.VF_NORMAL){var n=t.readInt();for(a=0;a<n;a++)e.source_normalData.push(t.readFloat()),e.source_normalData.push(t.readFloat()),e.source_normalData.push(t.readFloat())}if(i&m.VertexFormat.VF_COLOR){var o=t.readInt();for(a=0;a<o;a++)e.source_vertexColorData.push(t.readFloat()),e.source_vertexColorData.push(t.readFloat()),e.source_vertexColorData.push(t.readFloat()),e.source_vertexColorData.push(t.readFloat())}if(i&m.VertexFormat.VF_UV0){var s=t.readInt();for(a=0;a<s;a++)e.source_uvData.push(t.readFloat()),e.source_uvData.push(t.readFloat())}if(i&m.VertexFormat.VF_UV1)for(s=t.readInt(),a=0;a<s;a++)e.source_uv2Data.push(t.readFloat()),e.source_uv2Data.push(t.readFloat());e.faces=t.readInt();for(a=0;a<e.faces;a++)e.vertexIndices.push(t.readUnsignedInt()),e.vertexIndices.push(t.readUnsignedInt()),e.vertexIndices.push(t.readUnsignedInt()),i&m.VertexFormat.VF_NORMAL&&(e.normalIndices.push(t.readUnsignedInt()),e.normalIndices.push(t.readUnsignedInt()),e.normalIndices.push(t.readUnsignedInt())),i&m.VertexFormat.VF_COLOR&&(e.colorIndices.push(t.readUnsignedInt()),e.colorIndices.push(t.readUnsignedInt()),e.colorIndices.push(t.readUnsignedInt())),i&m.VertexFormat.VF_UV0&&(e.uvIndices.push(t.readUnsignedInt()),e.uvIndices.push(t.readUnsignedInt()),e.uvIndices.push(t.readUnsignedInt())),i&m.VertexFormat.VF_UV1&&(e.uv2Indices.push(t.readUnsignedInt()),e.uv2Indices.push(t.readUnsignedInt()),e.uv2Indices.push(t.readUnsignedInt()));var h=t.readUnsignedByte();0<h&&(e.skeleton=new m.Skeleton);var l=(new m.Quaternion,new m.Vector3D),u=new m.Vector3D,c=new m.Vector3D;for(a=0;a<h;++a){var d=new m.Joint(null);t.readInt(),d.parentIndex=t.readInt(),d.name=t.readUTF(),l.x=t.readFloat()*m.MathUtil.RADIANS_TO_DEGREES,l.y=t.readFloat()*m.MathUtil.RADIANS_TO_DEGREES,l.z=t.readFloat()*m.MathUtil.RADIANS_TO_DEGREES,u.x=t.readFloat(),u.y=t.readFloat(),u.z=t.readFloat(),c.x=t.readFloat(),c.y=t.readFloat(),c.z=t.readFloat(),d.buildInverseMatrix(u,l,c),e.skeleton.joints.push(d)}var p=t.readInt();for(a=0;a<p;a++){for(var _=t.readUnsignedByte(),f=0;f<_;f++)e.source_skinData.push(t.readUnsignedByte()),e.source_skinData.push(t.readFloat());for(f=_;f<4;f++)e.source_skinData.push(0),e.source_skinData.push(0)}},i.parserVersion_2=function(t,e){var i=t.readInt();e.matCount=t.readInt();for(var a=0;a<e.matCount;++a)e.material[a]={},e.material[a].matID=t.readInt(),e.material[a].start=t.readInt(),e.material[a].count=t.readInt(),e.material[a].textureDiffuse=t.readUTF(),e.material[a].textureNormal=t.readUTF(),e.material[a].textureSpecular=t.readUTF();if(i&m.VertexFormat.VF_POSITION){var r=t.readInt();for(a=0;a<r;a++)e.source_vertexData.push(t.readFloat()),e.source_vertexData.push(t.readFloat()),e.source_vertexData.push(t.readFloat())}if(i&m.VertexFormat.VF_NORMAL){var n=t.readInt();for(a=0;a<n;a++)e.source_normalData.push(t.readFloat()),e.source_normalData.push(t.readFloat()),e.source_normalData.push(t.readFloat())}if(i&m.VertexFormat.VF_COLOR){var o=t.readInt();for(a=0;a<o;a++)e.source_vertexColorData.push(t.readUnsignedByte()/255),e.source_vertexColorData.push(t.readUnsignedByte()/255),e.source_vertexColorData.push(t.readUnsignedByte()/255),e.source_vertexColorData.push(t.readUnsignedByte()/255)}if(i&m.VertexFormat.VF_UV0){var s=t.readInt();for(a=0;a<s;a++)e.source_uvData.push(t.readFloat()),e.source_uvData.push(t.readFloat())}if(i&m.VertexFormat.VF_UV1)for(s=t.readInt(),a=0;a<s;a++)e.source_uv2Data.push(t.readFloat()),e.source_uv2Data.push(t.readFloat());e.faces=t.readInt();for(a=0;a<e.faces;a++)e.vertexIndices.push(t.readUnsignedShort()),e.vertexIndices.push(t.readUnsignedShort()),e.vertexIndices.push(t.readUnsignedShort()),i&m.VertexFormat.VF_NORMAL&&(e.normalIndices.push(t.readUnsignedShort()),e.normalIndices.push(t.readUnsignedShort()),e.normalIndices.push(t.readUnsignedShort())),i&m.VertexFormat.VF_COLOR&&(e.colorIndices.push(t.readUnsignedShort()),e.colorIndices.push(t.readUnsignedShort()),e.colorIndices.push(t.readUnsignedShort())),i&m.VertexFormat.VF_UV0&&(e.uvIndices.push(t.readUnsignedShort()),e.uvIndices.push(t.readUnsignedShort()),e.uvIndices.push(t.readUnsignedShort())),i&m.VertexFormat.VF_UV1&&(e.uv2Indices.push(t.readUnsignedShort()),e.uv2Indices.push(t.readUnsignedShort()),e.uv2Indices.push(t.readUnsignedShort()));var h=t.readUnsignedByte();0<h&&(e.skeleton=new m.Skeleton);var l=(new m.Quaternion,new m.Vector3D),u=new m.Vector3D,c=new m.Vector3D;for(a=0;a<h;++a){var d=new m.Joint(null);t.readInt(),d.parentIndex=t.readInt(),d.name=t.readUTF(),l.x=t.readFloat()*m.MathUtil.RADIANS_TO_DEGREES,l.y=t.readFloat()*m.MathUtil.RADIANS_TO_DEGREES,l.z=t.readFloat()*m.MathUtil.RADIANS_TO_DEGREES,u.x=t.readFloat(),u.y=t.readFloat(),u.z=t.readFloat(),c.x=t.readFloat(),c.y=t.readFloat(),c.z=t.readFloat(),d.buildInverseMatrix(u,l,c),e.skeleton.joints.push(d)}var p=t.readInt();for(a=0;a<p;a++){for(var _=t.readUnsignedByte(),f=0;f<_;f++)e.source_skinData.push(t.readUnsignedByte()),e.source_skinData.push(t.readFloat());for(f=_;f<4;f++)e.source_skinData.push(0),e.source_skinData.push(0)}},i.parserVersion_3=function(t,e){var i=t.readInt();e.matCount=t.readInt();for(var a=0;a<e.matCount;++a)e.material[a]={},e.material[a].matID=t.readInt(),e.material[a].start=t.readInt(),e.material[a].count=t.readInt(),e.material[a].textureDiffuse=t.readUTF(),e.material[a].textureNormal=t.readUTF(),e.material[a].textureSpecular=t.readUTF();if(i&m.VertexFormat.VF_POSITION){var r=t.readInt();for(a=0;a<r;a++)e.source_vertexData.push(t.readFloat()),e.source_vertexData.push(t.readFloat()),e.source_vertexData.push(t.readFloat())}if(i&m.VertexFormat.VF_NORMAL){var n=t.readInt();for(a=0;a<n;a++)e.source_normalData.push(t.readFloat()),e.source_normalData.push(t.readFloat()),e.source_normalData.push(t.readFloat())}if(i&m.VertexFormat.VF_COLOR){var o=t.readInt();for(a=0;a<o;a++)e.source_vertexColorData.push(t.readUnsignedByte()/255),e.source_vertexColorData.push(t.readUnsignedByte()/255),e.source_vertexColorData.push(t.readUnsignedByte()/255),e.source_vertexColorData.push(t.readUnsignedByte()/255)}if(i&m.VertexFormat.VF_UV0){var s=t.readInt();for(a=0;a<s;a++)e.source_uvData.push(t.readFloat()),e.source_uvData.push(t.readFloat())}if(i&m.VertexFormat.VF_UV1)for(s=t.readInt(),a=0;a<s;a++)e.source_uv2Data.push(t.readFloat()),e.source_uv2Data.push(t.readFloat());e.faces=t.readInt();for(a=0;a<e.faces;a++)e.vertexIndices.push(t.readUnsignedShort()),e.vertexIndices.push(t.readUnsignedShort()),e.vertexIndices.push(t.readUnsignedShort()),i&m.VertexFormat.VF_NORMAL&&(e.normalIndices.push(t.readUnsignedShort()),e.normalIndices.push(t.readUnsignedShort()),e.normalIndices.push(t.readUnsignedShort())),i&m.VertexFormat.VF_COLOR&&(e.colorIndices.push(t.readUnsignedShort()),e.colorIndices.push(t.readUnsignedShort()),e.colorIndices.push(t.readUnsignedShort())),i&m.VertexFormat.VF_UV0&&(e.uvIndices.push(t.readUnsignedShort()),e.uvIndices.push(t.readUnsignedShort()),e.uvIndices.push(t.readUnsignedShort())),i&m.VertexFormat.VF_UV1&&(e.uv2Indices.push(t.readUnsignedShort()),e.uv2Indices.push(t.readUnsignedShort()),e.uv2Indices.push(t.readUnsignedShort()));var h=t.readUnsignedByte();0<h&&(e.skeleton=new m.Skeleton);var l=new m.Quaternion,u=(new m.Vector3D,new m.Vector3D),c=new m.Vector3D;for(a=0;a<h;++a){var d=new m.Joint(null);t.readInt(),d.parentIndex=t.readInt(),d.name=t.readUTF(),l.x=t.readFloat(),l.y=t.readFloat(),l.z=t.readFloat(),l.w=t.readFloat(),u.x=t.readFloat(),u.y=t.readFloat(),u.z=t.readFloat(),c.x=t.readFloat(),c.y=t.readFloat(),c.z=t.readFloat(),d.buildInverseMatrix(u,l,c),e.skeleton.joints.push(d)}var p=t.readInt();for(a=0;a<p;a++){for(var _=t.readUnsignedByte(),f=0;f<_;f++)e.source_skinData.push(t.readUnsignedByte()),e.source_skinData.push(t.readFloat());for(f=_;f<4;f++)e.source_skinData.push(0),e.source_skinData.push(0)}},i.versionDictionary={1:function(t,e){return i.parserVersion_1(t,e)},2:function(t,e){return i.parserVersion_2(t,e)},3:function(t,e){return i.parserVersion_3(t,e)}},i}();m.ESMVersion=t}(egret3d||(egret3d={})),function(a){var t=function(){function t(){}return t.parse=function(t){var e=new a.ByteArray(t);if(1701863680!=e.readUnsignedInt())return null;var i=e.readUnsignedInt();return a.EPAVersion.versionDictionary[i]?a.EPAVersion.versionDictionary[i](e):(console.log("egret3d engine not found "+i+" version"),null)},t}();a.EPAParser=t}(egret3d||(egret3d={})),function(l){var t=function(){function e(){}return e.parserVersion_1=function(t){for(var e=new l.PropertyAnim,i=t.readUnsignedShort(),a=0;a<i;a++){for(var r=t.readUTF(),n=[],o=t.readUnsignedShort(),s=0;s<o;s++){var h=new l.AnimCurve;h.type=t.readUnsignedInt(),h.start.x=t.readFloat(),h.start.y=t.readFloat(),h.end.x=t.readFloat(),h.end.y=t.readFloat(),h.c1.x=t.readFloat(),h.c1.y=t.readFloat(),h.c2.x=t.readFloat(),h.c2.y=t.readFloat(),n.push(h)}e.addAnimCurve(r,n)}return e},e.versionDictionary={1:function(t){return e.parserVersion_1(t)}},e}();l.EPAVersion=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){}return t.parse=function(t){var e=null;if(!window.DOMParser&&window.ActiveXObject)for(var i=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"],a=0;a<i.length;a++)try{(e=new ActiveXObject(i[a])).async=!1,e.loadXML(t);break}catch(t){}else{if(!(window.DOMParser&&document.implementation&&document.implementation.createDocument))return null;try{e=(new DOMParser).parseFromString(t,"text/xml")}catch(t){}}return e},t.eachXmlAttr=function(t,e){if(null!=t&&null!=e)for(var i,a=0,r=t.attributes.length;a<r;a++)e((i=t.attributes[a]).nodeName,i.textContent)},t}();t.XMLParser=e}(egret3d||(egret3d={})),function(y){var t=function(a){function v(t,e,i){void 0===t&&(t=null),void 0===e&&(e="MapConfig.xml"),void 0===i&&(i="resource/scene/"),a.call(this),this.container=null,this.autoPlayAnimation=!1,this._pathRoot="",this._path="",this._mapXmlParser=null,this._textures={},this._taskCount=0,this._event=new y.LoaderEvent3D,this.huds=new Array,this.taskTotal=0,this.taskCurrent=0,this.lightDict={},this.container=new y.Object3D,t&&this.load(t,e,i)}return __extends(v,a),v.prototype.findTexture=function(t){return this._textures[t]},v.prototype.load=function(t,e,i){void 0===e&&(e="MapConfig.xml"),void 0===i&&(i="resource/scene/"),this._pathRoot=i+t+"/",this._path=this._pathRoot+e,this.taskTotal++;var a=v._assetMgr.dispatchTask(this._path);a.data?this.parseXML(a.data):(this.addTask(a),v._assetMgr.dispatchEvent(a,this.onXmlLoad,this,null))},v.prototype.parseXML=function(t){var e=y.XMLParser.parse(t);for(var i in this._mapXmlParser=new y.MapXmlParser(e),this._mapXmlParser.taskDict)this.taskTotal++;this.createLight();for(var a=0;a<this._mapXmlParser.nodeList.length;a++){var r=this._mapXmlParser.nodeList[a];switch(r.object3d.parent||this.container.addChild(r.object3d),("Object3D"==r.type||"Camera3D"==r.type)&&this.doLoadEpa(r),r.type){case"Mesh":if(r.path){var n=this._pathRoot+r.path,o=v._assetMgr.dispatchTask(n);o.data?this.processMesh(r,new y.Mesh(o.data,new y.TextureMaterial)):(this.addTask(o),v._assetMgr.dispatchEvent(o,this.onEsmLoad,this,r))}else r.geometry&&this.processMesh(r,new y.Mesh(y.GeometryUtil.createGemetryForType(r.geometry.type,r.geometry),new y.TextureMaterial));break;case"Terrain":if(r.path){n=this._pathRoot+r.path;var s=v._assetMgr.dispatchTask(n);if(s.data){var h=r.geometry,l=new y.ElevationGeometry(s.data,h.width,h.height,h.depth,h.segmentsW,h.segmentsH),u=new y.Mesh(l,new y.TextureMaterial(s.data));this.processHeightMesh(r,u)}else this.addTask(s),v._assetMgr.dispatchEvent(s,this.onHeightImg,this,r)}break;case"ParticleEmitter":if(r.path){n=this._pathRoot+r.path;var c=v._assetMgr.dispatchTask(n);if(c.data){var d=c.ParticleData;d&&this.processParticle(d,r)}else this.addTask(s),v._assetMgr.dispatchEvent(c,this.onParticleXML,this,r)}}}for(a=0;a<this._mapXmlParser.textures.length;++a){var p=this._mapXmlParser.textures[a],_=(n=this._pathRoot+p.path,v._assetMgr.dispatchTask(n));_.data?this._textures[p.name]=_.data:(this.addTask(_),v._assetMgr.dispatchEvent(_,this.onTexture,this,p.name))}for(a=0;a<this._mapXmlParser.hudList.length;++a){var f=this._mapXmlParser.hudList[a],m=new y.HUD;if(m.name=f.name,m.bothside=f.bothside,m.x=f.x,m.y=f.y,m.rotationX=f.rx,m.rotationY=f.ry,m.rotationZ=f.rz,m.width=f.width,m.height=f.height,f.vs&&(m.vsShader=f.vs),f.fs&&(m.fsShader=f.fs),this.huds.push(m),f.hud=m,f.texture){n=this._pathRoot+f.texture;var g=v._assetMgr.dispatchTask(n);g.data?m.diffuseTexture=g.data:(this.addTask(g),v._assetMgr.dispatchEvent(g,this.onHudTexture,this,f))}}},v.prototype.onParticleXML=function(t,e){var i=t.ParticleData;i||(i=(new y.ParticleXmlParser).parse(t.data),(t.ParticleData=i).fileUrl=t.url,i.fileName=t.fileName),this.processParticle(i,e),this.processTask(t)},v.prototype.processParticle=function(t,e){if(t.shape.meshFile){var i=this._pathRoot+t.shape.meshFile,a=v._assetMgr.dispatchTask(i);if(a.data)t.shape.geometry=a.data,this.processParticleGeometry(t,e);else{var r={};r.particle=t,r.nodeData=e,this.addTask(a),v._assetMgr.dispatchEvent(a,this.onParticleEsmLoad,this,r)}}else e.geometry&&(t.shape.geometry=y.GeometryUtil.createGemetryForType(e.geometry.type,e.geometry)),this.processParticleGeometry(t,e);return null},v.prototype.processParticleGeometry=function(t,e){t.materialData=this._mapXmlParser.matDict[e.materialIDs[0]];var i=new y.ParticleEmitter(t,new y.TextureMaterial);e.x*=y.ParticleData.SCALE_VALUE,e.y*=y.ParticleData.SCALE_VALUE,e.z*=y.ParticleData.SCALE_VALUE,e.object3d.position.scaleBy(y.ParticleData.SCALE_VALUE),this.processObject3d(e,i),i.play(),this.processMat(e)},v.prototype.processObject3d=function(t,e){e.name=t.object3d.name,e.visible=t.object3d.visible,e.position=t.object3d.position,e.orientation=t.object3d.orientation,e.scale=t.object3d.scale,t.object3d.swapObject(e),t.object3d=e},v.prototype.onXmlLoad=function(t){this.parseXML(t.data),this.processTask(t)},v.prototype.onHeightImg=function(t,e){var i=e.geometry,a=new y.ElevationGeometry(t.data,i.width,i.height,i.depth,i.segmentsW,i.segmentsH),r=new y.Mesh(a,new y.TextureMaterial(t.data));this.processHeightMesh(e,r),this.doLoadEpa(e),this.processTask(t)},v.prototype.onTexture=function(t,e){this._textures[e]=t.data,this.processTask(t)},v.prototype.onHudTexture=function(t,e){e.hud.diffuseTexture=t.data,this.processTask(t)},v.prototype.onMaterialTexture=function(t,e){e.mapNodeData.object3d.getMaterial(e.matID)[e.type]=t.data,this.processTask(t)},v.prototype.onMethodTexture=function(t,e){e.method[e.textureName]=t.data,this.processTask(t)},v.prototype.doLoadEpa=function(t){if(t.propertyAnims)for(var e=0;e<t.propertyAnims.length;++e){var i=t.propertyAnims[e],a=this._pathRoot+i.path,r=v._assetMgr.dispatchTask(a);r.data?this.processEpa(t,r.data):(this.addTask(r),v._assetMgr.dispatchEvent(r,this.onEpaLoad,this,t))}},v.prototype.processEpa=function(t,e){t.object3d.bindAnimation(e),this.autoPlayAnimation&&t.object3d.proAnimation&&t.object3d.proAnimation.play()},v.prototype.processHeightMesh=function(t,e){this.processObject3d(t,e),this.processMat(t)},v.prototype.processMesh=function(t,e){this.processObject3d(t,e),this.processMat(t);for(var i=0;i<t.skinClips.length;i++){var a=t.skinClips[i],r=this._pathRoot+a.path,n=v._assetMgr.dispatchTask(r);if(n.data){var o=n.data;e.animation.skeletonAnimationController.addSkeletonAnimationClip(o.clone())}else{var s={};s.eamData=a,s.mapNodeData=t,this.addTask(n),v._assetMgr.dispatchEvent(n,this.onEamLoad,this,s)}}},v.prototype.onEsmLoad=function(t,e){if(e){var i=new y.Mesh(t.data,new y.TextureMaterial);this.processMesh(e,i),this.doLoadEpa(e)}this.processTask(t)},v.prototype.onParticleEsmLoad=function(t,e){var i=e.particle,a=e.nodeData;i.shape.geometry=t.data,this.processParticleGeometry(i,a),this.processTask(t)},v.prototype.onEamLoad=function(t,e){var i=t.data;i.animationName=e.eamData.name;var a=e.mapNodeData.object3d;a.animation.skeletonAnimationController.addSkeletonAnimationClip(i.clone()),this.autoPlayAnimation&&a.animation.play(i.animationName,1,!1,!1),this.processTask(t)},v.prototype.onEpaLoad=function(t,e){var i=t.data.clone();this.processEpa(e,i),this.processTask(t)},v.prototype.addTask=function(t){this._taskCount++},v.prototype.processTask=function(t){if(this._taskCount--,this.taskCurrent++,this._event.eventType=y.LoaderEvent3D.LOADER_PROGRESS,(this._event.target=this)._event.loader=t,this._event.data=t,this.dispatchEvent(this._event),this._taskCount<=0){for(var e=[],i=0;i<this._mapXmlParser.nodeList.length;i++){var a=this._mapXmlParser.nodeList[i];if(a.object3d instanceof y.ParticleEmitter)for(var r=a.object3d,n=0;n<a.childs.length;++n){var o=a.childs[n],s=this.container.findObject3D(o.name);e.push(s),s instanceof y.ParticleEmitter&&r.addSubEmitter(Number(y.ParticleDataSubEmitterPhase[o.phase]),s)}}var h;for(i=0;i<e.length;i++)(h=e[i])&&h.parent&&h.parent.removeChild(h);if(this._event.eventType=y.LoaderEvent3D.LOADER_COMPLETE,(this._event.target=this).view3d)for(i=0;i<this.huds.length;++i)this.view3d.addHUD(this.huds[i]);this.dispatchEvent(this._event)}},v.prototype.addImaTask=function(t,e,i,a,r){var n=null,o=this._pathRoot+t;if((n=v._assetMgr.dispatchTask(o)).data)r[e]=n.data;else{var s={};s.type=e,s.matID=i,s.mapNodeData=a,this.addTask(n),v._assetMgr.dispatchEvent(n,this.onMaterialTexture,this,s)}return n},v.prototype.addMethodImgTask=function(t,e,i){var a=this._pathRoot+t,r=v._assetMgr.dispatchTask(a);if(r.data)e[i]=r.data;else{var n={};n.method=e,n.textureName=i,this.addTask(r),v._assetMgr.dispatchEvent(r,this.onMethodTexture,this,n)}return r},v.prototype.processMat=function(t){for(var e=t.object3d,i=0;i<t.materialIDs.length;++i){var a=this._mapXmlParser.matDict[t.materialIDs[i]];if(a){var r=e.getMaterial(i);r||(r=new y.TextureMaterial,e.addSubMaterial(i,r));""!=a.diffuseTextureName&&this.addImaTask(a.diffuseTextureName,"diffuseTexture",i,t,r),""!=a.normalTextureName&&this.addImaTask(a.normalTextureName,"normalTexture",i,t,r),""!=a.specularTextureName&&this.addImaTask(a.specularTextureName,"specularTexture",i,t,r),r.diffuseColor=a.diffuseColor,r.ambientColor=a.ambientColor,r.specularColor=a.specularColor,r.alpha=a.alpha,r.specularLevel=a.specularLevel,r.gloss=a.gloss,r.castShadow=a.castShadow,r.acceptShadow=a.acceptShadow,r.smooth=a.smooth,r.repeat=a.repeat,r.bothside=a.bothside,r.drawMode=a.drawMode,r.cullMode=a.cullMode,r.blendMode=a.blendMode,r.cutAlpha=a.cutAlpha,r.uvRectangle.copy(a.uvRectangle);for(var n=new y.LightGroup,o=0;o<a.lightIds.length;++o){var s=this.lightDict[a.lightIds[o]];s&&n.addLight(s)}0<n.lightNum&&(r.lightGroup=n),this.processMethod(r,a)}}},v.prototype.processMethod=function(t,e){for(var i=null,a=0,r=e.methods;a<r.length;a++){i=r[a];var n=y.CheckerboardTexture.texture;if(i.type==y.MatMethodData.methodType.lightmapMethod){var o=new y.LightmapMethod(i.usePower);t.diffusePass.addMethod(o),o.lightTexture=n;var s=i.texturesData[0];this.addMethodImgTask(s.path,o,s.attributeName)}else if(i.type==y.MatMethodData.methodType.uvRollMethod){var h=new y.UVRollMethod;t.diffusePass.addMethod(h),h.speedU=i.uSpeed,h.speedV=i.vSpeed,t.repeat=!0,h.start(!0)}else if(i.type==y.MatMethodData.methodType.mulUvRollMethod){var l=new y.MulUVRollMethod;t.diffusePass.addMethod(l),l.diffuseTexture1=n,l.setSpeedU(0,i.uSpeed),l.setSpeedV(0,i.vSpeed);s=i.texturesData[0];l.setSpeedU(1,s.uSpeed),l.setSpeedV(1,s.vSpeed),this.addMethodImgTask(s.path,l,s.attributeName),t.repeat=!0,l.start(!0)}else if(i.type==y.MatMethodData.methodType.alphaMaskMethod){var u=new y.AlphaMaskMethod;t.diffusePass.addMethod(u),u.maskTexture=n;s=i.texturesData[0];this.addMethodImgTask(s.path,u,s.attributeName)}else if(i.type==y.MatMethodData.methodType.streamerMethod){var c=new y.StreamerMethod;t.diffusePass.addMethod(c),c.steamerTexture=n;s=i.texturesData[0];this.addMethodImgTask(s.path,c,s.attributeName),c.speedU=i.uSpeed,c.speedV=i.vSpeed,c.start(!0)}else if(i.type==y.MatMethodData.methodType.terrainARGBMethod){var d=new y.TerrainARGBMethod(n,n,n,n,n);t.diffusePass.addMethod(d);s=null;for(var p=0;p<i.texturesData.length;++p)s=i.texturesData[p],this.addMethodImgTask(s.path,d,s.attributeName),0!=p&&d.setUVTitling(p-1,Number(s.uvTitlingX),Number(s.uvTitlingY))}else if(i.type==y.MatMethodData.methodType.waterWaveMethod){var _=new y.WaterWaveMethod;t.diffusePass.addMethod(_),i.deepWaterColor&&(_.deepWaterColor=Number(i.deepWaterColor)),i.shallowWaterColor&&(_.shallowWaterColor=Number(i.shallowWaterColor)),t.repeat=!0}else if(i.type==y.MatMethodData.methodType.waterNormalMethod){var f=new y.WaterNormalMethod;t.diffusePass.addMethod(f),f.normalTextureA=n,f.normalTextureB=n,i.uScale&&i.vScale&&f.setUvScale(Number(i.uScale),Number(i.vScale));for(s=null,p=0;p<i.texturesData.length;++p)s=i.texturesData[p],f.setUvSpeed(p,Number(s.uSpeed),Number(s.vSpeed)),this.addMethodImgTask(s.path,f,s.attributeName)}}},v.prototype.createLight=function(){var t=null;for(var e in this._mapXmlParser.lightDict)if((t=this._mapXmlParser.lightDict[e]).type==y.LightType.directlight&&this._mapXmlParser.directLight){var i=new y.DirectLight(t.direction);i.lightId=t.id,i.diffuse=t.diffuseColor,i.ambient=t.ambientColor,i.halfIntensity=t.halfIntensity,i.intensity=t.intensity,this.lightDict[t.id]=i}else if(t.type==y.LightType.pointlight&&this._mapXmlParser.pointLight){var a=new y.PointLight(0);a.lightId=t.id,a.position=t.position,a.ambient=t.ambientColor,a.diffuse=t.diffuseColor,a.radius=t.radius,a.falloff=t.falloff,a.intensity=t.intensity,this.lightDict[t.id]=a}},v._assetMgr=new y.AssetManager,v}(y.EventDispatcher);y.MapLoader=t}(egret3d||(egret3d={})),function(t){var e=function(){this.type="",this.insID="",this.parent="",this.name="",this.path="",this.fov=0,this.clipNear=0,this.clipFar=0,this.materialIDs=[],this.skinClips=[],this.propertyAnims=[],this.billboard=!1,this.visible=!0,this.x=0,this.y=0,this.z=0,this.rx=0,this.ry=0,this.rz=0,this.rw=0,this.sx=1,this.sy=1,this.sz=1,this.geometry={},this.childs=[]};(egret3d||(egret3d={})).MapNodeData=e}(),function(p){var t=function(){function t(t){this.version=1,this.nodeList=new Array,this.hudList=new Array,this.matDict={},this.lightDict={},this.directLight=!1,this.pointLight=!1,this.textures=[],this.taskDict={};var e=t.getElementsByTagName("version");this.version=Number(e[0].textContent);var i=t.getElementsByTagName("mat"),a=t.getElementsByTagName("node"),r=t.getElementsByTagName("env"),n=(t.getElementsByTagName("cameraAnims"),t.getElementsByTagName("hud")),o=t.getElementsByTagName("texture");this.parseEnvironment(r);for(var s=0;s<i.length;s++){var h=this.parseMat(i[s]);h&&(this.matDict[h.id]=h,this.calculateMatTask(h))}for(s=0;s<a.length;s++){(u=this.parseNode(a[s]))&&(this.nodeList.push(u),this.calculateNodeTask(u))}for(s=0;s<o.length;s++)this.parseTexture(o[s]);for(s=0;s<n.length;s++){var l=this.parseHud(n[s]);l&&(this.hudList.push(l),this.calculateHudTask(l))}for(s=0;s<this.nodeList.length;s++){var u;if("Camera3D"==(u=this.nodeList[s]).type){var c=new p.Camera3D;c.fieldOfView=u.fov,c.near=u.clipNear,c.far=u.clipFar,u.object3d=c}else"Billboard"==u.type?u.object3d=new p.Billboard(new p.TextureMaterial(p.CheckerboardTexture.texture)):(u.type,u.object3d=new p.Object3D);u.object3d.name=u.name,u.object3d.visible=u.visible,u.object3d.position=new p.Vector3D(u.x,u.y,u.z),u.object3d.orientation=new p.Quaternion(u.rx,u.ry,u.rz,u.rw),u.object3d.scale=new p.Vector3D(u.sx,u.sy,u.sz)}this.processNode()}return t.prototype.parseTexture=function(t){if(1==t.childNodes.length)return null;var e,i,a=null,r=0;for(r=0,i=t.childNodes.length;r<i;r++)if(e=t.childNodes[r],!this.nodeFilter(e)){for(var n={},o=0;o<e.attributes.length;++o)n[(a=e.attributes[o]).name]=a.value;this.textures.push(n),this.calculateTextureTask(n)}},t.prototype.parseMethod=function(t){if(t.childNodes.length<=1)return null;for(var e,i,a,r=[],n=null,o=0,s=t.childNodes.length;o<s;o++)if(i=(e=t.childNodes[o]).nodeName,!this.nodeFilter(e)){(a=new p.MatMethodData).type=i;for(var h=0;h<e.attributes.length;++h){var l=typeof a[(n=e.attributes[h]).name];a[n.name]="string"==l?n.value:"number"==l?Number(n.value):"boolean"==l?"true"==n.value:n.value}for(h=0;h<e.childNodes.length;++h){var u=e.childNodes[h];if(!this.nodeFilter(u)){for(var c={},d=0;d<u.attributes.length;++d)c[(n=u.attributes[d]).name]=n.value;a.texturesData.push(c)}}r.push(a)}return r},t.prototype.parseMat=function(t){if(0==t.childNodes.length)return null;for(var e=new p.MatSphereData,i=null,a=0;a<t.attributes.length;++a)e[(i=t.attributes[a]).name]=i.value;a=0;for(var r,n,o=t.childNodes.length;a<o;a++)if(n=(r=t.childNodes[a]).nodeName,!this.nodeFilter(r))if("methods"==n)e.methods=this.parseMethod(r);else if("uvRectangle"==n)for(var s=0;s<r.attributes.length;++s)e.uvRectangle[r.attributes[s].name]=Number(r.attributes[s].value);else if("blendMode"==n)e[r.nodeName]=p.BlendMode[r.textContent];else if("lightIds"==n){if(r.textContent){var h=r.textContent.split(",");for(s=0;s<h.length;++s)e.lightIds.push(Number(h[s]))}}else{var l=typeof e[r.nodeName];"string"==l?e[r.nodeName]=r.textContent:"number"==l?e[r.nodeName]=Number(r.textContent):"boolean"==l&&(e[r.nodeName]="true"==r.textContent)}return e},t.prototype.processNode=function(){for(var t=0;t<this.nodeList.length;t++)for(var e=this.nodeList[t],i=0;i<this.nodeList.length;i++){var a=this.nodeList[i];if(e.parent==a.insID){a.object3d.addChild(e.object3d);break}}},t.prototype.parseNode=function(t){if(1==t.childNodes.length)return null;for(var e=null,i=new p.MapNodeData,a=0;a<t.attributes.length;++a){var r=typeof i[(e=t.attributes[a]).name];i[e.name]="number"==r?Number(e.value):"boolean"==r?"true"==e.value:e.value}var n,o,s;a=0;for(a=0,s=t.childNodes.length;a<s;a++)if(o=(n=t.childNodes[a]).nodeName,!this.nodeFilter(n))if("pos"==o)for(var h=0;h<n.attributes.length;++h)i[(e=n.attributes[h]).nodeName]=Number(e.value);else if("rot"==o)for(h=0;h<n.attributes.length;++h)i[(e=n.attributes[h]).nodeName]=Number(e.value);else if("scale"==o)for(h=0;h<n.attributes.length;++h)i[(e=n.attributes[h]).nodeName]=Number(e.value);else if("mat"==o)for(h=0;h<n.attributes.length;++h)"id"==(e=n.attributes[h]).nodeName&&(i.materialIDs=(e.value+"").split(","));else if("skinClip"==o){var l={};i.skinClips.push(l);for(h=0;h<n.attributes.length;++h)l[(e=n.attributes[h]).nodeName]=e.value}else if("propertyAnim"==o){var u={};i.propertyAnims.push(u);for(h=0;h<n.attributes.length;++h)u[(e=n.attributes[h]).nodeName]=e.value}else if("geometry"==o){var c={};for(h=0;h<n.attributes.length;++h)"type"==(e=n.attributes[h]).name?c[e.name]=e.value:c[e.name]=Number(e.value);i.geometry=c}else if("sub"==o){var d={};for(h=0;h<n.attributes.length;++h)d[(e=n.attributes[h]).name]=e.value;i.childs.push(d)}return i},t.prototype.parseEnvironment=function(t){if(!(t.length<=0)){for(var e,i,a,r=null,n=0;n<t[0].attributes.length;++n)this[(r=t[0].attributes[n]).name]="open"==r.value;for(var o=0,s=t.length;o<s;o++){e=t[o];for(var h=0;h<e.childNodes.length;++h)if(i=e.childNodes[h],!this.nodeFilter(i))if("light"==i.nodeName){var l=new p.MapLightData;for(n=0;n<i.attributes.length;++n)"id"==(r=i.attributes[n]).name?l[r.name]=Number(r.value):l[r.name]=r.value;this.lightDict[l.id]=l;for(n=0;n<i.childNodes.length;++n)if(a=i.childNodes[n],!this.nodeFilter(a))if("direction"==a.nodeName)for(var u=0;u<a.attributes.length;++u)r=a.attributes[u],l.direction[r.name]=Number(r.value);else if("position"==a.nodeName)for(u=0;u<a.attributes.length;++u)r=a.attributes[u],l.position[r.name]=Number(r.value);else"type"==a.nodeName&&(l.type=p.LightType[a.textContent])}else i.nodeName}}},t.prototype.parseHud=function(t){if(1==t.childNodes.length)return null;for(var e=null,i=new p.HUDData,a=0;a<t.attributes.length;++a)"bothside"==(e=t.attributes[a]).nodeName?i[e.nodeName]="true"==e.value:i[e.nodeName]=e.value;var r,n,o;a=0;for(a=0,o=t.childNodes.length;a<o;a++)if(n=(r=t.childNodes[a]).nodeName,!this.nodeFilter(r))for(var s=0;s<r.attributes.length;++s)i[(e=r.attributes[s]).nodeName]="shader"==n?e.value:Number(e.value);return i},t.prototype.calculateMatTask=function(t){""!=t.diffuseTextureName&&(this.taskDict[t.diffuseTextureName]=0),""!=t.normalTextureName&&(this.taskDict[t.normalTextureName]=0),""!=t.specularTextureName&&(this.taskDict[t.specularTextureName]=0);for(var e=0;e<t.methods.length;++e)for(var i=t.methods[e],a=0;a<i.texturesData.length;++a){var r=i.texturesData[a];r.path&&(this.taskDict[r.path]=0)}},t.prototype.calculateNodeTask=function(t){t.path&&(this.taskDict[t.path]=0);for(var e=0;e<t.skinClips.length;e++){var i=t.skinClips[e];i.path&&(this.taskDict[i.path]=0)}for(e=0;e<t.propertyAnims.length;++e){var a=t.propertyAnims[e];a.path&&(this.taskDict[a.path]=0)}},t.prototype.calculateHudTask=function(t){t.texture&&(this.taskDict[t.texture]=0)},t.prototype.calculateTextureTask=function(t){t.path&&(this.taskDict[t.path]=0)},t.prototype.nodeFilter=function(t){return"#text"==t.nodeName||"#comment"==t.nodeName},t}();p.MapXmlParser=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){this.id="",this.type="",this.usePower=!1,this.texturesData=[],this.uSpeed=0,this.vSpeed=0}return t.methodType={lightmapMethod:"lightmapMethod",uvRollMethod:"uvRollMethod",mulUvRollMethod:"mulUvRollMethod",alphaMaskMethod:"alphaMaskMethod",streamerMethod:"streamerMethod",terrainARGBMethod:"terrainARGBMethod",waterWaveMethod:"waterWaveMethod",waterNormalMethod:"waterNormalMethod",particleUVRoll:"particleUVRoll"},t}();t.MatMethodData=e}(egret3d||(egret3d={})),function(t){var e=function(){this.id="",this.diffuseTextureName="",this.normalTextureName="",this.specularTextureName="",this.diffuseColor=0,this.ambientColor=0,this.specularColor=0,this.alpha=0,this.specularLevel=0,this.gloss=0,this.ambientPower=0,this.diffusePower=0,this.normalPower=0,this.castShadow=!1,this.acceptShadow=!1,this.smooth=!1,this.repeat=!1,this.bothside=!1,this.drawMode=0,this.cullMode=0,this.blendMode=0,this.cutAlpha=.7,this.methods=[],this.lightIds=[],this.uvRectangle=new t.Rectangle(0,0,1,1)};t.MatSphereData=e}(egret3d||(egret3d={})),function(t){var e=function(){this.id=0,this.type=0,this.diffuseColor=16777215,this.ambientColor=16777215,this.intensity=1,this.halfIntensity=0,this.direction=new t.Vector3D(-.5,-.6,.2),this.position=new t.Vector3D,this.falloff=0,this.radius=100};t.MapLightData=e}(egret3d||(egret3d={})),function(t){var e=function(){this.bothside=!1};(egret3d||(egret3d={})).HUDData=e}(),function(s){var t=function(t){function e(){t.apply(this,arguments),this._event=new s.ParserEvent3D}return __extends(e,t),e.prototype.parser=function(t){var e=this,i=new s.ByteArray(t),a=new s.ByteArray;i.readBytes(a,0,3);var r=i.position=0;switch(r|=a.readUnsignedByte()<<16,r|=a.readUnsignedByte()<<8,r|=a.readUnsignedByte()){case 4473939:this.datas=s.DDSParser.parse(t),this.dataFormat=".dds",this.doLoadComplete();break;case 2:case 16:this.datas=s.TGAParser.parse(t),this.dataFormat=".tga",this.doLoadComplete();break;case 16767231:var n=new Blob([t]);this.dataFormat=".jpg";var o=document.createElement("img");null!=window.createObjectURL?o.src=window.createObjectURL(n):null!=window.URL?o.src=window.URL.createObjectURL(n):null!=window.webkitURL&&(o.src=window.webkitURL.createObjectURL(n)),o.onload=function(){return e.onLoad(o)};break;case 8998990:n=new Blob([t]);this.dataFormat=".png";o=document.createElement("img");null!=window.createObjectURL?o.src=window.createObjectURL(n):null!=window.URL?o.src=window.URL.createObjectURL(n):null!=window.webkitURL&&(o.src=window.webkitURL.createObjectURL(n)),o.onload=function(){return e.onLoad(o)};break;case 6648685:this.dataFormat=".esm",this.datas=s.ESMParser.parse(t),this.doLoadComplete();break;case 6644077:this.dataFormat=".eam",this.datas=s.EAMParser.parse(t),this.doLoadComplete();break;case 6644577:this.dataFormat=".eca",this.datas=s.ECAParser.parse(t),this.doLoadComplete();break;default:return!1}return!0},e.prototype.onLoad=function(t){this.datas=new s.ImageTexture(t),this.doLoadComplete()},e.prototype.doLoadComplete=function(){this._event.eventType=s.ParserEvent3D.PARSER_COMPLETE,((this._event.data=this)._event.parser=this).dispatchEvent(this._event)},e}(s.EventDispatcher);s.ParserUtils=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){this.vsShaderList=[],this.fsShaderList=[]}return t.prototype.upload=function(t,e,i,a,r,n,o){},t.prototype.activeState=function(t,e,i,a,r,n,o){},t.prototype.dispose=function(){},t}();t.MethodBase=e}(egret3d||(egret3d={})),function(o){var t=function(n){function t(t,e,i,a,r){n.call(this),this.uvs=new Float32Array(8),this.fsShaderList[o.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[o.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[o.ShaderPhaseType.diffuse_fragment].push("terrainRGBA_fragment"),this.controlTex=t,this.splat_0=e,this.splat_1=i,this.splat_2=a,this.splat_3=r,this.uvs[0]=1,this.uvs[1]=1,this.uvs[2]=1,this.uvs[3]=1,this.uvs[4]=1,this.uvs[5]=1,this.uvs[6]=1,this.uvs[7]=1}return __extends(t,n),t.prototype.setUVTitling=function(t,e,i){this.uvs[2*t]=e,this.uvs[2*t+1]=i},Object.defineProperty(t.prototype,"splat_0_Texture",{set:function(t){this.splat_0=t,this.materialData.splat_0Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"splat_1_Texture",{set:function(t){this.splat_1=t,this.materialData.splat_1Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"splat_2_Texture",{set:function(t){this.splat_2=t,this.materialData.splat_2Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"splat_3_Texture",{set:function(t){this.splat_3=t,this.materialData.splat_3Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlTexture",{set:function(t){this.controlTex=t,this.materialData.blendMaskTexture=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),t.prototype.upload=function(t,e,i,a,r,n,o){i.uvs=r.getUniformLocation(i.program3D,"uvs")},t.prototype.activeState=function(t,e,i,a,r,n,o){r.uniform1fv(i.uvs,this.uvs)},t.prototype.dispose=function(){},t}(o.MethodBase);o.TerrainARGBMethod=t}(egret3d||(egret3d={})),function(i){var t=function(e){function t(t){void 0===t&&(t="expHeightFog_fs"),e.call(this),this.uniform_globalFog=new Float32Array(7),this._fogColor=204,this._globalDensity=1,this._fogStartDistance=1e3,this._fogDistanceScale=.5,this._height=500,this._fogAlpha=1,this.vsShaderList[i.ShaderPhaseType.local_vertex]=this.vsShaderList[i.ShaderPhaseType.local_vertex]||[],this.vsShaderList[i.ShaderPhaseType.local_vertex].push("vertexPos_vs"),"line"==t?this.fsShaderList[i.ShaderPhaseType.lighting_fragment].push("lineFog"):"exp"==t?this.fsShaderList[i.ShaderPhaseType.lighting_fragment].push("expFog_fs"):"expHeightFog_fs"==t&&(this.fsShaderList[i.ShaderPhaseType.lighting_fragment]=this.fsShaderList[i.ShaderPhaseType.lighting_fragment]||[],this.fsShaderList[i.ShaderPhaseType.lighting_fragment].push("expHeightFog_fs")),this.uniform_globalFog[0]=.5,this.uniform_globalFog[1]=.6,this.uniform_globalFog[2]=.7,this.uniform_globalFog[3]=this._globalDensity,this.uniform_globalFog[4]=this._fogStartDistance,this.uniform_globalFog[5]=this._height,this.uniform_globalFog[6]=this._fogAlpha}return __extends(t,e),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this.fogColor},set:function(t){this._fogColor=t,this.uniform_globalFog[0]=(this._fogColor>>16&255)/255,this.uniform_globalFog[1]=(this._fogColor>>8&255)/255,this.uniform_globalFog[2]=(255&this._fogColor)/255},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(t){this._globalDensity=t,this.uniform_globalFog[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogStartDistance",{get:function(){return this._fogStartDistance},set:function(t){this._fogStartDistance=t,this.uniform_globalFog[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogHeight",{get:function(){return this._height},set:function(t){this._height=t,this.uniform_globalFog[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogAlpha",{get:function(){return this._height},set:function(t){this._height=t,this.uniform_globalFog[6]=t},enumerable:!0,configurable:!0}),t.prototype.upload=function(t,e,i,a,r,n,o){i.uniform_globalFog=r.getUniformLocation(i.program3D,"uniform_globalFog")},t.prototype.activeState=function(t,e,i,a,r,n,o){r.uniform1fv(i.uniform_globalFog,this.uniform_globalFog)},t.prototype.dispose=function(){},t}(i.MethodBase);i.FogMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.uniform_globalFog=new Float32Array(7),this._fogColor=204,this._fogStartDistance=1e3,this._fogFarDistance=4e4,this._fogAlpha=.6,this.vsShaderList[i.ShaderPhaseType.local_vertex]=this.vsShaderList[i.ShaderPhaseType.local_vertex]||[],this.vsShaderList[i.ShaderPhaseType.local_vertex].push("vertexPos_vs"),this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[i.ShaderPhaseType.multi_end_fragment].push("lineFog"),this.uniform_globalFog[0]=.5,this.uniform_globalFog[1]=.6,this.uniform_globalFog[2]=.7,this.uniform_globalFog[3]=1,this.uniform_globalFog[4]=this._fogStartDistance,this.uniform_globalFog[5]=this._fogFarDistance,this.uniform_globalFog[6]=this._fogAlpha}return __extends(e,t),Object.defineProperty(e.prototype,"fogColor",{get:function(){return this.fogColor},set:function(t){this._fogColor=t,this.uniform_globalFog[0]=(this._fogColor>>16&255)/255,this.uniform_globalFog[1]=(this._fogColor>>8&255)/255,this.uniform_globalFog[2]=(255&this._fogColor)/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogStartDistance",{get:function(){return this._fogStartDistance},set:function(t){this._fogStartDistance=t,this.uniform_globalFog[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogFarDistance",{get:function(){return this._fogFarDistance},set:function(t){this._fogFarDistance=t,this.uniform_globalFog[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogAlpha",{get:function(){return this._fogAlpha},set:function(t){this._fogAlpha=t,this.uniform_globalFog[6]=t},enumerable:!0,configurable:!0}),e.prototype.upload=function(t,e,i,a,r,n,o){i.uniform_globalFog=r.getUniformLocation(i.program3D,"uniform_globalFog")},e.prototype.activeState=function(t,e,i,a,r,n,o){r.uniform1fv(i.uniform_globalFog,this.uniform_globalFog)},e.prototype.dispose=function(){},e}(i.MethodBase);i.LineFogMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._uvRoll=new Float32Array(2),this._speedU=5e-5,this._speedV=0,this._time=0,this._start=!1,this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[i.ShaderPhaseType.diffuse_fragment].push("uvRoll_fs")}return __extends(e,t),Object.defineProperty(e.prototype,"speedU",{get:function(){return this._speedU},set:function(t){this._speedU=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedV",{get:function(){return this._speedV},set:function(t){this._speedV=t},enumerable:!0,configurable:!0}),e.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},e.prototype.stop=function(){this._start=!1},e.prototype.upload=function(t,e,i,a,r,n,o){i.uvRoll=r.getUniformLocation(i.program3D,"uvRoll")},e.prototype.activeState=function(t,e,i,a,r,n,o){this._start&&(this._time+=e,this._uvRoll[0]=this._time*this._speedU,this._uvRoll[1]=this._time*this._speedV,r.uniform1fv(i.uvRoll,this._uvRoll))},e}(i.MethodBase);i.UVRollMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._uvRoll=new Float32Array(4),this._uvSpeed=new Float32Array(4),this._time=0,this._start=!1,this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[i.ShaderPhaseType.diffuse_fragment].push("mulUvRoll_fs"),this._uvSpeed[0]=5e-5,this._uvSpeed[1]=0,this._uvSpeed[2]=5e-5,this._uvSpeed[3]=0}return __extends(e,t),e.prototype.setSpeedU=function(t,e){this._uvSpeed[2*t+0]=e},e.prototype.getSpeedU=function(t){return this._uvSpeed[2*t+0]},e.prototype.setSpeedV=function(t,e){this._uvSpeed[2*t+1]=e},e.prototype.getSpeedV=function(t){return this._uvSpeed[2*t+1]},e.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},e.prototype.stop=function(){this._start=!1},Object.defineProperty(e.prototype,"diffuseTexture1",{get:function(){return this._diffuseTexture1},set:function(t){this._diffuseTexture1=t,this.materialData.diffuseTexture1=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),e.prototype.upload=function(t,e,i,a,r,n,o){i.mulUvRoll=r.getUniformLocation(i.program3D,"mulUvRoll")},e.prototype.activeState=function(t,e,i,a,r,n,o){if(this._start){this._time+=e;for(var s=0;s<4;++s)this._uvRoll[s]=this._time*this._uvSpeed[s];r.uniform1fv(i.mulUvRoll,this._uvRoll)}},e}(i.MethodBase);i.MulUVRollMethod=t}(egret3d||(egret3d={})),function(n){var t=function(r){function t(t,e,i,a){r.call(this),this._uvSpriteSheet=new Float32Array(4),this._uvRectangle=new n.Rectangle,this._speed=0,this._time=0,this._numTime=.4,this._start=!1,this._frameNum=12,this._row=4,this._column=4,this._currentFrame=0,this.frameList=[],this._change=!1,this.fsShaderList[n.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[n.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[n.ShaderPhaseType.diffuse_fragment].push("uvSpriteSheet_fs"),this.frameNum=t,this.row=e,this.column=i,this.numTime=a}return __extends(t,r),t.prototype.caculate=function(){this._speed=1e3*this._numTime/this._frameNum,this._uvRectangle.x=0,this._uvRectangle.y=0,this._uvRectangle.width=1/this._row,this._uvRectangle.height=1/this._column,this.frameList.length=this._frameNum;for(var t=0,e=0,i=0;i<this._frameNum;i++){t=i%this._row,e=Math.floor(i/this._column);var a=new n.Rectangle;a.x=t*this._uvRectangle.width+this._uvRectangle.x,a.y=e*this._uvRectangle.height+this._uvRectangle.y,a.width=this._uvRectangle.width,a.height=this._uvRectangle.height,this.frameList[i]=a}},Object.defineProperty(t.prototype,"numTime",{get:function(){return this._numTime},set:function(t){this._numTime!=t&&(this._change=!0,this._numTime=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameNum",{get:function(){return this._frameNum},set:function(t){this._frameNum!=t&&(this._change=!0,this._frameNum=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._row},set:function(t){this._row!=t&&(this._change=!0,this._row=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"column",{get:function(){return this._column},set:function(t){this._column!=t&&(this._change=!0,this._column=t)},enumerable:!0,configurable:!0}),t.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0,this._change&&this.caculate()},t.prototype.stop=function(){this._start=!1},t.prototype.upload=function(t,e,i,a,r,n,o){i.uvSpriteSheet=r.getUniformLocation(i.program3D,"uvSpriteSheet")},t.prototype.activeState=function(t,e,i,a,r,n,o){this._start&&(this._time+=e,1<this._time/this._speed&&(this._currentFrame++,this._currentFrame=this._currentFrame%this._frameNum,this._time=0,this._uvSpriteSheet[0]=this.frameList[this._currentFrame].x,this._uvSpriteSheet[1]=this.frameList[this._currentFrame].y,this._uvSpriteSheet[2]=this.frameList[this._currentFrame].width,this._uvSpriteSheet[3]=this.frameList[this._currentFrame].height,r.uniform1fv(i.uvSpriteSheet,this._uvSpriteSheet)))},t}(n.MethodBase);n.UVSpriteSheetMethod=t}(egret3d||(egret3d={})),function(i){var t=function(e){function t(t){void 0===t&&(t=!0),e.call(this),this.vsShaderList[i.ShaderPhaseType.local_vertex]=this.vsShaderList[i.ShaderPhaseType.local_vertex]||[],this.vsShaderList[i.ShaderPhaseType.local_vertex].push("secondaryUV_vs"),t?(this.fsShaderList[i.ShaderPhaseType.shadow_fragment]=this.fsShaderList[i.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[i.ShaderPhaseType.shadow_fragment].push("lightMapSpecularPower_fs")):(this.fsShaderList[i.ShaderPhaseType.shadow_fragment]=this.fsShaderList[i.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[i.ShaderPhaseType.shadow_fragment].push("lightMap_fs"))}return __extends(t,e),Object.defineProperty(t.prototype,"lightTexture",{set:function(t){this.texture=t,this.materialData.lightTexture!=this.texture&&(this.materialData.lightTexture=this.texture,this.materialData.lightTexture.useMipmap=!1,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),t.prototype.upload=function(t,e,i,a,r,n,o){},t.prototype.activeState=function(t,e,i,a,r,n,o){},t}(i.MethodBase);i.LightmapMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._speed=new i.Vector3D,this._time=0,this._windData=new Float32Array(4),this.vsShaderList[i.ShaderPhaseType.local_vertex]=this.vsShaderList[i.ShaderPhaseType.local_vertex]||[],this.vsShaderList[i.ShaderPhaseType.local_vertex].push("detail_Bending_vs")}return __extends(e,t),Object.defineProperty(e.prototype,"windDirAndSpeed",{get:function(){return this._speed},set:function(t){this._speed=t,this._windData[1]=t.x,this._windData[2]=t.y,this._windData[3]=t.z},enumerable:!0,configurable:!0}),e.prototype.upload=function(t,e,i,a,r,n,o){i.uniformTime=r.getUniformLocation(i.program3D,"uniformTime")},e.prototype.activeState=function(t,e,i,a,r,n,o){this._time+=e,this._windData[0]=this._time,r.uniform1fv(i.uniformTime,this._windData)},e}(i.MethodBase);i.PlantDistortedMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.fsShaderList[i.ShaderPhaseType.shadow_fragment]=this.fsShaderList[i.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[i.ShaderPhaseType.shadow_fragment].push("alphaMask_fs")}return __extends(e,t),Object.defineProperty(e.prototype,"maskTexture",{set:function(t){this.texture=t,this.materialData.maskTexture=this.texture,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),e.prototype.upload=function(t,e,i,a,r,n,o){},e.prototype.activeState=function(t,e,i,a,r,n,o){},e}(i.MethodBase);i.AlphaMaskMethod=t}(egret3d||(egret3d={})),function(i){var t=function(e){function t(t){e.call(this),this.aoPower=1,this.fsShaderList[i.ShaderPhaseType.shadow_fragment]=this.fsShaderList[i.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[i.ShaderPhaseType.shadow_fragment].push("AOMap_fs"),this.lightTexture=t}return __extends(t,e),Object.defineProperty(t.prototype,"lightTexture",{set:function(t){this.texture=t,this.materialData.aoTexture=this.texture,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),t.prototype.upload=function(t,e,i,a,r,n,o){i.aoPower=r.getUniformLocation(i.program3D,"aoPower")},t.prototype.activeState=function(t,e,i,a,r,n,o){r.uniform1f(i.aoPower,this.aoPower)},t.prototype.dispose=function(){},t}(i.MethodBase);i.AOMapMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[i.ShaderPhaseType.multi_end_fragment].push("colorTransform_fs")}return __extends(e,t),Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this.materialData.colorTransform},set:function(t){this.materialData.colorTransform=t},enumerable:!0,configurable:!0}),e.prototype.upload=function(t,e,i,a,r,n,o){i.uniform_colorTransformVec4=r.getUniformLocation(i.program3D,"uniform_colorTransformVec4"),i.uniform_colorTransformM44=r.getUniformLocation(i.program3D,"uniform_colorTransformM44")},e.prototype.activeState=function(t,e,i,a,r,n,o){r.uniform4fv(i.uniform_colorTransformVec4,this.colorTransform.vec4),r.uniformMatrix4fv(i.uniform_colorTransformM44,!1,this.colorTransform.m44.rawData)},e}(i.MethodBase);i.ColorTransformMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._posStart=new i.Vector3D,this._posEnd=new i.Vector3D,this._color=new i.Color,this._zeroVector=new i.Vector3D,this._helpVector=new i.Vector3D,this._helpMatrix=new i.Matrix4_4,this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[i.ShaderPhaseType.multi_end_fragment].push("colorGradients_fs"),this.vsShaderList[i.ShaderPhaseType.local_vertex]=this.vsShaderList[i.ShaderPhaseType.local_vertex]||[],this.vsShaderList[i.ShaderPhaseType.local_vertex].push("vertexPos_vs")}return __extends(e,t),e.prototype.setStartData=function(t,e,i){this._color.copyFrom(i),this._posStart.copyFrom(t),this._posEnd.copyFrom(e),this._posStart.w=0,this._posEnd.w=0},e.prototype.upload=function(t,e,i,a,r,n,o){i.uniform_colorGradientsSource=r.getUniformLocation(i.program3D,"uniform_colorGradientsSource")},e.prototype.activeState=function(t,e,i,a,r,n,o){this._helpMatrix.identity(),this._helpMatrix.copyFrom(o.viewMatrix),this._helpMatrix.transformVector(this._posStart,this._helpVector),this.materialData.colorGradientsSource[0]=this._helpVector.x,this.materialData.colorGradientsSource[1]=this._helpVector.y,this.materialData.colorGradientsSource[2]=this._helpVector.z,this._helpMatrix.transformVector(this._posEnd,this._helpVector),this.materialData.colorGradientsSource[3]=this._helpVector.x,this.materialData.colorGradientsSource[4]=this._helpVector.y,this.materialData.colorGradientsSource[5]=this._helpVector.z,this.materialData.colorGradientsSource[6]=this._color.r,this.materialData.colorGradientsSource[7]=this._color.g,this.materialData.colorGradientsSource[8]=this._color.b,this.materialData.colorGradientsSource[9]=this._color.a,r.uniform1fv(i.uniform_colorGradientsSource,this.materialData.colorGradientsSource)},e}(i.MethodBase);i.ColorGradientsMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._uvRoll=new Float32Array(3),this._speedU=1e-4,this._speedV=1e-4,this._intensity=.9,this._time=0,this._start=!1,this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[i.ShaderPhaseType.diffuse_fragment].push("uvStreamerRoll_fs"),this.start()}return __extends(e,t),Object.defineProperty(e.prototype,"speedU",{get:function(){return this._speedU},set:function(t){this._speedU=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedV",{get:function(){return this._speedV},set:function(t){this._speedV=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"steamerTexture",{get:function(){return this._steamerTexture},set:function(t){this._steamerTexture=t,this.materialData.streamerTexture=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),e.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},e.prototype.stop=function(){this._start=!1},e.prototype.upload=function(t,e,i,a,r,n,o){i.uvRoll=r.getUniformLocation(i.program3D,"uvRoll")},e.prototype.activeState=function(t,e,i,a,r,n,o){this._start&&(this._time+=e,this._uvRoll[0]=this._time*this._speedU,this._uvRoll[1]=this._time*this._speedV,this._uvRoll[2]=this._intensity,r.uniform1fv(i.uvRoll,this._uvRoll))},e}(i.MethodBase);i.StreamerMethod=t}(egret3d||(egret3d={})),function(s){var t=function(e){function t(t){e.call(this),this.materialData=t.materialData,this.vsShaderList[s.ShaderPhaseType.local_vertex]=this.vsShaderList[s.ShaderPhaseType.local_vertex]||[],this.vsShaderList[s.ShaderPhaseType.local_vertex].push("shadowMapping_vs"),this.fsShaderList[s.ShaderPhaseType.shadow_fragment]=this.fsShaderList[s.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[s.ShaderPhaseType.shadow_fragment].push("shadowMapping_fs")}return __extends(t,e),Object.defineProperty(t.prototype,"shadowMapTexture",{get:function(){return this.materialData.shadowMapTexture},set:function(t){this.materialData.shadowMapTexture!=t&&(this.materialData.shadowMapTexture=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),t.prototype.upload=function(t,e,i,a,r,n,o){},t.prototype.activeState=function(t,e,i,a,r,n,o){s.ShadowCast.instance.shadowCamera&&r.uniformMatrix4fv(i.uniform_ShadowMatrix.uniformIndex,!1,s.ShadowCast.instance.shadowCamera.viewProjectionMatrix.rawData),r.uniform3fv(i.uniform_ShadowColor.uniformIndex,this.materialData.shadowColor)},t}(s.MethodBase);s.ShadowMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.vsShaderList[i.ShaderPhaseType.global_vertex]=this.fsShaderList[i.ShaderPhaseType.global_vertex]||[],this.vsShaderList[i.ShaderPhaseType.global_vertex].push("cube_vertex"),this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[i.ShaderPhaseType.diffuse_fragment].push("cube_fragment")}return __extends(e,t),e.prototype.upload=function(t,e,i,a,r,n,o){},e.prototype.activeState=function(t,e,i,a,r,n,o){},e}(i.MethodBase);i.CubeMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[i.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[i.ShaderPhaseType.diffuse_fragment].push("color_fragment")}return __extends(e,t),e.prototype.upload=function(t,e,i,a,r,n,o){},e.prototype.activeState=function(t,e,i,a,r,n,o){},e}(i.MethodBase);i.ColorMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._waveVSData=new Float32Array(12),this._waveFSData=new Float32Array(8),this._time=0,this._start=!1,this._wave_xyz_intensity_0=new i.Vector3D(120,50,70),this._wave_xyz_intensity_1=new i.Vector3D(80,40,80),this._wave_xyz_speed_0=new i.Vector3D(.001,.001,-.001),this._wave_xyz_speed_1=new i.Vector3D(.001,.001,.001),this.vsShaderList[i.ShaderPhaseType.start_vertex]=this.vsShaderList[i.ShaderPhaseType.start_vertex]||[],this.vsShaderList[i.ShaderPhaseType.start_vertex].push("wave_vs"),this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[i.ShaderPhaseType.multi_end_fragment].push("wave_fs"),this.start(),this._waveVSData[0]=this._wave_xyz_intensity_0.x,this._waveVSData[1]=this._wave_xyz_intensity_0.y,this._waveVSData[2]=this._wave_xyz_intensity_0.z,this._waveVSData[3]=this._wave_xyz_intensity_1.x,this._waveVSData[4]=this._wave_xyz_intensity_1.y,this._waveVSData[5]=this._wave_xyz_intensity_1.z,this._waveVSData[6]=this._wave_xyz_speed_0.x,this._waveVSData[7]=this._wave_xyz_speed_0.y,this._waveVSData[8]=this._wave_xyz_speed_0.z,this._waveVSData[9]=this._wave_xyz_speed_1.x,this._waveVSData[10]=this._wave_xyz_speed_1.y,this._waveVSData[11]=this._wave_xyz_speed_1.z,this._waveFSData[0]=0,this._waveFSData[1]=63/255,this._waveFSData[2]=77/255,this._waveFSData[3]=1,this._waveFSData[4]=71/255,this._waveFSData[5]=118/255,this._waveFSData[6]=138/255,this._waveFSData[7]=1}return __extends(e,t),Object.defineProperty(e.prototype,"deepWaterColor",{get:function(){var t=255*this._waveFSData[0],e=255*this._waveFSData[1],i=255*this._waveFSData[2];return 255*this._waveFSData[3]<<24|t<<16|e<<8|i},set:function(t){var e=t>>24&255,i=t>>16&255,a=t>>8&255,r=255&t;this._waveFSData[0]=i/255,this._waveFSData[1]=a/255,this._waveFSData[2]=r/255,this._waveFSData[3]=e/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shallowWaterColor",{get:function(){var t=255*this._waveFSData[4],e=255*this._waveFSData[5],i=255*this._waveFSData[6];return 255*this._waveFSData[7]<<24|t<<16|e<<8|i},set:function(t){var e=t>>24&255,i=t>>16&255,a=t>>8&255,r=255&t;this._waveFSData[4]=i/255,this._waveFSData[5]=a/255,this._waveFSData[6]=r/255,this._waveFSData[7]=e/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waveTexture",{set:function(t){(this._waveTexture=t)&&this.materialData.waveTexture!=this._waveTexture&&(this.materialData.waveTexture=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),e.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},e.prototype.stop=function(){this._start=!1},e.prototype.upload=function(t,e,i,a,r,n,o){i.waveVSData=r.getUniformLocation(i.program3D,"waveVSData"),i.waveFSData=r.getUniformLocation(i.program3D,"waveFSData"),i.time=r.getUniformLocation(i.program3D,"time")},e.prototype.activeState=function(t,e,i,a,r,n,o){this._start&&(this._time+=e,r.uniform3fv(i.waveVSData,this._waveVSData),r.uniform4fv(i.waveFSData,this._waveFSData),r.uniform1f(i.time,this._time))},e}(i.MethodBase);i.WaterWaveMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._uvData=new Float32Array(8),this._time=0,this._start=!1,this._speedU_0=new i.Point(-9e-6,0),this._speedU_1=new i.Point(3e-5,0),this._distion_intensity=new i.Point(.05,.05),this._normal_0_UVScale=4,this._normal_1_UVScale=4,this.fsShaderList[i.ShaderPhaseType.normal_fragment]=this.fsShaderList[i.ShaderPhaseType.normal_fragment]||[],this.fsShaderList[i.ShaderPhaseType.normal_fragment].push("waterNormal_fs"),this.start(),this._uvData[0]=2.5*this._speedU_0.x,this._uvData[1]=2.5*this._speedU_0.y,this._uvData[2]=2.5*this._speedU_1.x,this._uvData[3]=2.5*this._speedU_1.y,this._uvData[4]=this._distion_intensity.x,this._uvData[5]=this._distion_intensity.y,this._uvData[6]=this._normal_0_UVScale,this._uvData[7]=this._normal_1_UVScale}return __extends(e,t),e.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},e.prototype.stop=function(){this._start=!1},e.prototype.setUvSpeed=function(t,e,i){switch(t){case 0:this._speedU_0.x=e,this._speedU_0.y=i,this._uvData[0]=2.5*this._speedU_0.x,this._uvData[1]=2.5*this._speedU_0.y;break;case 1:this._speedU_1.x=e,this._speedU_1.y=i,this._uvData[2]=2.5*this._speedU_1.x,this._uvData[3]=2.5*this._speedU_1.y}},e.prototype.setUvScale=function(t,e){this._normal_0_UVScale=t,this._normal_1_UVScale=e,this._uvData[6]=this._normal_0_UVScale,this._uvData[7]=this._normal_1_UVScale},Object.defineProperty(e.prototype,"normalTextureA",{set:function(t){this._normalTexture_0=t,this.materialData.normalTextureA!=this._normalTexture_0&&(this.materialData.normalTextureA=this._normalTexture_0,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalTextureB",{set:function(t){this._normalTexture_1=t,this.materialData.normalTextureB!=this._normalTexture_1&&(this.materialData.normalTextureB=this._normalTexture_1,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),e.prototype.upload=function(t,e,i,a,r,n,o){i.waterNormalData=r.getUniformLocation(i.program3D,"waterNormalData"),i.time=r.getUniformLocation(i.program3D,"time")},e.prototype.activeState=function(t,e,i,a,r,n,o){this._start&&(this._time+=e,r.uniform2fv(i.waterNormalData,this._uvData),r.uniform1f(i.time,this._time))},e}(i.MethodBase);i.WaterNormalMethod=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.reflectValue=.3,this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[i.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[i.ShaderPhaseType.multi_end_fragment].push("environmentMapping_fragment")}return __extends(e,t),Object.defineProperty(e.prototype,"reflect",{get:function(){return this.reflectValue},set:function(t){this.reflectValue=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"environmentTexture",{set:function(t){(this.texture=t)&&this.materialData.environmentMapTex!=this.texture&&(this.materialData.environmentMapTex=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),e.prototype.upload=function(t,e,i,a,r,n,o){i.reflectValue=r.getUniformLocation(i.program3D,"reflectValue")},e.prototype.activeState=function(t,e,i,a,r,n,o){r.uniform1f(i.reflectValue,this.reflectValue)},e}(i.MethodBase);i.EnvironmentMethod=t}(egret3d||(egret3d={})),function(e){var t=function(){function t(){this.sampler2DList=new Array,this.sampler3DList=new Array,this.vertexShader=new e.ShaderBase(e.Shader.vertex),this.fragmentShader=new e.ShaderBase(e.Shader.fragment),this.maxDirectLight=0,this.maxSpotLight=0,this.maxPointLight=0,this.maxBone=0,this.attributeDiry=!0}return t.prototype.dispose=function(){},t}();e.PassUsage=t}(egret3d||(egret3d={})),function(e){var t=function(t){function i(){t.apply(this,arguments),this.shaderPhaseTypes={},this.matID=0,this.drawMode=e.DrawMode.TRIANGLES,this.useMipmap=!0,this.normalTexture=e.CheckerboardTexture.texture,this.matcapTexture=e.CheckerboardTexture.texture,this.specularTexture=e.CheckerboardTexture.texture,this.lightTexture=e.CheckerboardTexture.texture,this.maskTexture=e.CheckerboardTexture.texture,this.aoTexture=e.CheckerboardTexture.texture,this.environmentTexture=e.CheckerboardTexture.texture,this.blendMaskTexture=e.CheckerboardTexture.texture,this.splat_0Tex=e.CheckerboardTexture.texture,this.splat_1Tex=e.CheckerboardTexture.texture,this.splat_2Tex=e.CheckerboardTexture.texture,this.splat_3Tex=e.CheckerboardTexture.texture,this.layer=0,this.castShadow=!1,this.acceptShadow=!0,this.shadowColor=new Float32Array([.5,.5,.6]),this.depthTest=!0,this.depthMode=0,this.smooth=!0,this.blendMode=e.BlendMode.NORMAL,this.alphaBlending=!1,this.ambientColor=3355443,this.diffuseColor=16777215,this.specularColor=16777215,this.specularLevel=4,this.gloss=20,this.cutAlpha=.7,this.repeat=!1,this.bothside=!1,this.alpha=1,this.albedo=.95,this.specularScale=1,this.normalScale=1,this.uvRectangle=new e.Rectangle(0,0,1,1),this.materialDataNeedChange=!0,this.textureChange=!1,this.textureStateChage=!0,this.cullFrontOrBack=e.ContextConfig.BACK,this.materialSourceData=new Float32Array(20),this.materialSourceData2=new Float32Array(20),this.colorGradientsSource=new Float32Array(10),this.colorTransform=new e.ColorTransform}return __extends(i,t),i.prototype.clone=function(){var t=new i;t.drawMode=this.drawMode,t.diffuseTexture=this.diffuseTexture,t.shadowMapTexture=this.shadowMapTexture;for(var e=0;e<3;++e)t.shadowColor[e]=this.shadowColor[e];return t.layer=this.layer,t.castShadow=this.castShadow,t.acceptShadow=this.acceptShadow,t.depthTest=this.depthTest,t.smooth=this.smooth,t.blendMode=this.blendMode,t.blend_src=this.blend_src,t.blend_dest=this.blend_dest,t.ambientColor=this.ambientColor,t.diffuseColor=this.diffuseColor,t.specularColor=this.specularColor,t.cutAlpha=this.cutAlpha,t.alpha=this.alpha,t.specularLevel=this.specularLevel,t.gloss=this.gloss,t.albedo=this.albedo,t.specularScale=this.specularScale,t.materialDataNeedChange=this.materialDataNeedChange,t.textureChange=!0,t.cullFrontOrBack=this.cullFrontOrBack,t.colorTransform=this.colorTransform,t},i.prototype.dispose=function(){},i}(Object);e.MaterialData=t}(egret3d||(egret3d={})),function(d){var t=function(){function t(t){this._passChange=!0,this._vs_shader_methods={},this._fs_shader_methods={},this.methodList=new Array,this.methodDatas=new Array,this.vsShaderNames=new Array,this.fsShaderNames=new Array,this._helpMatrix=new d.Matrix4_4,this._materialData=t}return t.prototype.addMethod=function(t){-1==this.methodList.indexOf(t)&&(this.methodList.push(t),t.materialData=this._materialData,this._passChange=!0)},t.prototype.removeMethod=function(t){var e=this.methodList.indexOf(t);-1!=e&&(this.methodList.slice(e),this._passChange=!0)},t.prototype.materialDataChange=function(){this._materialData.materialDataNeedChange=!0},t.prototype.passInvalid=function(){this._passChange=!0},t.prototype.resetTexture=function(t){var e,i;for(var a in this._passUsage.sampler2DList)e=this._passUsage.sampler2DList[a],this._materialData[e.varName]&&(e.texture=this._materialData[e.varName]);for(var a in this._passUsage.sampler3DList)i=this._passUsage.sampler3DList[a],this._materialData[i.varName]&&(i.texture=this._materialData[i.varName]);this._materialData.textureChange=!1},t.prototype.addMethodShaders=function(t,e){for(var i=0;i<e.length;i++)t.addUseShaderName(e[i])},t.prototype.addShaderPhase=function(t,e,i){var a,r,n;for(r in e){a=e[r];for(var o=0;o<a.length;o++){i[r]=i[r]||[],i[r].push(a[o]),n=d.ShaderPhaseType[r];var s=this._materialData.shaderPhaseTypes[t].indexOf(d.ShaderPhaseType[n]);-1!=s&&this._materialData.shaderPhaseTypes[t].splice(s,1)}}},t.prototype.initOthreMethods=function(){for(var t,e,i=0;i<this.methodList.length;i++){var a=this.methodList[i];for(t in a.vsShaderList){e=a.vsShaderList[t];for(var r=0;r<e.length;r++)this._vs_shader_methods[t]=this._vs_shader_methods[t]||[],this._vs_shader_methods[t].push(e[r])}for(t in a.fsShaderList){e=a.fsShaderList[t];for(r=0;r<e.length;r++)this._fs_shader_methods[t]=this._fs_shader_methods[t]||[],this._fs_shader_methods[t].push(e[r])}}},t.prototype.initUseMethod=function(t,e){var i;this._passChange=!1,this._passUsage=new d.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},t&&(t.skeletonAnimationController?(this._passUsage.maxBone=2*t.skeletonAnimationController.jointNum,this._vs_shader_methods[d.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[d.ShaderPhaseType.start_vertex].push("skeleton_vs")):t.particleAnimationController&&(this._vs_shader_methods[d.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[d.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,t.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,t.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),this._materialData.acceptShadow&&(this._vs_shader_methods[d.ShaderPhaseType.global_vertex]=this._vs_shader_methods[d.ShaderPhaseType.global_vertex]||[],this._fs_shader_methods[d.ShaderPhaseType.shadow_fragment]=this._fs_shader_methods[d.ShaderPhaseType.shadow_fragment]||[]),-1!=this._materialData.shaderPhaseTypes[d.PassType.diffusePass].indexOf(d.ShaderPhaseType.diffuse_fragment)&&(this._fs_shader_methods[d.ShaderPhaseType.diffuse_fragment]=[],this._fs_shader_methods[d.ShaderPhaseType.diffuse_fragment].push("diffuse_fragment")),-1!=this._materialData.shaderPhaseTypes[d.PassType.diffusePass].indexOf(d.ShaderPhaseType.normal_fragment)&&(this._fs_shader_methods[d.ShaderPhaseType.normal_fragment]=[],this._fs_shader_methods[d.ShaderPhaseType.normal_fragment].push("normalMap_fragment")),-1!=this._materialData.shaderPhaseTypes[d.PassType.diffusePass].indexOf(d.ShaderPhaseType.specular_fragment)&&(this._fs_shader_methods[d.ShaderPhaseType.specular_fragment]=[],this._fs_shader_methods[d.ShaderPhaseType.specular_fragment].push("specularMap_fragment")),-1!=this._materialData.shaderPhaseTypes[d.PassType.diffusePass].indexOf(d.ShaderPhaseType.matCap_fragment)&&(this._fs_shader_methods[d.ShaderPhaseType.matCap_fragment]=[],this._fs_shader_methods[d.ShaderPhaseType.matCap_fragment].push("matCap_TextureMult_fs")),this.lightGroup&&(this._passUsage.maxDirectLight=this.lightGroup.directLightList.length,this._passUsage.maxSpotLight=this.lightGroup.spotLightList.length,this._passUsage.maxPointLight=this.lightGroup.pointLightList.length,this._vs_shader_methods[d.ShaderPhaseType.local_vertex]=this._vs_shader_methods[d.ShaderPhaseType.local_vertex]||[],this._fs_shader_methods[d.ShaderPhaseType.lighting_fragment]=[],this._fs_shader_methods[d.ShaderPhaseType.lighting_fragment].push("lightingBase_fs"),this.lightGroup.directLightList.length&&(this._passUsage.directLightData=new Float32Array(d.DirectLight.stride*this.lightGroup.directLightList.length),this._vs_shader_methods[d.ShaderPhaseType.local_vertex].push("varyingViewDir_vs"),this._fs_shader_methods[d.ShaderPhaseType.lighting_fragment].push("directLight_fragment")),this.lightGroup.spotLightList.length&&(this._passUsage.spotLightData=new Float32Array(d.SpotLight.stride*this.lightGroup.spotLightList.length),this._fs_shader_methods[d.ShaderPhaseType.lighting_fragment].push("spotLight_fragment")),this.lightGroup.pointLightList.length&&(this._passUsage.pointLightData=new Float32Array(d.PointLight.stride*this.lightGroup.pointLightList.length),this._fs_shader_methods[d.ShaderPhaseType.lighting_fragment].push("pointLight_fragment"))),this.initOthreMethods(),this.addMethodShaders(this._passUsage.vertexShader,["base_vs"]),(i=this._vs_shader_methods[d.ShaderPhaseType.start_vertex])&&0<i.length?this.addMethodShaders(this._passUsage.vertexShader,i):this.addMethodShaders(this._passUsage.vertexShader,["diffuse_vertex"]),(i=this._vs_shader_methods[d.ShaderPhaseType.local_vertex])&&0<i.length&&this.addMethodShaders(this._passUsage.vertexShader,i),(i=this._vs_shader_methods[d.ShaderPhaseType.global_vertex])&&0<i.length&&this.addMethodShaders(this._passUsage.vertexShader,i),(i=this._vs_shader_methods[d.ShaderPhaseType.end_vertex])&&0<i.length?this.addMethodShaders(this._passUsage.vertexShader,i):this.addMethodShaders(this._passUsage.vertexShader,["end_vs"]),this.addMethodShaders(this._passUsage.fragmentShader,["base_fs"]),(i=this._fs_shader_methods[d.ShaderPhaseType.start_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[d.ShaderPhaseType.materialsource_fragment])&&0<i.length?this.addMethodShaders(this._passUsage.fragmentShader,i):this.addMethodShaders(this._passUsage.fragmentShader,["materialSource_fs"]),(i=this._fs_shader_methods[d.ShaderPhaseType.diffuse_fragment])&&0<i.length?this.addMethodShaders(this._passUsage.fragmentShader,i):this.addMethodShaders(this._passUsage.fragmentShader,["diffuse_fragment"]),(i=this._fs_shader_methods[d.ShaderPhaseType.normal_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[d.ShaderPhaseType.shadow_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[d.ShaderPhaseType.lighting_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[d.ShaderPhaseType.specular_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[d.ShaderPhaseType.matCap_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[d.ShaderPhaseType.multi_end_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[d.ShaderPhaseType.end_fragment])&&0<i.length?this.addMethodShaders(this._passUsage.fragmentShader,i):t&&t.particleAnimationController?this.addMethodShaders(this._passUsage.fragmentShader,["particle_end_fs"]):this.addMethodShaders(this._passUsage.fragmentShader,["end_fs"])},t.prototype.upload=function(t,e,i,a,r,n,o){for(var s in this._passChange&&this._passUsage&&d.Context3DProxy.gl.deleteProgram(this._passUsage.program3D.program),this._passChange=!1,this.initUseMethod(n,o),this._passUsage.vertexShader.shader=this._passUsage.vertexShader.getShader(this._passUsage),this._passUsage.fragmentShader.shader=this._passUsage.fragmentShader.getShader(this._passUsage),this._passUsage.program3D=d.ShaderPool.getProgram(this._passUsage.vertexShader.shader.id,this._passUsage.fragmentShader.shader.id),this._passUsage)-1!=s.indexOf("uniform")&&this._passUsage[s]&&(this._passUsage[s].uniformIndex=i.getUniformLocation(this._passUsage.program3D,s));var h,l;for(var u in this._passUsage.sampler2DList)(h=this._passUsage.sampler2DList[u]).uniformIndex=i.getUniformLocation(this._passUsage.program3D,h.varName),h.texture=this._materialData[h.varName];for(var u in this._passUsage.sampler3DList)(l=this._passUsage.sampler3DList[u]).uniformIndex=i.getUniformLocation(this._passUsage.program3D,l.varName);if(this.methodList)for(var c=0;c<this.methodList.length;c++)this.methodList[c].upload(t,e,this._passUsage,null,i,a,r)},t.prototype.draw=function(t,e,i,a,r,n,o){var s,h;for(var l in this._materialData.materialDataNeedChange&&(this._materialData.materialSourceData[0]=(this._materialData.diffuseColor>>16&255)/255,this._materialData.materialSourceData[1]=(this._materialData.diffuseColor>>8&255)/255,this._materialData.materialSourceData[2]=(255&this._materialData.diffuseColor)/255,this._materialData.materialSourceData[3]=(this._materialData.ambientColor>>16&255)/255,this._materialData.materialSourceData[4]=(this._materialData.ambientColor>>8&255)/255,this._materialData.materialSourceData[5]=(255&this._materialData.ambientColor)/255,this._materialData.materialSourceData[6]=(this._materialData.specularColor>>16&255)/255,this._materialData.materialSourceData[7]=(this._materialData.specularColor>>8&255)/255,this._materialData.materialSourceData[8]=(255&this._materialData.specularColor)/255,this._materialData.materialSourceData[9]=this._materialData.alpha,this._materialData.materialSourceData[10]=this._materialData.cutAlpha,this._materialData.materialSourceData[11]=this._materialData.gloss,this._materialData.materialSourceData[12]=this._materialData.specularLevel,this._materialData.materialSourceData[13]=this._materialData.albedo,this._materialData.materialSourceData[14]=this._materialData.uvRectangle.x,this._materialData.materialSourceData[15]=this._materialData.uvRectangle.y,this._materialData.materialSourceData[16]=this._materialData.uvRectangle.width,this._materialData.materialSourceData[17]=this._materialData.uvRectangle.height,this._materialData.materialSourceData[18]=this._materialData.specularLevel,this._materialData.materialSourceData[19]=this._materialData.normalScale),this._passChange&&this.upload(t,e,i,a,r,o,n.geometry),i.setProgram(this._passUsage.program3D),n.activeState(t,e,this._passUsage,i),this._materialData.depthTest?i.enableDepth():i.disableDepth(),i.depthFunc(d.ContextConfig.LEQUAL),i.setCulling(this._materialData.cullFrontOrBack),this._materialData.bothside?i.disableCullFace():i.enableCullFace(),this._materialData.alphaBlending&&d.Context3DProxy.gl.depthMask(!1),i.enableBlend(),i.setBlendFactors(this._materialData.blend_src,this._materialData.blend_dest),this._passUsage.uniform_materialSource&&i.uniform1fv(this._passUsage.uniform_materialSource.uniformIndex,this._materialData.materialSourceData),this._materialData.textureChange&&this.resetTexture(i),this._passUsage.sampler2DList)(s=this._passUsage.sampler2DList[l]).texture=this._materialData[s.varName],s.texture&&(s.texture.upload(i),i.setTexture2DAt(s.activeTextureIndex,s.uniformIndex,s.index,s.texture.texture2D),s.texture.useMipmap&&(s.texture.useMipmap=this._materialData.useMipmap),s.texture.repeat=this._materialData.repeat,s.texture.smooth=this._materialData.smooth,s.texture.activeState(i),this._materialData.textureStateChage=!1);for(var l in this._passUsage.sampler3DList)(h=this._passUsage.sampler3DList[l]).texture=this._materialData[h.varName],h.texture&&(h.texture.upload(i),i.setCubeTextureAt(h.activeTextureIndex,h.uniformIndex,h.index,h.texture.texture3D));var u=0;if(this.lightGroup){for(u=0;u<this._passUsage.maxDirectLight;u++)this.lightGroup.directLightList[u].updateLightData(r,u,this._passUsage.directLightData);for(u=0;u<this._passUsage.maxSpotLight;u++)this.lightGroup.spotLightList[u].updateLightData(r,u,this._passUsage.spotLightData);for(u=0;u<this._passUsage.maxPointLight;u++)this.lightGroup.pointLightList[u].updateLightData(r,u,this._passUsage.pointLightData);this._passUsage.uniform_directLightSource&&i.uniform1fv(this._passUsage.uniform_directLightSource.uniformIndex,this._passUsage.directLightData),this._passUsage.uniform_sportLightSource&&i.uniform1fv(this._passUsage.uniform_sportLightSource.uniformIndex,this._passUsage.spotLightData),this._passUsage.uniform_pointLightSource&&i.uniform1fv(this._passUsage.uniform_pointLightSource.uniformIndex,this._passUsage.pointLightData)}if(this._passUsage.uniform_ModelMatrix&&i.uniformMatrix4fv(this._passUsage.uniform_ModelMatrix.uniformIndex,!1,a.rawData),this._passUsage.uniform_ViewMatrix&&i.uniformMatrix4fv(this._passUsage.uniform_ViewMatrix.uniformIndex,!1,r.viewMatrix.rawData),this._passUsage.uniform_ProjectionMatrix&&i.uniformMatrix4fv(this._passUsage.uniform_ProjectionMatrix.uniformIndex,!1,r.projectMatrix.rawData),this._passUsage.uniform_ModelViewMatrix&&(this._helpMatrix.identity(),this._helpMatrix.copyFrom(a),this._helpMatrix.multiply(r.viewMatrix),i.uniformMatrix4fv(this._passUsage.uniform_ModelViewMatrix.uniformIndex,!1,this._helpMatrix.rawData)),this._passUsage.uniform_ViewProjectionMatrix&&i.uniformMatrix4fv(this._passUsage.uniform_ViewProjectionMatrix.uniformIndex,!1,r.viewProjectionMatrix.rawData),o&&o.activeState(t,e,this._passUsage,n,i,a,r),this.methodList)for(u=0;u<this.methodList.length;u++)this.methodList[u].activeState(t,e,this._passUsage,null,i,a,r);this._passUsage.uniform_NormalMatrix&&(this._helpMatrix.identity(),this._helpMatrix.copyFrom(a),this._helpMatrix.multiply(r.viewMatrix),this._helpMatrix.invert(),this._helpMatrix.transpose(),i.uniformMatrix4fv(this._passUsage.uniform_NormalMatrix.uniformIndex,!1,this._helpMatrix.rawData)),this._passUsage.uniform_ShadowMatrix,this._passUsage.uniform_eyepos&&i.uniform3f(this._passUsage.uniform_eyepos.uniformIndex,r.x,r.y,r.z),this._passUsage.uniform_cameraMatrix&&i.uniformMatrix4fv(this._passUsage.uniform_cameraMatrix.uniformIndex,!1,r.modelMatrix.rawData),i.drawElement(this._materialData.drawMode,n.start,n.count),this._materialData.alphaBlending&&d.Context3DProxy.gl.depthMask(!0),n.deactiveState(this._passUsage,i)},t.prototype.deactiveState=function(t,e){var i;for(var a in t.sampler2DList)(i=this._passUsage.sampler2DList[a]).texture&&e.disableTexture2DAt(i.activeTextureIndex,i.uniformIndex,i.index)},t.prototype.dispose=function(){},t}();d.MaterialPass=t}(egret3d||(egret3d={})),function(e){var t=function(i){function t(t){i.call(this,t),this._passID=e.PassType.colorPass}return __extends(t,i),t.prototype.initUseMethod=function(t,e){i.prototype.initUseMethod.call(this,t,e)},t}(e.MaterialPass);e.ColorPass=t}(egret3d||(egret3d={})),function(e){var t=function(i){function t(t){i.call(this,t),this._passID=e.PassType.diffusePass}return __extends(t,i),t.prototype.initUseMethod=function(t,e){i.prototype.initUseMethod.call(this,t,e)},t}(e.MaterialPass);e.DiffusePass=t}(egret3d||(egret3d={})),function(a){var t=function(e){function t(t){e.call(this,t),this._passID=a.PassType.shadowPass}return __extends(t,e),t.prototype.initUseMethod=function(t,e){var i;this._passChange=!1,this._passUsage=new a.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},t?t.skeletonAnimationController?(this._passUsage.maxBone=2*t.skeletonAnimationController.jointNum,this._vs_shader_methods[a.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[a.ShaderPhaseType.start_vertex].push("skeletonShadowPass_vs")):t.particleAnimationController:(this._vs_shader_methods[a.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[a.ShaderPhaseType.start_vertex].push("staticShadowPass_vs")),-1!=this._materialData.shaderPhaseTypes[a.PassType.shadowPass].indexOf(a.ShaderPhaseType.diffuse_fragment)&&(this._fs_shader_methods[a.ShaderPhaseType.diffuse_fragment]=[],this._fs_shader_methods[a.ShaderPhaseType.diffuse_fragment].push("diffuseShadowPass_fs")),this.addMethodShaders(this._passUsage.vertexShader,["baseShadowPass_vs"]),(i=this._vs_shader_methods[a.ShaderPhaseType.start_vertex])&&0<i.length&&this.addMethodShaders(this._passUsage.vertexShader,i),this.addMethodShaders(this._passUsage.vertexShader,["endShadowPass_vs"]),this.addMethodShaders(this._passUsage.fragmentShader,["baseShadowPass_fs"]),(i=this._fs_shader_methods[a.ShaderPhaseType.diffuse_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),this.addMethodShaders(this._passUsage.fragmentShader,["endShadowPass_fs"])},t}(a.MaterialPass);a.ShadowPass=t}(egret3d||(egret3d={})),function(i){var t=function(e){function t(t){e.call(this,t),this._passID=i.PassType.CubePass}return __extends(t,e),t.prototype.initUseMethod=function(t,e){this._passChange=!1,this._passUsage=new i.PassUsage,this._passUsage.vertexShader.shaderType=i.Shader.vertex,this._passUsage.fragmentShader.shaderType=i.Shader.fragment,this._passUsage.vertexShader.addUseShaderName("cube_vertex"),this._passUsage.fragmentShader.addUseShaderName("cube_fragment")},t}(i.MaterialPass);i.CubePass=t}(egret3d||(egret3d={})),function(a){var t=function(e){function t(t){e.call(this,t),this._passID=a.PassType.matCapPass}return __extends(t,e),t.prototype.initUseMethod=function(t,e){var i;this._passChange=!1,this._passUsage=new a.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},t&&t.skeletonAnimationController&&(this._passUsage.maxBone=2*t.skeletonAnimationController.jointNum,this._vs_shader_methods[a.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[a.ShaderPhaseType.start_vertex].push("skeleton_vs")),this._fs_shader_methods[a.ShaderPhaseType.diffuse_fragment]=[],this._fs_shader_methods[a.ShaderPhaseType.diffuse_fragment].push("diffuse_fragment"),this._fs_shader_methods[a.ShaderPhaseType.matCap_fragment]=[],this._fs_shader_methods[a.ShaderPhaseType.matCap_fragment].push("matCap_TextureAdd_fs"),this._materialData.shaderPhaseTypes[a.PassType.matCapPass]&&-1!=this._materialData.shaderPhaseTypes[a.PassType.matCapPass].indexOf(a.ShaderPhaseType.normal_fragment)&&(this._fs_shader_methods[a.ShaderPhaseType.normal_fragment]=[],this._fs_shader_methods[a.ShaderPhaseType.normal_fragment].push("normalMap_fragment")),this.addMethodShaders(this._passUsage.vertexShader,["base_vs","tangent_vs"]),(i=this._vs_shader_methods[a.ShaderPhaseType.start_vertex])&&0<i.length?this.addMethodShaders(this._passUsage.vertexShader,i):this.addMethodShaders(this._passUsage.vertexShader,["diffuse_vertex"]),(i=this._vs_shader_methods[a.ShaderPhaseType.local_vertex])&&0<i.length&&this.addMethodShaders(this._passUsage.vertexShader,i),this.addMethodShaders(this._passUsage.vertexShader,["end_vs"]),this.addMethodShaders(this._passUsage.fragmentShader,["base_fs"]),(i=this._fs_shader_methods[a.ShaderPhaseType.materialsource_fragment])&&0<i.length?this.addMethodShaders(this._passUsage.fragmentShader,i):this.addMethodShaders(this._passUsage.fragmentShader,["materialSource_fs"]),(i=this._fs_shader_methods[a.ShaderPhaseType.diffuse_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[a.ShaderPhaseType.normal_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),(i=this._fs_shader_methods[a.ShaderPhaseType.matCap_fragment])&&0<i.length&&this.addMethodShaders(this._passUsage.fragmentShader,i),this.addMethodShaders(this._passUsage.fragmentShader,["end_fs"])},t}(a.MaterialPass);a.MatCapPass=t}(egret3d||(egret3d={})),function(i){var t;(t=i.PassType||(i.PassType={}))[t.diffusePass=0]="diffusePass",t[t.colorPass=1]="colorPass",t[t.normalPass=2]="normalPass",t[t.shadowPass=3]="shadowPass",t[t.lightPass=4]="lightPass",t[t.matCapPass=5]="matCapPass",t[t.depthPass_8=6]="depthPass_8",t[t.depthPass_32=7]="depthPass_32",t[t.CubePass=8]="CubePass";var a=i.PassType,e=function(){function t(){}return t.CreatPass=function(t,e){switch(t){case a.colorPass:return e.shaderPhaseTypes[a.colorPass]=[],[new i.ColorPass(e)];case a.diffusePass:return e.shaderPhaseTypes[a.diffusePass]=[],[new i.DiffusePass(e)];case a.shadowPass:return e.shaderPhaseTypes[a.shadowPass]=[],[new i.ShadowPass(e)];case a.matCapPass:return e.shaderPhaseTypes[a.matCapPass]=[],[new i.MatCapPass(e)];case a.CubePass:return e.shaderPhaseTypes[a.diffusePass]=[],[new i.CubePass(e)]}return null},t.PassAuto=[!0,!0,!0,!1,!1,!0,!0,!0],t}();i.PassUtil=e}(egret3d||(egret3d={})),function(i){var t=function(){function t(t){void 0===t&&(t=null),this.passes=[],null==t?this.setData(new i.MaterialData):this.setData(t)}return t.prototype.setData=function(t){this.materialData=t,this.initPass(),this.blendMode=i.BlendMode.NORMAL},t.prototype.getData=function(){return this.materialData},t.prototype.initPass=function(){this.addPass(i.PassType.colorPass)},Object.defineProperty(t.prototype,"lightGroup",{get:function(){return this._lightGroup},set:function(t){if(this._lightGroup=t,this.passes[i.PassType.diffusePass]&&0<this.passes[i.PassType.diffusePass].length)for(var e=0;e<this.passes[i.PassType.diffusePass].length;e++)this.passes[i.PassType.diffusePass][e].lightGroup=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depth",{get:function(){return this.materialData.depthTest},set:function(t){this.materialData.depthTest=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMode",{get:function(){return this.materialData.depthMode},set:function(t){this.materialData.depthMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseTexture",{get:function(){return this.materialData.diffuseTexture},set:function(t){t&&(this.materialData.diffuseTexture=t,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[i.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[i.PassType.diffusePass].indexOf(i.ShaderPhaseType.diffuse_fragment)&&this.materialData.shaderPhaseTypes[i.PassType.diffusePass].push(i.ShaderPhaseType.diffuse_fragment),this.materialData.shaderPhaseTypes[i.PassType.shadowPass]&&-1==this.materialData.shaderPhaseTypes[i.PassType.shadowPass].indexOf(i.ShaderPhaseType.diffuse_fragment)&&this.materialData.shaderPhaseTypes[i.PassType.shadowPass].push(i.ShaderPhaseType.diffuse_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalTexture",{get:function(){return this.materialData.normalTexture},set:function(t){t&&(this.materialData.normalTexture=t,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[i.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[i.PassType.diffusePass].indexOf(i.ShaderPhaseType.normal_fragment)&&(this.materialData.shaderPhaseTypes[i.PassType.diffusePass].push(i.ShaderPhaseType.normal_fragment),this.passInvalid(i.PassType.diffusePass)),this.materialData.shaderPhaseTypes[i.PassType.matCapPass]&&-1==this.materialData.shaderPhaseTypes[i.PassType.matCapPass].indexOf(i.ShaderPhaseType.normal_fragment)&&this.materialData.shaderPhaseTypes[i.PassType.matCapPass].push(i.ShaderPhaseType.normal_fragment))},enumerable:!0,configurable:!0}),t.prototype.passInvalid=function(t){if(this.passes[t]&&0<this.passes[t].length)for(var e=0;e<this.passes[t].length;e++)this.passes[t][e].passInvalid()},Object.defineProperty(t.prototype,"matcapTexture",{get:function(){return this.materialData.normalTexture},set:function(t){t&&(this.materialData.matcapTexture=t,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[i.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[i.PassType.diffusePass].indexOf(i.ShaderPhaseType.matCap_fragment)&&(this.materialData.shaderPhaseTypes[i.PassType.diffusePass].push(i.ShaderPhaseType.matCap_fragment),this.passInvalid(i.PassType.diffusePass)),this.materialData.shaderPhaseTypes[i.PassType.matCapPass]&&-1==this.materialData.shaderPhaseTypes[i.PassType.matCapPass].indexOf(i.ShaderPhaseType.matCap_fragment)&&this.materialData.shaderPhaseTypes[i.PassType.matCapPass].push(i.ShaderPhaseType.matCap_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularTexture",{get:function(){return this.materialData.specularTexture},set:function(t){t&&(this.materialData.specularTexture=t,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[i.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[i.PassType.diffusePass].indexOf(i.ShaderPhaseType.specular_fragment)&&this.materialData.shaderPhaseTypes[i.PassType.diffusePass].push(i.ShaderPhaseType.specular_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawMode",{get:function(){return this.materialData.drawMode},set:function(t){this.materialData.drawMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cutAlpha",{get:function(){return this.materialData.cutAlpha},set:function(t){this.materialData.cutAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this.materialData.diffuseColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.diffuseColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this.materialData.ambientColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.ambientColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this.materialData.specularColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.specularColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.materialData.alpha},set:function(t){this.materialData.alpha!=t&&(this.materialData.alpha=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this.materialData.alphaBlending},set:function(t){this.materialData.alphaBlending!=t&&(this.materialData.alphaBlending=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularLevel",{get:function(){return this.materialData.specularLevel},set:function(t){this.materialData.specularLevel!=t&&(this.materialData.specularLevel=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gloss",{get:function(){return this.materialData.gloss},set:function(t){this.materialData.gloss!=t&&(this.materialData.gloss=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uvRectangle",{get:function(){return this.materialData.uvRectangle},set:function(t){this.materialData.uvRectangle.x=t.x,this.materialData.uvRectangle.y=t.y,this.materialData.uvRectangle.width=t.width,this.materialData.uvRectangle.height=t.height,this.materialData.materialDataNeedChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffusePass",{get:function(){return this.passes[i.PassType.diffusePass][0]},enumerable:!0,configurable:!0}),t.prototype.addPass=function(t){this.passes[t]=this.passes[i.PassType.shadowPass]||i.PassUtil.CreatPass(t,this.materialData)},Object.defineProperty(t.prototype,"castShadow",{get:function(){return this.materialData.castShadow},set:function(t){(this.materialData.castShadow=t)?this.addPass(i.PassType.shadowPass):this.passes[i.PassType.shadowPass]&&(this.disposePass(i.PassType.shadowPass),this.passes[i.PassType.shadowPass]=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"acceptShadow",{get:function(){return this.materialData.acceptShadow},set:function(t){this.materialData.acceptShadow=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{get:function(){var t=0;return t|=255*this.materialData.shadowColor[0]<<16,(t|=255*this.materialData.shadowColor[1]<<8)|255*this.materialData.shadowColor[2]},set:function(t){this.materialData.shadowColor[0]=t>>16&1,this.materialData.shadowColor[1]=t>>8&1,this.materialData.shadowColor[2]=1&t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smooth",{get:function(){return this.materialData.smooth},set:function(t){this.materialData.smooth=t,this.materialData.textureStateChage=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repeat",{get:function(){return this.materialData.repeat},set:function(t){this.materialData.repeat=t,this.materialData.textureStateChage=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bothside",{get:function(){return this.materialData.bothside},set:function(t){this.materialData.textureStateChage=!0,this.materialData.bothside=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cullMode",{get:function(){return this.materialData.cullFrontOrBack},set:function(t){this.materialData.textureStateChage=!0,this.materialData.cullFrontOrBack=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{set:function(t){switch(this.materialData.textureStateChage=!0,this.materialData.blendMode=t){case i.BlendMode.NORMAL:this.materialData.blend_src=i.ContextConfig.ONE,this.materialData.blend_dest=i.ContextConfig.ONE_MINUS_SRC_ALPHA,this.materialData.alphaBlending=!1;break;case i.BlendMode.LAYER:this.materialData.blend_src=i.ContextConfig.SRC_ALPHA,this.materialData.blend_dest=i.ContextConfig.ZERO,this.materialData.alphaBlending=!0;break;case i.BlendMode.MULTIPLY:this.materialData.blend_src=i.ContextConfig.ZERO,this.materialData.blend_dest=i.ContextConfig.SRC_COLOR,this.materialData.alphaBlending=!0;break;case i.BlendMode.ADD:this.materialData.blend_src=i.ContextConfig.SRC_ALPHA,this.materialData.blend_dest=i.ContextConfig.ONE,this.materialData.alphaBlending=!0;break;case i.BlendMode.SOFT_ADD:this.materialData.blend_src=i.ContextConfig.SRC_COLOR,this.materialData.blend_dest=i.ContextConfig.ONE,this.materialData.alphaBlending=!0;break;case i.BlendMode.ALPHA:this.materialData.blend_src=i.ContextConfig.ONE,this.materialData.blend_dest=i.ContextConfig.ONE_MINUS_SRC_ALPHA,this.materialData.alphaBlending=!0;break;case i.BlendMode.SCREEN:this.materialData.blend_src=i.ContextConfig.ONE,this.materialData.blend_dest=i.ContextConfig.ONE_MINUS_SRC_COLOR}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointSize",{get:function(){return this.materialData.specularLevel},set:function(t){t!=this.materialData.specularLevel&&(this.materialData.specularLevel=t,this.materialData.textureStateChage=!0)},enumerable:!0,configurable:!0}),t.prototype.disposePass=function(t){for(var e=0;e<this.passes[t].length;e++)this.passes[t][e].dispose()},t.prototype.renderXRayPass=function(){},t.prototype.renderOutlinePass=function(){},t.prototype.renderNormalPass=function(){},t.prototype.renderDepthPass=function(){},t.prototype.renderPositionPass=function(){},t.prototype.renderUVPass=function(){},t.prototype.renderScendUVPass=function(){},t.prototype.renderVertexColorPass=function(){},t.prototype.renderLightingPass=function(){},t}();i.MaterialBase=t}(egret3d||(egret3d={})),function(i){var t=function(e){function t(t){void 0===t&&(t=13421772),e.call(this),this.color=t,this.diffuseTexture=i.CheckerboardTexture.texture,this.initMatPass()}return __extends(t,e),t.prototype.initMatPass=function(){this.addPass(i.PassType.diffusePass),this.diffusePass.addMethod(new i.ColorMethod)},Object.defineProperty(t.prototype,"color",{get:function(){return this.materialData.diffuseColor},set:function(t){this.materialData.diffuseColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.materialData.alpha},set:function(t){this.materialData.alpha=t},enumerable:!0,configurable:!0}),t}(i.MaterialBase);i.ColorMaterial=t}(egret3d||(egret3d={})),function(a){var t=function(i){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),i.call(this,e),this.diffuseTexture=t||a.CheckerboardTexture.texture,this.initMatPass()}return __extends(t,i),t.prototype.initMatPass=function(){this.addPass(a.PassType.diffusePass)},t.prototype.clone=function(){return new t(this.diffuseTexture,this.materialData.clone())},t}(a.MaterialBase);a.TextureMaterial=t}(egret3d||(egret3d={})),function(e){var t=function(i){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),i.call(this,e),this.diffuseTexture=t,this.initMatPass()}return __extends(t,i),t.prototype.initMatPass=function(){this.addPass(e.PassType.diffusePass),this.diffusePass.addMethod(new e.CubeMethod)},t.prototype.clone=function(){return new t(this.diffuseTexture,this.materialData.clone())},t}(e.MaterialBase);e.CubeTextureMaterial=t}(egret3d||(egret3d={})),function(a){var t=function(){function t(){this._renderIndex=0,this.numEntity=0}return t.prototype.setRenderToTexture=function(t,e,i){void 0===i&&(i=a.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.renderTexture=new a.RenderTexture(t,e,i)},t.prototype.draw=function(t,e,i,a,r,n,o){void 0===n&&(n=null),void 0===o&&(o=!1)},t}();a.RenderBase=t}(egret3d||(egret3d={})),function(u){var t=function(e){function t(t){void 0===t&&(t=u.PassType.diffusePass),e.call(this),this._i=0,this._j=0,this._pass=t}return __extends(t,e),t.prototype.draw=function(t,e,i,a,r,n,o){var s;for(void 0===n&&(n=null),void 0===o&&(o=!1),this.numEntity=a.renderList.length,this.renderTexture&&(this.renderTexture.upload(i),i.setRenderToTexture(this.renderTexture.texture2D,!0,0)),this._renderIndex=0;this._renderIndex<this.numEntity;this._renderIndex++)if(this._renderItem=a.renderList[this._renderIndex],!o||this._renderItem.material.castShadow)for(this._renderItem.geometry.activeState(t,e,u.Egret3DCanvas.context3DProxy,r),this._i=0;this._i<this._renderItem.geometry.subGeometrys.length;this._i++){var h=this._renderItem.geometry.subGeometrys[this._i],l=h.matID;if(null!=(s=this._renderItem.multiMaterial[l]))if(s.passes[this._pass])for(this._j=s.passes[this._pass].length-1;0<=this._j;this._j--)s.passes[this._pass][this._j].draw(t,e,i,this._renderItem.modelMatrix,r,h,this._renderItem.animation);else if(u.PassUtil.PassAuto[this._pass])for(this._j=s.passes[this._pass].length-1;0<=this._j;this._j--)s.passes[this._pass]=u.PassUtil.CreatPass(this._pass,s.materialData),s.passes[this._pass][this._j].draw(t,e,i,this._renderItem.modelMatrix,r,h,this._renderItem.animation)}this.renderTexture&&(i.setRenderToBackBuffer(),n&&(i.viewPort(n.x,n.y,n.width,n.height),i.setScissorRectangle(n.x,n.y,n.width,n.height)))},t}(u.RenderBase);u.MultiRender=t}(egret3d||(egret3d={})),function(a){var t=function(i){function t(t,e){i.call(this),this._hud=new a.HUD,this._hud.vsShader=t,this._hud.fsShader=e}return __extends(t,i),t.prototype.setRenderToTexture=function(t,e,i){void 0===i&&(i=a.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.renderTexture=new a.RenderTexture(t,e,a.FrameBufferFormat.UNSIGNED_BYTE_RGB)},t.prototype.draw=function(t,e,i,a,r,n,o){void 0===n&&(n=null),this.numEntity=a.renderList.length,this.renderTexture&&(this.renderTexture.upload(i),i.setRenderToTexture(this.renderTexture.texture2D,!0,0)),this._hud.viewPort=r.viewPort,this._hud.x=r.viewPort.x,this._hud.y=r.viewPort.y,this._hud.width=r.viewPort.width,this._hud.height=r.viewPort.height,this._hud.diffuseTexture=o.end,this._hud.colorTexture=o.colorTexture,this._hud.draw(i),i.setRenderToBackBuffer(),n&&(i.viewPort(n.x,n.y,n.width,n.height),i.setScissorRectangle(n.x,n.y,n.width,n.height))},t}(a.RenderBase);a.PostRender=t}(egret3d||(egret3d={})),function(f){var t;(t=f.ValueType||(f.ValueType={}))[t.float=0]="float",t[t.vec2=1]="vec2",t[t.vec3=2]="vec3",t[t.vec4=3]="vec4";var i=f.ValueType,e=function(){function t(){}return t.prototype.calculate=function(t,e){return void 0===e&&(e=null),new Error("asd"),null},t}(),a=function(t){function e(){t.apply(this,arguments),this.valueType=i.float,this.value=5}return __extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=0;i<t;i++)e.push(this.value);return e},e}(f.ValueShape=e);f.ConstValueShape=a;var r=function(t){function e(){t.apply(this,arguments),this.valueType=i.float,this.min=0,this.max=100}return __extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=0;i<t;i++)e.push(this.min+Math.random()*(this.max-this.min));return e},e}(e);f.ConstRandomValueShape=r;var n=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec2,this.minX=0,this.minY=0}return __extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=0;i<t;i++){var a=new f.Point;a.x=this.minX,a.y=this.minY,e.push(a)}return e},e}(e);f.Vec2ConstValueShape=n;var o=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec2,this.minX=0,this.minY=0,this.maxX=100,this.maxY=100}return __extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=0;i<t;i++){var a=new f.Point;a.x=this.minX+Math.random()*(this.maxX-this.minX),a.y=this.minY+Math.random()*(this.maxY-this.minY),e.push(a)}return e},e}(e);f.Vec2ConstRandomValueShape=o;var s=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.minX=0,this.minY=0,this.minZ=0}return __extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=0;i<t;i++){var a=new f.Vector3D;a.x=this.minX,a.y=this.minY,a.z=this.minZ,e.push(a)}return e},e}(e);f.Vec3ConstValueShape=s;var h=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.minX=-50,this.minY=-50,this.minZ=-50,this.maxX=50,this.maxY=50,this.maxZ=50}return __extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=0;i<t;i++){var a=new f.Vector3D;a.x=this.minX+Math.random()*(this.maxX-this.minX),a.y=this.minY+Math.random()*(this.maxY-this.minY),a.z=this.minZ+Math.random()*(this.maxZ-this.minZ),e.push(a)}return e},e}(e);f.Vec3ConstRandomValueShape=h;var l=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.width=100,this.height=100,this.depth=100}return __extends(e,t),e.prototype.calculate=function(t){for(var e,i=[],a=0;a<t;a++)(e=new f.Vector3D).x=Math.random()*this.width-.5*this.width,e.y=Math.random()*this.height-.5*this.height,e.z=Math.random()*this.depth-.5*this.depth,i.push(e);return i},e}(e);f.CubeVector3DValueShape=l;var u=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.width=100,this.height=100}return __extends(e,t),e.prototype.calculate=function(t){for(var e,i=[],a=0;a<t;a++)(e=new f.Vector3D).x=Math.random()*this.width-.5*this.width,e.y=0,e.z=Math.random()*this.height-.5*this.height,i.push(e);return i},e}(e);f.PlaneValueShape=u;var c=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.radiusTop=20,this.radiusBottom=20,this.height=20,this.coneType=f.ParticleConeShapeType.Volume}return __extends(e,t),e.prototype.calculate=function(t){var e,i=[];if(this.radiusBottom==this.radiusTop){this.origPoint=null;for(var a=0;a<t;a++){if(e=new f.Vector3D,o=2*Math.random()*Math.PI,e.x=Math.sin(o)*this.radiusBottom,e.z=Math.cos(o)*this.radiusBottom,this.coneType==f.ParticleConeShapeType.Volume){var r=Math.random();e.x*=r,e.z*=r,e.y=Math.random()*this.height-.5*this.height}else this.coneType==f.ParticleConeShapeType.VolumeShell?e.y=Math.random()*this.height-.5*this.height:this.coneType==f.ParticleConeShapeType.Base?(e.y=.5*-this.height,e.x*=r,e.z*=r):this.coneType==f.ParticleConeShapeType.BaseShell&&(e.y=.5*-this.height);i.push(e)}}else{this.origPoint=new f.Vector3D(0,0,0);var n=this.radiusTop*this.height/Math.abs(this.radiusTop-this.radiusBottom);this.origPoint.y=-(this.height/2+n),this.radiusTop<this.radiusBottom&&(this.origPoint.y*=-1);var o,s,h=Math.abs(this.radiusBottom-this.radiusTop);for(a=0;a<t;a++){if(e=new f.Vector3D,o=2*Math.random()*Math.PI,this.coneType==f.ParticleConeShapeType.Base?e.y=.5*-this.height:this.coneType==f.ParticleConeShapeType.BaseShell?e.y=.5*-this.height:this.coneType==f.ParticleConeShapeType.Volume?e.y=Math.random()*this.height-.5*this.height:this.coneType==f.ParticleConeShapeType.VolumeShell&&(e.y=Math.random()*this.height-.5*this.height),s=Math.abs(e.y-this.origPoint.y),s=this.radiusBottom<this.radiusTop?h*(this.height/2+e.y)/this.height:h*(this.height/2-e.y)/this.height,s+=this.radiusBottom,e.x=Math.sin(o)*s,e.z=Math.cos(o)*s,this.coneType==f.ParticleConeShapeType.Volume||this.coneType==f.ParticleConeShapeType.Base){r=Math.random();e.x*=r,e.z*=r}i.push(e)}}this.origPoint&&this.yz_zy(this.origPoint);a=0;for(var l=i.length;a<l;a++)this.yz_zy(i[a]);return i},e.prototype.yz_zy=function(t){t.y+=this.height/2,t.setTo(t.x,t.z,t.y,t.w)},e.prototype.getDirection=function(t,e){return null==e&&(e=new f.Vector3D),e.setTo(0,1,0),null==t||this.origPoint&&(e.copyFrom(t),e.decrementBy(this.origPoint),e.normalize(),this.radiusTop<this.radiusBottom&&(e.x*=-1,e.y*=-1,e.z*=-1)),e},e}(e);f.CylinderValueShape=c;var d=(function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.points=[new f.Vector3D,new f.Vector3D(100,0,0),new f.Vector3D(100,200,0)]}__extends(e,t),e.prototype.calculate=function(t){if(1==this.points.length)return this.points;for(var e,i=0,a=1;a<this.points.length;a++)i+=f.Vector3D.distance(this.points[a-1],this.points[a]);e=i/t;var r=new f.Vector3D,n=0,o=0;for(a=1;a<this.points.length;a++)r.x=this.points[a].x-this.points[a-1].x,r.y=this.points[a].y-this.points[a-1].y,r.z=this.points[a].z-this.points[a-1].z,r.normalize(),r.scaleBy(e+o),f.Vector3D.distance(this.points[a-1],this.points[a])<(n=f.Vector3D.distance(r,this.points[a]))&&(o+=n);return[]}}(e),function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3}__extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var a=e[0][0];return this.getPoints1(t,a)},e.prototype.getPoints1=function(t,e){for(var i,a,r,n,o,s=[],h=0;h<t;h++)1<(n=(i=2*Math.random()-1)*i+(a=2*Math.random()-1)*a+(r=2*Math.random()-1)*r)?h--:(o=Math.sqrt(n),s.push(new f.Vector3D(i/o*e,a/o*e,r/o*e)));return s},e.prototype.getPoints2=function(t,e){for(var i=0;i<t;i++);return[]}}(e),function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.r=10}return __extends(e,t),e.prototype.calculate=function(t){return this.getPoints1(t,this.r)},e.prototype.getPoints1=function(t,e){for(var i,a,r,n,o=[],s=new f.Vector3D(0,0,0),h=0;h<t;h++)i=2*Math.random()*e-e,a=2*Math.random()*e-e,r=2*Math.random()*e-e,n=new f.Vector3D(i,a,r),f.Vector3D.distance(s,n)>e?h--:o.push(n);return o},e}(e));f.BallValueShape=d;var p=function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3,this.r=10}return __extends(e,t),e.prototype.calculate=function(t){return this.getPoints1(t,this.r)},e.prototype.getPoints1=function(t,e){for(var i,a,r,n,o=[],s=new f.Vector3D(0,0,0),h=0;h<t;h++)i=2*Math.random()*e-e,a=2*Math.random()*e-e,r=Math.abs(2*Math.random()*e-e),n=new f.Vector3D(i,a,r),f.Vector3D.distance(s,n)>e?h--:o.push(n);return o},e}(e);f.HemiBallValueShape=p;var _=(function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3}__extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var a=e[0][0];return this.createRandomPoint1(t,a)},e.prototype.createRandomPoint1=function(t,e){for(var i=[],a=2*e,r=0;r<t;r++){var n=Math.random()*a-e,o=Math.random()*a-e;e*e<n*n+o*o?r--:i.push(new f.Vector3D(n,0,o))}return i},e.prototype.createRandomPoint2=function(t,e){for(var i,a,r,n=[],o=0;o<t;o++)i=new f.Vector3D,a=Math.sqrt(Math.random())*e,r=360*Math.random(),i.x=a*Math.sin(r),i.z=a*Math.cos(r),i.y=0,n.push(i);return n}}(e),function(t){function c(){t.apply(this,arguments),this.valueType=i.vec3,this.normalList=[],this.type=f.ParticleMeshShapeType.Edge}return __extends(c,t),c.prototype.calculate=function(t){var e=[];return this.type==f.ParticleMeshShapeType.Edge?this.edgePosition(e,t):this.type==f.ParticleMeshShapeType.Triangle?this.trianglePosition(e,t):this.type==f.ParticleMeshShapeType.Vertex&&this.vertexPosition(e,t),e},c.prototype.edgePosition=function(t,e){for(var i,a,r,n,o,s=this.geometry.indexData.length/3,h=[],l=0;l<e;l++){i=new f.Vector3D,t.push(i);var u=3*Math.floor(s*Math.random());h.length=0,this.geometry.getVertexForIndex(u+0,f.VertexFormat.VF_POSITION,h),c.vct1.setTo(h[0],h[1],h[2]),h.length=0,this.geometry.getVertexForIndex(u+1,f.VertexFormat.VF_POSITION,h),c.vct2.setTo(h[0],h[1],h[2]),h.length=0,this.geometry.getVertexForIndex(u+2,f.VertexFormat.VF_POSITION,h),c.vct3.setTo(h[0],h[1],h[2]),a=this.calcNormal(c.vct1,c.vct2,c.vct3),this.normalList.push(a),(o=Math.random())<.333?(r=c.vct1,n=c.vct2):o<.666?(r=c.vct2,n=c.vct3):(r=c.vct3,n=c.vct1),r.lerp(r,n,Math.random()),i.copyFrom(r)}},c.prototype.trianglePosition=function(t,e){for(var i,a,r=this.geometry.indexData.length/3,n=new f.Vector3D,o=new f.Vector3D,s=[],h=0;h<e;h++){i=new f.Vector3D,t.push(i);var l=3*Math.floor(r*Math.random());s.length=0,this.geometry.getVertexForIndex(l+0,f.VertexFormat.VF_POSITION,s),c.vct1.setTo(s[0],s[1],s[2]),s.length=0,this.geometry.getVertexForIndex(l+1,f.VertexFormat.VF_POSITION,s),c.vct2.setTo(s[0],s[1],s[2]),s.length=0,this.geometry.getVertexForIndex(l+2,f.VertexFormat.VF_POSITION,s),c.vct3.setTo(s[0],s[1],s[2]),a=this.calcNormal(c.vct1,c.vct2,c.vct3),this.normalList.push(a),n.lerp(c.vct1,c.vct2,Math.random()),o.lerp(c.vct2,c.vct3,Math.random()),i.lerp(n,o,Math.random())}},c.prototype.vertexPosition=function(t,e){for(var i,a,r,n=this.geometry.indexData.length/3,o=[],s=0;s<e;s++){i=new f.Vector3D,t.push(i);var h=3*Math.floor(n*Math.random());o.length=0,this.geometry.getVertexForIndex(h+0,f.VertexFormat.VF_POSITION,o),c.vct1.setTo(o[0],o[1],o[2]),o.length=0,this.geometry.getVertexForIndex(h+1,f.VertexFormat.VF_POSITION,o),c.vct2.setTo(o[0],o[1],o[2]),o.length=0,this.geometry.getVertexForIndex(h+2,f.VertexFormat.VF_POSITION,o),c.vct3.setTo(o[0],o[1],o[2]),a=this.calcNormal(c.vct1,c.vct2,c.vct3),this.normalList.push(a),(r=Math.random())<.333?i.copyFrom(c.vct1):r<.666?i.copyFrom(c.vct2):i.copyFrom(c.vct3)}},c.prototype.calcNormal=function(t,e,i){return c.crsVector1.setTo(e.x-t.x,e.y-t.y,e.z-t.z),c.crsVector2.setTo(i.x-t.x,i.y-t.y,i.z-t.z),this.normal=c.crsVector1.crossProduct(c.crsVector2),this.normal.normalize(),this.normal},c.vct1=new f.Vector3D,c.vct2=new f.Vector3D,c.vct3=new f.Vector3D,c.crsVector1=new f.Vector3D,c.crsVector2=new f.Vector3D,c}(e));f.Mesh3DValueShape=_;var m=(function(t){function e(){t.apply(this,arguments),this.valueType=i.vec3}__extends(e,t),e.prototype.calculate=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var a=[],r=[];r.push(new f.Vector3D(0,0,0)),r.push(new f.Vector3D(-200,1e3,700)),r.push(new f.Vector3D(200,-50,300)),r.push(new f.Vector3D(-300,-220,500));for(var n,o,s,h,l,u=r[0],c=r[1],d=r[2],p=r[3],_=0;_<t;_++)o=1-(n=Math.random()),s=u.x*o*o*o+3*c.x*o*o*n+3*d.x*o*n*n+p.x*n*n*n,h=u.y*o*o*o+3*c.y*o*o*n+3*d.y*o*n*n+p.y*n*n*n,l=u.z*o*o*o+3*c.z*o*o*n+3*d.z*o*n*n+p.z*n*n*n,a.push(new f.Vector3D(s,h,l));return a}}(e),function(){function t(){this.emitter={}}return t.calculate=function(t,e){return e.calculate(t,e)},t.getValues=function(t,e,i){},t._instance=new t,t}());f.Value=m}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleEndNode",this.vertex_ShaderName[i.ShaderPhaseType.end_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.end_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.end_vertex].push("particle_end_vs")}return __extends(e,t),e.prototype.build=function(t,e){},e}(i.AnimationNode);i.ParticleEndNode=t}(egret3d||(egret3d={})),function(m){var t=function(t){function e(){t.call(this),this.name="ParticleSpeedNode",this.vertex_ShaderName[m.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[m.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[m.ShaderPhaseType.local_vertex].push("particle_bezier"),this.vertex_ShaderName[m.ShaderPhaseType.local_vertex].push("particle_time_vs"),this.fragment_ShaderName[m.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[m.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[m.ShaderPhaseType.start_fragment].push("particle_time_fs"),this.fragment_ShaderName[m.ShaderPhaseType.diffuse_fragment]=this.fragment_ShaderName[m.ShaderPhaseType.diffuse_fragment]||[],this.fragment_ShaderName[m.ShaderPhaseType.diffuse_fragment].push("particle_diffuse_fragment"),this.attribute_time=new m.GLSL.VarRegister,this.attribute_time.name="attribute_time",this.attribute_time.size=3,this.attributes.push(this.attribute_time)}return __extends(e,t),e.prototype.initNode=function(t){var e=this._node=t,i=new m.ConstRandomValueShape;i.max=e.max,i.min=e.min,this._life=i},e.prototype.build=function(t,e){this._animationState=this.state;var i,a=this._animationState.emitter.data.emission,r=this._life.calculate(e);(i=a.type==m.ParticleValueType.Const?this.createBornTimeConst(e,a):this.createBornTimeBezier(e,a)).sort(function(t,e){return t-e}),i.length=e;for(var n,o=t.vertexCount/e,s=0,h=0,l=0,u=0,c=this._animationState.emitter.data.life.duration,d=0;d<e;++d){if(l=i[d],this._node.type==m.ParticleValueType.OneBezier||this._node.type==m.ParticleValueType.TwoBezier){if(u=l/c,u-=Math.floor(u),n=this._node.bezier1.calc(u),this._node.type==m.ParticleValueType.TwoBezier){var p=Math.random();n*=p,n+=this._node.bezier2.calc(u)*(1-p)}}else n=r[d];h=Math.max(h,n);for(var _=0;_<o;++_)s=(s=d*o+_)*t.vertexAttLength+this.attribute_time.offsetIndex,t.verticesData[s+0]=l,t.verticesData[s+1]=n,t.verticesData[s+2]=d}var f=h;h<l&&(f=l),this._animationState.loopTime=f,this._animationState.circleTime=this._animationState.emitter.data.life.delay+n+l},e.prototype.createBornTimeConst=function(t,e){var i,a=[];i=e.rate<=0?60:1/e.rate;for(var r=0;r<t;r++)a.push(r*i+i);return e.bursts&&(a=this.burstParticle(e.bursts,a,t)),a},e.prototype.createBornTimeBezier=function(t,e){for(var i=[],a=e.bezier,r=1e3*this._node.duration,n=(Math.ceil(1e3*this._node.duration/100),0),o=0,s=0,h=0;h<t;)if(n+=100,1<=(o+=a.calc(n%r/r)/10)){h+=s=Math.floor(o);for(var l=0;l<s;l++)i.push((n+100*l/s)/1e3);o-=s}return e.bursts&&(i=this.burstParticle(e.bursts,i,t)),i},e.prototype.burstParticle=function(t,e,i){t.sort(function(t,e){return t.x-e.x});for(var a,r=this._node.duration,n=[],o=0;o<t.length;o++){a=t[o];for(var s=0;s<a.y;s++)n.push(a.x)}var h=e[e.length-1],l=1;this._node.loop&&(l=Math.ceil(h/this._node.duration));for(o=0,i=n.length;o<i;o++)for(var u=n[o],c=0;c<l;c++)e.push(c*r+u);return e},Object.defineProperty(e.prototype,"offsetIndex",{get:function(){return this.attribute_time.offsetIndex},enumerable:!0,configurable:!0}),e}(m.AnimationNode);m.ParticleTime=t}(egret3d||(egret3d={})),function(_){var t=function(t){function e(){t.call(this),this.rotationMat=new _.Matrix4_4,this.name="ParticlePosition",this.attribute_offsetPosition=new _.GLSL.VarRegister,this.attribute_offsetPosition.name="attribute_offsetPosition",this.attribute_offsetPosition.size=3,this.attributes.push(this.attribute_offsetPosition)}return __extends(e,t),e.prototype.initNode=function(t,e){var i,a=e.renderMode;i=a==_.ParticleRenderModeType.Billboard?"particle_rm_billboard":a==_.ParticleRenderModeType.StretchedBillboard?"particle_rm_stretched":"particle_rm_mesh",this.vertex_ShaderName[_.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[_.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[_.ShaderPhaseType.local_vertex].push(i);var r=this._node=t;if(r.type==_.ParticleDataShapeType.Point){var n=new _.Vec3ConstValueShape;n.minX=0,n.minY=0,n.minZ=0,this._positions=n}else if(r.type==_.ParticleDataShapeType.Cube){var o=new _.CubeVector3DValueShape;o.width=r.cubeW,o.height=r.cubeH,o.depth=r.cubeD,this._positions=o}else if(r.type==_.ParticleDataShapeType.Sphere){var s=new _.BallValueShape;s.r=r.sphereRadius,this._positions=s}else if(r.type==_.ParticleDataShapeType.HemiSphere){var h=new _.HemiBallValueShape;h.r=r.hemiSphereRadius,this._positions=h}else if(r.type==_.ParticleDataShapeType.Cone){var l=new _.CylinderValueShape;l.radiusTop=r.coneRadiusTop,l.radiusBottom=r.coneRadiusBottom,l.coneType==_.ParticleConeShapeType.BaseShell?l.height=0:l.height=r.coneHeight,l.coneType=r.coneType,this._positions=l}else if(r.type==_.ParticleDataShapeType.Mesh){var u=new _.Mesh3DValueShape;u.geometry=r.geometry,u.type=r.meshType,this._positions=u}},Object.defineProperty(e.prototype,"offsetIndex",{get:function(){return this.attribute_offsetPosition.offsetIndex},enumerable:!0,configurable:!0}),e.prototype.build=function(t,e){this._animationState=this.state;var i,a=this._positions.calculate(e),r=this._animationState.directionArray=[];this._node.type==_.ParticleDataShapeType.Mesh&&(i=this._positions.normalList);for(var n=t.vertexCount/e,o=0,s=this._animationState.emitter.data,h=new _.Vector3D,l=this._positions,u=0;u<e;++u){var c=a[u];h.copyFrom(c),c.multiply(s.property.scale,c);var d=new _.Vector3D;s.shape.randomDirection?d.setTo(Math.random()-.5,Math.random()-.5,Math.random()-.5):this._node.type==_.ParticleDataShapeType.Point?d.setTo(Math.random()-.5,Math.random()-.5,Math.random()-.5):this._node.type==_.ParticleDataShapeType.Cube?d.setTo(0,0,1,1):this._node.type==_.ParticleDataShapeType.Sphere?d.copyFrom(h):this._node.type==_.ParticleDataShapeType.HemiSphere?d.copyFrom(h):this._node.type==_.ParticleDataShapeType.Cone?d=l.getDirection(h,d):this._node.type==_.ParticleDataShapeType.Mesh&&d.copyFrom(i[u]),d.normalize(),r.push(d);for(var p=0;p<n;++p)o=(o=u*n+p)*t.vertexAttLength+this.attribute_offsetPosition.offsetIndex,t.verticesData[o+0]=c.x,t.verticesData[o+1]=c.y,t.verticesData[o+2]=c.z}},e}(_.AnimationNode);_.ParticlePosition=t}(egret3d||(egret3d={})),function(f){var t=function(t){function e(){t.call(this),this.rotationMat=new f.Matrix4_4,this.name="ParticleRotation"}return __extends(e,t),e.prototype.initNode=function(t){var e=this._node=t;this._rotations=new f.ConstRandomValueShape,this._rotations.max=e.max,this._rotations.min=e.min},e.prototype.build=function(t,e){this._animationState=this.state;for(var i,a,r=this._rotations.calculate(e),n=t.vertexCount/e,o=0,s=new f.Vector3D,h=0,l=this._animationState.emitter.data.life.duration,u=this._animationState.emitter.timeNode.offsetIndex,c=this._animationState.emitter.data.property.renderMode,d=0;d<e;++d){if(this._node.type==f.ParticleValueType.OneBezier||this._node.type==f.ParticleValueType.TwoBezier){if(a=0*t.vertexAttLength+u,h=t.verticesData[a+0]/l,h-=Math.floor(h),i=this._node.bezier1.calc(h),this._node.type==f.ParticleValueType.TwoBezier){var p=Math.random();i*=p,i+=this._node.bezier2.calc(h)*(1-p)}}else i=r[d];this.rotationMat.identity(),c==f.ParticleRenderModeType.VerticalBillboard||c==f.ParticleRenderModeType.HorizontalBillboard?this.rotationMat.rotation(0,i,0):this.rotationMat.rotation(0,0,i);for(var _=0;_<n;++_)o=d*n+_,o*=t.vertexAttLength,s.x=t.verticesData[o+0],s.y=t.verticesData[o+1],s.z=t.verticesData[o+2],this.rotationMat.transformVector4(s,s),t.verticesData[o+0]=s.x,t.verticesData[o+1]=s.y,t.verticesData[o+2]=s.z}},e}(f.AnimationNode);f.ParticleRotation=t}(egret3d||(egret3d={})),function(p){var t=function(t){function e(){t.call(this),this.name="ParticleScale"}return __extends(e,t),e.prototype.initNode=function(t){var e=this._node=t;this._scale=new p.ConstRandomValueShape,this._scale.max=e.max,this._scale.min=e.min},e.prototype.build=function(t,e){this._animationState=this.state;for(var i,a=this._scale.calculate(e),r=t.vertexCount/e,n=0,o=0,s=this._animationState.emitter.data.life.duration,h=this._animationState.emitter.timeNode.offsetIndex,l=0,u=0;u<e;++u){if(this._node.type==p.ParticleValueType.OneBezier||this._node.type==p.ParticleValueType.TwoBezier){if(i=0*t.vertexAttLength+h,o=t.verticesData[i+0]/s,o-=Math.floor(o),l=this._node.bezier1.calc(o),this._node.type==p.ParticleValueType.TwoBezier){var c=Math.random();l*=c,l+=this._node.bezier2.calc(o)*(1-c)}}else l=a[u];for(var d=0;d<r;++d)n=u*r+d,n*=t.vertexAttLength,t.verticesData[n+0]*=l,t.verticesData[n+1]*=l,t.verticesData[n+2]*=l}},e}(p.AnimationNode);p.ParticleScale=t}(egret3d||(egret3d={})),function(d){var t=function(t){function e(){t.call(this),this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.name="ParticleStartColor"}return __extends(e,t),e.prototype.initNode=function(t){this._node=t},e.prototype.build=function(t,e){this.particleAnimationState=this.state;for(var i=t.vertexCount/e,a=0,r=this.particleAnimationState.emitter.timeNode.offsetIndex,n=0,o=new d.Color,s=new d.Color,h=0,l=this.particleAnimationState.emitter.data.life.duration,u=0;u<e;++u){n=u*i,this.timeIndex=n*t.vertexAttLength+r,this.bornTime=t.verticesData[this.timeIndex+0],h=this.bornTime/l,h-=Math.floor(h),this.lerpBirthColor(o,s,h),o.a/=256,o.r/=256,o.g/=256,o.b/=256,this.processTintColor(o,this._node.tintColor);for(var c=0;c<i;++c)a=(a=u*i+c)*t.vertexAttLength+3,t.verticesData[a+0]=o.r,t.verticesData[a+1]=o.g,t.verticesData[a+2]=o.b,t.verticesData[a+3]=o.a}},e.prototype.processTintColor=function(t,e){t.a*=e.a/128,t.r*=e.r/128,t.g*=e.g/128,t.b*=e.b/128},e.prototype.lerpBirthColor=function(t,e,i){this._node.colorType==d.ParticleBirthColorType.Const?t.copyFrom(this._node.colorConst1):this._node.colorType==d.ParticleBirthColorType.RandomConst?t.randomColor(this._node.colorConst1,this._node.colorConst2,!0):this._node.colorType==d.ParticleBirthColorType.OneGradients?this._node.colorGradients1.lerpColor(i,t):this._node.colorType==d.ParticleBirthColorType.TwoGradients&&(this._node.colorGradients1.lerpColor(i,t),this._node.colorGradients2.lerpColor(i,e),t.lerp(t,e,.5))},e}(d.AnimationNode);d.ParticleStartColor=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.count=0,this._followRotation=!1,this._followScale=!1,this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.geometryDirty=!1,this.name="ParticleFollowNode",this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_follow_vs"),this.attribute_followPosition=new i.GLSL.VarRegister,this.attribute_followPosition.name="attribute_followPosition",this.attribute_followPosition.size=3,this.attributes.push(this.attribute_followPosition),this.attribute_followRotation=new i.GLSL.VarRegister,this.attribute_followRotation.name="attribute_followRotation",this.attribute_followRotation.size=4,this.attributes.push(this.attribute_followRotation),this.attribute_followScale=new i.GLSL.VarRegister,this.attribute_followScale.name="attribute_followScale",this.attribute_followScale.size=3,this.attributes.push(this.attribute_followScale)}return __extends(e,t),e.prototype.initNode=function(t){var e=t;this._followScale=e.followScale,this._followRotation=e.followRotation},e.prototype.build=function(t,e){this.count=e,this.particleAnimationState=this.state,this.lifeCircles=[];for(var i=0;i<this.count;i++)this.lifeCircles[i]=-1},e.prototype.update=function(t,e,i){this.geometryDirty=this.geometryDirty;var a=this.particleAnimationState.emitter.data.life.loop,r=this.particleAnimationState.loopTime+this.particleAnimationState.emitter.data.life.duration;if(a||!(r<=.001*t)){for(var n=0,o=i.vertexCount/this.count,s=0,h=!1,l=this.particleAnimationState.emitter.timeNode.offsetIndex,u=.001*t-this.particleAnimationState.emitter.data.life.delay,c=i.sharedVertexBuffer?i.sharedVertexBuffer.arrayBuffer:i.verticesData,d=this.particleAnimationState.followTarget||this.particleAnimationState.emitter,p=0;p<this.count;++p){s=p*o,this.timeIndex=s*i.vertexAttLength+l,this.bornTime=c[this.timeIndex+0],this.life=c[this.timeIndex+1];var _=-1;if(u>=this.bornTime){if(u>this.bornTime+this.life&&!a)continue;if((_=Math.floor((u-this.bornTime)/this.particleAnimationState.loopTime))!=this.lifeCircles[p]){this.lifeCircles[p]=_,h=!0;for(var f=0;f<o;++f)c[(n=(n=s+f)*i.vertexAttLength+this.attribute_followPosition.offsetIndex)+0]=d.globalPosition.x,c[n+1]=d.globalPosition.y,c[n+2]=d.globalPosition.z,n=(n=s+f)*i.vertexAttLength+this.attribute_followRotation.offsetIndex,this._followRotation?(c[n+0]=d.globalOrientation.x,c[n+1]=d.globalOrientation.y,c[n+2]=d.globalOrientation.z,c[n+3]=d.globalOrientation.w):(c[n+0]=0,c[n+1]=0,c[n+2]=0,c[n+3]=0),n=(n=s+f)*i.vertexAttLength+this.attribute_followScale.offsetIndex,this._followScale?(c[n+0]=d.globalScaleX,c[n+1]=d.globalScaleY,c[n+2]=d.globalScaleZ):(c[n+0]=0,c[n+1]=0,c[n+2]=0)}}}this.geometryDirty=h}},e.prototype.activeState=function(t,e,i,a,r,n,o){this.geometryDirty&&(n.geometry.upload(o),this.geometryDirty=!1)},e}(i.AnimationNode);i.ParticleFollowNode=t}(egret3d||(egret3d={})),function(m){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityNode",this.vertex_ShaderName[m.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[m.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[m.ShaderPhaseType.global_vertex].push("particle_velocity"),this.attribute_velocity=new m.GLSL.VarRegister,this.attribute_velocity.name="attribute_velocity",this.attribute_velocity.size=3,this.attributes.push(this.attribute_velocity)}return __extends(e,t),e.prototype.initNode=function(t){var e=this._node=t;(e.type==m.ParticleValueType.Const||e.type==m.ParticleValueType.RandomConst)&&(this._velocityConstShape=new m.ConstRandomValueShape,this._velocityConstShape.max=e.max,this._velocityConstShape.min=e.min)},e.prototype.build=function(t,e){this._animationState=this.state;for(var i,a,r=t.vertexCount/e,n=0,o=this._velocityConstShape.calculate(e),s=this._animationState.directionArray,h=new m.Vector3D,l=0,u=this._animationState.emitter.data.life.duration,c=this._animationState.emitter.timeNode.offsetIndex,d=0,p=0;p<e;++p){if(d=p*r,this._node.type==m.ParticleValueType.OneBezier||this._node.type==m.ParticleValueType.TwoBezier){if(i=d*t.vertexAttLength+c,l=t.verticesData[i+0]/u,l-=Math.floor(l),a=this._node.bezier1.calc(l),this._node.type==m.ParticleValueType.TwoBezier){var _=Math.random();a*=_,a+=this._node.bezier2.calc(l)*(1-_)}}else a=o[p];h.copyFrom(s[p]),h.scaleBy(a);for(var f=0;f<r;++f)n=(n=p*r+f)*t.vertexAttLength+this.attribute_velocity.offsetIndex,t.verticesData[n+0]=h.x,t.verticesData[n+1]=h.y,t.verticesData[n+2]=h.z}},e}(m.AnimationNode);m.ParticleVelocityNode=t}(egret3d||(egret3d={})),function(e){var t=function(t){function n(){t.call(this),this._colorSegment=new Float32Array(2*n.MaxColor),this.name="ParticleColorGlobalNode",this.vertex_ShaderName[e.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[e.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[e.ShaderPhaseType.global_vertex].push("particle_color_vs"),this.fragment_ShaderName[e.ShaderPhaseType.multi_end_fragment]=this.fragment_ShaderName[e.ShaderPhaseType.multi_end_fragment]||[],this.fragment_ShaderName[e.ShaderPhaseType.multi_end_fragment].push("particle_color_fs")}return __extends(n,t),n.prototype.initNode=function(t){var e=n.MaxColor,i=t.data;i.colors.length=i.times.length=e;for(var a,r=0;r<e;r++)(a=i.colors[r])?(this._colorSegment[r]=this.getGpuColor(a.r,a.g,a.b),this._colorSegment[r+e]=this.getTimeAndAlpha(i.times[r],a.a)):(this._colorSegment[r]=0,this._colorSegment[r+e]=0)},n.prototype.build=function(t,e){},n.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_colorTransform.uniformIndex,this._colorSegment)},n.prototype.getGpuColor=function(t,e,i){return 256*(t=this.normalizeChannel(t))+(e=this.normalizeChannel(e))+(i=this.normalizeChannel(i))/256},n.prototype.normalizeChannel=function(t){return 255<t?t=255:t<0&&(t=0),Math.floor(t)},n.prototype.normalizeTime=function(t){return 1<=t?t=.9999:t<0&&(t=0),t},n.prototype.getTimeAndAlpha=function(t,e){return(e=this.normalizeChannel(e))+(t=this.normalizeTime(t))},n.MaxColor=20,n}(e.AnimationNode);e.ParticleColorGlobalNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleSizeGlobalNode",this.vertex_ShaderName[i.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.local_vertex].push("particle_size_vs")}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.data.sampler()},e.prototype.build=function(t,e){},e.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_bezierSize.uniformIndex,this._floatCompressData)},e}(i.AnimationNode);i.ParticleSizeGlobalNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityOverConstNode",this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverConst"),this.attribute_velocityOver=new i.GLSL.VarRegister,this.attribute_velocityOver.name="attribute_velocityOverConst",this.attribute_velocityOver.size=3,this.attributes.push(this.attribute_velocityOver)}return __extends(e,t),e.prototype.initNode=function(t){var e=t;this._velocityOverShape=new i.Vec3ConstRandomValueShape,this._velocityOverShape.maxX=e.velocityOver.max.x,this._velocityOverShape.maxY=e.velocityOver.max.y,this._velocityOverShape.maxZ=e.velocityOver.max.z,this._velocityOverShape.minX=e.velocityOver.min.x,this._velocityOverShape.minY=e.velocityOver.min.y,this._velocityOverShape.minZ=e.velocityOver.min.z},e.prototype.build=function(t,e){this.particleAnimationState=this.state;for(var i=t.vertexCount/e,a=0,r=this._velocityOverShape.calculate(e),n=0;n<e;++n)for(var o=r[n],s=0;s<i;++s)a=(a=n*i+s)*t.vertexAttLength+this.attribute_velocityOver.offsetIndex,t.verticesData[a+0]=o.x,t.verticesData[a+1]=o.y,t.verticesData[a+2]=o.z},e}(i.AnimationNode);i.ParticleVelocityOverConstNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityOverOneBezierNode"}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressDataX=this._node.velocityOver.xBezier1.trySampler(),this._floatCompressDataY=this._node.velocityOver.yBezier1.trySampler(),this._floatCompressDataZ=this._node.velocityOver.zBezier1.trySampler(),this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezier"),this._floatCompressDataX&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierX"),this._floatCompressDataY&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierY"),this._floatCompressDataZ&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierZ")},e.prototype.build=function(t,e){},e.prototype.activeState=function(t,e,i,a,r,n,o){this._floatCompressDataX&&o.uniform1fv(r.uniform_velocityOverX.uniformIndex,this._floatCompressDataX),this._floatCompressDataY&&o.uniform1fv(r.uniform_velocityOverY.uniformIndex,this._floatCompressDataY),this._floatCompressDataZ&&o.uniform1fv(r.uniform_velocityOverZ.uniformIndex,this._floatCompressDataZ)},e}(i.AnimationNode);i.ParticleVelocityOverOneBezierNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityOverTwoBezierNode",this.attribute_randomSeed=new i.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityOverRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressDataX1=this._node.velocityOver.xBezier1.trySampler(),this._floatCompressDataY1=this._node.velocityOver.yBezier1.trySampler(),this._floatCompressDataZ1=this._node.velocityOver.zBezier1.trySampler(),this._floatCompressDataX2=this._node.velocityOver.xBezier2.trySampler(),this._floatCompressDataY2=this._node.velocityOver.yBezier2.trySampler(),this._floatCompressDataZ2=this._node.velocityOver.zBezier2.trySampler(),this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezier"),this._floatCompressDataX1&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierX1"),this._floatCompressDataX2&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierX2"),this._floatCompressDataY1&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierY1"),this._floatCompressDataY2&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierY2"),this._floatCompressDataZ1&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierZ1"),this._floatCompressDataZ2&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierZ2")},e.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,a=0,r=0;r<e;++r)for(var n=Math.random(),o=0;o<i;++o)a=(a=r*i+o)*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.verticesData[a+0]=n},e.prototype.activeState=function(t,e,i,a,r,n,o){this._floatCompressDataX1&&o.uniform1fv(r.uniform_velocityOverX1.uniformIndex,this._floatCompressDataX1),this._floatCompressDataX2&&o.uniform1fv(r.uniform_velocityOverX2.uniformIndex,this._floatCompressDataX2),this._floatCompressDataY1&&o.uniform1fv(r.uniform_velocityOverY1.uniformIndex,this._floatCompressDataY1),this._floatCompressDataY2&&o.uniform1fv(r.uniform_velocityOverY2.uniformIndex,this._floatCompressDataY2),this._floatCompressDataZ1&&o.uniform1fv(r.uniform_velocityOverZ1.uniformIndex,this._floatCompressDataZ1),this._floatCompressDataZ2&&o.uniform1fv(r.uniform_velocityOverZ2.uniformIndex,this._floatCompressDataZ2)},e}(i.AnimationNode);i.ParticleVelocityOverTwoBezierNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityForceConstNode",this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceConst"),this.attribute_accelerationSpeed=new i.GLSL.VarRegister,this.attribute_accelerationSpeed.name="attribute_velocityForceConst",this.attribute_accelerationSpeed.size=3,this.attributes.push(this.attribute_accelerationSpeed)}return __extends(e,t),e.prototype.initNode=function(t){this._node=t;var e=this._node.velocityForce;this._forceData=new i.Vec3ConstRandomValueShape,this._forceData.maxX=e.max.x,this._forceData.maxY=e.max.y,this._forceData.maxZ=e.max.z,this._forceData.minX=e.min.x,this._forceData.minY=e.min.y,this._forceData.minZ=e.min.z},e.prototype.build=function(t,e){for(var i=t.vertexCount/e,a=0,r=this._forceData.calculate(e),n=0;n<e;++n)for(var o=r[n],s=0;s<i;++s)a=(a=n*i+s)*t.vertexAttLength+this.attribute_accelerationSpeed.offsetIndex,t.verticesData[a+0]=o.x,t.verticesData[a+1]=o.y,t.verticesData[a+2]=o.z},e}(i.AnimationNode);i.ParticleVelocityForceConstNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityForceOneBezierNode"}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressDataX=this._node.velocityForce.xBezier1.trySampler(),this._floatCompressDataY=this._node.velocityForce.yBezier1.trySampler(),this._floatCompressDataZ=this._node.velocityForce.zBezier1.trySampler(),this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezier"),this._floatCompressDataX&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierX"),this._floatCompressDataY&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierY"),this._floatCompressDataZ&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierZ")},e.prototype.build=function(t,e){},e.prototype.activeState=function(t,e,i,a,r,n,o){this._floatCompressDataX&&o.uniform1fv(r.uniform_velocityForceX.uniformIndex,this._floatCompressDataX),this._floatCompressDataY&&o.uniform1fv(r.uniform_velocityForceY.uniformIndex,this._floatCompressDataY),this._floatCompressDataZ&&o.uniform1fv(r.uniform_velocityForceZ.uniformIndex,this._floatCompressDataZ)},e}(i.AnimationNode);i.ParticleVelocityForceOneBezierNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityForceTwoBezierNode",this.attribute_randomSeed=new i.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityForceRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressDataX1=this._node.velocityForce.xBezier1.trySampler(),this._floatCompressDataY1=this._node.velocityForce.yBezier1.trySampler(),this._floatCompressDataZ1=this._node.velocityForce.zBezier1.trySampler(),this._floatCompressDataX2=this._node.velocityForce.xBezier2.trySampler(),this._floatCompressDataY2=this._node.velocityForce.yBezier2.trySampler(),this._floatCompressDataZ2=this._node.velocityForce.zBezier2.trySampler(),this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezier"),this._floatCompressDataX1&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierX1"),this._floatCompressDataX2&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierX2"),this._floatCompressDataY1&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierY1"),this._floatCompressDataY2&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierY2"),this._floatCompressDataZ1&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierZ1"),this._floatCompressDataZ2&&this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierZ2")},e.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,a=0,r=0;r<e;++r)for(var n=Math.random(),o=0;o<i;++o)a=(a=r*i+o)*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.verticesData[a+0]=n},e.prototype.activeState=function(t,e,i,a,r,n,o){this._floatCompressDataX1&&o.uniform1fv(r.uniform_velocityForceX1.uniformIndex,this._floatCompressDataX1),this._floatCompressDataX2&&o.uniform1fv(r.uniform_velocityForceX2.uniformIndex,this._floatCompressDataX2),this._floatCompressDataY1&&o.uniform1fv(r.uniform_velocityForceY1.uniformIndex,this._floatCompressDataY1),this._floatCompressDataY2&&o.uniform1fv(r.uniform_velocityForceY2.uniformIndex,this._floatCompressDataY2),this._floatCompressDataZ1&&o.uniform1fv(r.uniform_velocityForceZ1.uniformIndex,this._floatCompressDataZ1),this._floatCompressDataZ2&&o.uniform1fv(r.uniform_velocityForceZ2.uniformIndex,this._floatCompressDataZ2)},e}(i.AnimationNode);i.ParticleVelocityForceTwoBezierNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityLimitConstNode",this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityLimitConst"),this.attribute_velocityLimit=new i.GLSL.VarRegister,this.attribute_velocityLimit.name="attribute_velocityLimit",this.attribute_velocityLimit.size=1,this.attributes.push(this.attribute_velocityLimit)}return __extends(e,t),e.prototype.initNode=function(t){var e=t;this._velocityLimitShape=new i.ConstRandomValueShape,this._velocityLimitShape.max=e.velocityLimit.max,this._velocityLimitShape.min=e.velocityLimit.min},e.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,a=0,r=this._velocityLimitShape.calculate(e),n=0;n<e;++n)for(var o=r[n],s=0;s<i;++s)a=(a=n*i+s)*t.vertexAttLength+this.attribute_velocityLimit.offsetIndex,t.verticesData[a+0]=o},e}(i.AnimationNode);i.ParticleVelocityLimitConstNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityLimitOneBezierNode",this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityLimitOneBezier")}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.velocityLimit.bezier1.sampler()},e.prototype.build=function(t,e){},e.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_velocityLimit.uniformIndex,this._floatCompressData)},e}(i.AnimationNode);i.ParticleVelocityLimitOneBezierNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleVelocityLimitTwoBezierNode",this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_velocityLimitTwoBezier"),this.attribute_randomSeed=new i.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityLimitRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.velocityLimit.bezier1.sampler(),this._floatCompressData2=this._node.velocityLimit.bezier2.sampler()},e.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,a=0,r=0;r<e;++r)for(var n=Math.random(),o=0;o<i;++o)a=(a=r*i+o)*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.verticesData[a+0]=n},e.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_velocityLimit.uniformIndex,this._floatCompressData),o.uniform1fv(r.uniform_velocityLimit2.uniformIndex,this._floatCompressData2)},e}(i.AnimationNode);i.ParticleVelocityLimitTwoBezierNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleRotationConstNode",this.vertex_ShaderName[i.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.local_vertex].push("particle_rotationConst"),this.attribute_Rotation=new i.GLSL.VarRegister,this.attribute_Rotation.name="attribute_rotationZ",this.attribute_Rotation.size=1,this.attributes.push(this.attribute_Rotation)}return __extends(e,t),e.prototype.initNode=function(t){var e=t;this._rotation=new i.ConstRandomValueShape,this._rotation.max=e.max.z,this._rotation.min=e.min.z},e.prototype.build=function(t,e){for(var i=0,a=t.vertexCount/e,r=this._rotation.calculate(e),n=0;n<e;++n)for(var o=r[n],s=0;s<a;++s)i=(i=n*a+s)*t.vertexAttLength+this.attribute_Rotation.offsetIndex,t.verticesData[i+0]=o},e}(i.AnimationNode);i.ParticleRotationConstNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleRotationOneBezierNode",this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_rotationOneBezier")}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.bezier1.sampler()},e.prototype.build=function(t,e){},e.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_rotationBezier.uniformIndex,this._floatCompressData)},e}(i.AnimationNode);i.ParticleRotationOneBezierNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this.name="ParticleRotationTwoBezierNode",this.attribute_randomSeed=new i.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_rotationRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(e,t),e.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.bezier1.sampler(),this._floatCompressData2=this._node.bezier2.sampler(),this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[i.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[i.ShaderPhaseType.global_vertex].push("particle_rotationTwoBezier")},e.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,a=0,r=0;r<e;++r)for(var n=Math.random(),o=0;o<i;++o)a=(a=r*i+o)*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.verticesData[a+0]=n},e.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_rotationBezier.uniformIndex,this._floatCompressData),o.uniform1fv(r.uniform_rotationBezier2.uniformIndex,this._floatCompressData2)},e}(i.AnimationNode);i.ParticleRotationTwoBezierNode=t}(egret3d||(egret3d={})),function(l){var t=function(t){function e(){t.call(this),this._sheetFloatData=new Float32Array(5),this.name="ParticleTextureSheetNode",this.attribute_textureSheetData=new l.GLSL.VarRegister,this.attribute_textureSheetData.name="attribute_textureSheetData",this.attribute_textureSheetData.size=3,this.attributes.push(this.attribute_textureSheetData),this.vertex_ShaderName[l.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[l.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[l.ShaderPhaseType.local_vertex].push("particle_textureSheet_vs")}return __extends(e,t),e.prototype.initNode=function(t,e){this._sheetData=e,this._sheetFloatData[0]=this._sheetData.tileX,this._sheetFloatData[1]=this._sheetData.tileY,this._sheetFloatData[2]=this._sheetData.circles,this._sheetData.whole?(this._sheetFloatData[3]=0,this._sheetFloatData[4]=this._sheetData.tileX*this._sheetData.tileY-1):(this._sheetFloatData[3]=0,this._sheetFloatData[4]=this._sheetData.tileY-1),this._sheetData.frameType==l.ParticleValueType.Const||this._sheetData.frameType==l.ParticleValueType.RandomConst?(this.fragment_ShaderName[l.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[l.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[l.ShaderPhaseType.start_fragment].push("particle_textureSheetConst")):this._sheetData.frameType==l.ParticleValueType.OneBezier?(this.fragment_ShaderName[l.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[l.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[l.ShaderPhaseType.start_fragment].push("particle_bezier"),this.fragment_ShaderName[l.ShaderPhaseType.start_fragment].push("particle_textureSheetOneBezier"),this._floatCompressData1=this._sheetData.bezier1.sampler()):this._sheetData.frameType==l.ParticleValueType.TwoBezier&&(this.fragment_ShaderName[l.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[l.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[l.ShaderPhaseType.start_fragment].push("particle_bezier"),this.fragment_ShaderName[l.ShaderPhaseType.start_fragment].push("particle_textureSheetTwoBezier"),this._floatCompressData1=this._sheetData.bezier1.sampler(),this._floatCompressData2=this._sheetData.bezier2.sampler())},e.prototype.build=function(t,e){for(var i=0,a=0,r=0,n=0,o=t.vertexCount/e,s=0;s<e;++s){i=this._sheetData.whole?0:this._sheetData.randomRow?Math.floor(this._sheetData.tileY*Math.random())*this._sheetData.tileX:this._sheetData.row*this._sheetData.tileX,this._sheetData.frameType==l.ParticleValueType.Const||this._sheetData.frameType==l.ParticleValueType.RandomConst?(a=(this._sheetData.max-this._sheetData.min)*Math.random()+this._sheetData.min,a=Math.floor(a)):a=0,r=this._sheetData.frameType==l.ParticleValueType.TwoBezier?Math.random():1;for(var h=0;h<o;++h)n=(n=s*o+h)*t.vertexAttLength+this.attribute_textureSheetData.offsetIndex,t.verticesData[n+0]=i+.001,t.verticesData[n+1]=a,t.verticesData[n+2]=r}},e.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_textureSheet.uniformIndex,this._sheetFloatData),this._sheetData.frameType==l.ParticleValueType.OneBezier?o.uniform1fv(r.uniform_frameBezier.uniformIndex,this._floatCompressData1):this._sheetData.frameType==l.ParticleValueType.TwoBezier&&(o.uniform1fv(r.uniform_frameBezier1.uniformIndex,this._floatCompressData1),o.uniform1fv(r.uniform_frameBezier2.uniformIndex,this._floatCompressData2))},e}(l.AnimationNode);l.ParticleTextureSheetNode=t}(egret3d||(egret3d={})),function(i){var t=function(t){function e(){t.call(this),this._uvRollData=new Float32Array(2),this.name="ParticleUVRollNode",this.fragment_ShaderName[i.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[i.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[i.ShaderPhaseType.start_fragment].push("particle_uv_roll_fs")}return __extends(e,t),e.prototype.initNode=function(t,e){this._methodData=e,this._uvRollData[0]=this._methodData.uSpeed,this._uvRollData[1]=this._methodData.vSpeed},e.prototype.build=function(t,e){},e.prototype.activeState=function(t,e,i,a,r,n,o){o.uniform1fv(r.uniform_particleUVRoll.uniformIndex,this._uvRollData)},e}(i.AnimationNode);i.ParticleUVRollNode=t}(egret3d||(egret3d={})),function(l){var t=function(t){function e(){t.call(this),this._empty=!0,this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.count=0,this.position=new l.Vector3D,this._added=!1,this._orientation=new l.Quaternion,this._birthPhase=new i(l.ParticleDataSubEmitterPhase.BIRTH),this._collisionPhase=new i(l.ParticleDataSubEmitterPhase.COLLISION),this._deathPhase=new i(l.ParticleDataSubEmitterPhase.DEATH),this.name="ParticleSubEmitterNode"}return __extends(e,t),e.prototype.initNode=function(t,e){void 0===e&&(e=null),this._parent=e},e.prototype.importSubEmitter=function(t,e){var i;t==l.ParticleDataSubEmitterPhase.BIRTH?i=this._birthPhase:t==l.ParticleDataSubEmitterPhase.COLLISION?i=this._collisionPhase:t==l.ParticleDataSubEmitterPhase.DEATH&&(i=this._deathPhase),i&&(this._empty=!1,i.importSubEmitter(e))},e.prototype.build=function(t,e){this.count=e,this._animationState=this.state,this._lifeCircles=[];for(var i=0;i<this.count;i++)this._lifeCircles[i]=-1},e.prototype.update=function(t,e,i){if(!this._empty){this.recycleParticle();var a=this._animationState.emitter.data.life.loop,r=this._animationState.loopTime+this._animationState.emitter.data.life.duration;if(a||!(r<=.001*t))for(var n=0,o=i.vertexCount/this.count,s=0,h=this._animationState.emitter.positionNode.offsetIndex,l=this._animationState.emitter.timeNode.offsetIndex,u=.001*t-this._animationState.emitter.data.life.delay,c=i.sharedVertexBuffer?i.sharedVertexBuffer.arrayBuffer:i.verticesData,d=(this._animationState.followTarget||this._animationState.emitter,0);d<this.count;++d){s=d*o,this.timeIndex=s*i.vertexAttLength+l,this.bornTime=c[this.timeIndex+0],this.life=c[this.timeIndex+1];var p=-1;if(u>=this.bornTime){if(u>this.bornTime+this.life&&!a)continue;(p=Math.floor((u-this.bornTime)/this._animationState.loopTime))!=this._lifeCircles[d]&&(n=s*i.vertexAttLength+h,this._lifeCircles[d]=p,this.position.x=c[n+0],this.position.y=c[n+1],this.position.z=c[n+2],this.emitParticleAtPhase(this._birthPhase,this.position))}}}},e.prototype.emitParticleAtPhase=function(t,e){var i,a,r,n,o=t.playing.getKeys();this._orientation.copyFrom(this._parent.orientation),this._orientation.w*=-1;for(var s=0,h=o.length;s<h;s++)i=o[s],r=t.recycle.getValueByKey(i),a=t.playing.getValueByKey(i),null==(n=r.shift())&&(n=new l.ParticleEmitter(i.data,i.material)),a.push(n),n.play(),n.position=e,n.orientation=this._orientation,this._parent.addChild(n)},e.prototype.recycleParticle=function(){this.recycleParticleAtPhase(this._birthPhase),this.recycleParticleAtPhase(this._collisionPhase),this.recycleParticleAtPhase(this._deathPhase)},e.prototype.recycleParticleAtPhase=function(t){for(var e,i,a,r,n,o=t.playing.getKeys(),s=0,h=o.length;s<h;s++)for(e=o[s],i=t.playing.getValueByKey(e),a=t.recycle.getValueByKey(e),n=i.length-1;0<=n;n--)1<(r=i[n]).loopProgress&&(i.splice(n,1),r.stop(),this._parent.removeChild(r),a.push(r))},e.prototype.activeState=function(t,e,i,a,r,n,o){},e}(l.AnimationNode);l.ParticleSubEmitterNode=t;var i=function(){function t(t){this.playing=new l.DoubleArray,this.recycle=new l.DoubleArray}return t.prototype.importSubEmitter=function(t){0<=this.playing.getKeys().indexOf(t)||(this.playing.put(t,[]),this.recycle.put(t,[]))},t}();l.ParticleSubEmitterNodePhase=i}(egret3d||(egret3d={})),function(t){var e=function(){function t(t,e){this.numberOfVertices=0,this.vertexSizeInBytes=0,this.vertex_shaders={},this.fragment_shaders={},this.loopTime=0,this.circleTime=0,this.reverse=1,this.followTarget=null,this._particleProperty=new Float32Array(22),this._particleFsData=new Float32Array(3),this._emitter=e,this.name=t,this.animNodes=[],this.keyFrames=[]}return Object.defineProperty(t.prototype,"emitter",{get:function(){return this._emitter},enumerable:!0,configurable:!0}),t.prototype.addNode=function(t){(t.state=this).animNodes.push(t)},t.prototype.removeNode=function(t){var e=this.animNodes.indexOf(t);-1!=e&&this.animNodes.splice(e,1)},t.prototype.clean=function(){this.animNodes.length=0},t.prototype.addShaderPhase=function(t,e){var i,a;for(a in t){i=t[a];for(var r=0;r<i.length;r++)e[a]=e[a]||[],e[a].push(i[r])}},t.prototype.calculate=function(t){for(var e=0;e<this.animNodes.length;e++){this.addShaderPhase(this.animNodes[e].vertex_ShaderName,this.vertex_shaders),this.addShaderPhase(this.animNodes[e].fragment_ShaderName,this.fragment_shaders);for(var i=t.vertexAttLength,a=0;a<this.animNodes[e].attributes.length;++a)0<this.animNodes[e].attributes[a].size&&(this.animNodes[e].attributes[a].offsetIndex=i,t.vertexAttLength+=this.animNodes[e].attributes[a].size,t.vertexSizeInBytes+=4*this.animNodes[e].attributes[a].size,t.subGeometrys[0].preAttList.push(this.animNodes[e].attributes[a])),i=t.vertexAttLength}},t.prototype.fill=function(t,e){for(var i=0;i<this.animNodes.length;i++)this.animNodes[i].build(t,e)},t.prototype.update=function(t,e,i){for(var a=0;a<this.animNodes.length;a++)this.animNodes[a].update(t,e,i)},t.prototype.activeState=function(t,e,i,a,r,n,o,s){var h,l,u=this._emitter.data;u.followTarget&&this._emitter.followTarget?(h=this._emitter.followTarget.globalOrientation,l=this._emitter.followTarget.globalPosition):(h=this._emitter.globalOrientation,l=this._emitter.globalPosition),this._particleProperty[0]=.001*e,this._particleProperty[1]=u.life.loop?1:0,this._particleProperty[2]=u.followTarget?1:0,this._particleProperty[3]=1,this._particleProperty[4]=1,this._particleProperty[5]=1,this._particleProperty[6]=h.x,this._particleProperty[7]=h.y,this._particleProperty[8]=h.z,this._particleProperty[9]=h.w,this._particleProperty[10]=l.x,this._particleProperty[11]=l.y,this._particleProperty[12]=l.z,this._particleProperty[13]=this.loopTime,this._particleProperty[14]=u.life.delay,this._particleProperty[15]=u.life.duration,this._particleProperty[16]=u.property.gravity,this._particleProperty[17]=u.moveSpeed.velocityOver&&u.moveSpeed.velocityOver.worldSpace?1:0,this._particleProperty[18]=u.moveSpeed.velocityForce&&u.moveSpeed.velocityForce.worldSpace?1:0,this._particleProperty[19]=u.property.cameraScale,this._particleProperty[20]=u.property.speedScale,this._particleProperty[21]=u.property.lengthScale,o.uniform1fv(r.uniform_particleState.uniformIndex,this._particleProperty),this._particleFsData[0]=s.far,this._particleFsData[1]=s.near,this._particleFsData[2]=this._emitter.material.materialData.blendMode,o.uniform1fv(r.uniform_particleFsData.uniformIndex,this._particleFsData);for(var c=0;c<this.animNodes.length;c++)this.animNodes[c].activeState(t,e,i,a,r,n,o)},t}();t.ParticleAnimationState=e}(egret3d||(egret3d={})),function(i){var t=function(e){function t(t){e.call(this),this.animTime=0,this.delay=0,this.speed=1,this._play=!1,this.animStates=[],this.particleAnimationState=new i.ParticleAnimationState("particle",t),this.addAnimState(this.particleAnimationState)}return __extends(t,e),t.prototype.update=function(t,e,i){this._play&&(this.delay=e,this.animTime+=this.delay,this.particleAnimationState&&this.particleAnimationState.update(this.animTime,this.delay,i))},t.prototype.activeState=function(t,e,i,a,r,n,o){this.particleAnimationState&&this.particleAnimationState.activeState(t,this.animTime,e,this.delay,i,a,r,o)},t.prototype.play=function(t,e,i,a){void 0===e&&(e=1),void 0===i&&(i=!0),void 0===a&&(a=!0),this._play=!0,i&&(this.animTime=0),a&&(this.animTime=this.particleAnimationState.loopTime),this.delay=0},t.prototype.stop=function(){this._play=!1},t.prototype.isPlay=function(){return this._play},t.prototype.addAnimState=function(t){-1==this.animStates.indexOf(t)&&this.animStates.push(t)},t.prototype.removeAnimState=function(t){var e=this.animStates.indexOf(t);-1!=e&&this.animStates.splice(e,1)},t.prototype.getAnimList=function(){return[]},t.prototype.getAnimNode=function(){return[]},t.prototype.clone=function(){return null},t}(i.EventDispatcher);i.ParticleAnimation=t}(egret3d||(egret3d={})),function(i){var t;(t=i.ParticleDataNodeType||(i.ParticleDataNodeType={}))[t.Property=0]="Property",t[t.Emission=1]="Emission",t[t.Life=2]="Life",t[t.Shape=3]="Shape",t[t.RotationBirth=4]="RotationBirth",t[t.ScaleBirth=5]="ScaleBirth",t[t.Geometry=6]="Geometry",t[t.MoveSpeed=7]="MoveSpeed",t[t.FollowTarget=8]="FollowTarget",t[t.ScaleBezier=9]="ScaleBezier",t[t.RotationSpeed=10]="RotationSpeed",t[t.ColorOffset=11]="ColorOffset",t[t.TextureSheet=12]="TextureSheet";var e,a,r=i.ParticleDataNodeType;(e=i.ParticleDataSubEmitterPhase||(i.ParticleDataSubEmitterPhase={}))[e.BIRTH=0]="BIRTH",e[e.COLLISION=1]="COLLISION",e[e.DEATH=2]="DEATH",i.ParticleDataSubEmitterPhase,(a=i.ParticleValueType||(i.ParticleValueType={}))[a.Const=0]="Const",a[a.RandomConst=1]="RandomConst",a[a.OneBezier=2]="OneBezier",a[a.TwoBezier=3]="TwoBezier";var n,o=i.ParticleValueType;(n=i.ParticleRenderModeType||(i.ParticleRenderModeType={}))[n.Billboard=0]="Billboard",n[n.StretchedBillboard=1]="StretchedBillboard",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh";var s,h=i.ParticleRenderModeType;(s=i.ParticleBirthColorType||(i.ParticleBirthColorType={}))[s.Const=0]="Const",s[s.RandomConst=1]="RandomConst",s[s.OneGradients=2]="OneGradients",s[s.TwoGradients=3]="TwoGradients";var l,u=i.ParticleBirthColorType;(l=i.ParticleDataShapeType||(i.ParticleDataShapeType={}))[l.Point=0]="Point",l[l.Cube=1]="Cube",l[l.Sphere=2]="Sphere",l[l.HemiSphere=3]="HemiSphere",l[l.Cone=4]="Cone",l[l.Mesh=5]="Mesh";var c,d=i.ParticleDataShapeType;(c=i.ParticleMeshShapeType||(i.ParticleMeshShapeType={}))[c.Vertex=0]="Vertex",c[c.Triangle=1]="Triangle",c[c.Edge=2]="Edge";var p,_=i.ParticleMeshShapeType;(p=i.ParticleConeShapeType||(i.ParticleConeShapeType={}))[p.Base=0]="Base",p[p.BaseShell=1]="BaseShell",p[p.Volume=2]="Volume",p[p.VolumeShell=3]="VolumeShell";var f=i.ParticleConeShapeType,m=function(){function t(){this.property=new v,this.emission=new y,this.life=new x,this.shape=new D,this.rotationBirth=new b,this.scaleBirth=new w,this.geometry=new T,this.moveSpeed=new P}return t.prototype.validate=function(){this.property.validate(),this.emission.validate(),this.life.validate(),this.shape.validate(),this.rotationBirth.validate(),this.scaleBirth.validate(),this.geometry.validate(),this.moveSpeed.validate(),this.scaleBezier&&this.scaleBezier.validate(),this.rotationSpeed&&this.rotationSpeed.validate(),this.colorOffset&&this.colorOffset.validate(),this.followTarget&&this.followTarget.validate(),this.textureSheet&&this.textureSheet.validate()},t.prototype.scaleBy=function(t){this.property.bounds.scaleBy(t),this.property.gravity*=t,this.property.position.scaleBy(t),this.shape.cubeW*=t,this.shape.cubeH*=t,this.shape.cubeD*=t,this.shape.sphereRadius*=t,this.shape.hemiSphereRadius*=t,this.shape.coneHeight*=t,this.shape.coneRadiusBottom*=t,this.shape.coneRadiusTop*=t,this.geometry.planeW*=t,this.geometry.planeH*=t,this.moveSpeed.max*=t,this.moveSpeed.min*=t,this.moveSpeed.bezier1&&this.moveSpeed.bezier1.scaleBy(t),this.moveSpeed.bezier2&&this.moveSpeed.bezier2.scaleBy(t),this.moveSpeed.velocityOver&&this.moveSpeed.velocityOver.scaleBy(t),this.moveSpeed.velocityLimit&&this.moveSpeed.velocityLimit.scaleBy(t),this.moveSpeed.velocityForce&&this.moveSpeed.velocityForce.scaleBy(t)},t.SCALE_VALUE=1,t}();i.ParticleData=m;var g=function(){function t(t){this._nodeType=t}return Object.defineProperty(t.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),t}(),v=function(t){function e(){t.call(this,r.Property),this.particleCount=10,this.bounds=new i.Vector3D(10,10,10),this.colorType=u.Const,this.colorConst1=new i.Color(255,255,255,255),this.colorConst2=new i.Color(255,255,255,255),this.tintColor=new i.Color(128,128,128,128),this.gravity=0,this.prewarm=!1,this.rotation=new i.Vector3D(0,0,0,1),this.scale=new i.Vector3D(1,1,1,1),this.position=new i.Vector3D(0,0,0,1),this.sortingFudge=0,this.renderMode=h.Billboard,this.cameraScale=0,this.speedScale=0,this.lengthScale=1}return __extends(e,t),e.prototype.validate=function(){null==this.bounds&&(this.bounds=new i.Vector3D(10,10,10)),this.bounds.x<0&&(this.bounds.x=1),this.bounds.y<0&&(this.bounds.y=1),this.bounds.z<0&&(this.bounds.z=1),this.particleCount<0&&(this.particleCount=10),null==this.colorConst1&&(this.colorConst1=new i.Color(255,255,255,255)),null==this.colorConst2&&(this.colorConst2=new i.Color(255,255,255,255)),(this.colorType==u.OneGradients||this.colorType==u.TwoGradients)&&null==this.colorGradients1&&(this.colorGradients1=new i.ColorGradients),this.colorType==u.TwoGradients&&null==this.colorGradients2&&(this.colorGradients2=new i.ColorGradients),null==this.rotation&&(this.rotation=new i.Vector3D(0,0,0,1)),null==this.scale&&(this.scale=new i.Vector3D(1,1,1,1)),null==this.position&&(this.rotation=new i.Vector3D(0,0,0,1))},e}(i.ParticleDataNode=g);i.ParticleDataProperty=v;var y=function(t){function e(){t.call(this,r.Emission),this.rate=10,this.type=o.Const,this.bezier=new i.BezierData}return __extends(e,t),e.prototype.validate=function(){this.rate<0&&(this.rate=1e-5),this.type==o.OneBezier&&(null==this.bezier&&(this.bezier=new i.BezierData),this.bezier.validate())},e}(g);i.ParticleDataEmission=y;var x=function(t){function e(){t.call(this,r.Life),this.type=o.Const,this.max=0,this.min=0,this.duration=5,this.delay=0,this.loop=!0}return __extends(e,t),e.prototype.validate=function(){this.max<=0&&(this.max=1),this.min>this.max&&(this.min=this.max),this.type==o.Const&&(this.min=this.max),this.type==o.RandomConst&&this.min>this.max&&(this.min=this.max),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new i.BezierData),this.bezier1.validate()),this.type==o.TwoBezier&&(null==this.bezier2&&(this.bezier2=new i.BezierData),this.bezier2.validate()),this.delay<0&&(this.delay=0),this.duration<0&&(this.duration=5)},e}(g);i.ParticleDataLife=x;var D=function(t){function e(){t.call(this,r.Shape),this.type=d.Cube,this.randomDirection=!1,this.cubeW=0,this.cubeH=0,this.cubeD=0,this.sphereRadius=10,this.hemiSphereRadius=10,this.coneHeight=10,this.coneRadiusBottom=2,this.coneRadiusTop=4,this.coneType=f.Volume,this.meshType=_.Vertex}return __extends(e,t),e.prototype.validate=function(){this.type==d.Cube?(this.cubeW<0&&(this.cubeW=0),this.cubeH<0&&(this.cubeH=0),this.cubeD<0&&(this.cubeD=0)):this.type==d.Sphere&&this.sphereRadius<0&&(this.sphereRadius=10)},e}(g);i.ParticleDataShape=D;var b=function(t){function e(){t.call(this,r.RotationBirth),this.type=o.Const,this.max=0,this.min=0}return __extends(e,t),e.prototype.validate=function(){this.type==o.Const&&(this.min=this.max),this.type==o.RandomConst&&this.min>this.max&&(this.min=this.max),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new i.BezierData),this.bezier1.validate()),this.type==o.TwoBezier&&(null==this.bezier2&&(this.bezier2=new i.BezierData),this.bezier2.validate())},e}(g);i.ParticleDataRotationBirth=b;var w=function(t){function e(){t.call(this,r.ScaleBirth),this.type=o.Const,this.max=1,this.min=1}return __extends(e,t),e.prototype.validate=function(){this.type==o.Const&&(this.min=this.max),this.type==o.RandomConst&&this.min>this.max&&(this.min=this.max),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new i.BezierData),this.bezier1.validate()),this.type==o.TwoBezier&&(null==this.bezier2&&(this.bezier2=new i.BezierData),this.bezier2.validate())},e}(g);i.ParticleDataScaleBirth=w;var T=function(t){function e(){t.call(this,r.Geometry),this.planeW=10,this.planeH=10}return __extends(e,t),e.prototype.validate=function(){this.planeW<0&&(this.planeW=10),this.planeH<0&&(this.planeH=10)},e}(g);i.ParticleDataGeometry=T;var P=function(t){function e(){t.call(this,r.MoveSpeed),this.type=o.Const,this.max=0,this.min=0}return __extends(e,t),e.prototype.validate=function(){this.velocityOver&&this.velocityOver.validate(),this.velocityLimit&&this.velocityLimit.validate(),this.velocityForce&&this.velocityForce.validate(),this.type==o.Const&&(this.min=this.max),this.type==o.RandomConst&&this.min>this.max&&(this.min=this.max),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new i.BezierData),this.bezier1.validate()),this.type==o.TwoBezier&&(null==this.bezier2&&(this.bezier2=new i.BezierData),this.bezier2.validate())},e}(g);i.ParticleDataMoveSpeed=P;var S=function(){function t(){this.type=o.Const,this.max=0,this.min=0,this.bezier1=new i.BezierData,this.bezier2=new i.BezierData}return t.prototype.validate=function(){this.max<0&&(this.max=0),this.min>this.max&&(this.min=this.max),this.type==o.Const&&(this.min=this.max),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new i.BezierData),this.bezier1.validate()),this.type==o.TwoBezier&&(null==this.bezier2&&(this.bezier2=new i.BezierData),this.bezier2.validate())},t.prototype.scaleBy=function(t){this.min*=t,this.max*=t,this.bezier1&&this.bezier1.scaleBy(t),this.bezier2&&this.bezier2.scaleBy(t)},t}();i.VelocityLimitLifeTimeData=S;var C=function(){function t(){this.type=o.Const,this.max=new i.Vector3D,this.min=new i.Vector3D,this.worldSpace=!1,this.xBezier1=new i.BezierData,this.yBezier1=new i.BezierData,this.zBezier1=new i.BezierData,this.xBezier2=new i.BezierData,this.yBezier2=new i.BezierData,this.zBezier2=new i.BezierData}return t.prototype.validate=function(){null==this.max&&(this.max=new i.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.xBezier1&&(this.xBezier1=new i.BezierData),null==this.yBezier1&&(this.yBezier1=new i.BezierData),null==this.zBezier1&&(this.zBezier1=new i.BezierData),this.xBezier1.validate(),this.yBezier1.validate(),this.zBezier1.validate()),this.type==o.TwoBezier&&(null==this.xBezier2&&(this.xBezier2=new i.BezierData),null==this.yBezier2&&(this.yBezier2=new i.BezierData),null==this.zBezier2&&(this.zBezier2=new i.BezierData),this.xBezier2.validate(),this.yBezier2.validate(),this.zBezier2.validate())},t.prototype.scaleBy=function(t){this.min.scaleBy(t),this.max.scaleBy(t),this.xBezier1&&this.xBezier1.scaleBy(t),this.yBezier1&&this.yBezier1.scaleBy(t),this.zBezier1&&this.zBezier1.scaleBy(t),this.xBezier2&&this.xBezier2.scaleBy(t),this.yBezier2&&this.yBezier2.scaleBy(t),this.zBezier2&&this.zBezier2.scaleBy(t)},t}();i.VelocityOverLifeTimeData=C;var A=function(){function t(){this.type=o.Const,this.max=new i.Vector3D,this.min=new i.Vector3D,this.worldSpace=!1,this.xBezier1=new i.BezierData,this.yBezier1=new i.BezierData,this.zBezier1=new i.BezierData,this.xBezier2=new i.BezierData,this.yBezier2=new i.BezierData,this.zBezier2=new i.BezierData}return t.prototype.validate=function(){null==this.max&&(this.max=new i.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.xBezier1&&(this.xBezier1=new i.BezierData),null==this.yBezier1&&(this.yBezier1=new i.BezierData),null==this.zBezier1&&(this.zBezier1=new i.BezierData),this.xBezier1.validate(),this.yBezier1.validate(),this.zBezier1.validate()),this.type==o.TwoBezier&&(null==this.xBezier2&&(this.xBezier2=new i.BezierData),null==this.yBezier2&&(this.yBezier2=new i.BezierData),null==this.zBezier2&&(this.zBezier2=new i.BezierData),this.xBezier2.validate(),this.yBezier2.validate(),this.zBezier2.validate())},t.prototype.scaleBy=function(t){this.min.scaleBy(t),this.max.scaleBy(t),this.xBezier1&&this.xBezier1.scaleBy(t),this.yBezier1&&this.yBezier1.scaleBy(t),this.zBezier1&&this.zBezier1.scaleBy(t),this.xBezier2&&this.xBezier2.scaleBy(t),this.yBezier2&&this.yBezier2.scaleBy(t),this.zBezier2&&this.zBezier2.scaleBy(t)},t}();i.VelocityForceLifeTimeData=A;var E=function(t){function e(){t.call(this,r.ScaleBezier),this.data=new i.BezierData}return __extends(e,t),e.prototype.validate=function(){null==this.data&&(this.data=new i.BezierData),this.data.validate()},e}(g);i.ParticleDataScaleBezier=E;var L=function(t){function e(){t.call(this,r.RotationSpeed),this.max=new i.Vector3D,this.min=new i.Vector3D,this.type=o.Const,this.bezier1=new i.BezierData,this.bezier2=new i.BezierData}return __extends(e,t),e.prototype.validate=function(){null==this.max&&(this.max=new i.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==o.OneBezier||this.type==o.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new i.BezierData),this.bezier1.validate()),this.type==o.TwoBezier&&(null==this.bezier2&&(this.bezier2=new i.BezierData),this.bezier2.validate())},e}(g);i.ParticleDataRotationSpeed=L;var M=function(t){function e(){t.call(this,r.ColorOffset),this.data=new i.ColorGradients}return __extends(e,t),e.prototype.validate=function(){null==this.data.colors&&(this.data.colors=[]),null==this.data.times&&(this.data.times=[])},e}(g);i.ParticleDataColorOffset=M;var F=function(t){function e(){t.call(this,r.FollowTarget),this.followRotation=!0,this.followScale=!0}return __extends(e,t),e.prototype.validate=function(){},e}(g);i.ParticleDataFollowTarget=F;var z=function(t){function e(){t.call(this,r.TextureSheet),this.tileX=1,this.tileY=1,this.whole=!0,this.frameType=o.Const,this.randomRow=!1,this.row=0,this.min=0,this.max=0,this.circles=1,this.bezier1=new i.BezierData,this.bezier2=new i.BezierData}return __extends(e,t),e.prototype.validate=function(){this.tileX<0&&(this.tileX=1),this.tileX=Math.floor(this.tileX),this.tileY<0&&(this.tileY=1),this.tileY=Math.floor(this.tileY),this.max<0&&(this.max=0),this.min>this.max&&(this.min=this.max),(this.frameType==o.OneBezier||this.frameType==o.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new i.BezierData),this.bezier1.validate()),this.frameType==o.TwoBezier&&(null==this.bezier2&&(this.bezier2=new i.BezierData),this.bezier2.validate()),this.circles<1&&(this.circles=1)},e}(g);i.ParticleDataTextureSheet=z}(egret3d||(egret3d={})),function(y){var t=function(){function t(){this.version=1}return t.prototype.parse=function(t){this._particleData=new y.ParticleData,this._xml=y.XMLParser.parse(t),this.version=Number(this.getNode(this._xml,"version").textContent);var e=this.getNode(this._xml,"property");this.parseProperty(e);var i=this.getNode(this._xml,"emission");this.parseEmission(i);var a=this.getNode(this._xml,"life");this.parseLife(a);var r=this.getNode(this._xml,"shape");this.parseShape(r);var n=this.getNode(this._xml,"rotationBirth");this.parseRotationBirth(n);var o=this.getNode(this._xml,"scaleBirth");this.parseScaleBirth(o);var s=this.getNode(this._xml,"geometry");this.parseGeometry(s);var h=this.getNode(this._xml,"moveSpeed");this.parseMoveSpeed(h);var l=this.getNode(this._xml,"followTarget");this.parseFollowTarget(l);var u=this.getNode(this._xml,"scaleBezier");this.parseScaleBeizer(u);var c=this.getNode(this._xml,"rotationSpeed");this.parseRotationSpeed(c);var d=this.getNode(this._xml,"colorOffset");this.parseColorOffset(d);var p=(this.getNode(this._xml,"mat"),this.getNode(this._xml,"textureSheet"));return this.parseTextureSheet(p),this._particleData.validate(),this._particleData.scaleBy(y.ParticleData.SCALE_VALUE),this._particleData},t.prototype.parseProperty=function(t){var e=this._particleData.property;e.particleCount=Number(this.getNode(t,"particleCount").textContent),e.prewarm="true"==this.getNode(t,"prewarm").textContent;var i=this.getNode(t,"bounds");e.bounds=this.parseVector3D(i,e.bounds),e.colorType=y.ParticleBirthColorType[this.getNode(t,"colorType").textContent];var a=this.getNode(t,"colorConst1"),r=this.getNode(t,"colorConst2"),n=this.getNode(t,"colorGradients1"),o=this.getNode(t,"colorGradients2"),s=this.getNode(t,"tintColor");this.parseColorProperty(e,a,r,n,o,s),e.gravity=Number(this.getNode(t,"gravity").textContent);var h=this.getNode(t,"transform"),l=this.getNode(h,"rotation"),u=this.getNode(h,"scale"),c=this.getNode(h,"position");e.rotation=this.parseVector3D(l,e.rotation),e.scale=this.parseVector3D(u,e.scale),e.position=this.parseVector3D(c,e.position);var d=this.getNode(t,"render"),p=this.getNode(d,"renderMode");p&&(e.renderMode=y.ParticleRenderModeType[p.textContent]);var _=this.getNode(d,"lengthScale");_&&(e.lengthScale=Number(_.textContent));var f=this.getNode(d,"cameraScale");f&&(e.cameraScale=Number(f.textContent));var m=this.getNode(d,"speedScale");m&&(e.speedScale=Number(m.textContent));var g=this.getNode(d,"meshFile");g&&(e.meshFile=g.textContent);var v=this.getNode(t,"sortingFudge");v&&(e.sortingFudge=Number(v.textContent))},t.prototype.parseColorProperty=function(t,e,i,a,r,n){if(e&&(t.colorConst1=y.Color.createColor(Number(e.textContent))),i&&(t.colorConst2=y.Color.createColor(Number(i.textContent))),a){var o=this.getNodeList(a,"item");t.colorGradients1=this.parseGradientsColor(o,t.colorGradients1)}if(r){o=this.getNodeList(r,"item");t.colorGradients2=this.parseGradientsColor(o,t.colorGradients2)}n&&(t.tintColor=y.Color.createColor(Number(n.textContent)))},t.prototype.parseEmission=function(t){var e=this._particleData.emission;e.type=y.ParticleValueType[this.getNode(t,"type").textContent],e.rate=Number(this.getNode(t,"rate").textContent);var i,a,r=this.getNode(t,"bursts"),n=0,o=0;if(r){e.bursts=[];var s=this.getNodeList(r,"item");for(n=0,o=s?s.length:0;n<o;n++)i=s[n],a=new y.Point,e.bursts.push(a),this.eachAttr(i,function(t,e){"time"==t?a.x=Number(e):"count"==t&&(a.y=Number(e))})}var h=this.getNode(t,"bezier");e.type==y.ParticleValueType.OneBezier&&(e.bezier=this.parseBezierData(h))},t.prototype.parseLife=function(t){var e=this._particleData.life;e.type=y.ParticleValueType[this.getNode(t,"type").textContent],e.min=Number(this.getNode(t,"min").textContent),e.max=Number(this.getNode(t,"max").textContent),e.bezier1=this.parseBezierData(this.getNode(t,"bezier1")),e.bezier2=this.parseBezierData(this.getNode(t,"bezier2")),e.duration=Number(this.getNode(t,"duration").textContent),e.delay=Number(this.getNode(t,"delay").textContent),e.loop="true"==this.getNode(t,"loop").textContent},t.prototype.parseShape=function(t){var i=this._particleData.shape;i.type=y.ParticleDataShapeType[this.getNode(t,"type").textContent],i.randomDirection="true"==this.getNode(t,"randomDirection").textContent;var e=this.getNode(t,"cube");this.eachAttr(e,function(t,e){"width"==t?i.cubeW=Number(e):"height"==t?i.cubeH=Number(e):"depth"==t&&(i.cubeD=Number(e))});var a=this.getNode(t,"sphereRadius");a&&(i.sphereRadius=Number(a.textContent));var r=this.getNode(t,"hemiSphereRadius");r&&(i.hemiSphereRadius=Number(r.textContent));var n=this.getNode(t,"cone");this.eachAttr(n,function(t,e){"coneHeight"==t?i.coneHeight=Number(e):"coneRadiusBottom"==t?i.coneRadiusBottom=Number(e):"coneRadiusTop"==t?i.coneRadiusTop=Number(e):"type"==t&&(i.coneType=y.ParticleConeShapeType[e])});var o=this.getNode(t,"meshType");o&&(i.meshType=y.ParticleMeshShapeType[o.textContent]);var s=this.getNode(t,"meshFile");s&&(i.meshFile=s.textContent)},t.prototype.parseRotationBirth=function(t){var e=this._particleData.rotationBirth;e.type=y.ParticleValueType[this.getNode(t,"type").textContent],e.min=Number(this.getNode(t,"min").textContent),e.max=Number(this.getNode(t,"max").textContent),e.bezier1=this.parseBezierData(this.getNode(t,"bezier1")),e.bezier2=this.parseBezierData(this.getNode(t,"bezier2"))},t.prototype.parseScaleBirth=function(t){var e=this._particleData.scaleBirth;e.type=y.ParticleValueType[this.getNode(t,"type").textContent],e.min=Number(this.getNode(t,"min").textContent),e.max=Number(this.getNode(t,"max").textContent),e.bezier1=this.parseBezierData(this.getNode(t,"bezier1")),e.bezier2=this.parseBezierData(this.getNode(t,"bezier2"))},t.prototype.parseGeometry=function(t){var i=this._particleData.geometry,e=this.getNode(t,"plane");this.eachAttr(e,function(t,e){"width"==t?i.planeW=Number(e):"height"==t&&(i.planeH=Number(e))})},t.prototype.parseMoveSpeed=function(t){var e=this._particleData.moveSpeed;e.type=y.ParticleValueType[this.getNode(t,"type").textContent],e.min=Number(this.getNode(t,"min").textContent),e.max=Number(this.getNode(t,"max").textContent),e.bezier1=this.parseBezierData(this.getNode(t,"bezier1")),e.bezier2=this.parseBezierData(this.getNode(t,"bezier2"));var i=this.getNode(t,"velocityOver");if(i){var a=new y.VelocityOverLifeTimeData;a.type=y.ParticleValueType[this.getNode(i,"type").textContent];var r=this.getNode(i,"min"),n=this.getNode(i,"max");a.min=this.parseVector3D(r,a.min),a.max=this.parseVector3D(n,a.max),a.worldSpace="true"==this.getNode(i,"worldSpace").textContent,a.xBezier1=this.parseBezierData(this.getNode(i,"xBezier1")),a.yBezier1=this.parseBezierData(this.getNode(i,"yBezier1")),a.zBezier1=this.parseBezierData(this.getNode(i,"zBezier1")),a.xBezier2=this.parseBezierData(this.getNode(i,"xBezier2")),a.yBezier2=this.parseBezierData(this.getNode(i,"yBezier2")),a.zBezier2=this.parseBezierData(this.getNode(i,"zBezier2")),e.velocityOver=a}var o=this.getNode(t,"velocityForce");if(o){var s=new y.VelocityForceLifeTimeData;s.type=y.ParticleValueType[this.getNode(o,"type").textContent];r=this.getNode(o,"min"),n=this.getNode(o,"max");s.min=this.parseVector3D(r,s.min),s.max=this.parseVector3D(n,s.max),s.worldSpace="true"==this.getNode(o,"worldSpace").textContent,s.xBezier1=this.parseBezierData(this.getNode(o,"xBezier1")),s.yBezier1=this.parseBezierData(this.getNode(o,"yBezier1")),s.zBezier1=this.parseBezierData(this.getNode(o,"zBezier1")),s.xBezier2=this.parseBezierData(this.getNode(o,"xBezier2")),s.yBezier2=this.parseBezierData(this.getNode(o,"yBezier2")),s.zBezier2=this.parseBezierData(this.getNode(o,"zBezier2")),e.velocityForce=s}var h=this.getNode(t,"velocityLimit");if(h){var l=new y.VelocityLimitLifeTimeData;l.type=y.ParticleValueType[this.getNode(h,"type").textContent];r=this.getNode(h,"min"),n=this.getNode(h,"max");l.min=Number(r.textContent),l.max=Number(n.textContent),l.bezier1=this.parseBezierData(this.getNode(h,"bezier1")),l.bezier2=this.parseBezierData(this.getNode(h,"bezier2")),e.velocityLimit=l}},t.prototype.parseFollowTarget=function(t){if(null!=t){var e=this._particleData.followTarget=new y.ParticleDataFollowTarget;e.followRotation="true"==this.getNode(t,"followRotation").textContent,e.followScale="true"==this.getNode(t,"followScale").textContent}},t.prototype.parseScaleBeizer=function(t){null!=t&&((this._particleData.scaleBezier=new y.ParticleDataScaleBezier).data=this.parseBezierData(this.getNode(t,"bezier")))},t.prototype.parseRotationSpeed=function(t){if(null!=t){var e=this._particleData.rotationSpeed=new y.ParticleDataRotationSpeed;e.type=y.ParticleValueType[this.getNode(t,"type").textContent];var i=this.getNode(t,"min"),a=this.getNode(t,"max");e.min=this.parseVector3D(i,e.min),e.max=this.parseVector3D(a,e.max),e.bezier1=this.parseBezierData(this.getNode(t,"bezier1")),e.bezier2=this.parseBezierData(this.getNode(t,"bezier2"))}},t.prototype.parseColorOffset=function(t){if(null!=t){var e=this._particleData.colorOffset=new y.ParticleDataColorOffset,i=this.getNodeList(t,"item");e.data=this.parseGradientsColor(i,e.data)}},t.prototype.parseTextureSheet=function(t){if(null==t)return null;var e=this._particleData.textureSheet=new y.ParticleDataTextureSheet;return e.frameType=y.ParticleValueType[this.getNode(t,"frameType").textContent],e.tileX=Number(this.getNode(t,"tileX").textContent),e.tileY=Number(this.getNode(t,"tileY").textContent),e.whole="true"==this.getNode(t,"whole").textContent,e.row=Number(this.getNode(t,"row").textContent),e.min=Number(this.getNode(t,"min").textContent),e.max=Number(this.getNode(t,"max").textContent),e.circles=Number(this.getNode(t,"circles").textContent),e.bezier1=this.parseBezierData(this.getNode(t,"bezier1")),e.bezier2=this.parseBezierData(this.getNode(t,"bezier2")),e},t.prototype.parseGradientsColor=function(t,i){i||(i=new y.ColorGradients);var e,a,r=0,n=0;for(r=0,n=t?t.length:0;r<n;r++)e=t[r],this.eachAttr(e,function(t,e){"time"==t?i.times.push(Number(e)):"color"==t&&(a=y.Color.createColor(Number(e)),i.colors.push(a))});var o=i.times.slice(),s=i.colors.slice();for(o.sort(function(t,e){return t-e}),r=0,n=i?i.times.length:0;r<n;r++){var h=o.indexOf(i.times[r]);i.colors[r]=s[h]}return i.times=o,i},t.prototype.parseBezierData=function(t){var e=new y.BezierData;if(null==t)return e;var i,a,r=this.getNodeList(t,"pos"),n=this.getNodeList(t,"ctrl"),o=0,s=0;for(o=0,s=r?r.length:0;o<s;o++)i=r[o],a=new y.Point,e.posPoints.push(a),this.eachAttr(i,function(t,e){"x"==t?a.x=Number(e):"y"==t&&(a.y=Number(e))});for(o=0,s=n?n.length:0;o<s;o++)i=n[o],a=new y.Point,e.ctrlPoints.push(a),this.eachAttr(i,function(t,e){"x"==t?a.x=Number(e):"y"==t&&(a.y=Number(e))});return e},t.prototype.parseVector3D=function(t,i){return null==i&&(i=new y.Vector3D),this.eachAttr(t,function(t,e){"x"==t?i.x=Number(e):"y"==t?i.y=Number(e):"z"==t&&(i.z=Number(e))}),i},t.prototype.getNode=function(t,e){if(null==t)return null;var i=t.getElementsByTagName(e);return null==i||0==i.length?null:i[0]},t.prototype.getNodeList=function(t,e){if(null==t)return null;var i=t.getElementsByTagName(e);return null==i||0==i.length?null:i},t.prototype.eachAttr=function(t,e){y.XMLParser.eachXmlAttr(t,e)},t}();y.ParticleXmlParser=t}(egret3d||(egret3d={})),function(L){var t=function(a){function t(t,e){void 0===e&&(e=null),a.call(this,null,e),this._isEmitterDirty=!0,this._userNodes=[],this.tag.name="effect",this.type="particleEmit",this._data=t,this._externalGeometry=t.property.geometry,this.animation=this.particleAnimation=new L.ParticleAnimation(this),this.animation.particleAnimationController=this.particleAnimation,this._particleState=this.particleAnimation.particleAnimationState,(this.particleAnimation.emit=this).buildParticle()}return __extends(t,a),Object.defineProperty(t.prototype,"drawOrder",{get:function(){return this._data.property.sortingFudge},enumerable:!0,configurable:!0}),t.prototype.addSubEmitter=function(t,e){e.animation.stop(),this._subEmitterNode.importSubEmitter(t,e)},t.prototype.buildParticle=function(){null==this._externalGeometry?this._geometryShape=this.createPlane():this._geometryShape=this._externalGeometry,this.initialize(),this.initBoudBox(this._data.property.bounds),this._isEmitterDirty=!1},t.prototype.createPlane=function(){var t=this._data.geometry,e=L.Vector3D.Z_AXIS;e=this._data.property.renderMode==L.ParticleRenderModeType.VerticalBillboard?L.Vector3D.Y_AXIS:this._data.property.renderMode==L.ParticleRenderModeType.HorizontalBillboard?L.Vector3D.Y_AXIS:L.Vector3D.Z_AXIS;var i=!0,a=!0;return this._data.property.renderMode==L.ParticleRenderModeType.StretchedBillboard&&(a=!(i=!1)),new L.PlaneGeometry(t.planeW,t.planeH,1,1,1,1,e,i,a)},Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeNode",{get:function(){return this._timeNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionNode",{get:function(){return this._positionNode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"followTarget",{get:function(){return this._particleState.followTarget},set:function(t){this._particleState.followTarget=t},enumerable:!0,configurable:!0}),t.prototype.addAnimNode=function(t){-1==this._userNodes.indexOf(t)&&(this._userNodes.push(t),this._isEmitterDirty=!0)},t.prototype.removeAnimNode=function(t){var e=this._userNodes.indexOf(t);-1!=e&&(this._userNodes.slice(e),this._isEmitterDirty=!0)},t.prototype.play=function(t){void 0===t&&(t=!1),t?this.animation.play("",1,!1,!0):this.animation.play("",1,!0,!1)},t.prototype.stop=function(){this.animation.stop()},t.prototype.initialize=function(){this.particleAnimation.particleAnimationState.clean();var t=this._data.property.particleCount;this.geometry=new L.Geometry,this.geometry.buildDefaultSubGeometry(),this.geometry.subGeometrys[0].count=t*this._geometryShape.indexData.length;var e=0,i=new Array;this.geometry.vertexFormat=L.VertexFormat.VF_POSITION|L.VertexFormat.VF_UV0|L.VertexFormat.VF_COLOR,this.initMainAnimNode(),this.initUserAnimNode(),this.initEndNode(),this.geometry.verticesData=new Array;for(var a=0;a<t;++a)for(var r=0;r<this._geometryShape.vertexCount;++r){for(var n=0;n<this.geometry.vertexAttLength;++n)this.geometry.verticesData.push(0);e=a*this._geometryShape.vertexCount+r,i.length=0,this._geometryShape.getVertexForIndex(r,this.geometry.vertexFormat,i);for(n=0;n<i.length;++n)this.geometry.verticesData[e*this.geometry.vertexAttLength+n]=i[n]}this.geometry.indexData=new Array;for(a=0;a<t;++a)for(r=0;r<this._geometryShape.indexData.length;++r)this.geometry.indexData[a*this._geometryShape.indexData.length+r]=this._geometryShape.indexData[r]+a*this._geometryShape.vertexCount;this.particleAnimation.particleAnimationState.fill(this.geometry,t)},t.prototype.initMainAnimNode=function(){var t=[];this._timeNode=new L.ParticleTime,this._timeNode.initNode(this._data.life),t.push(this._timeNode),this._positionNode=new L.ParticlePosition,this._positionNode.initNode(this._data.shape,this._data.property),t.push(this._positionNode);var e=new L.ParticleVelocityNode;e.initNode(this._data.moveSpeed),t.push(e),this._subEmitterNode=new L.ParticleSubEmitterNode,this._subEmitterNode.initNode(null,this),this.particleAnimation.particleAnimationState.addNode(this._subEmitterNode);var i=this._data.moveSpeed.velocityOver;if(i)if(i.type==L.ParticleValueType.Const||i.type==L.ParticleValueType.RandomConst){var a=new L.ParticleVelocityOverConstNode;a.initNode(this._data.moveSpeed),t.push(a)}else if(i.type==L.ParticleValueType.OneBezier){var r=new L.ParticleVelocityOverOneBezierNode;r.initNode(this._data.moveSpeed),t.push(r)}else if(i.type==L.ParticleValueType.TwoBezier){var n=new L.ParticleVelocityOverTwoBezierNode;n.initNode(this._data.moveSpeed),t.push(n)}var o=this._data.moveSpeed.velocityLimit;if(o)if(o.type==L.ParticleValueType.Const||o.type==L.ParticleValueType.RandomConst){var s=new L.ParticleVelocityLimitConstNode;s.initNode(this._data.moveSpeed),t.push(s)}else if(o.type==L.ParticleValueType.OneBezier){var h=new L.ParticleVelocityLimitOneBezierNode;h.initNode(this._data.moveSpeed),t.push(h)}else if(o.type==L.ParticleValueType.TwoBezier){var l=new L.ParticleVelocityLimitTwoBezierNode;l.initNode(this._data.moveSpeed),t.push(l)}var u=this._data.moveSpeed.velocityForce;if(u)if(u.type==L.ParticleValueType.Const||u.type==L.ParticleValueType.RandomConst){var c=new L.ParticleVelocityForceConstNode;c.initNode(this._data.moveSpeed),t.push(c)}else if(u.type==L.ParticleValueType.OneBezier){var d=new L.ParticleVelocityForceOneBezierNode;d.initNode(this._data.moveSpeed),t.push(d)}else if(u.type==L.ParticleValueType.TwoBezier){var p=new L.ParticleVelocityForceTwoBezierNode;p.initNode(this._data.moveSpeed),t.push(p)}var _=new L.ParticleRotation;_.initNode(this._data.rotationBirth),t.push(_);var f=new L.ParticleScale;f.initNode(this._data.scaleBirth),t.push(f);var m=new L.ParticleStartColor;if(m.initNode(this._data.property),t.push(m),this._data.followTarget){var g=new L.ParticleFollowNode;g.initNode(this._data.followTarget),t.push(g)}if(this._data.scaleBezier){var v=new L.ParticleSizeGlobalNode;v.initNode(this._data.scaleBezier),t.push(v)}if(this._data.rotationSpeed)if(this._data.rotationSpeed.type==L.ParticleValueType.Const||this._data.rotationSpeed.type==L.ParticleValueType.RandomConst){var y=new L.ParticleRotationConstNode;y.initNode(this._data.rotationSpeed),t.push(y)}else if(this._data.rotationSpeed.type==L.ParticleValueType.OneBezier){var x=new L.ParticleRotationOneBezierNode;x.initNode(this._data.rotationSpeed),t.push(x)}else if(this._data.rotationSpeed.type==L.ParticleValueType.TwoBezier){var D=new L.ParticleRotationTwoBezierNode;D.initNode(this._data.rotationSpeed),t.push(D)}if(this._data.colorOffset){var b=new L.ParticleColorGlobalNode;b.initNode(this._data.colorOffset),t.push(b)}if(this._data.materialData)for(var w,T=0,P=this._data.materialData.methods;T<P.length;T++)if((w=P[T]).type==L.MatMethodData.methodType.lightmapMethod);else if(w.type==L.MatMethodData.methodType.uvRollMethod){var S=new L.ParticleUVRollNode;S.initNode(null,w),t.push(S)}else w.type==L.MatMethodData.methodType.alphaMaskMethod||(w.type,L.MatMethodData.methodType.streamerMethod);if(this._data.textureSheet){var C=new L.ParticleTextureSheetNode;C.initNode(null,this._data.textureSheet),t.push(C)}for(var A=0,E=t.length;A<E;A++)this.particleAnimation.particleAnimationState.addNode(t[A])},t.prototype.initUserAnimNode=function(){for(var t=0;t<this._userNodes.length;t++)this.particleAnimation.particleAnimationState.addNode(this._userNodes[t])},t.prototype.initEndNode=function(){var t=new L.ParticleEndNode;this.particleAnimation.particleAnimationState.addNode(t),this.particleAnimation.particleAnimationState.calculate(this.geometry)},t.prototype.initBoudBox=function(t){var e=new L.BoundBox(this);e.fillBox(new L.Vector3D(-t.x/2,-t.y/2,-t.z/2),new L.Vector3D(t.x/2,t.y/2,t.z/2)),this.bound=e,this.initAABB()},Object.defineProperty(t.prototype,"loopProgress",{get:function(){return this.animation.animTime/(1e3*this._particleState.circleTime)},enumerable:!0,configurable:!0}),t.prototype.update=function(t,e,i){this._isEmitterDirty&&this.buildParticle(),a.prototype.update.call(this,t,e,i)},t}(L.Mesh);L.ParticleEmitter=t}(egret3d||(egret3d={})),function(o){var t=function(){function t(){this._root=new o.Object3D,this._tree=new o.TreeBase(this._root)}return Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quad",{get:function(){return this._quad},enumerable:!0,configurable:!0}),t.prototype.addChild3D=function(t){this._root.addChild(t)},t.prototype.removeChild3D=function(t){this._root.removeChild(t)},t.prototype.update=function(){},t.prototype.infrustumList=function(t){return this._tree.infrustumList(t)},t.prototype.createQuadTree=function(){this._quad=new o.QuadRoot(8,128);var t=new Array;this.collectQuadList(t,this.root),this._quad.createQuadTree(t)},t.prototype.collectQuadList=function(t,e){var i,a;if(t=t||new Array,e instanceof o.Mesh&&((i=e).aabb&&t.push(i)),e.childs&&0<e.childs.length)for(var r=0,n=e.childs;r<n.length;r++)a=n[r],this.collectQuadList(t,a);return t},t}();o.Scene3D=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(t){this._searchList=new Array,this._root=t}return t.prototype.infrustumList=function(t){return this._searchList.length=0,this._searchList},t}();t.TreeBase=e}(egret3d||(egret3d={})),function(e){var t=function(){function t(){this.useMipmap=!0,this.smooth=!0,this.repeat=!1,this.premultiply_alpha=0,this.filp_y=0,this.hasMipmap=!1,this.ready=!1}return t.prototype.upload=function(t){},t.prototype.uploadForcing=function(t){},t.prototype.activeState=function(t){this.ready||(this.ready=!0,this.premultiply_alpha||e.Context3DProxy.gl.pixelStorei(e.Context3DProxy.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this.useMipmap&&!this.hasMipmap&&(e.Context3DProxy.gl.generateMipmap(e.Context3DProxy.gl.TEXTURE_2D),this.hasMipmap=!0),this.smooth?(this.hasMipmap?t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MIN_FILTER,e.Context3DProxy.gl.LINEAR_MIPMAP_LINEAR):t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MIN_FILTER,e.Context3DProxy.gl.LINEAR),t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MAG_FILTER,e.Context3DProxy.gl.LINEAR)):(t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MIN_FILTER,e.Context3DProxy.gl.NEAREST),t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MAG_FILTER,e.Context3DProxy.gl.NEAREST)),this.repeat?(t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_S,e.Context3DProxy.gl.REPEAT),t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_T,e.Context3DProxy.gl.REPEAT)):(t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_S,e.Context3DProxy.gl.CLAMP_TO_EDGE),t.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_T,e.Context3DProxy.gl.CLAMP_TO_EDGE)),this.filp_y&&e.Context3DProxy.gl.pixelStorei(e.Context3DProxy.gl.UNPACK_FLIP_Y_WEBGL,this.filp_y))},t}();e.ITexture=t}(egret3d||(egret3d={})),function(i){var t=function(e){function t(t){e.call(this),this.imageData=t}return __extends(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return this.imageData.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.imageData.height},enumerable:!0,configurable:!0}),t.prototype.upload=function(t){this.texture2D||(this.texture2D=t.creatTexture2D(),this.texture2D.internalFormat=i.InternalFormat.ImageData,this.texture2D.imageData=this.imageData,this.texture2D.colorFormat=i.ContextConfig.ColorFormat_RGBA8888,t.upLoadTextureData(0,this))},t.prototype.uploadForcing=function(t){t.upLoadTextureData(0,this)},t}(i.ITexture);i.ImageTexture=t}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.upload=function(t){},e.prototype.uploadForcing=function(t){},e}(t.ITexture);t.PVRTexture=e}(egret3d||(egret3d={})),function(t){var e=function(t){function e(){t.call(this),this.smooth=!0}return __extends(e,t),e.prototype.upload=function(t){if(!this.texture2D)if(this.texture2D=t.creatTexture2D(),this.texture2D.internalFormat=this.internalFormat,this.texture2D.colorFormat=this.colorFormat,this.texture2D.mimapData=this.mimapData,this.mimapData&&0<this.mimapData.length)for(var e=0;e<this.mimapData.length;e++)t.upLoadTextureData(e,this);else t.upLoadTextureData(0,this)},e.prototype.uploadForcing=function(t){t.upLoadTextureData(0,this)},e}(t.ITexture);t.MimapTexture=e}(egret3d||(egret3d={})),function(p){var t=function(o){function d(t,e,i,a,r,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=null),o.call(this),this.image_front=t,this.image_back=e,this.image_left=i,this.image_right=a,this.image_up=r,this.image_down=n}return __extends(d,o),d.createCubeTexture=function(t,e,i,a,r,n){var o=new p.Texture2D;o.imageData=t;var s=new p.Texture2D;s.imageData=e;var h=new p.Texture2D;h.imageData=i;var l=new p.Texture2D;l.imageData=a;var u=new p.Texture2D;u.imageData=r;var c=new p.Texture2D;return c.imageData=n,new d(o,s,h,l,u,c)},d.setCubeTexture=function(t,e,i,a,r,n,o){t.image_front=e.texture2D,t.image_back=i.texture2D,t.image_left=a.texture2D,t.image_right=r.texture2D,t.image_up=n.texture2D,t.image_down=o.texture2D},d.prototype.upload=function(t){this.image_front&&this.image_back&&this.image_left&&this.image_right&&this.image_up&&this.image_down&&(this.texture3D||(this.texture3D=t.creatCubeTexture(),this.texture3D.border=0,this.texture3D.image_front=this.image_front,this.texture3D.image_back=this.image_back,this.texture3D.image_left=this.image_left,this.texture3D.image_right=this.image_right,this.texture3D.image_up=this.image_up,this.texture3D.image_down=this.image_down,t.uploadCubetexture(this.texture3D)))},d.prototype.uploadForcing=function(t){},d}(p.ITexture);p.CubeTexture=t}(egret3d||(egret3d={})),function(n){var t=function(t){function e(){t.call(this),this.width=32,this.height=32,this.buildCheckerboard()}return __extends(e,t),e.prototype.upload=function(t){this.texture2D||(this.texture2D=t.creatTexture2D(),this.texture2D.border=0,this.texture2D.internalFormat=n.InternalFormat.PixelArray,this.texture2D.colorFormat=n.Context3DProxy.gl.RGBA,this.texture2D.mimapData=new Array,this.texture2D.mimapData.push(new n.MipmapData(this._pixelArray,this.width,this.height)),this.useMipmap=!1,this.texture2D.dataFormat=n.Context3DProxy.gl.FLOAT,t.upLoadTextureData(0,this))},e.prototype.buildCheckerboard=function(){if(!this._pixelArray){this._pixelArray=new Float32Array(this.width*this.height*4);for(var t=[n.Color.black(),n.Color.white()],e=0,i=0;i<this.height;i++)for(var a=0;a<this.width;a++){if(a%4==0&&(e=(e+1)%2),i%4==0&&0==a){var r=t[0];t[0]=t[1],t[1]=r,e=0}this._pixelArray[i*(4*this.width)+4*a+0]=a*i/1024,this._pixelArray[i*(4*this.width)+4*a+1]=a*i/1024,this._pixelArray[i*(4*this.width)+4*a+2]=a*i/1024,this._pixelArray[i*(4*this.width)+4*a+3]=a*i/1024}}},e.prototype.uploadForcing=function(t){},e.texture=new e,e}(n.ITexture);n.CheckerboardTexture=t}(egret3d||(egret3d={})),function(e){var t=function(a){function t(t,e){var i=this;void 0===t&&(t=256),void 0===e&&(e=256),a.call(this),this.canUpdataTexture=!1,this.width=t,this.height=e,this.tmpCanvas=document.createElement("canvas"),this.tmpCanvas.width=t,this.tmpCanvas.height=e,this.context=this.tmpCanvas.getContext("2d"),this.video=document.createElement("video"),this.video.msZoom=!0,this.video.width=t,this.video.height=e,this.video.videoWidth=t,this.video.videoHeight=e,this.video.controls=!1,this.video.autoplay=!0,this.video.addEventListener("canplaythrough",function(){return i.loadReady()},!0),this.tmpCanvas.hidden=!0}return __extends(t,a),t.prototype.loadReady=function(){this.canUpdataTexture=!0},Object.defineProperty(t.prototype,"source",{get:function(){return this.video.src},set:function(t){this.video.src=t},enumerable:!0,configurable:!0}),t.prototype.play=function(){this.video.play()},t.prototype.pause=function(){this.video.pause()},t.prototype.upload=function(t){this.texture2D||(this.texture2D=t.creatTexture2D(),this.context.drawImage(this.video,0,0,this.width,this.height),e.Context3DProxy.gl.pixelStorei(e.Context3DProxy.gl.UNPACK_ALIGNMENT,1),e.Context3DProxy.gl.bindTexture(e.Context3DProxy.gl.TEXTURE_2D,this.texture2D.textureBuffer),e.Context3DProxy.gl.texImage2D(e.Context3DProxy.gl.TEXTURE_2D,0,e.Context3DProxy.gl.RGB,e.Context3DProxy.gl.RGB,e.Context3DProxy.gl.UNSIGNED_BYTE,this.tmpCanvas),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MIN_FILTER,e.Context3DProxy.gl.LINEAR),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MAG_FILTER,e.Context3DProxy.gl.LINEAR),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_S,e.Context3DProxy.gl.CLAMP_TO_EDGE),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_T,e.Context3DProxy.gl.CLAMP_TO_EDGE)),this.canUpdataTexture&&(this.context.drawImage(this.video,0,0,this.width,this.height),e.Context3DProxy.gl.pixelStorei(e.Context3DProxy.gl.UNPACK_ALIGNMENT,1),e.Context3DProxy.gl.bindTexture(e.Context3DProxy.gl.TEXTURE_2D,this.texture2D.textureBuffer),e.Context3DProxy.gl.texImage2D(e.Context3DProxy.gl.TEXTURE_2D,0,e.Context3DProxy.gl.RGB,e.Context3DProxy.gl.RGB,e.Context3DProxy.gl.UNSIGNED_BYTE,this.tmpCanvas),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MIN_FILTER,e.Context3DProxy.gl.LINEAR),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_MAG_FILTER,e.Context3DProxy.gl.LINEAR),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_S,e.Context3DProxy.gl.CLAMP_TO_EDGE),e.Context3DProxy.gl.texParameteri(e.Context3DProxy.gl.TEXTURE_2D,e.Context3DProxy.gl.TEXTURE_WRAP_T,e.Context3DProxy.gl.CLAMP_TO_EDGE))},t.prototype.uploadForcing=function(t){},t}(e.ITexture);e.VideoTexture=t}(egret3d||(egret3d={})),function(r){var t=function(a){function t(t,e,i){void 0===t&&(t=512),void 0===e&&(e=512),void 0===i&&(i=r.FrameBufferFormat.UNSIGNED_BYTE_RGB),a.call(this),this.frameBufferFormat=r.FrameBufferFormat.UNSIGNED_BYTE_RGB,this.useMipmap=!1,this.width=t,this.height=e,this.frameBufferFormat=i}return __extends(t,a),t.prototype.upload=function(t){this.texture2D||(this.texture2D=t.createFramebuffer(this.width,this.height,this.frameBufferFormat))},t.prototype.uploadForcing=function(t){},t}(r.ITexture);r.RenderTexture=t}(egret3d||(egret3d={})),function(t){var a=function(){function t(){}return t.LITTLE_ENDIAN="littleEndian",t.BIG_ENDIAN="bigEndian",t}();t.Endian=a;var e=function(){function r(t){this.BUFFER_EXT_SIZE=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=a.BIG_ENDIAN}return r.prototype._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},Object.defineProperty(r.prototype,"buffer",{get:function(){return this.data.buffer},set:function(t){this.data=new DataView(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dataView",{get:function(){return this.data},set:function(t){this.data=t,this.write_position=t.byteLength},enumerable:!0,configurable:!0}),r.prototype.uncompress=function(t){void 0===t&&(t="7z")},Object.defineProperty(r.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return this._position},set:function(t){this._position<t&&!this.validate(t-this._position)||(this._position=t,this.write_position=t>this.write_position?t:this.write_position)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this.write_position},set:function(t){this.validateBuffer(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),r.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},r.prototype.readBoolean=function(){return this.validate(r.SIZE_OF_BOOLEAN)?0!=this.data.getUint8(this.position++):null},r.prototype.readByte=function(){return this.validate(r.SIZE_OF_INT8)?this.data.getInt8(this.position++):null},r.prototype.readBytes=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),0==i)i=this.bytesAvailable;else if(!this.validate(i))return null;t?t.validateBuffer(i):t=new r(new ArrayBuffer(i));for(var a=0;a<i;a++)t.data.setUint8(a+e,this.data.getUint8(this.position++))},r.prototype.readDouble=function(){if(!this.validate(r.SIZE_OF_FLOAT64))return null;var t=this.data.getFloat64(this.position,this.endian==a.LITTLE_ENDIAN);return this.position+=r.SIZE_OF_FLOAT64,t},r.prototype.readFloat=function(){if(!this.validate(r.SIZE_OF_FLOAT32))return null;var t=this.data.getFloat32(this.position,this.endian==a.LITTLE_ENDIAN);return this.position+=r.SIZE_OF_FLOAT32,t},r.prototype.readInt=function(){if(!this.validate(r.SIZE_OF_INT32))return null;var t=this.data.getInt32(this.position,this.endian==a.LITTLE_ENDIAN);return this.position+=r.SIZE_OF_INT32,t},r.prototype.readShort=function(){if(!this.validate(r.SIZE_OF_INT16))return null;var t=this.data.getInt16(this.position,this.endian==a.LITTLE_ENDIAN);return this.position+=r.SIZE_OF_INT16,t},r.prototype.readUnsignedByte=function(){return this.validate(r.SIZE_OF_UINT8)?this.data.getUint8(this.position++):null},r.prototype.readUnsignedInt=function(){if(!this.validate(r.SIZE_OF_UINT32))return null;var t=this.data.getUint32(this.position,this.endian==a.LITTLE_ENDIAN);return this.position+=r.SIZE_OF_UINT32,t},r.prototype.readUnsignedShort=function(){if(!this.validate(r.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==a.LITTLE_ENDIAN);return this.position+=r.SIZE_OF_UINT16,t},r.prototype.readUTF=function(){if(!this.validate(r.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==a.LITTLE_ENDIAN);return this.position+=r.SIZE_OF_UINT16,0<t?this.readUTFBytes(t):""},r.prototype.readUTFBytes=function(t){if(!this.validate(t))return null;var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},r.prototype.readLine=function(){for(var t=0,e=this.position;e<this.length;++e)if(10==this.data.getUint8(e)){t=e-this.position+1;break}return this.readUTFBytes(t)},r.prototype.writeBoolean=function(t){this.validateBuffer(r.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,t?1:0)},r.prototype.writeByte=function(t){this.validateBuffer(r.SIZE_OF_INT8),this.data.setInt8(this.position++,t)},r.prototype.writeBytes=function(t,e,i){var a;if(void 0===e&&(e=0),void 0===i&&(i=0),!(e<0)&&!(i<0)&&0<(a=0==i?t.length-e:Math.min(t.length-e,i))){this.validateBuffer(a);for(var r=new DataView(t.buffer),n=e;n<a+e;n++)this.data.setUint8(this.position++,r.getUint8(n))}},r.prototype.writeDouble=function(t){this.validateBuffer(r.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==a.LITTLE_ENDIAN),this.position+=r.SIZE_OF_FLOAT64},r.prototype.writeFloat=function(t){this.validateBuffer(r.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,t,this.endian==a.LITTLE_ENDIAN),this.position+=r.SIZE_OF_FLOAT32},r.prototype.writeInt=function(t){this.validateBuffer(r.SIZE_OF_INT32),this.data.setInt32(this.position,t,this.endian==a.LITTLE_ENDIAN),this.position+=r.SIZE_OF_INT32},r.prototype.writeShort=function(t){this.validateBuffer(r.SIZE_OF_INT16),this.data.setInt16(this.position,t,this.endian==a.LITTLE_ENDIAN),this.position+=r.SIZE_OF_INT16},r.prototype.writeUnsignedInt=function(t){this.validateBuffer(r.SIZE_OF_UINT32),this.data.setUint32(this.position,t,this.endian==a.LITTLE_ENDIAN),this.position+=r.SIZE_OF_UINT32},r.prototype.writeUTF=function(t){var e=this.encodeUTF8(t),i=e.length;this.validateBuffer(r.SIZE_OF_UINT16+i),this.data.setUint16(this.position,i,this.endian===a.LITTLE_ENDIAN),this.position+=r.SIZE_OF_UINT16,this._writeUint8Array(e,!1)},r.prototype.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},r.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},r.prototype._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},r.prototype.validate=function(t){return 0<this.data.byteLength&&this._position+t<=this.data.byteLength||void 0},r.prototype.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),a=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,a)),this.buffer=i.buffer}},r.prototype.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),a=[];i.length>e;){var r=i[e++];if(this.inRange(r,55296,57343))this.encoderError(r);else if(this.inRange(r,0,127))a.push(r);else{var n,o;for(this.inRange(r,128,2047)?(n=1,o=192):this.inRange(r,2048,65535)?(n=2,o=224):this.inRange(r,65536,1114111)&&(n=3,o=240),a.push(this.div(r,Math.pow(64,n))+o);0<n;){var s=this.div(r,Math.pow(64,n-1));a.push(128+s%64),n-=1}}}return new Uint8Array(a)},r.prototype.decodeUTF8=function(t){for(var e,i=0,a="",r=0,n=0,o=0,s=0;t.length>i;){var h=t[i++];if(h===this.EOF_byte)e=0!==n?this.decoderError(!1):this.EOF_code_point;else if(0===n)this.inRange(h,0,127)?e=h:(this.inRange(h,194,223)?(n=1,s=128,r=h-192):this.inRange(h,224,239)?(n=2,s=2048,r=h-224):this.inRange(h,240,244)?(n=3,s=65536,r=h-240):this.decoderError(!1),r*=Math.pow(64,n),e=null);else if(this.inRange(h,128,191))if(o+=1,r+=(h-128)*Math.pow(64,n-o),o!==n)e=null;else{var l=r,u=s;s=o=n=r=0,e=this.inRange(l,u,1114111)&&!this.inRange(l,55296,57343)?l:this.decoderError(!1,h)}else s=o=n=r=0,i--,e=this.decoderError(!1,h);null!==e&&e!==this.EOF_code_point&&(e<=65535?0<e&&(a+=String.fromCharCode(e)):(e-=65536,a+=String.fromCharCode(55296+(e>>10&1023)),a+=String.fromCharCode(56320+(1023&e))))}return a},r.prototype.encoderError=function(t){},r.prototype.decoderError=function(t,e){return e||65533},r.prototype.inRange=function(t,e,i){return e<=t&&t<=i},r.prototype.div=function(t,e){return Math.floor(t/e)},r.prototype.stringToCodePoints=function(t){for(var e=[],i=0,a=t.length;i<t.length;){var r=t.charCodeAt(i);if(this.inRange(r,55296,57343))if(this.inRange(r,56320,57343))e.push(65533);else if(i===a-1)e.push(65533);else{var n=t.charCodeAt(i+1);if(this.inRange(n,56320,57343)){var o=1023&r,s=1023&n;i+=1,e.push(65536+(o<<10)+s)}else e.push(65533)}else e.push(r);i+=1}return e},r.SIZE_OF_BOOLEAN=1,r.SIZE_OF_INT8=1,r.SIZE_OF_INT16=2,r.SIZE_OF_INT32=4,r.SIZE_OF_UINT8=1,r.SIZE_OF_UINT16=2,r.SIZE_OF_UINT32=4,r.SIZE_OF_FLOAT32=4,r.SIZE_OF_FLOAT64=8,r}();t.ByteArray=e}(egret3d||(egret3d={})),function(t){var e=function(){function t(){this.isDebug=!1,this._console=document.createElement("console"),document.body.appendChild(this._console),this._console.style.color="red",this._console.style.zIndex="1000",this._console.style.position="absolute",this._console.style.top="10px",this._console.style.left="10px"}return t.prototype.trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(this.isDebug){this.reset();for(var i=t.length,a=0;a<i;a++)this._console.innerHTML+=t[a]+"</br>"}},t.prototype.reset=function(){this._console.innerHTML=""},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t._instance=null,t}();t.Debug=e}(egret3d||(egret3d={})),function(s){var t=function(){function l(){}return l.parseContent=function(t){for(var e=new Array,i="",a=";",r=0;r<t.length;++r)if("{"==t.charAt(r)&&(i.indexOf("=")<0&&(a="}")),(""!=i||" "!=t.charAt(r)&&"    "!=t.charAt(r)&&"\t"!=t.charAt(r))&&(i+=t.charAt(r),"\n"!=a&&0<=i.indexOf("#extension")&&(a="\n"),a==t.charAt(r))){if("}"==a){for(var n=0,o=0,s=0;s<i.length;++s)"{"==i.charAt(s)?n++:"}"==i.charAt(s)&&o++;if(n!=o)continue;if(0<=i.indexOf("struct")){a=";";continue}}0<i.length&&e.push(i),i="",a=";"}return e},l.parseLines=function(t){for(var e=new Array,i="",a=!1,r=0;r<t.length;++r)if(a){if(";"==t.charAt(r)){a=!1,0<i.length&&(e.push(i),i="");break}i+=t.charAt(r)}else if(" "!=t.charAt(r)&&"\t"!=t.charAt(r)&&","!=t.charAt(r)&&"\r"!=t.charAt(r)&&"\n"!=t.charAt(r)&&":"!=t.charAt(r)){if(";"==t.charAt(r)){0<i.length&&(e.push(i),i="");break}if("="==t.charAt(r)){0<i.length&&(e.push(i),i=""),e.push("="),a=!0;continue}i+=t.charAt(r),r==t.length-1&&""!=t&&(e.push(i),i="")}else""!=i&&(e.push(i),i="");return e},l.hasString=function(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1},l.getVarName=function(t){var e=this.hasString(t,"=");if(0<=e){if(0<=(e-=1)&&e<t.length)return t[e]}else if(0<=(e=t.length-1)&&e<t.length)return t[e];return""},l.getVarValue=function(t){var e=this.hasString(t,"=");return 0<=e&&(0<=(e+=1)&&e<t.length)?t[e]:""},l.getVarType=function(t){var e=this.hasString(t,"=");if(0<=e){if(0<=(e-=2)&&e<t.length)return t[e]}else if(0<=(e=t.length-2)&&e<t.length)return t[e];return""},l.getVarKey=function(t){var e=this.hasString(t,"=");if(0<=e){if(0<=(e-=3)&&e<t.length)return t[e]}else if(0<=(e=t.length-3)&&e<t.length)return t[e];return""},l.processShaderFile=function(t){var e;e=[];for(var i=t,a=i;;){var r=i.indexOf("//");if(r<0)break;var n=i.indexOf("\r\n",r);-1==n&&(n=i.indexOf("\n",r));var o=i.slice(r,n);if((i=i.replace(o,""))==a)break;a=i}for(var s=0;s<e.length;++s)for(;i!=(a=i.replace(e[s],""));)i=a;return i},l.colorRgb=function(t){var e=t.toLowerCase();if(e&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var i="#",a=1;a<4;a+=1)i+=e.slice(a,a+1).concat(e.slice(a,a+1));e=i}var r=[];for(a=1;a<7;a+=2)r.push(parseInt("0x"+e.slice(a,a+2)));return"RGB("+r.join(",")+")"}return e},l.getLineType=function(t){var e=t.indexOf("{");if(0<e){var i=t.substr(0,e);if(0<=i.indexOf("struct")){var a=i.lastIndexOf(" ");return a++,"struct "+i.substr(a,i.length-a)}if(i.indexOf("=")<0){var r=t.indexOf("(");a=t.lastIndexOf(" ",r);return a++,"function "+t.substr(a,r-a)}}return"unknown"},l.processStruct=function(t,e,i){var a=e.lastIndexOf("}");a++;for(var r=e.lastIndexOf(";"),n=e.substr(a,r-a),o=l.parseLines(n),s=0;s<o.length;++s){var h=l.getTemper(t+" "+o[s]+";");h&&i.addVar(h)}},l.getAttribute=function(t){var e,i,a,r=l.parseLines(t);return e=l.getVarName(r),i=l.getVarType(r),(a=new s.GLSL.Attribute(e,i)).value=l.getVarValue(r),a},l.getTemper=function(t){var e,i,a,r=l.parseLines(t);return e=l.getVarName(r),i=l.getVarType(r),(a=new s.GLSL.TmpVar(e,i)).value=l.getVarValue(r),a},l.getVarying=function(t){var e,i,a=l.parseLines(t);return e=l.getVarName(a),i=l.getVarType(a),new s.GLSL.Varying(e,i)},l.getUniform=function(t){var e,i,a=l.parseLines(t);return e=l.getVarName(a),i=l.getVarType(a),new s.GLSL.Uniform(e,i)},l.getConst=function(t){var e,i,a,r=l.parseLines(t);return e=l.getVarName(r),i=l.getVarType(r),a=l.getVarValue(r),new s.GLSL.ConstVar(e,i,a)},l.getExtension=function(t){var e=t.indexOf("#"),i=t.indexOf(" "),a=(t.substr(e,i),t.indexOf(":")),r=t.substr(i,a-i);r=l.replaceCharacter(r,[" "],""),a+=1;var n=t.substr(a,t.length-a);n=l.replaceCharacter(n,[" ",":","\n","\r"],"");var o=new s.GLSL.Extension(r);return o.value=n,o},l.getSampler2D=function(t){var e,i=l.parseLines(t);return e=l.getVarName(i),new s.GLSL.Sampler2D(e)},l.getSampler3D=function(t){var e,i=l.parseLines(t);return e=l.getVarName(i),new s.GLSL.Sampler3D(e)},l.filterCharacter=function(t){for(var e=t,i=e,a=0;a<l._filterChar.length;++a)for(;e!=(i=e.replace(l._filterChar[a],""));)e=i;return i},l.replaceCharacter=function(t,e,i){for(var a=t,r=!1;!r;){r=!0;for(var n=0;n<e.length;++n)if(0<=a.indexOf(e[n])){r=!1;break}for(n=0;n<e.length;++n)a=a.replace(e[n],i)}return a},l.getURLName=function(t){var e=t.split(".");return(e=e[0].split("/"))[e.length-1]},l._filterChar=[" ","  ",";","\n","\r","\t","\n","\r","\t"],l}();s.StringUtil=t}(egret3d||(egret3d={})),function(o){var t=function(n){function t(t){void 0===t&&(t=100),n.call(this),this._xMat=new o.ColorMaterial(16711680),this._xMat.ambientColor=15790320,this._yMat=new o.ColorMaterial(65280),this._yMat.ambientColor=15790320,this._zMat=new o.ColorMaterial(255),this._zMat.ambientColor=15790320;var e,i=t/100;e=new o.CubeGeometry(t,i,i),this._lineX=new o.Mesh(e,this._xMat),this.addChild(this._lineX),e=new o.CubeGeometry(i,t,i),this._lineY=new o.Mesh(e,this._yMat),this.addChild(this._lineY),e=new o.CubeGeometry(i,i,t),this._lineZ=new o.Mesh(e,this._zMat),this.addChild(this._lineZ);var a=t/25,r=(t-a)/2;e=new o.CubeGeometry(a,a,a),this._boxX=new o.Mesh(e,this._xMat),this._boxX.position=new o.Vector3D(r,0,0),this.addChild(this._boxX),this._boxY=new o.Mesh(e,this._yMat),this._boxY.position=new o.Vector3D(0,r,0),this.addChild(this._boxY),this._boxZ=new o.Mesh(e,this._zMat),this._boxZ.position=new o.Vector3D(0,0,r),this.addChild(this._boxZ)}return __extends(t,n),t}(o.Object3D);o.AxisMesh=t}(egret3d||(egret3d={})),function(e){var t=function(){function h(t){void 0===t&&(t=null),this.cameraAnimationFrames=[],this._playing=!1,this._playTime=0,this._currentFrameIndex=0,this._loop=!0,this._smooth=!0,this._cameraAnimationFrame=new i,this._event=new e.Event3D,this._quatCurrentFrame=new e.Quaternion,this._quatnNextFrame=new e.Quaternion,this._quatn=new e.Quaternion,this._camera=t,this._cameraAnimationFrame.fov=45,this._cameraAnimationFrame.rotation=new e.Vector3D,this._cameraAnimationFrame.translation=new e.Vector3D}return h.prototype.bindCamera=function(t){this._camera=t},h.prototype.play=function(t){this.cameraAnimationFrames.length<=0||(this._loop=t,this._playTime=0,this._camera.isController=!1,this._playing=!0)},h.prototype.stop=function(){this._camera.isController=!0,this._playing=!1},h.prototype.update=function(t,e){if(this._playing){this._playTime+=5*e;var i=this._playTime%(this.cameraAnimationFrames[this.cameraAnimationFrames.length-1].time-this.cameraAnimationFrames[0].time+160),a=Math.floor(i/160)%this.cameraAnimationFrames.length;this._currentFrameIndex>a&&(this._loop||(this._playing=!1,this._camera.isController=!0),this._camera&&(this._event.eventType=h.EVENT_CAMERA_COMPLETE,(this._event.target=this)._camera.dispatchEvent(this._event))),this._currentFrameIndex=a;var r=this.cameraAnimationFrames[a];if(this._smooth){var n=(a+1)%this.cameraAnimationFrames.length,o=this.cameraAnimationFrames[n],s=(i-r.time)/Math.abs(o.time-r.time);this._cameraAnimationFrame.fov=(o.fov-r.fov)*s+r.fov,this._quatCurrentFrame.fromEulerAngles(r.rotation.x,r.rotation.y,r.rotation.z),this._quatnNextFrame.fromEulerAngles(o.rotation.x,o.rotation.y,o.rotation.z),this._quatn.lerp(this._quatCurrentFrame,this._quatnNextFrame,s),this._quatn.toEulerAngles(this._cameraAnimationFrame.rotation),this._cameraAnimationFrame.translation.lerp(r.translation,o.translation,s)}else this._cameraAnimationFrame.fov=r.fov,this._cameraAnimationFrame.rotation.copyFrom(r.rotation),this._cameraAnimationFrame.translation.copyFrom(r.translation);this._camera.rotation=this._cameraAnimationFrame.rotation,this._camera.position=this._cameraAnimationFrame.translation}},h.EVENT_CAMERA_COMPLETE="event_camera_complete",h}();e.CameraAnimationController=t;var i=function(){};e.CameraAnimationFrame=i}(egret3d||(egret3d={})),function(t){var e=function(){function t(){this.cameras=new Array}return t.prototype.addCamera=function(t){this.cameras.push(t)},t.prototype.update=function(t,e){},t.instance=new t,t}();t.CameraManager=e}(egret3d||(egret3d={})),function(n){var t;(t=n.CameraType||(n.CameraType={}))[t.perspective=0]="perspective",t[t.orthogonal=1]="orthogonal",t[t.VR=2]="VR";var e,i=n.CameraType;(e=n.VRType||(n.VRType={}))[e.left=0]="left",e[e.right=1]="right";var a=n.VRType,r=function(r){function t(t){void 0===t&&(t=i.perspective),r.call(this),this.projectMatrix=new n.Matrix4_4,this.frustum=new n.Frustum,this.viewPort=new n.Rectangle,this._viewPort=new n.Rectangle,this._scissorRect=new n.Rectangle,this._aspectRatio=1,this._fovY=45,this._near=1,this._far=1e4,this.temp=new n.Matrix4_4,this._lookAtPosition=new n.Vector3D,this._up=new n.Vector3D(0,1,0),this._cameraType=0,this._cameraMatrixChange=!1,this._viewMatrix=new n.Matrix4_4,this._tempQuat=new n.Quaternion,this._normalMatrix=new n.Matrix4_4,this._unprojection=new n.Matrix4_4,this._animation=[],this.raw=new Float32Array(16),this.v=new n.Vector3D,this.p=new n.Vector3D,this.cameraType=t,n.CameraManager.instance.addCamera(this)}return __extends(t,r),Object.defineProperty(t.prototype,"cameraType",{set:function(t){switch(this._cameraType=t){case i.orthogonal:this.projectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far);break;case i.perspective:this.projectMatrix.perspective(this._fovY,this._aspectRatio,this._near,this._far);break;case i.VR:this.projectMatrix.perspective(this._fovY,1,this._near,this._far),this.eyeMatrix=this.eyeMatrix||new n.EyesMatrix}},enumerable:!0,configurable:!0}),t.prototype.tap=function(t,e){void 0===e&&(e=null),t==i.VR&&(this.eyeMatrix.update(this),e==a.left?this.viewMatrix.copyFrom(this.eyeMatrix.leftEyeMatrix):e==a.right&&this.viewMatrix.copyFrom(this.eyeMatrix.rightEyeMatrix),this.viewMatrix.invert())},Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this._aspectRatio},set:function(t){this._aspectRatio!=t&&(this._aspectRatio=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldOfView",{get:function(){return this._fovY},set:function(t){this._fovY!=t&&(this._fovY=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"near",{get:function(){return this._near},set:function(t){this._near!=t&&(this._near=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"far",{get:function(){return this._far},set:function(t){this._far!=t&&(this._far=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewProjectionMatrix",{get:function(){return this.temp.copyFrom(this.viewMatrix),this.temp.multiply(this.projectMatrix),this.temp},enumerable:!0,configurable:!0}),t.prototype.updateScissorRect=function(t,e,i,a){this._scissorRect.x=t,this._scissorRect.y=e,this._scissorRect.width=i,this._scissorRect.height=a},t.prototype.updateViewport=function(t,e,i,a){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=a},t.prototype.lookAt=function(t,e,i){void 0===i&&(i=n.Vector3D.Y_AXIS),this.position=t,this._lookAtPosition.copyFrom(e),this._up.copyFrom(i),this._viewMatrix.lookAt(this._pos,this._lookAtPosition,this._up),this._viewMatrix.invert();var a=this._viewMatrix.decompose(n.Orientation3D.QUATERNION);this._tempQuat.x=a[1].x,this._tempQuat.y=a[1].y,this._tempQuat.z=a[1].z,this._tempQuat.w=a[1].w,this.orientation=this._tempQuat},t.prototype.onUpdateTransform=function(){this._viewMatrix.copyFrom(this._modelMatrix3D),this._viewMatrix.invert()},Object.defineProperty(t.prototype,"viewMatrix",{get:function(){return this._transformChange&&this.modelMatrix,this._viewMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},enumerable:!0,configurable:!0}),t.prototype.updataOrth=function(){var t,e,i,a,r=1e3*this._aspectRatio;if(0==this._scissorRect.x&&0==this._scissorRect.y&&this._scissorRect.width==this._viewPort.width&&this._scissorRect.height==this._viewPort.height)t=-r,e=r,i=-1e3,a=1e3,this.raw[0]=2/(2e3*this._aspectRatio),this.raw[5]=.001,this.raw[10]=1/(this._far-this._near),this.raw[14]=this._near/(this._near-this._far),this.raw[1]=this.raw[2]=this.raw[3]=this.raw[4]=this.raw[6]=this.raw[7]=this.raw[8]=this.raw[9]=this.raw[11]=this.raw[12]=this.raw[13]=0,this.raw[15]=1;else{var n=r*(this._viewPort.width/this._scissorRect.width),o=this._viewPort.height/this._scissorRect.height*1e3,s=r*(2*this._scissorRect.x-this._viewPort.width)/this._scissorRect.width+r,h=-1e3*(2*this._scissorRect.y-this._viewPort.height)/this._scissorRect.height-1e3;t=s-n,e=s+n,i=h-o,a=h+o,this.raw[0]=2/(e-t),this.raw[5]=-2/(i-a),this.raw[10]=1/(this._far-this._near),this.raw[12]=(e+t)/(e-t),this.raw[13]=(a+i)/(a-i),this.raw[14]=this._near/(this.near-this.far),this.raw[1]=this.raw[2]=this.raw[3]=this.raw[4]=this.raw[6]=this.raw[7]=this.raw[8]=this.raw[9]=this.raw[11]=0,this.raw[15]=1}this.projectMatrix.copyRawDataFrom(this.raw)},t.prototype.isVisibleToCamera=function(t){return t.modelMatrix,t.bound.inBound(this.frustum)},t.prototype.addAnimation=function(t,e){this._animation[t]=e},t.prototype.play=function(t,e){void 0===e&&(e=!1),this._animation[t]&&(this._animation[t].bindCamera(this),this._animation[t].play(e))},t.prototype.update=function(t,e,i){for(var a in r.prototype.update.call(this,t,e,i),this._animation)this._animation[a].update(t,e)},t.prototype.object3DToScreenRay=function(t,e){return void 0===e&&(e=null),e||(e=new n.Vector3D),this._halfw=.5*this.viewPort.width,this._halfh=.5*this.viewPort.height,e=this.viewMatrix.transformVector(t,e),this.project(e,e),e.x=this._halfw+e.x*this._halfw,e.y=this.viewPort.height-(this._halfh-e.y*this._halfh),e},t.prototype.ScreenRayToObject3D=function(t,e){return void 0===e&&(e=null),e||(e=new n.Vector3D),this._halfw=.5*this.viewPort.width,this._halfh=.5*this.viewPort.height,e.x=(t.x-this._halfw)/this._halfw,e.y=(this._halfh-(this.viewPort.height-t.y))/this._halfh,this.unproject(e.x,e.y,t.z,e),this.modelMatrix.transformVector(e,e),e},t.prototype.unproject=function(t,e,i,a){return a.x=t,a.y=-e,a.z=i,a.w=1,a.x*=i,a.y*=i,this._unprojection.copyFrom(this.projectMatrix),this._unprojection.invert(),this._unprojection.transformVector(a,a),a.z=i,a},t.prototype.project=function(t,e){return(e=this.projectMatrix.transformVector(t,e)).x=e.x/e.w,e.y=-e.y/e.w,e.z=t.z,e},t.prototype.onMakeTransform=function(){n.MathUtil.CALCULATION_VECTOR3D.x=1,n.MathUtil.CALCULATION_VECTOR3D.y=1,n.MathUtil.CALCULATION_VECTOR3D.z=1,this._modelMatrix3D.makeTransform(this._globalPos,n.MathUtil.CALCULATION_VECTOR3D,this._globalOrientation)},t}(n.Object3D);n.Camera3D=r}(egret3d||(egret3d={})),function(t){var e=function(){function r(){this.minPosX=0,this.minPosY=0,this.maxPosX=0,this.maxPosY=0,this.testID=0,this.points=new Array,this.offsetPosition=new t.Vector3D(0,0,0,0),this.clear()}return r.prototype.setAABox=function(t,e,i,a){this.minPosX=t-i/2-r.TINY,this.maxPosX=t+i/2+r.TINY,this.minPosY=e-a/2-r.TINY,this.maxPosY=e+a/2+r.TINY,this.offsetPosition.setTo(0,0,0)},r.prototype.setOffset=function(t){this.maxPosX+=t.x-this.offsetPosition.x,this.minPosX+=t.x-this.offsetPosition.x,this.minPosY+=t.z-this.offsetPosition.z,this.maxPosY+=t.z-this.offsetPosition.z,this.offsetPosition.copyFrom(t)},r.prototype.setContainRect=function(t,e,i,a){this.minPosX>t&&(this.minPosX=t),this.minPosY>e&&(this.minPosY=e),this.maxPosX<i&&(this.maxPosX=i),this.maxPosY<a&&(this.maxPosY=a)},r.prototype.clear=function(){this.minPosX=this.minPosY=1e9,this.maxPosX=this.maxPosY=-1e9,this.points.length=0,this.testID=0,this.offsetPosition.setTo(0,0,0)},r.prototype.addPoint=function(t){-1==this.points.indexOf(t)&&(t.x<this.minPosX&&(this.minPosX=t.x-r.TINY),t.x>this.maxPosX&&(this.maxPosX=t.x+r.TINY),t.z<this.minPosY&&(this.minPosY=t.z-r.TINY),t.z>this.maxPosY&&(this.maxPosY=t.z+r.TINY),this.points.push(t))},r.prototype.clone=function(){var t=new r;return t.minPosX=this.minPosX,t.minPosY=this.minPosY,t.maxPosX=this.maxPosX,t.maxPosY=this.maxPosY,t},Object.defineProperty(r.prototype,"radius",{get:function(){return Math.sqrt((this.maxPosY-this.minPosY)*(this.maxPosY-this.minPosY)+(this.maxPosX-this.minPosX)*(this.maxPosX-this.minPosX))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sideX",{get:function(){return this.maxPosX-this.minPosX},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sideY",{get:function(){return this.maxPosY-this.minPosY},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"centreX",{get:function(){return.5*(this.maxPosX-this.minPosX)+this.minPosX},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"centreY",{get:function(){return.5*(this.maxPosY-this.minPosY)+this.minPosY},enumerable:!0,configurable:!0}),r.prototype.overlapTest=function(t){return!(this.minPosY>=t.maxPosY||this.maxPosY<=t.minPosY||this.minPosX>=t.maxPosX||this.maxPosX<=t.minPosX)},r.prototype.isPointInside=function(t){return t.x>=this.minPosX&&t.x<=this.maxPosX&&t.z>=this.minPosY&&t.z<=this.maxPosY},r.prototype.isIntersectLineSegment=function(t,e,i,a){var r=!1,n=e-a,o=i-t,s=t*a-i*e,h=(-s-n*this.minPosX)/o;h<=this.maxPosY&&h>=this.minPosY&&(r=!0),(h=(-s-n*this.maxPosX)/o)<=this.maxPosY&&h>=this.minPosY&&(r=!0);var l=(-s-o*this.minPosY)/n;return l<=this.maxPosX&&l>=this.minPosX&&(r=!0),(l=(-s-o*this.maxPosY)/n)<=this.maxPosX&&l>=this.minPosX&&(r=!0),r},r.TINY=1e-6,r}();t.QuadAABB=e}(egret3d||(egret3d={})),function(f){var t=function(){function t(){this.logDeep=0,this._testID=0,this._cells=new Array,this._quadNodes=new Array,this._cellsToTest=new Array,this._aabb=new f.QuadAABB}return t.prototype.getQuadNode=function(t){return this._quadNodes[t]},t.prototype.clear=function(){this._cells.length=0,this._quadNodes.length=0},t.prototype.initNodes=function(t){this.clear();for(var e=0,i=t.length;e<i;)this._quadNodes.push(t[e]),e++},t.prototype.buildQuadTree=function(t,e){this._aabb.clear();for(var i=0,a=this._quadNodes;i<a.length;i++){var r=a[i];if(r.isTriangle)for(var n=0,o=r.aabb.points;n<o.length;n++){var s=o[n];this._aabb.addPoint(s)}else this._aabb.setContainRect(r.aabb.minPosX,r.aabb.minPosY,r.aabb.maxPosX,r.aabb.maxPosY)}this._cells.length=0,this._rootCell=new f.QuadTreeCell(this._aabb),this._cells.push(this._rootCell);for(var h=this._quadNodes.length,l=0;l<h;l++)this._cells[0].nodeIndices[l]=l;var u,c,d,p=new Array;for(p.push(0);0!=p.length;)if(c=p.pop(),!(this._cells[c].nodeIndices.length<=t||this._cells[c].aabb.radius<e)){for(l=0;l<f.QuadTreeCell.NUM_CHILDREN;l++){this._cells[c].childCellIndices[l]=this._cells.length,p.push(this._cells.length),this._cells.push(new f.QuadTreeCell(this.createAABox(this._cells[c].aabb,l))),d=this._cells[this._cells.length-1],h=this._cells[c].nodeIndices.length;for(var _=0;_<h;_++)u=this._cells[c].nodeIndices[_],this.doesNodeIntersectCell(this._quadNodes[u],d)&&(0,d.nodeIndices.push(u))}this._cells[c].nodeIndices.length=0}},t.prototype.createAABox=function(t,e){var i=t.centreX,a=t.centreY,r=t.sideX,n=t.sideY,o=new f.QuadAABB;switch(e){case 0:o.setAABox(i+r/4,a+n/4,r/2,n/2);break;case 1:o.setAABox(i-r/4,a+n/4,r/2,n/2);break;case 2:o.setAABox(i-r/4,a-n/4,r/2,n/2);break;case 3:o.setAABox(i+r/4,a-n/4,r/2,n/2);break;default:o.setAABox(i+r/4,a-n/4,r/2,n/2)}return o},t.prototype.doesNodeIntersectCell=function(t,e){var i=t.aabb;if(!i.overlapTest(e.aabb))return!1;if(!t.isTriangle)return!0;var a=i.points,r=a[0],n=a[1],o=a[2];if(e.aabb.isPointInside(r)||e.aabb.isPointInside(n)||e.aabb.isPointInside(o))return!0;var s=this.pointInTriangle(e.aabb.minPosX,e.aabb.minPosY,r,n,o)||this.pointInTriangle(e.aabb.minPosX,e.aabb.maxPosY,r,n,o)||this.pointInTriangle(e.aabb.maxPosX,e.aabb.maxPosY,r,n,o)||this.pointInTriangle(e.aabb.maxPosX,e.aabb.minPosY,r,n,o);return!!s||(s=e.aabb.isIntersectLineSegment(r.x,r.z,n.x,n.z)||e.aabb.isIntersectLineSegment(r.x,r.z,o.x,o.z)||e.aabb.isIntersectLineSegment(n.x,n.z,o.x,o.z))},t.prototype.getNodesIntersectingtAABox=function(t,e){if(0==this._cells.length)return 0;this._cellsToTest.length=0,this._cellsToTest.push(0),this.incrementTestCounter();for(var i,a,r,n,o=0;0!=this._cellsToTest.length;)if(i=this._cellsToTest.pop(),r=this._cells[i],e.overlapTest(r.aabb))if(r.isLeaf())for(a=r.nodeIndices.length,o=0;o<a;o++)(n=this.getQuadNode(r.nodeIndices[o]).aabb).testID!=this._testID&&(n.testID=this._testID,e.overlapTest(n)&&t.push(r.nodeIndices[o]));else for(o=0;o<f.QuadTreeCell.NUM_CHILDREN;o++)this._cellsToTest.push(r.childCellIndices[o]);return t.length},t.prototype.pointInTriangle=function(t,e,i,a,r){var n=i,o=a,s=r,h=!1,l=(n.z-o.z)*t+(o.x-n.x)*e+(n.x*o.z-o.x*n.z),u=(o.z-s.z)*t+(s.x-o.x)*e+(o.x*s.z-s.x*o.z),c=(s.z-n.z)*t+(n.x-s.x)*e+(s.x*n.z-n.x*s.z);return(-.01<=l&&-.01<=u&&-.01<=c||l<=.01&&u<=.01&&c<=.01)&&(h=!0),h},t.prototype.incrementTestCounter=function(){if(++this._testID,0==this._testID){for(var t=this._quadNodes.length,e=0;e<t;e++)this._quadNodes[e].aabb.testID=0;this._testID=1}},t.prototype.logTree=function(t){if(!(t<0)){this.logDeep++;for(var e=this._cells[t],i="",a=0;a<this.logDeep-1;a++)i+="-|";var r;for(console.log(i+"i="+t+" "+e.aabb.minPosX.toFixed(2)+" "+e.aabb.maxPosX.toFixed(2)+" "+e.aabb.minPosY.toFixed(2)+" "+e.aabb.maxPosY.toFixed(2)),r=0;r<e.nodeIndices.length;r++)if(0<=e.nodeIndices[r]){var n=this._quadNodes[e.nodeIndices[r]];console.log(i+" t="+e.nodeIndices[r]+" "+n.aabb.minPosX.toFixed(2)+" "+n.aabb.maxPosX.toFixed(2)+" "+n.aabb.minPosY.toFixed(2)+" "+n.aabb.maxPosY.toFixed(2))}for(r=0;r<e.childCellIndices.length;r++)0<=e.childCellIndices[r]&&this.logTree(e.childCellIndices[r]);this.logDeep--}},t}();f.QuadTree=t}(egret3d||(egret3d={})),function(l){var t=function(){function t(t,e){void 0===t&&(t=10),void 0===e&&(e=500),this._maxNodesPerCell=t,this._minCellSize=e,this._segBox=new l.QuadAABB,this._collisionNodesIdx=new Array,this._collisionNodes=new Array}return t.prototype.createQuadTree=function(t){this._quadTree=new l.QuadTree,this._quadTree.initNodes(t),this._quadTree.buildQuadTree(this._maxNodesPerCell,this._minCellSize)},t.prototype.getNodesByAABB=function(t,e,i,a){this._segBox.clear(),this._segBox.maxPosX=i,this._segBox.maxPosY=a,this._segBox.minPosX=t,this._segBox.minPosY=e,this._collisionNodesIdx.length=0,this._collisionNodes.length=0;for(var r,n=(this._quadTree.getNodesIntersectingtAABox(this._collisionNodesIdx,this._segBox),0);n<this._collisionNodesIdx.length;n++)r=this._quadTree.getQuadNode(this._collisionNodesIdx[n]),this._collisionNodes.push(r);return this._collisionNodes},t.prototype.getTriangleAtPoint=function(t,e){void 0===e&&(e=5),this._segBox.clear(),this._segBox.setAABox(t.x,t.z,1,1),this._collisionNodesIdx.length=0,this._collisionNodes.length=0;for(var i,a,r,n,o=(this._quadTree.getNodesIntersectingtAABox(this._collisionNodesIdx,this._segBox),Number.MAX_VALUE),s=0,h=0;h<this._collisionNodesIdx.length;h++)n=(a=this._quadTree.getQuadNode(this._collisionNodesIdx[h])).aabb,l.Navi3DTriangle.pointInsideTriangle(t,n.points[0],n.points[1],n.points[2])&&(r=a,e<(s=Math.abs(r.plane.distance(t)))||(null==a||s<=o)&&(i=r,o=s));return i},t}();l.QuadRoot=t}(egret3d||(egret3d={})),function(i){var t=function(){function e(t){this.childCellIndices=new Array,this.childCellIndices.length=e.NUM_CHILDREN,this.nodeIndices=new Array,this.clear(),this.aabb=t?t.clone():new i.QuadAABB}return e.prototype.isLeaf=function(){return-1==this.childCellIndices[0]},e.prototype.clear=function(){for(var t=0;t<e.NUM_CHILDREN;t++)this.childCellIndices[t]=-1;this.nodeIndices.splice(0,this.nodeIndices.length)},e.NUM_CHILDREN=4,e}();i.QuadTreeCell=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){this._keys=new Array,this._values=new Array}return t.prototype.getIndexByKey=function(t){return this._keys.indexOf(t)},t.prototype.getValueByKey=function(t){var e=this.getIndexByKey(t);return-1<e?this._values[e]:null},t.prototype.put=function(t,e){if(null==t)return null;var i=this.remove(t);return this._keys.push(t),this._values.push(e),i},t.prototype.remove=function(t){var e,i=this._keys.indexOf(t);return-1<i&&(e=this._values[i],this._keys.splice(i,1),this._values.splice(i,1)),e},t.prototype.getValues=function(){return this._values},t.prototype.getKeys=function(){return this._keys},t.prototype.clear=function(){this._values.length=0,this._keys.length=0},t}();t.DoubleArray=e}(egret3d||(egret3d={})),function(h){var t=function(){function t(){this._findIndex=0,this._openedList=new Array,this._closedList=new Array}return t.prototype.findPath=function(t,e,i){return this._findIndex++,this._navMesh=t,this._startNode=e,this._endNode=i,this._openedList.length=0,this._closedList.length=0,!(!this._startNode||!this._endNode)&&(this._startNode.g=0,this._startNode.h=0,this._startNode.f=0,this._startNode.parent=null,this.search())},t.prototype.search=function(){for(var t,e=this._startNode,i=new Array;e!=this._endNode;){for(var a=0,r=i=e.getNeibourTriangles(i,h.Navi3DMaskType.WalkAble,h.Navi3DMaskType.WalkAble);a<r.length;a++)if((t=r[a]).closeId!=this._findIndex&&t!=e&&t.walkAble){var n=e.g+h.Navi3DPoint.calcDistance(t,e)*t.costMultiplier,o=h.Navi3DPoint.calcDistance(t,this._endNode),s=n+o;t.openId==this._findIndex?t.f>s&&(t.f=s,t.g=n,t.h=o,t.parent=e):(t.f=s,t.g=n,t.h=o,t.parent=e,t.openId=this._findIndex,this._openedList.push(t))}if(e.closeId=this._findIndex,this._closedList.push(e),0==this._openedList.length)return!1;this._openedList.sort(function(t,e){return t.f-e.f}),e=this._openedList.shift()}return this.buildPath(),!0},t.prototype.buildPath=function(){this._triangleChannel=[];var t=this._endNode;for(this._triangleChannel.push(t);t!=this._startNode;)t=t.parent,this._triangleChannel.unshift(t)},Object.defineProperty(t.prototype,"channel",{get:function(){return this._triangleChannel},enumerable:!0,configurable:!0}),t}();h.Navi3DAstar=t}(egret3d||(egret3d={})),function(i){var t=function(){function e(t,e){if(this._edgeMask=0,this._edgeSize=0,this._pointA=t,this._pointB=e,t.id>=e.id)throw new Error("edge point order error!!!");this._triangleOwners=new Array,this._centerPoint=new i.Vector3D,this._edgeMask=i.Navi3DMaskType.WalkAble,i.Navi3DPoint.CALC_VECTOR3D1.setTo(t.x-e.x,t.y-e.y,t.z-e.z),this._edgeSize=i.Navi3DPoint.CALC_VECTOR3D1.length,this._centerPoint.setTo((t.x+e.x)/2,(t.y+e.y)/2,(t.z+e.z)/2)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._edgeSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleOwners",{get:function(){return this._triangleOwners},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerPoint",{get:function(){return this._centerPoint},enumerable:!0,configurable:!0}),e.prototype.initFatPoints=function(t){this._edgeDirA2B=this._pointB.subtract(this._pointA),this._edgeDirA2B.normalize(),this.fatPointA=this.fatPointA||new i.Navi3DPointFat(this._pointA,this),this.fatPointB=this.fatPointB||new i.Navi3DPointFat(this._pointB,this),this.fatPointA.radius!=t&&(e.CALC_FAT_VECTOR.copyFrom(this._edgeDirA2B),e.CALC_FAT_VECTOR.scaleBy(t),e.CALC_FAT_VECTOR.incrementBy(this._pointA),this.fatPointA.copyFrom(e.CALC_FAT_VECTOR),this.fatPointA.radius=t),this.fatPointB.radius!=t&&(e.CALC_FAT_VECTOR.copyFrom(this._edgeDirA2B),e.CALC_FAT_VECTOR.scaleBy(-t),e.CALC_FAT_VECTOR.incrementBy(this._pointB),this.fatPointB.copyFrom(e.CALC_FAT_VECTOR),this.fatPointB.radius=t)},e.prototype.getFatPoint=function(t){return t==this._pointA?this.fatPointA:this.fatPointB},e.prototype.getAnotherFatPoint=function(t){return t==this._pointA?this.fatPointB:this.fatPointA},e.prototype.getAnotherPoint=function(t){return t==this._pointA?this._pointB:this._pointA},e.prototype.containsPoint=function(t){return i.Navi3DPoint.equalPoint(t,this._pointA)?this._pointA:i.Navi3DPoint.equalPoint(t,this._pointB)?this._pointB:null},e.prototype.addTriangleOwners=function(t){if(-1==t.edges.indexOf(this))throw new Error("the edge is not belong triangle!!!");-1==this._triangleOwners.indexOf(t)&&this._triangleOwners.push(t)},e.prototype.getPublicPoint=function(t){return this._pointA==t._pointA||this._pointA==t._pointB?this._pointA:this._pointB==t._pointA||this._pointB==t._pointB?this._pointB:null},e.prototype.getEqualPoint=function(t){return i.Navi3DPoint.equalPoint(t,this._pointA)?this._pointA:i.Navi3DPoint.equalPoint(t,this._pointB)?this._pointB:null},Object.defineProperty(e.prototype,"pointA",{get:function(){return this._pointA},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointB",{get:function(){return this._pointB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"walkAble",{get:function(){return(this._edgeMask&i.Navi3DMaskType.WalkAble)==i.Navi3DMaskType.WalkAble},enumerable:!0,configurable:!0}),e.prototype.testMask=function(t){return(this._edgeMask&t)==t},e.CALC_FAT_VECTOR=new i.Vector3D,e}();i.Navi3DEdge=t}(egret3d||(egret3d={})),function(t){var e=function(){function t(){}return t.WalkAble=1,t}();t.Navi3DMaskType=e}(egret3d||(egret3d={})),function(t){var e=function(){function e(){}return e.prototype.setTo=function(t,e){this.x=t,this.y=e},e.prototype.equals=function(t,e){return t==this.x&&e==this.y},e.prototype.equalPoint=function(t){return this.equals(t.x,t.y)},Object.defineProperty(e.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e;return t.setTo(this.x,this.y),t},e.prototype.normalize=function(){var t=length;0!=t&&this.setTo(this.x/t,this.y/t)},e}();t.Navi3DPoint2D=e}(egret3d||(egret3d={})),function(a){var t=function(r){function i(t,e,i,a){r.call(this,e,i,a,0),this._pointId=0,this._pointId=t}return __extends(i,r),Object.defineProperty(i.prototype,"id",{get:function(){return this._pointId},enumerable:!0,configurable:!0}),i.equalPoint=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z)<a.Navi3DFunnel.POWER_EPSILON},i.calcDistance=function(t,e){return i.CALC_VECTOR3D3.setTo(t.x-e.x,t.y-e.y,t.z-e.z),i.CALC_VECTOR3D3.length},i.CALC_VECTOR3D1=new a.Vector3D,i.CALC_VECTOR3D2=new a.Vector3D,i.CALC_VECTOR3D3=new a.Vector3D,i.CALC_VECTOR3D4=new a.Vector3D,i.CALC_VECTOR3D5=new a.Vector3D,i}(a.Vector3D);a.Navi3DPoint=t}(egret3d||(egret3d={})),function(t){var e=function(i){function a(t,e){i.call(this,t.id,0,0,0),this.radius=0,this._ownerEdge=e,this._ownerPoint=t}return __extends(a,i),Object.defineProperty(a.prototype,"ownerPoint",{get:function(){return this._ownerPoint},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ownerEdge",{get:function(){return this._ownerEdge},enumerable:!0,configurable:!0}),a.prototype.scalePoint=function(t){void 0===t&&(t=.7);var e=new a(this._ownerPoint,this._ownerEdge);return e.copyFrom(this),e.decrementBy(this._ownerPoint),e.scaleBy(t),e.radius=e.length,e.incrementBy(this._ownerPoint),e},a}(t.Navi3DPoint);t.Navi3DPointFat=e}(egret3d||(egret3d={})),function(h){var t=function(s){function r(t,e,i,a){s.call(this,0,0,0,0),this._id=0,this._points=new Array,this._edges=new Array,this._neibourTriangles=new h.DoubleArray,this._pointAgainstEdge=new h.DoubleArray,this._edgeAgainstPoint=new h.DoubleArray,this._mask=0,this.f=0,this.g=0,this.h=0,this.costMultiplier=1,this.openId=0,this.closeId=0,this._id=t,this._mask=h.Navi3DMaskType.WalkAble,this._edges.push(e,i,a);for(var r,n=0,o=this._edges;n<o.length;n++)r=o[n],-1==this._points.indexOf(r.pointA)&&this._points.push(r.pointA),-1==this._points.indexOf(r.pointB)&&this._points.push(r.pointB);this.x=(this._points[0].x+this._points[1].x+this._points[2].x)/3,this.y=(this._points[0].y+this._points[1].y+this._points[2].y)/3,this.z=(this._points[0].z+this._points[1].z+this._points[2].z)/3,this._plane=new h.Plane3D,this._plane.fromPoints(this._points[0],this._points[1],this._points[2]),this._plane.normalize(),this.genarateAgainstData(),this.initAABB()}return __extends(r,s),Object.defineProperty(r.prototype,"aabb",{get:function(){return this._aabbBox},enumerable:!0,configurable:!0}),r.prototype.initAABB=function(){this._aabbBox=new h.QuadAABB,this._aabbBox.addPoint(this._points[0]),this._aabbBox.addPoint(this._points[1]),this._aabbBox.addPoint(this._points[2])},Object.defineProperty(r.prototype,"isTriangle",{get:function(){return!0},enumerable:!0,configurable:!0}),r.prototype.genarateAgainstData=function(){for(var t,e,i=0,a=this._edges;i<a.length;i++){t=a[i];for(var r=0,n=this._points;r<n.length;r++)e=n[r],t.pointA!=e&&t.pointB!=e&&(this._edgeAgainstPoint.put(t,e),this._pointAgainstEdge.put(e,t))}},Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"plane",{get:function(){return this._plane},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),r.prototype.addNeibour=function(t,e){if(!(0<=this._edges.indexOf(t)))throw new Error("the edge is not in triangle!!!");this._neibourTriangles.put(t,e)},r.prototype.getNeibourTriangles=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=1),void 0===i&&(i=1);for(var a,r,n=(t=t||new Array).length=0,o=this._neibourTriangles.getKeys();n<o.length;n++)(r=o[n]).testMask(e)&&((a=this._neibourTriangles.getValueByKey(r)).testMask(i)&&t.push(a));return t},r.prototype.getEdges=function(t,e){void 0===t&&(t=null),void 0===e&&(e=1);for(var i,a=(t=t||new Array).length=0,r=this._edges;a<r.length;a++)(i=r[a]).testMask(e)&&t.push(i);return t},Object.defineProperty(r.prototype,"walkAble",{get:function(){return this.testMask(h.Navi3DMaskType.WalkAble)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"edges",{get:function(){return this._edges},enumerable:!0,configurable:!0}),r.prototype.testMask=function(t){return(this._mask&t)==t},r.prototype.getEdgeAgainstPoint=function(t){return this._edgeAgainstPoint.getValueByKey(t)},r.prototype.getPointAgainstEdge=function(t){return this._pointAgainstEdge.getValueByKey(t)},r.prototype.getPublicEdge=function(t){if(t&&t!=this)for(var e,i=0,a=this._neibourTriangles.getKeys();i<a.length;i++)if(e=a[i],this._neibourTriangles.getValueByKey(e)==t)return e;return null},r.prototype.loopPublicEdge=function(t){var e;if(t&&t!=this)for(var i=0,a=this._edges;i<a.length;i++){e=a[i];for(var r=0,n=t._edges;r<n.length;r++)if(e==n[r])return e}return null},r.prototype.randomPoint=function(){var t=this._points[2].subtract(this._points[0]);t.scaleBy(Math.random()),t.incrementBy(this._points[0]);var e=this._points[1].subtract(t);return e.scaleBy(Math.random()),e.incrementBy(t),e},r.pointInsideTriangle=function(t,e,i,a){return r.pp.setTo(t.x,t.z),r.p1.setTo(e.x,e.z),r.p2.setTo(i.x,i.z),r.p3.setTo(a.x,a.z),r.pointInsideTriangle2d()},r.pointInsideTriangle2d=function(){return 0<=r.product2d(r.p1,r.p2,r.p3)?0<=r.product2d(r.p1,r.p2,r.pp)&&0<=r.product2d(r.p2,r.p3,r.pp)&&0<=r.product2d(r.p3,r.p1,r.pp):r.product2d(r.p1,r.p2,r.pp)<=0&&r.product2d(r.p2,r.p3,r.pp)<=0&&r.product2d(r.p3,r.p1,r.pp)<=0},r.product2d=function(t,e,i){var a=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x);return-1e-5<a&&a<1e-5&&(a=0),a},r.p1=new h.Navi3DPoint2D,r.p2=new h.Navi3DPoint2D,r.p3=new h.Navi3DPoint2D,r.pp=new h.Navi3DPoint2D,r}(h.Vector3D);h.Navi3DTriangle=t}(egret3d||(egret3d={})),function(h){var t=function(){function t(t,e){this._nav3dPoints=new Array,this._nav3dEdges=new Array,this._nav3dTriangles=new Array,this._edgesDict=new h.DoubleArray,this.initPoints(t),this.initEdgesAndTriangles(e),this.createConnections(),this._nav3dAstar=new h.Navi3DAstar,this._nav3dFunnel=new h.Navi3DFunnel,this._terrainQuad=new h.QuadRoot(8,128),this._terrainQuad.createQuadTree(this._nav3dTriangles)}return Object.defineProperty(t.prototype,"edges",{get:function(){return this._nav3dEdges},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"points",{get:function(){return this._nav3dPoints},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"triangles",{get:function(){return this._nav3dTriangles},enumerable:!0,configurable:!0}),t.prototype.getTriangleAtPoint=function(t,e){return void 0===e&&(e=5),this._terrainQuad.getTriangleAtPoint(t,e)},t.prototype.findPath=function(t,e,i){void 0===i&&(i=5),this._path=null,this._triangleList=null;var a=this.getTriangleAtPoint(t,10),r=this.getTriangleAtPoint(e,10),n=this._nav3dAstar.findPath(this,a,r);return!!n&&(this._triangleList=this._nav3dAstar.channel,n=this._nav3dFunnel.searchPath(this,t,e,this._triangleList,i),this._path=this._nav3dFunnel.path,n)},t.prototype.initPoints=function(t){for(var e,i,a=t.length,r=0;r<a;r++)e=t[r],i=new h.Navi3DPoint(r,e.x,e.y,e.z),this._nav3dPoints.push(i)},t.prototype.initEdgesAndTriangles=function(t){for(var e,i,a,r,n,o=t.length,s=0;s<o;s++)e=t[s],i=this.tryCreateEdge(e[0],e[1]),a=this.tryCreateEdge(e[1],e[2]),r=this.tryCreateEdge(e[2],e[0]),null!=i&&null!=a&&null!=r&&(n=new h.Navi3DTriangle(s,i,a,r),this._nav3dTriangles.push(n))},t.prototype.tryCreateEdge=function(t,e){if(t==e)throw new Error("edge point index error!!!");if(e<t){var i=t;t=e,e=i}var a=this._edgesDict.getValueByKey(t+"_"+e);return null==a&&(a=new h.Navi3DEdge(this._nav3dPoints[t],this._nav3dPoints[e]),this._nav3dEdges.push(a),this._edgesDict.put(t+"_"+e,a)),a},t.prototype.createConnections=function(){for(var t,e,i,a=this._nav3dTriangles.length,r=this._nav3dTriangles.length,n=0;n<a;n++){for(var o=0,s=(t=this._nav3dTriangles[n]).edges;o<s.length;o++)s[o].addTriangleOwners(t);for(var h=0;h<r;h++)t!=(e=this._nav3dTriangles[h])&&((i=t.loopPublicEdge(e))&&(t.addNeibour(i,e),e.addNeibour(i,t)))}},t}();h.Navi3DMesh=t}(egret3d||(egret3d={})),function(m){var t=function(){function f(){this._aiRadius=0,this._tempPublicEdgeList=new Array,this._tempSamePlaneList=new Array,this._router=new m.Navi3DRouter}return f.prototype.searchPath=function(t,e,i,a,r){return void 0===r&&(r=0),r<=0&&(r=1),this._aiRadius=1.5*r,this._navMesh=t,!!this.searchEnable(e,i,a)&&(this.search(e,i,a),!0)},Object.defineProperty(f.prototype,"path",{get:function(){return this._result},enumerable:!0,configurable:!0}),f.prototype.searchEnable=function(t,e,i){return null!=t&&null!=e&&null!=this._navMesh&&null!=i&&(i[0].plane.classifyPoint(t,f.EPSILON)==m.PlaneClassification.INTERSECT&&i[i.length-1].plane.classifyPoint(e,f.EPSILON)==m.PlaneClassification.INTERSECT)},f.prototype.search=function(t,e,i){this._tempPublicEdgeList.length=0;var a,r,n,o,s,h,l,u=this._tempSamePlaneList.length=0,c=i.length-1;for(u=0;u<c;u++)(r=i[u].getPublicEdge(i[u+1])).crossPoint=null,r.initFatPoints(this._aiRadius),this._tempPublicEdgeList.push(r),o=(a=i[u]).plane,n=(a=i[u+1]).getEdgeAgainstPoint(r),this._tempSamePlaneList.push(o.classifyPoint(n,f.EPSILON)==m.PlaneClassification.INTERSECT);for(this._router.continuePass(t,e,this._tempPublicEdgeList[0]),c=this._tempPublicEdgeList.length,u=0;u<c;u++)r=this._tempPublicEdgeList[u],a=i[u+1],n=(l=u==c-1)?e:a.getEdgeAgainstPoint(r),this._router.passEdge(r,this._tempPublicEdgeList[u+1],n,l)||(s=this._router.cornerPoint,h=this._router.cornerEdge,u=this._tempPublicEdgeList.indexOf(h),this._router.continuePass(s,e,this._tempPublicEdgeList[u+1]));this.pushAllPathPoint2(t,e),3<=this._result.length&&(this.optimusTerminusFat(),this.optimusByRadius())},f.prototype.optimusTerminusFat=function(){var t,e,i;(i=this._result[1])instanceof m.Navi3DPointFat&&(t=i),(i=this._result[this._result.length-2])instanceof m.Navi3DPointFat&&(e=i),t&&(this._result[1]=t.scalePoint()),e&&t!=e&&(this._result[this._result.length-2]=e.scalePoint())},f.prototype.pushAllPathPoint2=function(t,e){var i,a=this._tempPublicEdgeList.length;this._result=new Array,this._result.push(t);for(var r,n,o,s=t,h=0;h<a;h++)if(n=null,(i=this._tempPublicEdgeList[h]).crossPoint)(n=this.getFatPoint(i,i.crossPoint))?this._result.push(n):this._result.push(i.crossPoint),s=i.crossPoint;else{r=null;for(var l=h+1;l<a&&!(r=this._tempPublicEdgeList[l].crossPoint);l++);null==r&&(r=e),(n=this.getFatPoint(i,r))?this._result.push(n):(f.CROSS_TEST_DIRECTION.setTo(r.x-s.x,0,r.z-s.z),o=this._router.calcCrossEdge(i,s,f.CROSS_TEST_DIRECTION),this._result.push(o))}this._result.push(e)},f.prototype.optimusByRadius=function(){var t=new Array;t.length=this._result.length;var e,i,a,r,n,o,s,h,l,u,c,d,p,_=this._result.length-2;for(p=0;p<_;p++)s=h=l=null,r=n=o=null,c=!1,d=null,e=this._result[p],i=this._result[p+1],a=this._result[p+2],e instanceof m.Navi3DPointFat&&(r=e),i instanceof m.Navi3DPointFat&&(n=i),a instanceof m.Navi3DPointFat&&(o=a),r&&(s=r.ownerPoint),n&&(h=n.ownerPoint),o&&(l=o.ownerPoint),s&&h&&s==h&&h!=l&&(c=!0),l&&h&&l==h&&s!=h&&(c=!0),c&&(f.CROSS_TEST_DIRECTION.copyFrom(e),f.CROSS_TEST_DIRECTION.decrementBy(a),u=n.ownerEdge,(c=this._router.hasCrossPoint(u.pointA,u.pointB,a,f.CROSS_TEST_DIRECTION))&&(d=this._router.calcCrossPointOut(h,i,a,f.CROSS_TEST_DIRECTION)),d&&(t[p+1]=d))},f.prototype.getFatPoint=function(t,e){return null==t?null:(e instanceof m.Navi3DPointFat&&(i=e),null==(a=i?i.ownerPoint:t.getEqualPoint(e))?null:i=t.getFatPoint(a));var i,a},f.POWER_EPSILON=(f.EPSILON=5)*f.EPSILON,f.CROSS_TEST_DIRECTION=new m.Vector3D,f}();m.Navi3DFunnel=t}(egret3d||(egret3d={})),function(o){var t=function(){function n(){}return n.prototype.continuePass=function(t,e,i){this.resetData(),this.curPoint=t,this.endPoint=e,this.cornerEdge=i},n.prototype.passEdge=function(t,e,i,a){if((null==this.rayA||null==this.rayB)&&(this.rayA=n.RAY_1,this.rayB=n.RAY_2,this.rayAPoint=t.pointA,this.rayBPoint=t.pointB,this.rayA.setTo(this.rayAPoint.x-this.curPoint.x,0,this.rayAPoint.z-this.curPoint.z),this.rayB.setTo(this.rayBPoint.x-this.curPoint.x,0,this.rayBPoint.z-this.curPoint.z)),a)return this.checkEndPoint(i);if(n.TEST_RAY.setTo(i.x-this.curPoint.x,0,i.z-this.curPoint.z),this.isPointAtCenter(n.TEST_RAY,this.rayA,this.rayB)){this.hasCrossPoint(e.pointA,e.pointB,this.rayAPoint,this.rayA)?(this.rayB.copyFrom(n.TEST_RAY),i instanceof o.Navi3DPoint?this.rayBPoint=i:this.rayBPoint=null):(this.rayA.copyFrom(n.TEST_RAY),i instanceof o.Navi3DPoint?this.rayAPoint=i:this.rayAPoint=null);var r=e.getAnotherPoint(i);n.TEST_RAY.setTo(r.x-this.curPoint.x,0,r.z-this.curPoint.z),(r==this.rayAPoint||r==this.rayBPoint||this.isPointAtCenter(n.TEST_RAY,this.rayA,this.rayB))&&(this.cornerEdge=e)}else{if(n.TEST_RAY_1.copyFrom(e.pointA),n.TEST_RAY_1.decrementBy(this.curPoint),n.TEST_RAY_2.copyFrom(e.pointB),n.TEST_RAY_2.decrementBy(this.curPoint),n.TEST_RAY_1.y=0,n.TEST_RAY_2.y=0,!this.isPointAtCenter(this.rayA,n.TEST_RAY_1,n.TEST_RAY_2)&&!this.isPointAtCenter(this.rayB,n.TEST_RAY_1,n.TEST_RAY_2))return this.isPointAtCenter(this.rayA,n.TEST_RAY,this.rayB)?this.cornerPoint=this.rayAPoint:this.cornerPoint=this.rayBPoint,this.cornerEdge.crossPoint=this.cornerPoint,!1}return!0},n.prototype.checkEndPoint=function(t){return n.TEST_RAY.setTo(t.x-this.curPoint.x,0,t.z-this.curPoint.z),!!this.isPointAtCenter(n.TEST_RAY,this.rayA,this.rayB)||(this.isPointAtCenter(this.rayA,n.TEST_RAY,this.rayB)?this.cornerPoint=this.rayAPoint:this.cornerPoint=this.rayBPoint,this.cornerEdge.crossPoint=this.cornerPoint,!1)},n.prototype.calcCrossEdge=function(t,e,i){return this.calcCrossPoint(t.fatPointA,t.fatPointB,e,i)},n.prototype.calcCrossPoint=function(t,e,i,a){n.CALC_CROSS_POINT.copyFrom(e),n.CALC_CROSS_POINT.decrementBy(t);var r=((t.z-i.z)*a.x-(t.x-i.x)*a.z)/(n.CALC_CROSS_POINT.x*a.z-a.x*n.CALC_CROSS_POINT.z);return 1<r?r=1:r<0&&(r=0),n.CALC_CROSS_POINT.scaleBy(r),n.CALC_CROSS_POINT.incrementBy(t),n.CALC_CROSS_POINT.clone()},n.prototype.calcCrossPointOut=function(t,e,i,a){n.CALC_CROSS_POINT.copyFrom(e),n.CALC_CROSS_POINT.decrementBy(t);var r=((t.z-i.z)*a.x-(t.x-i.x)*a.z)/(n.CALC_CROSS_POINT.x*a.z-a.x*n.CALC_CROSS_POINT.z);return r<=1&&0<=r?null:(n.CALC_CROSS_POINT.scaleBy(r),n.CALC_CROSS_POINT.incrementBy(t),n.CALC_CROSS_POINT.clone())},n.prototype.hasCrossPoint=function(t,e,i,a){n.CALC_CROSS_TEST.copyFrom(e),n.CALC_CROSS_TEST.decrementBy(t);var r=((t.z-i.z)*a.x-(t.x-i.x)*a.z)/(n.CALC_CROSS_TEST.x*a.z-a.x*n.CALC_CROSS_TEST.z);return r<=1&&0<=r},n.prototype.isPointAtCenter=function(t,e,i){var a=e.crossProduct(t);if(0==a.length&&t.length<e.length)return!0;var r=i.crossProduct(t);return 0==r.length&&t.length<i.length||(a.normalize(),r.normalize(),a.incrementBy(r),a.length<.01)},n.prototype.resetData=function(){this.cornerEdge=null,this.cornerPoint=null,this.curPoint=null,this.rayA=this.rayB=null,this.rayAPoint=this.rayBPoint=null,n.RAY_1.setTo(0,0,0),n.RAY_2.setTo(0,0,0)},n.RAY_1=new o.Vector3D,n.RAY_2=new o.Vector3D,n.TEST_RAY=new o.Vector3D,n.TEST_RAY_1=new o.Vector3D,n.TEST_RAY_2=new o.Vector3D,n.CALC_CROSS_POINT=new o.Vector3D,n.CALC_CROSS_TEST=new o.Vector3D,n}();o.Navi3DRouter=t}(egret3d||(egret3d={})),function(r){var t=function(){function a(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=100),void 0===a&&(a=100),this._rectangle=new r.Rectangle,this._transformMatrix=new r.Matrix4_4,this._change=!1,this._rotation=new r.Vector3D,this._scale=new r.Vector3D(1,1,1),this._position=new r.Vector3D,this._transformComponents=[],this._changeTexture=!1,this._textureStage=!1,this._vertexFormat=r.VertexFormat.VF_POSITION|r.VertexFormat.VF_UV0,this._uv_scale=new Float32Array(2),this.name="",this.bothside=!1,this.cullMode=r.ContextConfig.BACK,this.visible=!0,this.vsShader="hud_vs",this.fsShader="hud_V_fs",this._passUsage=new r.PassUsage,this._attList=new Array,this._transformComponents.push(this._position),this._transformComponents.push(this._rotation),this._transformComponents.push(this._scale),this.x=t,this.y=e,this.width=i,this.height=a,this._uv_scale[0]=1,this._uv_scale[1]=1}return Object.defineProperty(a.prototype,"diffuseTexture",{get:function(){return this._diffuseTexture},set:function(t){this._changeTexture=!0,this._diffuseTexture=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"x",{get:function(){return this._rectangle.x},set:function(t){this._change=!0,this._rectangle.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this._rectangle.y},set:function(t){this._change=!0,this._rectangle.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this._rectangle.width},set:function(t){this._change=!0,this._rectangle.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._rectangle.height},set:function(t){this._change=!0,this._rectangle.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationX",{get:function(){return this._rotation.x},set:function(t){this._change=!0,this._rotation.x!=t&&(this._rotation.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationY",{get:function(){return this._rotation.y},set:function(t){this._change=!0,this._rotation.y!=t&&(this._rotation.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationZ",{get:function(){return this._rotation.z},set:function(t){this._change=!0,this._rotation.z!=t&&(this._rotation.z=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewPort",{set:function(t){this._viewPort=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"uScale",{get:function(){return this._uv_scale[0]},set:function(t){this._uv_scale[0]=t,1<this._uv_scale[0]&&(this._uv_scale[0]=1),this._uv_scale[0]<0&&(this._uv_scale[0]=0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vScale",{get:function(){return this._uv_scale[1]},set:function(t){this._uv_scale[1]=t,1<this._uv_scale[1]&&(this._uv_scale[1]=1),this._uv_scale[1]<0&&(this._uv_scale[1]=0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"transformMatrix",{get:function(){return this._viewPort&&this._change&&(this._scale.x=this._rectangle.width/this._viewPort.width,this._scale.y=this._rectangle.height/this._viewPort.height,this._position.x=r.MathUtil.ScreenToPosition(this._rectangle.x,this._rectangle.width,this._viewPort.width),this._position.y=-r.MathUtil.ScreenToPosition(this._rectangle.y,this._rectangle.height,this._viewPort.height),this._transformMatrix.recompose(this._transformComponents),this._change=!1),this._transformMatrix},enumerable:!0,configurable:!0}),a.prototype.updateTexture=function(t){var e;for(var i in this._passUsage.sampler2DList)(e=this._passUsage.sampler2DList[i]).uniformIndex=t.getUniformLocation(this._passUsage.program3D,e.varName),e.texture=this[e.varName];this._changeTexture=!1},a.prototype.upload=function(t){for(var e in this._vertexBuffer3D||(this._vertexBuffer3D=t.creatVertexBuffer(a.singleQuadData)),this._indexBuffer3D||(this._indexBuffer3D=t.creatIndexBuffer(a.singleQuadIndex)),this._passUsage.vertexShader.shaderType=r.Shader.vertex,this._passUsage.fragmentShader.shaderType=r.Shader.fragment,this._passUsage.vertexShader.addUseShaderName(this.vsShader),this._passUsage.fragmentShader.addUseShaderName(this.fsShader),this._passUsage.vertexShader.shader=this._passUsage.vertexShader.getShader(this._passUsage),this._passUsage.fragmentShader.shader=this._passUsage.fragmentShader.getShader(this._passUsage),this._passUsage.program3D=r.ShaderPool.getProgram(this._passUsage.vertexShader.shader.id,this._passUsage.fragmentShader.shader.id),this._passUsage)-1!=e.indexOf("uniform")&&this._passUsage[e]&&(this._passUsage[e].uniformIndex=t.getUniformLocation(this._passUsage.program3D,e));var i=this._attList.length=0;this._passUsage.attribute_position&&(this._passUsage.attribute_position.uniformIndex||(this._passUsage.attribute_position.uniformIndex=t.getShaderAttribLocation(this._passUsage.program3D,this._passUsage.attribute_position.varName)),this._attList.push(this._passUsage.attribute_position),this._passUsage.attribute_position.size=r.Geometry.positionSize,this._passUsage.attribute_position.dataType=r.ContextConfig.FLOAT,this._passUsage.attribute_position.normalized=!1,this._passUsage.attribute_position.stride=a.vertexBytes,this._passUsage.attribute_position.offset=i,i+=r.Geometry.positionSize*Float32Array.BYTES_PER_ELEMENT),this._passUsage.attribute_uv0&&(this._passUsage.attribute_uv0.uniformIndex||(this._passUsage.attribute_uv0.uniformIndex=t.getShaderAttribLocation(this._passUsage.program3D,this._passUsage.attribute_uv0.varName)),this._attList.push(this._passUsage.attribute_uv0),this._passUsage.attribute_uv0.size=r.Geometry.uvSize,this._passUsage.attribute_uv0.dataType=r.ContextConfig.FLOAT,this._passUsage.attribute_uv0.normalized=!1,this._passUsage.attribute_uv0.stride=a.vertexBytes,this._passUsage.attribute_uv0.offset=i,i+=r.Geometry.uvSize*Float32Array.BYTES_PER_ELEMENT),this._passUsage.uv_scale=t.getUniformLocation(this._passUsage.program3D,"uv_scale")},a.prototype.draw=function(t){if(this.visible){this._passUsage.program3D||this.upload(t),t.setProgram(this._passUsage.program3D),t.bindVertexBuffer(this._vertexBuffer3D),t.bindIndexBuffer(this._indexBuffer3D),t.activeVertexFormat(this._vertexFormat);for(var e=0;e<this._attList.length;++e)t.vertexAttribPointer(this._attList[e].uniformIndex,this._attList[e].size,this._attList[e].dataType,this._attList[e].normalized,this._attList[e].stride,this._attList[e].offset);var i;for(var a in this._changeTexture&&this.updateTexture(t),this._passUsage.sampler2DList)(i=this._passUsage.sampler2DList[a]).texture&&(i.texture.upload(t),t.setTexture2DAt(i.activeTextureIndex,i.uniformIndex,i.index,i.texture.texture2D),this._textureStage&&(i.texture.activeState(t),this._textureStage=!1));this._passUsage.uniform_ViewProjectionMatrix&&t.uniformMatrix4fv(this._passUsage.uniform_ViewProjectionMatrix.uniformIndex,!1,this.transformMatrix.rawData),this._passUsage.uv_scale&&-1!=this._passUsage.uv_scale&&t.uniform2f(this._passUsage.uv_scale,this._uv_scale[0],this._uv_scale[1]),t.setCulling(this.cullMode),this.bothside?t.disableCullFace():t.enableCullFace(),t.enableBlend(),t.setBlendFactors(r.ContextConfig.SRC_ALPHA,r.ContextConfig.ONE_MINUS_SRC_ALPHA),t.drawElement(r.DrawMode.TRIANGLES,0,6),t.clear(r.ContextConfig.DEPTH_BUFFER_BIT)}},a.singleQuadData=[-1,-1,0,0,1,1,-1,0,1,1,1,1,0,1,0,-1,1,0,0,0],a.singleQuadIndex=[0,1,2,0,2,3],a.vertexBytes=20,a}();r.HUD=t}(egret3d||(egret3d={})),function(n){var t=function(){function t(t,e,i,a,r){void 0===r&&(r=null),this._viewPort=new n.Rectangle,this._scene=new n.Scene3D,this._scissorRect=new n.Rectangle,this._viewMatrix=new n.Matrix4_4,this._backColor=new n.Vector3D(.3,.3,.6,1),this._cleanParmerts=n.Context3DProxy.gl.COLOR_BUFFER_BIT|n.Context3DProxy.gl.DEPTH_BUFFER_BIT,this._sizeDiry=!1,this._huds=new Array,this._postList=[],this.a=0,this._entityCollect=new n.EntityCollect,this._entityCollect.root=this._scene,this._render=new n.MultiRender(n.PassType.diffusePass),this._camera=r||new n.Camera3D(n.CameraType.perspective),this._camera.name="MainCamera",this._scene.addChild3D(this._camera),this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=a,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height)}return Object.defineProperty(t.prototype,"render",{get:function(){return this._render},set:function(t){this._render=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"post",{set:function(t){0<(this._postList=t).length&&(this._postProcessing=this._postProcessing||new n.PostProcessing,this._postHUD=this._postHUD||new n.HUD(0,0,512,512),this._postHUD.fsShader="hud_H_fs")},enumerable:!0,configurable:!0}),t.prototype.blender=function(t,e){this._cleanParmerts=(t?n.Context3DProxy.gl.COLOR_BUFFER_BIT:0)|(e?n.Context3DProxy.gl.DEPTH_BUFFER_BIT:0)},Object.defineProperty(t.prototype,"backColor",{get:function(){return 255*this._backColor.w<<24|255*this._backColor.x<<16|255*this._backColor.y<<8|255*this._backColor.z},set:function(t){this._backColor.w=(t>>24&255)/255,this._backColor.x=(t>>16&255)/255,this._backColor.y=(t>>8&255)/255,this._backColor.z=(255&t)/255},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backImage",{get:function(){return this._backImg.diffuseTexture},set:function(t){t&&(this._backImg=this._backImg||new n.HUD,this._backImg.diffuseTexture=t,this._backImg.x=this.x,this._backImg.y=this.y,this._backImg.width=this.width,this._backImg.height=this.height)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera3D",{get:function(){return this._camera},set:function(t){this._camera=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},set:function(t){this._scene=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._viewPort.x},set:function(t){this._viewPort.x=t,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._viewPort.y},set:function(t){this._viewPort.y=t,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._viewPort.width},set:function(t){this._viewPort.width=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.width=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._viewPort.height},set:function(t){this._viewPort.height=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.height=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"entityCollect",{get:function(){return this._entityCollect},enumerable:!0,configurable:!0}),t.prototype.addChild3D=function(t){this._scene.addChild3D(t)},t.prototype.removeChild3D=function(t){this._scene.removeChild3D(t)},t.prototype.inView3D=function(t,e){return this._viewPort.inner(t,e)},t.prototype.addHUD=function(t){-1==this._huds.indexOf(t)&&(t.viewPort=this._viewPort,this._huds.push(t))},t.prototype.findHud=function(t){for(var e=0;e<this._huds.length;++e)if(this._huds[e].name==t)return this._huds[e];return null},t.prototype.delHUD=function(t){var e=this._huds.indexOf(t);0<=e&&e<this._huds.length&&this._huds.splice(e,1)},t.prototype.update=function(t,e){if(this._camera.viewPort=this._viewPort,this._entityCollect.update(this._camera),n.Egret3DEngine.debug){n.Egret3DState.showDataInfo("drawCall : "+this._entityCollect.numberDraw.toString()),n.Egret3DState.showDataInfo("vertex : "+this._entityCollect.numberVertex.toString()),n.Egret3DState.showDataInfo("tris : "+this._entityCollect.numberFace.toString()),n.Egret3DState.showDataInfo("skin : "+this._entityCollect.numberSkin.toString()),n.Egret3DState.showDataInfo("proAnim : "+this._entityCollect.numberAnimation.toString()),n.Egret3DState.showDataInfo("particleEmiter : "+this._entityCollect.numberParticle.toString());for(var i,a=0;a<n.Layer.layerType.length;a++)i=n.Layer.layerType[a]+" layer: "+this._entityCollect.softRenderItems[n.Layer.layerType[a]].length.toString(),n.Egret3DState.showDataInfo(i)}if(this.updateObject3D(this._scene.root,t,e),n.Egret3DCanvas.context3DProxy.viewPort(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),n.Egret3DCanvas.context3DProxy.setScissorRectangle(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),n.ShadowCast.instance.shadowRender[0]){n.MathUtil.CALCULATION_QUATERNION.fromEulerAngles(0,this.a++,0);var r=new n.Vector3D(0,-1,-1);n.MathUtil.CALCULATION_QUATERNION.transformVector(r,n.ShadowCast.instance.dir),n.ShadowCast.instance.shadowRender[0].draw(t,e,n.Egret3DCanvas.context3DProxy,this._entityCollect,n.ShadowCast.instance.shadowCamera,this._viewPort,!0)}this._cleanParmerts&n.Context3DProxy.gl.COLOR_BUFFER_BIT&&n.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),n.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._backImg&&this._backImg.draw(n.Egret3DCanvas.context3DProxy),0<this._postList.length?(this._postProcessing.postItem=this._postList,this._postProcessing.drawFrameBuffer(t,e,n.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera,this._viewPort),this._postHUD.diffuseTexture=this._postProcessing.endTexture,this._postHUD.draw(n.Egret3DCanvas.context3DProxy)):this._render.draw(t,e,n.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera,this._viewPort);for(a=0;a<this._huds.length;++a)this._huds[a].draw(n.Egret3DCanvas.context3DProxy)},t.prototype.updateObject3D=function(t,e,i){if(t){t.update(e,i,this.camera3D);for(var a=0;a<t.childs.length;++a)this.updateObject3D(t.childs[a],e,i)}},t.requestFullScreen=function(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},t.exitFullscreen=function(){var t=document;t.exitFullscreen?t.exitFullscreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()},t}();n.View3D=t}(egret3d||(egret3d={})),function(n){var t=function(r){function t(t,e,i,a){r.call(this,t,e,i,a,new n.Camera3D(n.CameraType.VR)),this.leftViewPort=new n.Rectangle,this.rightViewPort=new n.Rectangle,this.updateViewport()}return __extends(t,r),t.prototype.updateViewport=function(){this.leftViewPort.x=this._viewPort.x,this.leftViewPort.y=this._viewPort.y,this.leftViewPort.width=this._viewPort.width/2,this.leftViewPort.height=this._viewPort.height,this.rightViewPort.x=this._viewPort.x+this.leftViewPort.width,this.rightViewPort.y=this._viewPort.y,this.rightViewPort.width=this.leftViewPort.width,this.rightViewPort.height=this.leftViewPort.height},Object.defineProperty(t.prototype,"x",{set:function(t){this._viewPort.x=t,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{set:function(t){this._viewPort.y=t,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{set:function(t){this._viewPort.width=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{set:function(t){this._viewPort.height=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this.updateViewport()},enumerable:!0,configurable:!0}),t.prototype.update=function(t,e){for(this._entityCollect.update(this._camera),this._numberEntity=this._entityCollect.renderList.length,this._index=0;this._index<this._numberEntity;this._index++)this._entityCollect.renderList[this._index].update(t,e,this._camera);var i=this.leftViewPort;this._camera.viewPort=i,this._camera.tap(n.CameraType.VR,n.VRType.left),n.Egret3DCanvas.context3DProxy.viewPort(i.x,i.y,i.width,i.height),n.Egret3DCanvas.context3DProxy.setScissorRectangle(i.x,i.y,i.width,i.height),this._cleanParmerts&n.Context3DProxy.gl.COLOR_BUFFER_BIT&&n.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),n.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._render.draw(t,e,n.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera),i=this.rightViewPort,this._camera.viewPort=i,this._camera.tap(n.CameraType.VR,n.VRType.right),n.Egret3DCanvas.context3DProxy.viewPort(i.x,i.y,i.width,i.height),n.Egret3DCanvas.context3DProxy.setScissorRectangle(i.x,i.y,i.width,i.height),this._cleanParmerts&n.Context3DProxy.gl.COLOR_BUFFER_BIT&&n.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),n.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._render.draw(t,e,n.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera)},Object.defineProperty(t.prototype,"eyeDistance",{get:function(){return this._camera.eyeMatrix.eyeSpace},set:function(t){this._camera.eyeMatrix.eyeSpace=t},enumerable:!0,configurable:!0}),t}(n.View3D);n.VRView3D=t}(egret3d||(egret3d={})),function(r){var t=function(e){function a(t){void 0===t&&(t=!1),e.call(this),this.canvas3DRectangle=new r.Rectangle,this._view3DS=new Array,this.sizeDiry=!0,this._time=0,this._delay=0,this._renderer=0,this._timeDate=null,this.offsetX=0,this.offsetY=0,r.ShaderUtil.instance.load(),this._envetManager=new r.EventManager(this),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.zIndex="-1",0<document.getElementsByClassName("egret-player").length?document.getElementsByClassName("egret-player")[0].appendChild(this.canvas):document.body.appendChild(this.canvas),this.canvas.id="egret3D",this.canvas.oncontextmenu=function(){return!1},a.context3DProxy=new r.Context3DProxy,r.Context3DProxy.gl=this.canvas.getContext("experimental-webgl"),r.Context3DProxy.gl||(r.Context3DProxy.gl=this.canvas.getContext("webgl")),r.Context3DProxy.gl||alert("you drivers not suport webgl"),a.context3DProxy.register(),console.log("this.context3D ==>",r.Context3DProxy.gl),(r.Input.canvas=this).initEvent()}return __extends(a,e),a.prototype.initEvent=function(){this._enterFrameEvent3D=new r.Event3D(r.Event3D.ENTER_FRAME),this._enterFrameEvent3D.target=this},Object.defineProperty(a.prototype,"x",{get:function(){return this.canvas3DRectangle.x},set:function(t){this.canvas3DRectangle.x!=t&&this.resize(t,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this.canvas3DRectangle.y},set:function(t){this.canvas3DRectangle.y!=t&&this.resize(this.canvas3DRectangle.x,t,this.canvas3DRectangle.width,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this.canvas3DRectangle.width},set:function(t){this.canvas3DRectangle.width!=t&&this.resize(this.canvas3DRectangle.x,this.canvas3DRectangle.y,t,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this.canvas3DRectangle.height},set:function(t){this.canvas3DRectangle.height!=t&&this.resize(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"view3Ds",{get:function(){return this._view3DS},enumerable:!0,configurable:!0}),a.prototype.addView3D=function(t){-1==this._view3DS.indexOf(t)&&this._view3DS.push(t)},a.prototype.removeView3D=function(t){var e=this._view3DS.indexOf(t);-1!=e&&this._view3DS.splice(e)},a.prototype.start=function(){this.update(0)},a.prototype.update=function(t){var e=this;this._timeDate=new Date,this._delay=this._timeDate.getTime()-this._time,this._time=this._timeDate.getTime(),this._enterFrameEvent3D.time+=this._time,this._enterFrameEvent3D.delay=this._delay,this.dispatchEvent(this._enterFrameEvent3D),a.context3DProxy.enableBlend(),a.context3DProxy.enableCullFace(),r.Context3DProxy.gl.enable(r.Context3DProxy.gl.SCISSOR_TEST),a.context3DProxy.viewPort(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height),a.context3DProxy.setScissorRectangle(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height),r.CameraManager.instance.update(this._time,this._delay);for(var i=0;i<this._view3DS.length;i++)this._view3DS[i].update(this._time,this._delay);r.Egret3DEngine.debug&&(this._renderer=(new Date).getTime()-this._time,r.Egret3DState.showTime(this._time,this._delay),r.Egret3DState.showDataInfo("renderer: "+this._renderer.toString()+" ms"),r.Egret3DState.show()),requestAnimationFrame(function(t){return e.update(t)})},a.prototype.resize=function(t,e,i,a){this.canvas3DRectangle.x=t,this.canvas3DRectangle.y=e,this.canvas3DRectangle.width=i,this.canvas3DRectangle.height=a,r.ContextConfig.canvasRectangle=this.canvas3DRectangle,this.canvas.style.left=this.canvas3DRectangle.x.toString()+"px",this.canvas.style.top=this.canvas3DRectangle.y.toString()+"px",this.canvas.width=this.canvas3DRectangle.width,this.canvas.height=this.canvas3DRectangle.height},a}(r.EventDispatcher);r.Egret3DCanvas=t}(egret3d||(egret3d={})),function(egret3d){var Egret3DEngine=function(){function Egret3DEngine(){}return Egret3DEngine.getXHR=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},Egret3DEngine.preload=function(t){return this._complete=t,null==this._xhr&&(this._xhr=this.getXHR()),null==this._xhr?void alert("Your browser does not support XMLHTTP."):(0<this._xhr.readyState&&this._xhr.abort(),this._xhr.open("GET",this._libUrl+"?"+1e5*Math.random(),!0),this._xhr.addEventListener("progress",function(t){return Egret3DEngine.onProgress(t)},!1),this._xhr.addEventListener("readystatechange",function(t){return Egret3DEngine.onReadyStateChange(t)},!1),this._xhr.addEventListener("error",function(t){return Egret3DEngine.onError(t)},!1),this._xhr.responseType="text",void this._xhr.send())},Egret3DEngine.onReadyStateChange=function(t){4==this._xhr.readyState&&(400<=this._xhr.status||0==this._xhr.status?console.log(this._libUrl,"load fail"):this.loadComplete())},Egret3DEngine.loadComplete=function(){var t=this._xhr.responseText;this.applyClass(t)},Egret3DEngine.onProgress=function(t){var e=t.loaded.toString()+t.total;console.log("progress event```"+e)},Egret3DEngine.onError=function(t){console.log("load error",t)},Egret3DEngine.applyClass=function(source){for(var obj=eval("("+source+")"),i=0;i<obj.files.length;++i)Egret3DEngine.importList[i]="/js/Egret3D/",Egret3DEngine.importList[i]+=obj.files[i],Egret3DEngine.importList[i]=Egret3DEngine.importList[i].replace(".ts",".js");Egret3DEngine.onTsconfig(),Egret3DEngine.startLoadScript(null)},Egret3DEngine.addImportScript=function(t){Egret3DEngine.importList.push(t)},Egret3DEngine.startLoadScript=function(t){var e=this;if(0<this.importList.length){var i=document.createElement("script");i.src=this.importList.shift(),i.onload=function(t){return e.startLoadScript(t)},i.onerror=function(t){return e.loadScriptError(t)},document.head.appendChild(i)}else console.log("all complete"),this._complete()},Egret3DEngine.loadScriptError=function(t){var e="load Script Error \r\n no file:"+t.srcElement.src;alert(e),this.startLoadScript(null)},Egret3DEngine.debug=!0,Egret3DEngine.djs="",Egret3DEngine.importList=new Array,Egret3DEngine._libUrl="/Egret3D/tsconfig.json",Egret3DEngine}();egret3d.Egret3DEngine=Egret3DEngine}(egret3d||(egret3d={})),function(e){var t=function(){function t(){this._debugHud=new e.HUD,this.mainPassRender=new e.MultiRender(e.PassType.diffusePass),this.mainPassRender.setRenderToTexture(2048,2048,e.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=512,this._debugHud.y=0,this._debugHud.width=256,this._debugHud.height=256}return t.prototype.drawTexture=function(t,e,i,a,r,n,o){this.mainPassRender.draw(t,e,i,a,r,n),o.mainPass=this.mainPassRender.renderTexture,o.end=this.mainPassRender.renderTexture,o.colorTexture=this.mainPassRender.renderTexture},t}();e.MainPass=t}(egret3d||(egret3d={})),function(e){var t=function(){function t(){this._debugHud=new e.HUD,this.postRender=new e.PostRender("hud_vs","bloom_fs"),this.postRender.setRenderToTexture(256,256,e.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.gaussPass=new e.GaussPass,this._debugHud.fsShader="hud_H_fs",this._debugHud.x=768,this._debugHud.y=0,this._debugHud.width=128,this._debugHud.height=128}return t.prototype.drawTexture=function(t,e,i,a,r,n,o){this.postRender.draw(t,e,i,a,r,n,o),o.bloomPass=this.postRender.renderTexture,o.end=this.postRender.renderTexture,this.gaussPass.drawTexture(t,e,i,a,r,n,o)},t}();e.BloomPass=t}(egret3d||(egret3d={})),function(e){var t=function(){function t(){this._debugHud=new e.HUD,this._h_postRender=new e.PostRender("hud_vs","gaussian_H_fs"),this._h_postRender.setRenderToTexture(2048,2048,e.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._v_postRender=new e.PostRender("hud_vs","gaussian_V_fs"),this._v_postRender.setRenderToTexture(2048,2048,e.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=768,this._debugHud.y=0,this._debugHud.width=128,this._debugHud.height=128}return t.prototype.drawTexture=function(t,e,i,a,r,n,o){this._h_postRender.draw(t,e,i,a,r,n,o),o.end=this._h_postRender.renderTexture,this._v_postRender.draw(t,e,i,a,r,n,o),o.end=this._v_postRender.renderTexture,o.bloomPass=this._v_postRender.renderTexture},t}();e.GaussPass=t}(egret3d||(egret3d={})),function(e){var t=function(){function t(){this.posTex={},this.postItem=[],this.postRender=new e.MultiRender(e.PassType.diffusePass),this.postRender.setRenderToTexture(1024,1024,e.FrameBufferFormat.FLOAT_RGB),this.endTexture=this.posTex.end=this.postRender.renderTexture}return t.prototype.drawFrameBuffer=function(t,e,i,a,r,n){void 0===n&&(n=null);for(var o=0;o<this.postItem.length;o++)this.postItem[o].drawTexture(t,e,i,a,r,n,this.posTex),this.endTexture=this.posTex.end},t}();e.PostProcessing=t}(egret3d||(egret3d={}));
var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};!function(t){var e=function(){};e.BINARY="binary",e.TEXT="text",e.VARIABLES="variables",e.TEXTURE="texture",e.SOUND="sound",t.URLLoaderDataFormat=e,__reflect(e.prototype,"egret.URLLoaderDataFormat")}(egret||(egret={})),function(t){var e=function(o){function t(t,e,i){var r=o.call(this)||this;return r._name=t,r._frame=0|e,i&&(r._end=0|i),r}return __extends(t,o),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this._frame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this._name,this._frame,this._end)},t}(t.EventDispatcher);t.FrameLabel=e,__reflect(e.prototype,"egret.FrameLabel")}(egret||(egret={})),function(o){var t=function(e){function t(){var t=e.call(this)||this;return t.$mcData=null,t.numFrames=1,t.frames=[],t.labels=null,t.events=[],t.frameRate=0,t.textureData=null,t.spriteSheet=null,t}return __extends(t,e),t.prototype.$init=function(t,e,i){this.textureData=e,this.spriteSheet=i,this.setMCData(t)},t.prototype.getKeyFrameData=function(t){var e=this.frames[t-1];return e.frame&&(e=this.frames[e.frame-1]),e},t.prototype.getTextureByFrame=function(t){var e=this.getKeyFrameData(t);return e.res?this.getTextureByResName(e.res):null},t.prototype.$getOffsetByFrame=function(t,e){var i=this.getKeyFrameData(t);i.res&&e.setTo(0|i.x,0|i.y)},t.prototype.getTextureByResName=function(t){if(null==this.spriteSheet)return null;var e=this.spriteSheet.getTexture(t);if(!e){var i=this.textureData[t];e=this.spriteSheet.createTexture(t,i.x,i.y,i.w,i.h)}return e},t.prototype.$isDataValid=function(){return 0<this.frames.length},t.prototype.$isTextureValid=function(){return null!=this.textureData&&null!=this.spriteSheet},t.prototype.$fillMCData=function(t){this.frameRate=t.frameRate||24,this.fillFramesData(t.frames),this.fillFrameLabelsData(t.labels),this.fillFrameEventsData(t.events)},t.prototype.fillFramesData=function(t){for(var e,i=this.frames,r=t?t.length:0,o=0;o<r;o++){var n=t[o];if(i.push(n),n.duration){var s=parseInt(n.duration);if(1<s){e=i.length;for(var a=1;a<s;a++)i.push({frame:e})}}}this.numFrames=i.length},t.prototype.fillFrameLabelsData=function(t){if(t){var e=t.length;if(0<e){this.labels=[];for(var i=0;i<e;i++){var r=t[i];this.labels.push(new o.FrameLabel(r.name,r.frame,r.end))}}}},t.prototype.fillFrameEventsData=function(t){if(t){var e=t.length;if(0<e){this.events=[];for(var i=0;i<e;i++){var r=t[i];this.events[r.frame]=r.name}}}},Object.defineProperty(t.prototype,"mcData",{get:function(){return this.$mcData},set:function(t){this.setMCData(t)},enumerable:!0,configurable:!0}),t.prototype.setMCData=function(t){this.$mcData!=t&&((this.$mcData=t)&&this.$fillMCData(t))},t}(o.HashObject);o.MovieClipData=t,__reflect(t.prototype,"egret.MovieClipData")}(egret||(egret={})),function(i){var t=function(r){function t(t,e){var i=r.call(this)||this;return i.enableCache=!0,i.$mcDataCache={},i.$mcDataSet=t,i.setTexture(e),i}return __extends(t,r),t.prototype.clearCache=function(){this.$mcDataCache={}},t.prototype.generateMovieClipData=function(t){if(void 0===t&&(t=""),""==t&&this.$mcDataSet)for(t in this.$mcDataSet.mc)break;if(""==t)return null;var e=this.findFromCache(t,this.$mcDataCache);return e||(e=new i.MovieClipData,this.fillData(t,e,this.$mcDataCache)),e},t.prototype.findFromCache=function(t,e){return this.enableCache&&e[t]?e[t]:null},t.prototype.fillData=function(t,e,i){if(this.$mcDataSet){var r=this.$mcDataSet.mc[t];r&&(e.$init(r,this.$mcDataSet.res,this.$spriteSheet),this.enableCache&&(i[t]=e))}},Object.defineProperty(t.prototype,"mcDataSet",{get:function(){return this.$mcDataSet},set:function(t){this.$mcDataSet=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{set:function(t){this.setTexture(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spriteSheet",{get:function(){return this.$spriteSheet},enumerable:!0,configurable:!0}),t.prototype.setTexture=function(t){this.$spriteSheet=t?new i.SpriteSheet(t):null},t}(i.EventDispatcher);i.MovieClipDataFactory=t,__reflect(t.prototype,"egret.MovieClipDataFactory")}(egret||(egret={})),function(a){var t=function(n){function s(t,e,i,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=null);var o=n.call(this,t,e,i)||this;return o.frameLabel=null,o.frameLabel=r,o}return __extends(s,n),s.dispatchMovieClipEvent=function(t,e,i){void 0===i&&(i=null);var r=a.Event.create(s,e);r.frameLabel=i;var o=t.dispatchEvent(r);return a.Event.release(r),o},s}(a.Event);t.FRAME_LABEL="frame_label",a.MovieClipEvent=t,__reflect(t.prototype,"egret.MovieClipEvent")}(egret||(egret={})),function(n){var t=function(){function t(){n.$error(1014)}return t.get=function(e){return e<-1&&(e=-1),1<e&&(e=1),function(t){return 0==e?t:e<0?t*(t*-e+1+e):t*((2-t)*e+(1-e))}},t.getPowOut=function(e){return function(t){return 1-Math.pow(1-t,e)}},t}();t.quintOut=t.getPowOut(5),t.quartOut=t.getPowOut(4),n.ScrollEase=t,__reflect(t.prototype,"egret.ScrollEase");var e=function(o){function _(t,e,i){var r=o.call(this)||this;return r._target=null,r._useTicks=!1,r.ignoreGlobalPause=!1,r.loop=!1,r.pluginData=null,r._steps=null,r._actions=null,r.paused=!1,r.duration=0,r._prevPos=-1,r.position=null,r._prevPosition=0,r._stepPosition=0,r.passive=!1,r.initialize(t,e,i),r}return __extends(_,o),_.get=function(t,e,i,r){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=!1),r&&_.removeTweens(t),new _(t,e,i)},_.removeTweens=function(t){if(t.tween_count){for(var e=_._tweens,i=e.length-1;0<=i;i--)e[i]._target==t&&(e[i].paused=!0,e.splice(i,1));t.tween_count=0}},_.tick=function(t,e){void 0===e&&(e=!1);var i=t-_._lastTime;_._lastTime=t;for(var r=_._tweens.concat(),o=r.length-1;0<=o;o--){var n=r[o];e&&!n.ignoreGlobalPause||n.paused||n.tick(n._useTicks?1:i)}return!1},_._register=function(t,e){var i=t._target,r=_._tweens;if(e)i&&(i.tween_count=0<i.tween_count?i.tween_count+1:1),r.push(t),_._inited||(_._lastTime=n.getTimer(),n.sys.$ticker.$startTick(_.tick,null),_._inited=!0);else{i&&i.tween_count--;for(var o=r.length;o--;)if(r[o]==t)return void r.splice(o,1)}},_.prototype.initialize=function(t,e,i){this._target=t,e&&(this._useTicks=e.useTicks,this.ignoreGlobalPause=e.ignoreGlobalPause,this.loop=e.loop,e.onChange&&this.addEventListener("change",e.onChange,e.onChangeObj),e.override&&_.removeTweens(t)),this.pluginData=i||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],e&&e.paused?this.paused=!0:_._register(this,!0),e&&null!=e.position&&this.setPosition(e.position)},_.prototype.setPosition=function(t,e){void 0===e&&(e=1),t<0&&(t=0);var i=t,r=!1;if(i>=this.duration&&(this.loop?i%=this.duration:(i=this.duration,r=!0)),i==this._prevPos)return r;var o=this._prevPos;if(this.position=this._prevPos=i,this._prevPosition=t,this._target)if(r)this._updateTargetProps(null,1);else if(0<this._steps.length){var n=void 0,s=this._steps.length;for(n=0;n<s&&!(this._steps[n].t>i);n++);var a=this._steps[n-1];this._updateTargetProps(a,(this._stepPosition=i-a.t)/a.d)}return r&&this.setPaused(!0),0!=e&&0<this._actions.length&&(this._useTicks?this._runActions(i,i):1==e&&i<o?(o!=this.duration&&this._runActions(o,this.duration),this._runActions(0,i,!0)):this._runActions(o,i)),this.dispatchEventWith("change"),r},_.prototype._runActions=function(t,e,i){void 0===i&&(i=!1);var r=t,o=e,n=-1,s=this._actions.length,a=1;for(e<t&&(r=e,o=t,n=s,s=a=-1);(n+=a)!=s;){var l=this._actions[n],h=l.t;(h==o||r<h&&h<o||i&&h==t)&&l.f.apply(l.o,l.p)}},_.prototype._updateTargetProps=function(t,e){var i,r,o,n,s,a;if(t||1!=e){if(this.passive=!!t.v,this.passive)return;t.e&&(e=t.e(e,0,1,1)),i=t.p0,r=t.p1}else this.passive=!1,i=r=this._curQueueProps;for(var l in this._initQueueProps){null==(n=i[l])&&(i[l]=n=this._initQueueProps[l]),null==(s=r[l])&&(r[l]=s=n),o=n==s||0==e||1==e||"number"!=typeof n?1==e?s:n:n+(s-n)*e;var h=!1;if(a=_._plugins[l])for(var c=0,u=a.length;c<u;c++){var p=a[c].tween(this,l,o,i,r,e,!!t&&i==r,!t);p==_.IGNORE?h=!0:o=p}h||(this._target[l]=o)}},_.prototype.setPaused=function(t){return this.paused=t,_._register(this,!t),this},_.prototype._cloneProps=function(t){var e={};for(var i in t)e[i]=t[i];return e},_.prototype._addStep=function(t){return 0<t.d&&(this._steps.push(t),t.t=this.duration,this.duration+=t.d),this},_.prototype._appendQueueProps=function(t){var e,i,r,o,n;for(var s in t)if(void 0===this._initQueueProps[s]){if(i=this._target[s],e=_._plugins[s])for(r=0,o=e.length;r<o;r++)i=e[r].init(this,s,i);this._initQueueProps[s]=this._curQueueProps[s]=void 0===i?null:i}else i=this._curQueueProps[s];for(var s in t){if(i=this._curQueueProps[s],e=_._plugins[s])for(n=n||{},r=0,o=e.length;r<o;r++)e[r].step&&e[r].step(this,s,i,t[s],n);this._curQueueProps[s]=t[s]}return n&&this._appendQueueProps(n),this._curQueueProps},_.prototype._addAction=function(t){return t.t=this.duration,this._actions.push(t),this},_.prototype.to=function(t,e,i){return void 0===i&&(i=void 0),(isNaN(e)||e<0)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:i,p1:this._cloneProps(this._appendQueueProps(t))})},_.prototype.call=function(t,e,i){return void 0===e&&(e=void 0),void 0===i&&(i=void 0),this._addAction({f:t,p:i||[],o:e||this._target})},_.prototype.tick=function(t){this.paused||this.setPosition(this._prevPosition+t)},_}(n.EventDispatcher);e._tweens=[],e.IGNORE={},e._plugins={},e._inited=!1,e._lastTime=0,n.ScrollTween=e,__reflect(e.prototype,"egret.ScrollTween")}(egret||(egret={})),function(a){var t=function(i){function _(t){void 0===t&&(t=null);var e=i.call(this)||this;return e.scrollBeginThreshold=10,e.scrollSpeed=1,e._content=null,e.delayTouchBeginEvent=null,e.touchBeginTimer=null,e.touchEnabled=!0,e._ScrV_Props_=new a.ScrollViewProperties,t&&e.setContent(t),e}return __extends(_,i),Object.defineProperty(_.prototype,"bounces",{get:function(){return this._ScrV_Props_._bounces},set:function(t){this._ScrV_Props_._bounces=!!t},enumerable:!0,configurable:!0}),_.prototype.setContent=function(t){this._content!==t&&(this.removeContent(),t&&(this._content=t,i.prototype.addChild.call(this,t),this._addEvents()))},_.prototype.removeContent=function(){this._content&&(this._removeEvents(),i.prototype.removeChildAt.call(this,0)),this._content=null},Object.defineProperty(_.prototype,"verticalScrollPolicy",{get:function(){return this._ScrV_Props_._verticalScrollPolicy},set:function(t){t!=this._ScrV_Props_._verticalScrollPolicy&&(this._ScrV_Props_._verticalScrollPolicy=t)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"horizontalScrollPolicy",{get:function(){return this._ScrV_Props_._horizontalScrollPolicy},set:function(t){t!=this._ScrV_Props_._horizontalScrollPolicy&&(this._ScrV_Props_._horizontalScrollPolicy=t)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"scrollLeft",{get:function(){return this._ScrV_Props_._scrollLeft},set:function(t){t!=this._ScrV_Props_._scrollLeft&&(this._ScrV_Props_._scrollLeft=t,this._validatePosition(!1,!0),this._updateContentPosition())},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"scrollTop",{get:function(){return this._ScrV_Props_._scrollTop},set:function(t){t!=this._ScrV_Props_._scrollTop&&(this._ScrV_Props_._scrollTop=t,this._validatePosition(!0,!1),this._updateContentPosition())},enumerable:!0,configurable:!0}),_.prototype.setScrollPosition=function(t,e,i){if(void 0===i&&(i=!1),(!i||0!=t||0!=e)&&(i||this._ScrV_Props_._scrollTop!=t||this._ScrV_Props_._scrollLeft!=e)){var r=this._ScrV_Props_._scrollTop,o=this._ScrV_Props_._scrollLeft;if(i){var n=this.getMaxScrollLeft(),s=this.getMaxScrollTop();(r<=0||s<=r)&&(t/=2),(o<=0||n<=o)&&(e/=2);var a=r+t,l=o+e;this._ScrV_Props_._bounces||((a<=0||s<=a)&&(a=Math.max(0,Math.min(a,s))),(l<=0||n<=l)&&(l=Math.max(0,Math.min(l,n)))),this._ScrV_Props_._scrollTop=a,this._ScrV_Props_._scrollLeft=l}else this._ScrV_Props_._scrollTop=t,this._ScrV_Props_._scrollLeft=e;this._validatePosition(!0,!0),this._updateContentPosition()}},_.prototype._validatePosition=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),t){var i=this.height,r=this._getContentHeight();this._ScrV_Props_._scrollTop=Math.max(this._ScrV_Props_._scrollTop,(0-i)/2),this._ScrV_Props_._scrollTop=Math.min(this._ScrV_Props_._scrollTop,i<r?r-i/2:i/2)}if(e){var o=this.width,n=this._getContentWidth();this._ScrV_Props_._scrollLeft=Math.max(this._ScrV_Props_._scrollLeft,(0-o)/2),this._ScrV_Props_._scrollLeft=Math.min(this._ScrV_Props_._scrollLeft,o<n?n-o/2:o/2)}},_.prototype.$setWidth=function(t){if(this.$getExplicitWidth()==t)return!1;var e=i.prototype.$setWidth.call(this,t);return this._updateContentPosition(),e},_.prototype.$setHeight=function(t){return this.$getExplicitHeight()!=t&&(i.prototype.$setHeight.call(this,t),this._updateContentPosition(),!0)},_.prototype._updateContentPosition=function(){var t=this.height,e=this.width;this.scrollRect=new a.Rectangle(Math.round(this._ScrV_Props_._scrollLeft),Math.round(this._ScrV_Props_._scrollTop),e,t),this.dispatchEvent(new a.Event(a.Event.CHANGE))},_.prototype._checkScrollPolicy=function(){var t=this._ScrV_Props_._horizontalScrollPolicy,e=this.__checkScrollPolicy(t,this._getContentWidth(),this.width);this._ScrV_Props_._hCanScroll=e;var i=this._ScrV_Props_._verticalScrollPolicy,r=this.__checkScrollPolicy(i,this._getContentHeight(),this.height);return this._ScrV_Props_._vCanScroll=r,e||r},_.prototype.__checkScrollPolicy=function(t,e,i){return"on"==t||"off"!=t&&i<e},_.prototype._addEvents=function(){this.addEventListener(a.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.addEventListener(a.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.addEventListener(a.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},_.prototype._removeEvents=function(){this.removeEventListener(a.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.removeEventListener(a.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.removeEventListener(a.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},_.prototype._onTouchBegin=function(t){t.$isDefaultPrevented||this._checkScrollPolicy()&&(this._ScrV_Props_._touchStartPosition.x=t.stageX,this._ScrV_Props_._touchStartPosition.y=t.stageY,(this._ScrV_Props_._isHTweenPlaying||this._ScrV_Props_._isVTweenPlaying)&&this._onScrollFinished(),this._tempStage=this.stage,this._tempStage.addEventListener(a.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.addEventListener(a.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.addEventListener(a.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.addEventListener(a.Event.ENTER_FRAME,this._onEnterFrame,this),this._logTouchEvent(t),t.preventDefault())},_.prototype._onTouchBeginCapture=function(t){var e=this._checkScrollPolicy();if(e){for(var i=t.target;i!=this;){if("_checkScrollPolicy"in i&&(e=i._checkScrollPolicy()))return;i=i.parent}t.stopPropagation();var r=this.cloneTouchEvent(t);this.delayTouchBeginEvent=r,this.touchBeginTimer||(this.touchBeginTimer=new a.Timer(100,1),this.touchBeginTimer.addEventListener(a.TimerEvent.TIMER_COMPLETE,this._onTouchBeginTimer,this)),this.touchBeginTimer.start(),this._onTouchBegin(t)}},_.prototype._onTouchEndCapture=function(t){var e=this;if(this.delayTouchBeginEvent){this._onTouchBeginTimer(),t.stopPropagation();var i=this.cloneTouchEvent(t);a.callLater(function(){e.stage&&e.dispatchPropagationEvent(i)},this)}},_.prototype._onTouchBeginTimer=function(){this.touchBeginTimer.stop();var t=this.delayTouchBeginEvent;this.delayTouchBeginEvent=null,this.stage&&this.dispatchPropagationEvent(t)},_.prototype.dispatchPropagationEvent=function(t){for(var e=t.$target,i=this.$getPropagationList(e),r=i.length,o=.5*i.length,n=-1,s=0;s<r;s++)if(i[s]===this._content){n=s;break}i.splice(0,n+1),o-=n+1,this.$dispatchPropagationEvent(t,i,o),a.Event.release(t)},_.prototype._onTouchMove=function(t){if(this._ScrV_Props_._lastTouchPosition.x!=t.stageX||this._ScrV_Props_._lastTouchPosition.y!=t.stageY){if(!this._ScrV_Props_._scrollStarted){var e=t.stageX-this._ScrV_Props_._touchStartPosition.x,i=t.stageY-this._ScrV_Props_._touchStartPosition.y;if(Math.sqrt(e*e+i*i)<this.scrollBeginThreshold)return void this._logTouchEvent(t)}this._ScrV_Props_._scrollStarted=!0,this.delayTouchBeginEvent&&(this.delayTouchBeginEvent=null,this.touchBeginTimer.stop()),this.touchChildren=!1;var r=this._getPointChange(t);this.setScrollPosition(r.y,r.x,!0),this._calcVelocitys(t),this._logTouchEvent(t)}},_.prototype._onTouchEnd=function(t){this.touchChildren=!0,this._ScrV_Props_._scrollStarted=!1,this._tempStage.removeEventListener(a.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.removeEventListener(a.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.removeEventListener(a.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.removeEventListener(a.Event.ENTER_FRAME,this._onEnterFrame,this),this._moveAfterTouchEnd()},_.prototype._onEnterFrame=function(t){var e=a.getTimer();100<e-this._ScrV_Props_._lastTouchTime&&e-this._ScrV_Props_._lastTouchTime<300&&this._calcVelocitys(this._ScrV_Props_._lastTouchEvent)},_.prototype._logTouchEvent=function(t){this._ScrV_Props_._lastTouchPosition.x=t.stageX,this._ScrV_Props_._lastTouchPosition.y=t.stageY,this._ScrV_Props_._lastTouchEvent=this.cloneTouchEvent(t),this._ScrV_Props_._lastTouchTime=a.getTimer()},_.prototype._getPointChange=function(t){return{x:!1===this._ScrV_Props_._hCanScroll?0:this._ScrV_Props_._lastTouchPosition.x-t.stageX,y:!1===this._ScrV_Props_._vCanScroll?0:this._ScrV_Props_._lastTouchPosition.y-t.stageY}},_.prototype._calcVelocitys=function(t){var e=a.getTimer();if(0!=this._ScrV_Props_._lastTouchTime){var i=this._getPointChange(t),r=e-this._ScrV_Props_._lastTouchTime;i.x/=r,i.y/=r,this._ScrV_Props_._velocitys.push(i),5<this._ScrV_Props_._velocitys.length&&this._ScrV_Props_._velocitys.shift(),this._ScrV_Props_._lastTouchPosition.x=t.stageX,this._ScrV_Props_._lastTouchPosition.y=t.stageY}else this._ScrV_Props_._lastTouchTime=e},_.prototype._getContentWidth=function(){return this._content.$getExplicitWidth()||this._content.width},_.prototype._getContentHeight=function(){return this._content.$getExplicitHeight()||this._content.height},_.prototype.getMaxScrollLeft=function(){var t=this._getContentWidth()-this.width;return Math.max(0,t)},_.prototype.getMaxScrollTop=function(){var t=this._getContentHeight()-this.height;return Math.max(0,t)},_.prototype._moveAfterTouchEnd=function(){if(0!=this._ScrV_Props_._velocitys.length){for(var t={x:0,y:0},e=0,i=0;i<this._ScrV_Props_._velocitys.length;i++){var r=this._ScrV_Props_._velocitys[i],o=_.weight[i];t.x+=r.x*o,t.y+=r.y*o,e+=o}this._ScrV_Props_._velocitys.length=0,this.scrollSpeed<=0&&(this.scrollSpeed=1);var n=t.x/e*this.scrollSpeed,s=t.y/e*this.scrollSpeed,a=Math.abs(n),l=Math.abs(s),h=this.getMaxScrollLeft(),c=this.getMaxScrollTop(),u=.02<a?this.getAnimationDatas(n,this._ScrV_Props_._scrollLeft,h):{position:this._ScrV_Props_._scrollLeft,duration:1},p=.02<l?this.getAnimationDatas(s,this._ScrV_Props_._scrollTop,c):{position:this._ScrV_Props_._scrollTop,duration:1};this.setScrollLeft(u.position,u.duration),this.setScrollTop(p.position,p.duration)}},_.prototype.onTweenFinished=function(t){t==this._ScrV_Props_._vScrollTween&&(this._ScrV_Props_._isVTweenPlaying=!1),t==this._ScrV_Props_._hScrollTween&&(this._ScrV_Props_._isHTweenPlaying=!1),0==this._ScrV_Props_._isHTweenPlaying&&0==this._ScrV_Props_._isVTweenPlaying&&this._onScrollFinished()},_.prototype._onScrollStarted=function(){},_.prototype._onScrollFinished=function(){a.ScrollTween.removeTweens(this),this._ScrV_Props_._hScrollTween=null,this._ScrV_Props_._vScrollTween=null,this._ScrV_Props_._isHTweenPlaying=!1,this._ScrV_Props_._isVTweenPlaying=!1,this.dispatchEvent(new a.Event(a.Event.COMPLETE))},_.prototype.setScrollTop=function(t,e){void 0===e&&(e=0);var i=Math.min(this.getMaxScrollTop(),Math.max(t,0));if(0!=e){0==this._ScrV_Props_._bounces&&(t=i);var r=a.ScrollTween.get(this).to({scrollTop:t},e,a.ScrollEase.quartOut);i!=t&&r.to({scrollTop:i},300,a.ScrollEase.quintOut),this._ScrV_Props_._isVTweenPlaying=!0,(this._ScrV_Props_._vScrollTween=r).call(this.onTweenFinished,this,[r]),this._ScrV_Props_._isHTweenPlaying||this._onScrollStarted()}else this.scrollTop=i},_.prototype.setScrollLeft=function(t,e){void 0===e&&(e=0);var i=Math.min(this.getMaxScrollLeft(),Math.max(t,0));if(0!=e){0==this._ScrV_Props_._bounces&&(t=i);var r=a.ScrollTween.get(this).to({scrollLeft:t},e,a.ScrollEase.quartOut);i!=t&&r.to({scrollLeft:i},300,a.ScrollEase.quintOut),this._ScrV_Props_._isHTweenPlaying=!0,(this._ScrV_Props_._hScrollTween=r).call(this.onTweenFinished,this,[r]),this._ScrV_Props_._isVTweenPlaying||this._onScrollStarted()}else this.scrollLeft=i},_.prototype.getAnimationDatas=function(t,e,i){var r=Math.abs(t),o=0,n=e+500*t;if(n<0||i<n)for(n=e;Math.abs(t)!=1/0&&.02<Math.abs(t);)t*=(n+=t)<0||i<n?.998*.95:.998,o++;else o=500*-Math.log(.02/r);return{position:Math.min(i+50,Math.max(n,-50)),duration:o}},_.prototype.cloneTouchEvent=function(t){var e=new a.TouchEvent(t.type,t.bubbles,t.cancelable);return e.touchPointID=t.touchPointID,e.$stageX=t.stageX,e.$stageY=t.stageY,e.touchDown=t.touchDown,e.$isDefaultPrevented=!1,e.$target=t.target,e},_.prototype.throwNotSupportedError=function(){a.$error(1023)},_.prototype.addChild=function(t){return this.throwNotSupportedError(),null},_.prototype.addChildAt=function(t,e){return this.throwNotSupportedError(),null},_.prototype.removeChild=function(t){return this.throwNotSupportedError(),null},_.prototype.removeChildAt=function(t){return this.throwNotSupportedError(),null},_.prototype.setChildIndex=function(t,e){this.throwNotSupportedError()},_.prototype.swapChildren=function(t,e){this.throwNotSupportedError()},_.prototype.swapChildrenAt=function(t,e){this.throwNotSupportedError()},_}(a.DisplayObjectContainer);t.weight=[1,1.33,1.66,2,2.33],a.ScrollView=t,__reflect(t.prototype,"egret.ScrollView")}(egret||(egret={})),function(t){var e=function(){this._verticalScrollPolicy="auto",this._horizontalScrollPolicy="auto",this._scrollLeft=0,this._scrollTop=0,this._hCanScroll=!1,this._vCanScroll=!1,this._lastTouchPosition=new t.Point(0,0),this._touchStartPosition=new t.Point(0,0),this._scrollStarted=!1,this._lastTouchTime=0,this._lastTouchEvent=null,this._velocitys=[],this._isHTweenPlaying=!1,this._isVTweenPlaying=!1,this._hScrollTween=null,this._vScrollTween=null,this._bounces=!0};t.ScrollViewProperties=e,__reflect(e.prototype,"egret.ScrollViewProperties")}(egret||(egret={})),function(i){i.$getUrl=function(t){var e=t.url;return-1==e.indexOf("?")&&t.method==i.URLRequestMethod.GET&&t.data&&t.data instanceof i.URLVariables&&(e=e+"?"+t.data.toString()),e}}(egret||(egret={})),function(r){var t=function(i){function t(t){void 0===t&&(t=null);var e=i.call(this)||this;return e.dataFormat=r.URLLoaderDataFormat.TEXT,e.data=null,e._request=null,e._status=-1,t&&e.load(t),e}return __extends(t,i),t.prototype.load=function(t){this._request=t,this.data=null,r.NetContext.getNetContext().proceed(this)},t.prototype.__recycle=function(){this._request=null,this.data=null},t}(r.EventDispatcher);r.URLLoader=t,__reflect(t.prototype,"egret.URLLoader")}(egret||(egret={})),function(u){var t=function(i){function t(t){var e=i.call(this)||this;return e.$bitmapData=null,e.offsetPoint=u.Point.create(0,0),e.$movieClipData=null,e.frames=null,e.$totalFrames=0,e.frameLabels=null,e.$frameLabelStart=0,e.$frameLabelEnd=0,e.frameEvents=null,e.frameIntervalTime=0,e.$eventPool=null,e.$isPlaying=!1,e.isStopped=!0,e.playTimes=0,e.$currentFrameNum=0,e.$nextFrameNum=1,e.displayedKeyFrameNum=0,e.passedTime=0,e.$frameRate=NaN,e.lastTime=0,e.$smoothing=u.Bitmap.defaultSmoothing,e.$renderNode=new u.sys.BitmapNode,e.setMovieClipData(t),e}return __extends(t,i),Object.defineProperty(t.prototype,"smoothing",{get:function(){return this.$smoothing},set:function(t){(t=!!t)!=this.$smoothing&&(this.$smoothing=t,this.$invalidate())},enumerable:!0,configurable:!0}),t.prototype.$init=function(){this.$reset();var t=this.$movieClipData;t&&t.$isDataValid()&&(this.frames=t.frames,this.$totalFrames=t.numFrames,this.frameLabels=t.labels,this.frameEvents=t.events,this.$frameRate=t.frameRate,this.frameIntervalTime=1e3/this.$frameRate,this._initFrame())},t.prototype.$reset=function(){this.frames=null,this.playTimes=0,this.$isPlaying=!1,this.setIsStopped(!0),this.$currentFrameNum=0,this.$nextFrameNum=1,this.displayedKeyFrameNum=0,this.passedTime=0,this.$eventPool=[]},t.prototype._initFrame=function(){this.$movieClipData.$isTextureValid()&&(this.advanceFrame(),this.constructFrame())},t.prototype.$render=function(){var t=this.$bitmapData;if(t){var e=Math.round(this.offsetPoint.x),i=Math.round(this.offsetPoint.y),r=t._bitmapWidth,o=t._bitmapHeight,n=t.$getTextureWidth(),s=t.$getTextureHeight(),a=Math.round(t.$getScaleBitmapWidth()),l=Math.round(t.$getScaleBitmapHeight()),h=t._sourceWidth,c=t._sourceHeight;u.sys.BitmapNode.$updateTextureData(this.$renderNode,t._bitmapData,t._bitmapX,t._bitmapY,r,o,e,i,n,s,a,l,h,c,null,u.BitmapFillMode.SCALE,this.$smoothing)}},t.prototype.$measureContentBounds=function(t){var e=this.$bitmapData;if(e){var i=this.offsetPoint.x,r=this.offsetPoint.y,o=e.$getTextureWidth(),n=e.$getTextureHeight();t.setTo(i,r,o,n)}else t.setEmpty()},t.prototype.$onAddToStage=function(t,e){i.prototype.$onAddToStage.call(this,t,e),this.$isPlaying&&1<this.$totalFrames&&this.setIsStopped(!1)},t.prototype.$onRemoveFromStage=function(){i.prototype.$onRemoveFromStage.call(this),this.setIsStopped(!0)},t.prototype.getFrameLabelByName=function(t,e){void 0===e&&(e=!1),e&&(t=t.toLowerCase());var i=this.frameLabels;if(i)for(var r=null,o=0;o<i.length;o++)if(r=i[o],e?r.name.toLowerCase()==t:r.name==t)return r;return null},t.prototype.getFrameStartEnd=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if(t==(i=e[r]).name){this.$frameLabelStart=i.frame,this.$frameLabelEnd=i.end;break}},t.prototype.getFrameLabelByFrame=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if((i=e[r]).frame==t)return i;return null},t.prototype.getFrameLabelForFrame=function(t){var e=null,i=null,r=this.frameLabels;if(r)for(var o=0;o<r.length;o++){if((i=r[o]).frame>t)return e;e=i}return e},t.prototype.play=function(t){void 0===t&&(t=0),this.$isPlaying=!0,this.setPlayTimes(t),1<this.$totalFrames&&this.$stage&&this.setIsStopped(!1)},t.prototype.stop=function(){this.$isPlaying=!1,this.setIsStopped(!0)},t.prototype.prevFrame=function(){this.gotoAndStop(this.$currentFrameNum-1)},t.prototype.nextFrame=function(){this.gotoAndStop(this.$currentFrameNum+1)},t.prototype.gotoAndPlay=function(t,e){void 0===e&&(e=0),(0==arguments.length||2<arguments.length)&&u.$error(1022,"MovieClip.gotoAndPlay()"),"string"==typeof t?this.getFrameStartEnd(t):(this.$frameLabelStart=0,this.$frameLabelEnd=0),this.play(e),this.gotoFrame(t)},t.prototype.gotoAndStop=function(t){1!=arguments.length&&u.$error(1022,"MovieClip.gotoAndStop()"),this.stop(),this.gotoFrame(t)},t.prototype.gotoFrame=function(t){var e;"string"==typeof t?e=this.getFrameLabelByName(t).frame:(e=parseInt(t+"",10))!=t&&u.$error(1022,"Frame Label Not Found"),e<1?e=1:e>this.$totalFrames&&(e=this.$totalFrames),e!=this.$nextFrameNum&&(this.$nextFrameNum=e,this.advanceFrame(),this.constructFrame(),this.handlePendingEvent())},t.prototype.advanceTime=function(t){var e=this,i=t-e.lastTime;e.lastTime=t;var r=e.frameIntervalTime,o=e.passedTime+i;e.passedTime=o%r;var n=o/r;if(n<1)return!1;for(;1<=n;){if(n--,e.$nextFrameNum++,e.$nextFrameNum>e.$totalFrames||0<e.$frameLabelStart&&e.$nextFrameNum>e.$frameLabelEnd)if(-1==e.playTimes)e.$eventPool.push(u.Event.LOOP_COMPLETE),e.$nextFrameNum=1;else{if(e.playTimes--,!(0<e.playTimes)){e.$nextFrameNum=e.$totalFrames,e.$eventPool.push(u.Event.COMPLETE),e.stop();break}e.$eventPool.push(u.Event.LOOP_COMPLETE),e.$nextFrameNum=1}e.$currentFrameNum==e.$frameLabelEnd&&(e.$nextFrameNum=e.$frameLabelStart),e.advanceFrame()}return e.constructFrame(),e.handlePendingEvent(),!1},t.prototype.advanceFrame=function(){this.$currentFrameNum=this.$nextFrameNum;var t=this.frameEvents[this.$nextFrameNum];t&&""!=t&&u.MovieClipEvent.dispatchMovieClipEvent(this,u.MovieClipEvent.FRAME_LABEL,t)},t.prototype.constructFrame=function(){var t=this.$currentFrameNum;this.displayedKeyFrameNum!=t&&(this.$bitmapData=this.$movieClipData.getTextureByFrame(t),this.$movieClipData.$getOffsetByFrame(t,this.offsetPoint),this.$invalidateContentBounds(),this.displayedKeyFrameNum=t)},t.prototype.$renderFrame=function(){this.$bitmapData=this.$movieClipData.getTextureByFrame(this.$currentFrameNum),this.$invalidateContentBounds()},t.prototype.handlePendingEvent=function(){if(0!=this.$eventPool.length){this.$eventPool.reverse();for(var t=this.$eventPool,e=t.length,i=!1,r=!1,o=0;o<e;o++){var n=t.pop();n==u.Event.LOOP_COMPLETE?r=!0:n==u.Event.COMPLETE?i=!0:this.dispatchEventWith(n)}r&&this.dispatchEventWith(u.Event.LOOP_COMPLETE),i&&this.dispatchEventWith(u.Event.COMPLETE)}},Object.defineProperty(t.prototype,"totalFrames",{get:function(){return this.$totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentFrame",{get:function(){return this.$currentFrameNum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentFrameLabel",{get:function(){var t=this.getFrameLabelByFrame(this.$currentFrameNum);return t&&t.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLabel",{get:function(){var t=this.getFrameLabelForFrame(this.$currentFrameNum);return t?t.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameRate",{get:function(){return this.$frameRate},set:function(t){t!=this.$frameRate&&(this.$frameRate=t,this.frameIntervalTime=1e3/this.$frameRate)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this.$isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"movieClipData",{get:function(){return this.$movieClipData},set:function(t){this.setMovieClipData(t)},enumerable:!0,configurable:!0}),t.prototype.setMovieClipData=function(t){this.$movieClipData!=t&&(this.$movieClipData=t,this.$init())},t.prototype.setPlayTimes=function(t){(t<0||1<=t)&&(this.playTimes=t<0?-1:Math.floor(t))},t.prototype.setIsStopped=function(t){this.isStopped!=t&&((this.isStopped=t)?u.sys.$ticker.$stopTick(this.advanceTime,this):(this.playTimes=0==this.playTimes?1:this.playTimes,this.lastTime=u.getTimer(),u.sys.$ticker.$startTick(this.advanceTime,this)))},t}(u.DisplayObject);u.MovieClip=t,__reflect(t.prototype,"egret.MovieClip")}(egret||(egret={})),function(r){var t=function(i){function t(t){void 0===t&&(t=null);var e=i.call(this)||this;return e.data=null,e.method=r.URLRequestMethod.GET,e.url="",e.requestHeaders=[],e.url=t,e}return __extends(t,i),t}(r.HashObject);r.URLRequest=t,__reflect(t.prototype,"egret.URLRequest")}(egret||(egret={})),function(t){var e=function(t,e){this.name="",this.value="",this.name=t,this.value=e};(egret||(egret={})).URLRequestHeader=e,__reflect(e.prototype,"egret.URLRequestHeader")}(),function(t){var e=function(){};e.GET="get",e.POST="post",t.URLRequestMethod=e,__reflect(e.prototype,"egret.URLRequestMethod")}(egret||(egret={})),function(t){var e=function(i){function t(t){void 0===t&&(t=null);var e=i.call(this)||this;return(e.variables=null)!==t&&e.decode(t),e}return __extends(t,i),t.prototype.decode=function(t){this.variables||(this.variables={}),t=t.split("+").join(" ");for(var e,i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);){var r=decodeURIComponent(e[1]),o=decodeURIComponent(e[2]);if(r in this.variables!=0){var n=this.variables[r];n instanceof Array?n.push(o):this.variables[r]=[n,o]}else this.variables[r]=o}},t.prototype.toString=function(){if(!this.variables)return"";var t=this.variables,e=[];for(var i in t)e.push(this.encodeValue(i,t[i]));return e.join("&")},t.prototype.encodeValue=function(t,e){return e instanceof Array?this.encodeArray(t,e):encodeURIComponent(t)+"="+encodeURIComponent(e)},t.prototype.encodeArray=function(e,t){return e?0==t.length?encodeURIComponent(e)+"=":t.map(function(t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&"):""},t}(t.HashObject);t.URLVariables=e,__reflect(e.prototype,"egret.URLVariables")}(egret||(egret={})),function(i){var t=function(e){function t(){var t=e.call(this)||this;return t._timeScale=1,t._paused=!1,t._callIndex=-1,t._lastTime=0,t.callBackList=[],i.sys.$ticker.$startTick(t.update,t),t._lastTime=i.getTimer(),t}return __extends(t,e),t.prototype.update=function(t){var e=t-this._lastTime;if(this._lastTime=t,this._paused)return!1;var i=e*this._timeScale;for(this._callList=this.callBackList.concat(),this._callIndex=0;this._callIndex<this._callList.length;this._callIndex++){var r=this._callList[this._callIndex];r.listener.call(r.thisObject,i)}return this._callIndex=-1,this._callList=null,!1},t.prototype.register=function(t,e,i){void 0===i&&(i=0),this.$insertEventBin(this.callBackList,"",t,e,!1,i,!1)},t.prototype.unregister=function(t,e){this.$removeEventBin(this.callBackList,t,e)},t.prototype.setTimeScale=function(t){this._timeScale=t},t.prototype.getTimeScale=function(){return this._timeScale},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1},t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t}(i.EventDispatcher);i.Ticker=t,__reflect(t.prototype,"egret.Ticker")}(egret||(egret={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"stage",{get:function(){return i.sys.$TempStage},enumerable:!0,configurable:!0}),Object.defineProperty(e,"runtimeType",{get:function(){return i.$warn(1041,"egret.MainContext.runtimeType","egret.Capabilities.runtimeType"),e._runtimeType},enumerable:!0,configurable:!0}),e.prototype.run=function(){},Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}(i.EventDispatcher);t.deviceType=null,t.DEVICE_PC="web",t.DEVICE_MOBILE="native",t.RUNTIME_HTML5="runtimeHtml5",t.RUNTIME_NATIVE="runtimeNative",i.MainContext=t,__reflect(t.prototype,"egret.MainContext")}(egret||(egret={}));var egret,testDeviceType1=function(){if(!this.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")},testRuntimeType1=function(){return!!this.navigator};egret.MainContext.deviceType=testDeviceType1()?egret.MainContext.DEVICE_MOBILE:egret.MainContext.DEVICE_PC,egret.MainContext._runtimeType=testRuntimeType1()?egret.MainContext.RUNTIME_HTML5:egret.MainContext.RUNTIME_NATIVE,delete testDeviceType1,delete testRuntimeType1,function(t){var e=function(i){function r(t){void 0===t&&(t=300);var e=i.call(this)||this;return e.objectPool=[],e._length=0,t<1&&(t=1),e.autoDisposeTime=t,e.frameCount=0,e}return __extends(r,i),r.$init=function(){t.sys.$ticker.$startTick(r.onUpdate,r)},r.onUpdate=function(t){for(var e=r._callBackList,i=e.length-1;0<=i;i--)e[i].$checkFrame();return!1},r.prototype.$checkFrame=function(){this.frameCount--,this.frameCount<=0&&this.dispose()},Object.defineProperty(r.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),r.prototype.push=function(t){var e=this.objectPool;-1==e.indexOf(t)&&(e.push(t),t.__recycle&&t.__recycle(),this._length++,0==this.frameCount&&(this.frameCount=this.autoDisposeTime,r._callBackList.push(this)))},r.prototype.pop=function(){return 0==this._length?null:(this._length--,this.objectPool.pop())},r.prototype.dispose=function(){0<this._length&&(this.objectPool=[],this._length=0),this.frameCount=0;var t=r._callBackList,e=t.indexOf(this);-1!=e&&t.splice(e,1)},r}(t.HashObject);e._callBackList=[],t.Recycler=e,__reflect(e.prototype,"egret.Recycler"),e.$init()}(egret||(egret={})),function(s){function a(t){var e=t-u;for(var i in u=t,l){var r=l[i];r.delay-=e,r.delay<=0&&(r.delay=r.originDelay,r.listener.apply(r.thisObject,r.params))}return!1}var l={},h=0,c=0,u=0;s.setInterval=function(t,e,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var n={listener:t,thisObject:e,delay:i,originDelay:i,params:r};return 1==++c&&(u=s.getTimer(),s.sys.$ticker.$startTick(a,null)),l[++h]=n,h},s.clearInterval=function(t){l[t]&&(c--,delete l[t],0==c&&s.sys.$ticker.$stopTick(a,null))}}(egret||(egret={})),function(s){function n(t){l[t]&&(c--,delete l[t],0==c&&s.sys.$ticker&&s.sys.$ticker.$stopTick(a,null))}function a(t){var e=t-u;for(var i in u=t,l){var r=i,o=l[r];o.delay-=e,o.delay<=0&&(o.listener.apply(o.thisObject,o.params),n(r))}return!1}var l={},h=0,c=0,u=0;s.setTimeout=function(t,e,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var n={listener:t,thisObject:e,delay:i,params:r};return 1==++c&&s.sys.$ticker&&(u=s.getTimer(),s.sys.$ticker.$startTick(a,null)),l[++h]=n,h},s.clearTimeout=n}(egret||(egret={}));
var egret,__reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};!function(t){var e=function(){function e(){t.$error(1014)}return e.get=function(e){return e<-1&&(e=-1),1<e&&(e=1),function(t){return 0==e?t:e<0?t*(t*-e+1+e):t*((2-t)*e+(1-e))}},e.getPowIn=function(e){return function(t){return Math.pow(t,e)}},e.getPowOut=function(e){return function(t){return 1-Math.pow(1-t,e)}},e.getPowInOut=function(e){return function(t){return(t*=2)<1?.5*Math.pow(t,e):1-.5*Math.abs(Math.pow(2-t,e))}},e.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},e.sineOut=function(t){return Math.sin(t*Math.PI/2)},e.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},e.getBackIn=function(e){return function(t){return t*t*((e+1)*t-e)}},e.getBackOut=function(e){return function(t){return--t*t*((e+1)*t+e)+1}},e.getBackInOut=function(e){return e*=1.525,function(t){return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},e.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},e.circOut=function(t){return Math.sqrt(1- --t*t)},e.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},e.bounceIn=function(t){return 1-e.bounceOut(1-t)},e.bounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},e.bounceInOut=function(t){return t<.5?.5*e.bounceIn(2*t):.5*e.bounceOut(2*t-1)+.5},e.getElasticIn=function(n,i){var s=2*Math.PI;return function(t){if(0==t||1==t)return t;var e=i/s*Math.asin(1/n);return-n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*s/i)}},e.getElasticOut=function(n,i){var s=2*Math.PI;return function(t){if(0==t||1==t)return t;var e=i/s*Math.asin(1/n);return n*Math.pow(2,-10*t)*Math.sin((t-e)*s/i)+1}},e.getElasticInOut=function(n,i){var s=2*Math.PI;return function(t){var e=i/s*Math.asin(1/n);return(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*s/i)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*s/i)*.5+1}},e}();e.quadIn=e.getPowIn(2),e.quadOut=e.getPowOut(2),e.quadInOut=e.getPowInOut(2),e.cubicIn=e.getPowIn(3),e.cubicOut=e.getPowOut(3),e.cubicInOut=e.getPowInOut(3),e.quartIn=e.getPowIn(4),e.quartOut=e.getPowOut(4),e.quartInOut=e.getPowInOut(4),e.quintIn=e.getPowIn(5),e.quintOut=e.getPowOut(5),e.quintInOut=e.getPowInOut(5),e.backIn=e.getBackIn(1.7),e.backOut=e.getBackOut(1.7),e.backInOut=e.getBackInOut(1.7),e.elasticIn=e.getElasticIn(1,.3),e.elasticOut=e.getElasticOut(1,.3),e.elasticInOut=e.getElasticInOut(1,.3*1.5),t.Ease=e,__reflect(e.prototype,"egret.Ease")}(egret||(egret={})),function(r){var t=function(s){function f(t,e,n){var i=s.call(this)||this;return i._target=null,i._useTicks=!1,i.ignoreGlobalPause=!1,i.loop=!1,i.pluginData=null,i._steps=null,i.paused=!1,i.duration=0,i._prevPos=-1,i.position=null,i._prevPosition=0,i._stepPosition=0,i.passive=!1,i.initialize(t,e,n),i}return __extends(f,s),f.get=function(t,e,n,i){return void 0===n&&(n=null),void 0===i&&(i=!1),i&&f.removeTweens(t),new f(t,e,n)},f.removeTweens=function(t){if(t.tween_count){for(var e=f._tweens,n=e.length-1;0<=n;n--)e[n]._target==t&&(e[n].paused=!0,e.splice(n,1));t.tween_count=0}},f.pauseTweens=function(t){if(t.tween_count)for(var e=r.Tween._tweens,n=e.length-1;0<=n;n--)e[n]._target==t&&(e[n].paused=!0)},f.resumeTweens=function(t){if(t.tween_count)for(var e=r.Tween._tweens,n=e.length-1;0<=n;n--)e[n]._target==t&&(e[n].paused=!1)},f.tick=function(t,e){void 0===e&&(e=!1);var n=t-f._lastTime;f._lastTime=t;for(var i=f._tweens.concat(),s=i.length-1;0<=s;s--){var r=i[s];e&&!r.ignoreGlobalPause||r.paused||r.$tick(r._useTicks?1:n)}return!1},f._register=function(t,e){var n=t._target,i=f._tweens;if(e)n&&(n.tween_count=0<n.tween_count?n.tween_count+1:1),i.push(t),f._inited||(f._lastTime=r.getTimer(),r.sys.$ticker.$startTick(f.tick,null),f._inited=!0);else{n&&n.tween_count--;for(var s=i.length;s--;)if(i[s]==t)return void i.splice(s,1)}},f.removeAllTweens=function(){for(var t=f._tweens,e=0,n=t.length;e<n;e++){var i=t[e];i.paused=!0,i._target.tweenjs_count=0}t.length=0},f.prototype.initialize=function(t,e,n){this._target=t,e&&(this._useTicks=e.useTicks,this.ignoreGlobalPause=e.ignoreGlobalPause,this.loop=e.loop,e.onChange&&this.addEventListener("change",e.onChange,e.onChangeObj),e.override&&f.removeTweens(t)),this.pluginData=n||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],e&&e.paused?this.paused=!0:f._register(this,!0),e&&null!=e.position&&this.setPosition(e.position,f.NONE)},f.prototype.setPosition=function(t,e){void 0===e&&(e=1),t<0&&(t=0);var n=t,i=!1;if(n>=this.duration&&(this.loop?n%=this.duration:(n=this.duration,i=!0)),n==this._prevPos)return i;i&&this.setPaused(!0);var s=this._prevPos;if(this.position=this._prevPos=n,this._prevPosition=t,this._target&&0<this._steps.length){for(var r=this._steps.length,o=-1,u=0;u<r&&!("step"==this._steps[u].type&&(o=u,this._steps[u].t<=n&&this._steps[u].t+this._steps[u].d>=n));u++);for(u=0;u<r;u++)if("action"==this._steps[u].type)0!=e&&(this._useTicks?this._runAction(this._steps[u],n,n):1==e&&n<s?(s!=this.duration&&this._runAction(this._steps[u],s,this.duration),this._runAction(this._steps[u],0,n,!0)):this._runAction(this._steps[u],s,n));else if("step"==this._steps[u].type&&o==u){var p=this._steps[o];this._updateTargetProps(p,Math.min((this._stepPosition=n-p.t)/p.d,1))}}return this.dispatchEventWith("change"),i},f.prototype._runAction=function(t,e,n,i){void 0===i&&(i=!1);var s=e,r=n;n<e&&(s=n,r=e);var o=t.t;(o==r||s<o&&o<r||i&&o==e)&&t.f.apply(t.o,t.p)},f.prototype._updateTargetProps=function(t,e){var n,i,s,r,o,u;if(t||1!=e){if(this.passive=!!t.v,this.passive)return;t.e&&(e=t.e(e,0,1,1)),n=t.p0,i=t.p1}else this.passive=!1,n=i=this._curQueueProps;for(var p in this._initQueueProps){null==(r=n[p])&&(n[p]=r=this._initQueueProps[p]),null==(o=i[p])&&(i[p]=o=r),s=r==o||0==e||1==e||"number"!=typeof r?1==e?o:r:r+(o-r)*e;var a=!1;if(u=f._plugins[p])for(var h=0,c=u.length;h<c;h++){var _=u[h].tween(this,p,s,n,i,e,!!t&&n==i,!t);_==f.IGNORE?a=!0:s=_}a||(this._target[p]=s)}},f.prototype.setPaused=function(t){return this.paused=t,f._register(this,!t),this},f.prototype._cloneProps=function(t){var e={};for(var n in t)e[n]=t[n];return e},f.prototype._addStep=function(t){return 0<t.d&&(t.type="step",this._steps.push(t),t.t=this.duration,this.duration+=t.d),this},f.prototype._appendQueueProps=function(t){var e,n,i,s,r;for(var o in t)if(void 0===this._initQueueProps[o]){if(n=this._target[o],e=f._plugins[o])for(i=0,s=e.length;i<s;i++)n=e[i].init(this,o,n);this._initQueueProps[o]=this._curQueueProps[o]=void 0===n?null:n}else n=this._curQueueProps[o];for(var o in t){if(n=this._curQueueProps[o],e=f._plugins[o])for(r=r||{},i=0,s=e.length;i<s;i++)e[i].step&&e[i].step(this,o,n,t[o],r);this._curQueueProps[o]=t[o]}return r&&this._appendQueueProps(r),this._curQueueProps},f.prototype._addAction=function(t){return t.t=this.duration,t.type="action",this._steps.push(t),this},f.prototype._set=function(t,e){for(var n in t)e[n]=t[n]},f.prototype.wait=function(t,e){if(null==t||t<=0)return this;var n=this._cloneProps(this._curQueueProps);return this._addStep({d:t,p0:n,p1:n,v:e})},f.prototype.to=function(t,e,n){return void 0===n&&(n=void 0),(isNaN(e)||e<0)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:n,p1:this._cloneProps(this._appendQueueProps(t))}),this.set(t)},f.prototype.call=function(t,e,n){return void 0===e&&(e=void 0),void 0===n&&(n=void 0),this._addAction({f:t,p:n||[],o:e||this._target})},f.prototype.set=function(t,e){return void 0===e&&(e=null),this._appendQueueProps(t),this._addAction({f:this._set,o:this,p:[t,e||this._target]})},f.prototype.play=function(t){return t||(t=this),this.call(t.setPaused,t,[!1])},f.prototype.pause=function(t){return t||(t=this),this.call(t.setPaused,t,[!0])},f.prototype.$tick=function(t){this.paused||this.setPosition(this._prevPosition+t)},f}(r.EventDispatcher);t.NONE=0,t.LOOP=1,t.REVERSE=2,t._tweens=[],t.IGNORE={},t._plugins={},t._inited=!1,t._lastTime=0,r.Tween=t,__reflect(t.prototype,"egret.Tween")}(egret||(egret={})),function(a){!function(t){function e(t,e,n,i){var s=t.prototype;s.__meta__=s.__meta__||{},s.__meta__[e]=n,i&&(s.__defaultProperty__=e)}var n=function(e){function t(){var t=e.apply(this,arguments)||this;return t.name="",t}return __extends(t,e),t}(a.EventDispatcher);t.BasePath=n,__reflect(n.prototype,"egret.tween.BasePath");var i=function(e){function t(){var t=e.apply(this,arguments)||this;return t.props=void 0,t.duration=500,t.ease=void 0,t}return __extends(t,e),t}(n);t.To=i,__reflect(i.prototype,"egret.tween.To");var s=function(e){function t(){var t=e.apply(this,arguments)||this;return t.duration=500,t.passive=void 0,t}return __extends(t,e),t}(n);t.Wait=s,__reflect(s.prototype,"egret.tween.Wait");var r=function(e){function t(){var t=e.apply(this,arguments)||this;return t.props=void 0,t}return __extends(t,e),t}(n);t.Set=r,__reflect(r.prototype,"egret.tween.Set");var o=function(e){function t(){var t=e.apply(this,arguments)||this;return t.delta=0,t}return __extends(t,e),t}(n);t.Tick=o,__reflect(o.prototype,"egret.tween.Tick");var u=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},set:function(t){this._props=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paths",{get:function(){return this._paths},set:function(t){this._paths=t||[]},enumerable:!0,configurable:!0}),e.prototype.play=function(t){this.tween?(this.tween.setPaused(!1),null!=t&&this.tween.setPosition(t)):this.createTween()},e.prototype.pause=function(){this.tween&&this.tween.setPaused(!0)},e.prototype.stop=function(){this.pause(),this.tween=null},e.prototype.createTween=function(){this.tween=a.Tween.get(this._target,this._props),this._paths&&this.applyPaths()},e.prototype.applyPaths=function(){for(var t=0;t<this._paths.length;t++){var e=this._paths[t];this.applyPath(e)}},e.prototype.applyPath=function(t){var e=this;t instanceof i?this.tween.to(t.props,t.duration,function(t){if("function"==typeof t)return t;var e=a.Ease[t];return"function"==typeof e?e:null}(t.ease)):t instanceof s?this.tween.wait(t.duration,t.passive):t instanceof r?this.tween.set(t.props):t instanceof o&&this.tween.$tick(t.delta),this.tween.call(function(){return e.pathComplete(t)})},e.prototype.pathComplete=function(t){t.dispatchEventWith("complete"),this.dispatchEventWith("pathComplete",!1,t);var e=this._paths.indexOf(t);0<=e&&e===this._paths.length-1&&this.dispatchEventWith("complete")},e}(a.EventDispatcher);t.TweenItem=u,__reflect(u.prototype,"egret.tween.TweenItem"),e(u,"paths","Array",!0);var p=function(e){function t(){var t=e.call(this)||this;return t.completeCount=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"items",{get:function(){return this._items},set:function(t){this.completeCount=0,this.registerEvent(!1),this._items=t,this.registerEvent(!0)},enumerable:!0,configurable:!0}),t.prototype.registerEvent=function(e){var n=this;this._items&&this._items.forEach(function(t){e?t.addEventListener("complete",n.itemComplete,n):t.removeEventListener("complete",n.itemComplete,n)})},t.prototype.play=function(t){if(this._items)for(var e=0;e<this._items.length;e++){this._items[e].play(t)}},t.prototype.pause=function(){if(this._items)for(var t=0;t<this._items.length;t++){this._items[t].pause()}},t.prototype.stop=function(){if(this._items)for(var t=0;t<this._items.length;t++){this._items[t].stop()}},t.prototype.itemComplete=function(t){var e=t.currentTarget;this.completeCount++,this.dispatchEventWith("itemComplete",!1,e),this.completeCount===this.items.length&&(this.dispatchEventWith("complete"),this.completeCount=0)},t}(a.EventDispatcher);t.TweenGroup=p,__reflect(p.prototype,"egret.tween.TweenGroup"),e(p,"items","Array",!0)}(a.tween||(a.tween={}))}(egret||(egret={}));
var RES,egret,__reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};!function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.resourceConfig=null,e.resourceConfig=r.configInstance,e}return __extends(e,t),e.prototype.addSubkey=function(e,t){this.resourceConfig.addSubkey(e,t)},e.prototype.loadFile=function(e,t,r){},e.prototype.getRes=function(e){},e.prototype.destroyRes=function(e){return!1},e.getStringPrefix=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(0,t):""},e.getStringTail=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(t+1):""},e}(egret.HashObject);r.AnalyzerBase=e,__reflect(e.prototype,"RES.AnalyzerBase")}(RES||(RES={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.fileDic={},e.resItemDic=[],e._dataFormat=egret.HttpResponseType.ARRAY_BUFFER,e.recycler=[],e}return __extends(e,t),e.prototype.loadFile=function(e,t,r){if(this.fileDic[e.name])t.call(r,e);else{var i=this.getRequest();this.resItemDic[i.hashCode]={item:e,func:t,thisObject:r},i.open(n.$getVirtualUrl(e.url)),i.send()}},e.prototype.getRequest=function(){var e=this.recycler.pop();return e||((e=new egret.HttpRequest).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e.responseType=this._dataFormat,e},e.prototype.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;i.loaded=e.type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t.response),this.recycler.push(t),n.call(r.thisObject,i)},e.prototype.analyzeData=function(e,t){var r=e.name;this.fileDic[r]||""!=t&&!t||(this.fileDic[r]=t)},e.prototype.getRes=function(e){return this.fileDic[e]},e.prototype.hasRes=function(e){return null!=this.getRes(e)},e.prototype.destroyRes=function(e){return!!this.fileDic[e]&&(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0)},e.prototype.onResourceDestroy=function(e){},e}(n.AnalyzerBase);n.BinAnalyzer=e,__reflect(e.prototype,"RES.BinAnalyzer")}(RES||(RES={})),function(e){var t=function(){function e(e,t,r){this.groupName="",this.data=null,this._loaded=!1,this.name=e,this.url=t,this.type=r}return Object.defineProperty(e.prototype,"loaded",{get:function(){return this.data?this.data.loaded:this._loaded},set:function(e){this.data&&(this.data.loaded=e),this._loaded=e},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return'[ResourceItem name="'+this.name+'" url="'+this.url+'" type="'+this.type+'"]'},e}();t.TYPE_XML="xml",t.TYPE_IMAGE="image",t.TYPE_BIN="bin",t.TYPE_TEXT="text",t.TYPE_JSON="json",t.TYPE_SHEET="sheet",t.TYPE_FONT="font",t.TYPE_SOUND="sound",e.ResourceItem=t,__reflect(t.prototype,"RES.ResourceItem")}(RES||(RES={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.sheetMap={},e.textureMap={},e.recyclerIamge=[],e._dataFormat=egret.HttpResponseType.TEXT,e}return __extends(e,t),e.prototype.getRes=function(e){var t=this.fileDic[e];if(t||(t=this.textureMap[e]),!t){var r=n.AnalyzerBase.getStringPrefix(e);if(t=this.fileDic[r]){var i=n.AnalyzerBase.getStringTail(e);t=t.getTexture(i)}}return t},e.prototype.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var o=this.analyzeConfig(i,t.response);if(o)return this.loadImage(o,r),void this.recycler.push(t)}else{var s=new egret.Texture;s._setBitmapData(t.data),this.analyzeBitmap(i,s)}t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),n.call(r.thisObject,i)},e.prototype.analyzeConfig=function(t,r){var e,i=t.name,n="";try{var o=r;e=JSON.parse(o)}catch(e){egret.$warn(1017,t.url,r)}return e&&(this.sheetMap[i]=e,n=this.getRelativePath(t.url,e.file)),n},e.prototype.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=e.data&&e.data.subkeys?"":r,o=this.parseSpriteSheet(t,i,n);this.fileDic[r]=o}},e.prototype.getRelativePath=function(e,t){var r=(e=e.split("\\").join("/")).match(/#.*|\?.*/),i="";r&&(i=r[0]);var n=e.lastIndexOf("/");return(e=-1!=n?e.substring(0,n+1)+t:t)+i},e.prototype.parseSpriteSheet=function(e,t,r){var i=t.frames;if(!i)return null;var n=new egret.SpriteSheet(e),o=this.textureMap;for(var s in i){var a=i[s],u=n.createTexture(s,a.x,a.y,a.w,a.h,a.offX,a.offY,a.sourceW,a.sourceH);if(a.scale9grid){var l=a.scale9grid.split(",");u.scale9Grid=new egret.Rectangle(parseInt(l[0]),parseInt(l[1]),parseInt(l[2]),parseInt(l[3]))}null==o[s]&&(o[s]=u,r&&this.addSubkey(s,r))}return n},e.prototype.destroyRes=function(e){var t=this.fileDic[e];if(t){delete this.fileDic[e];var r=void 0;for(var i in t._textureMap)null==r&&(r=t._textureMap[i],this.onResourceDestroy(r),r=null),delete this.textureMap[i];return t.dispose&&t.dispose(),!0}return!1},e.prototype.loadImage=function(e,t){var r=this.getImageLoader();this.resItemDic[r.hashCode]=t,r.load(n.$getVirtualUrl(e))},e.prototype.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||((e=new egret.ImageLoader).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},e.prototype.onResourceDestroy=function(e){e&&e.dispose()},e}(n.BinAnalyzer);n.SheetAnalyzer=e,__reflect(e.prototype,"RES.SheetAnalyzer")}(RES||(RES={})),RES||(RES={}),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.fileDic={},e.resItemDic=[],e.recycler=[],e}return __extends(e,t),e.prototype.loadFile=function(e,t,r){if(this.fileDic[e.name])t.call(r,e);else{var i=this.getLoader();this.resItemDic[i.$hashCode]={item:e,func:t,thisObject:r},i.load(n.$getVirtualUrl(e.url))}},e.prototype.getLoader=function(){var e=this.recycler.pop();return e||((e=new egret.ImageLoader).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},e.prototype.onLoadFinish=function(e){var t=e.$target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,n=r.func;if(i.loaded=e.$type==egret.Event.COMPLETE,i.loaded){var o=new egret.Texture;o._setBitmapData(t.data),this.analyzeData(i,o)}this.recycler.push(t),n.call(r.thisObject,i)},e.prototype.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){this.fileDic[r]=t;var i=e.data;if(i&&i.scale9grid){var n=i.scale9grid.split(",");t.scale9Grid=new egret.Rectangle(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3]))}}},e.prototype.getRes=function(e){return this.fileDic[e]},e.prototype.hasRes=function(e){return null!=this.getRes(e)},e.prototype.destroyRes=function(e){return!!this.fileDic[e]&&(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0)},e.prototype.onResourceDestroy=function(e){e.dispose()},e}(n.AnalyzerBase);n.ImageAnalyzer=e,__reflect(e.prototype,"RES.ImageAnalyzer")}(RES||(RES={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e._dataFormat=egret.HttpResponseType.TEXT,e}return __extends(e,t),e}(e.BinAnalyzer);e.TextAnalyzer=t,__reflect(t.prototype,"RES.TextAnalyzer")}(RES||(RES={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e._dataFormat=egret.HttpResponseType.TEXT,e}return __extends(e,t),e.prototype.analyzeData=function(t,r){var e=t.name;if(!this.fileDic[e]&&r)try{var i=r;this.fileDic[e]=JSON.parse(i)}catch(e){egret.$warn(1017,t.url,r)}},e}(e.BinAnalyzer);e.JsonAnalyzer=t,__reflect(t.prototype,"RES.JsonAnalyzer")}(RES||(RES={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.thread=2,e.loadingCount=0,e.callBack=null,e.resInstance=null,e.groupTotalDic={},e.numLoadedDic={},e.itemListDic={},e.groupErrorDic={},e.retryTimesDic={},e.maxRetryTimes=3,e.failedList=new Array,e.priorityQueue={},e.lazyLoadList=new Array,e.analyzerDic={},e.queueIndex=0,e}return __extends(e,t),e.prototype.isGroupInLoading=function(e){return void 0!==this.itemListDic[e]},e.prototype.loadGroup=function(e,t,r){if(void 0===r&&(r=0),!this.itemListDic[t]&&t){if(!e||0==e.length){egret.$warn(3201,t);var i=new s.ResourceEvent(s.ResourceEvent.GROUP_LOAD_ERROR);return i.groupName=t,void this.dispatchEvent(i)}this.priorityQueue[r]?this.priorityQueue[r].push(t):this.priorityQueue[r]=[t];for(var n=(this.itemListDic[t]=e).length,o=0;o<n;o++){e[o].groupName=t}this.groupTotalDic[t]=e.length,this.numLoadedDic[t]=0,this.next()}},e.prototype.loadItem=function(e){this.lazyLoadList.push(e),e.groupName="",this.next()},e.prototype.next=function(){for(;this.loadingCount<this.thread;){var e=this.getOneResourceItem();if(!e)break;if(this.loadingCount++,e.loaded)this.onItemComplete(e);else this.resInstance.$getAnalyzerByType(e.type).loadFile(e,this.onItemComplete,this)}},e.prototype.getOneResourceItem=function(){if(0<this.failedList.length)return this.failedList.shift();var e=Number.NEGATIVE_INFINITY;for(var t in this.priorityQueue)e=Math.max(e,t);var r=this.priorityQueue[e];if(!r||0==r.length)return 0==this.lazyLoadList.length?null:this.lazyLoadList.pop();for(var i,n=r.length,o=0;o<n&&(this.queueIndex>=n&&(this.queueIndex=0),!(0<(i=this.itemListDic[r[this.queueIndex]]).length));o++)this.queueIndex++;return 0==i.length?null:i.shift()},e.prototype.onItemComplete=function(e){this.loadingCount--;var t=e.groupName;if(!e.loaded){var r=this.retryTimesDic[e.name]||1;if(!(r>this.maxRetryTimes))return this.retryTimesDic[e.name]=r+1,this.failedList.push(e),void this.next();delete this.retryTimesDic[e.name],s.ResourceEvent.dispatchResourceEvent(this.resInstance,s.ResourceEvent.ITEM_LOAD_ERROR,t,e)}if(t){this.numLoadedDic[t]++;var i=this.numLoadedDic[t],n=this.groupTotalDic[t];if(e.loaded||(this.groupErrorDic[t]=!0),s.ResourceEvent.dispatchResourceEvent(this.resInstance,s.ResourceEvent.GROUP_PROGRESS,t,e,i,n),i==n){var o=this.groupErrorDic[t];this.removeGroupName(t),delete this.groupTotalDic[t],delete this.numLoadedDic[t],delete this.itemListDic[t],delete this.groupErrorDic[t],o?s.ResourceEvent.dispatchResourceEvent(this,s.ResourceEvent.GROUP_LOAD_ERROR,t):s.ResourceEvent.dispatchResourceEvent(this,s.ResourceEvent.GROUP_COMPLETE,t)}}else this.callBack.call(this.resInstance,e);this.next()},e.prototype.removeGroupName=function(e){for(var t in this.priorityQueue){for(var r=this.priorityQueue[t],i=0,n=!1,o=r.length,s=0;s<o;s++){if(r[s]==e){r.splice(i,1),n=!0;break}i++}if(n){0==r.length&&delete this.priorityQueue[t];break}}},e}(egret.EventDispatcher);s.ResourceLoader=e,__reflect(e.prototype,"RES.ResourceLoader")}(RES||(RES={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.analyzeConfig=function(e,t){var r,i=e.name,n="";try{var o=t;r=JSON.parse(o)}catch(e){}return r?n=this.getRelativePath(e.url,r.file):(r=t,n=this.getTexturePath(e.url,r)),this.sheetMap[i]=r,n},t.prototype.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=new egret.BitmapFont(t,i);this.fileDic[r]=n}},t.prototype.getTexturePath=function(e,t){var r="",i=t.split("\n")[2],n=i.indexOf('file="');return-1!=n&&(n=(i=i.substring(n+6)).indexOf('"'),r=i.substring(0,n)),-1!=(n=(e=e.split("\\").join("/")).lastIndexOf("/"))?e.substring(0,n+1)+r:r},t.prototype.onResourceDestroy=function(e){e&&e.dispose()},t}(e.SheetAnalyzer);e.FontAnalyzer=t,__reflect(t.prototype,"RES.FontAnalyzer")}(RES||(RES={})),function(r){var e=function(){function e(){this.keyMap={},this.groupDic={},r.configInstance=this}return e.prototype.getGroupByName=function(e){var t=new Array;if(!this.groupDic[e])return t;for(var r=this.groupDic[e],i=r.length,n=0;n<i;n++){var o=r[n];t.push(this.parseResourceItem(o))}return t},e.prototype.getRawGroupByName=function(e){return this.groupDic[e]?this.groupDic[e]:[]},e.prototype.createGroup=function(e,t,r){if(void 0===r&&(r=!1),!r&&this.groupDic[e]||!t||0==t.length)return!1;for(var i=this.groupDic,n=[],o=t.length,s=0;s<o;s++){var a=t[s],u=i[a];if(u)for(var l=u.length,c=0;c<l;c++){var p=u[c];-1==n.indexOf(p)&&n.push(p)}else(p=this.keyMap[a])?-1==n.indexOf(p)&&n.push(p):egret.$warn(3200,a)}return 0!=n.length&&(this.groupDic[e]=n,!0)},e.prototype.parseConfig=function(e,t){if(e){var r=e.resources;if(r)for(var i=r.length,n=0;n<i;n++){var o=(f=r[n]).url;o&&-1==o.indexOf("://")&&(f.url=t+o),this.addItemToKeyMap(f)}var s=e.groups;if(s){var a=s.length;for(n=0;n<a;n++){for(var u=s[n],l=[],c=u.keys.split(","),p=c.length,h=0;h<p;h++){var f,d=c[h].trim();(f=this.keyMap[d])&&-1==l.indexOf(f)&&l.push(f)}this.groupDic[u.name]=l}}}},e.prototype.addSubkey=function(e,t){var r=this.keyMap[t];r&&!this.keyMap[e]&&(this.keyMap[e]=r)},e.prototype.addItemToKeyMap=function(e){if(this.keyMap[e.name]||(this.keyMap[e.name]=e),e.hasOwnProperty("subkeys"))for(var t=e.subkeys.split(","),r=(e.subkeys=t).length,i=0;i<r;i++){var n=t[i];null==this.keyMap[n]&&(this.keyMap[n]=e)}},e.prototype.getName=function(e){var t=this.keyMap[e];return t?t.name:""},e.prototype.getType=function(e){var t=this.keyMap[e];return t?t.type:""},e.prototype.getRawResourceItem=function(e){return this.keyMap[e]},e.prototype.getResourceItem=function(e){var t=this.keyMap[e];return t?this.parseResourceItem(t):null},e.prototype.parseResourceItem=function(e){var t=new r.ResourceItem(e.name,e.url,e.type);return t.data=e,t},e}();r.ResourceConfig=e,__reflect(e.prototype,"RES.ResourceConfig")}(RES||(RES={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e._dataFormat=egret.HttpResponseType.TEXT,e}return __extends(e,t),e.prototype.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t)try{var i=t,n=egret.XML.parse(i);this.fileDic[r]=n}catch(e){}},e}(e.BinAnalyzer);e.XMLAnalyzer=t,__reflect(t.prototype,"RES.XMLAnalyzer")}(RES||(RES={})),function(e){var t=function(n){function u(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var i=n.call(this,e,t,r)||this;return i.itemsLoaded=0,i.itemsTotal=0,i.groupName="",i.resItem=null,i}return __extends(u,n),u.dispatchResourceEvent=function(e,t,r,i,n,o){void 0===r&&(r=""),void 0===i&&(i=null),void 0===n&&(n=0),void 0===o&&(o=0);var s=egret.Event.create(u,t);s.groupName=r,s.resItem=i,s.itemsLoaded=n,s.itemsTotal=o;var a=e.dispatchEvent(s);return egret.Event.release(s),a},u}(egret.Event);t.ITEM_LOAD_ERROR="itemLoadError",t.CONFIG_COMPLETE="configComplete",t.CONFIG_LOAD_ERROR="configLoadError",t.GROUP_PROGRESS="groupProgress",t.GROUP_COMPLETE="groupComplete",t.GROUP_LOAD_ERROR="groupLoadError",e.ResourceEvent=t,__reflect(t.prototype,"RES.ResourceEvent")}(RES||(RES={})),function(e){var t,r;t=e.web||(e.web={}),r=function(t){function e(){var e=t.call(this)||this;return e._versionInfo={},e}return __extends(e,t),e.prototype.fetchVersion=function(e){e.onSuccess(null)},e.prototype.getChangeList=function(){return[]},e.prototype.getVirtualUrl=function(e){return e},e}(egret.EventDispatcher),t.Html5VersionController=r,__reflect(r.prototype,"RES.web.Html5VersionController",["RES.VersionController","RES.IVersionController"]),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(e.VersionController=r)}(RES||(RES={})),function(e){var t,r;t=e.native||(e.native={}),r=function(){function e(){this._versionInfo={},this._versionPath="",this._localFileArr=[]}return e.prototype.fetchVersion=function(r){var i=this;if(i._versionPath="all.manifest",i._versionInfo=i.getLocalData(i._versionPath),null!=i._versionInfo){var n=0,e=function(e){if(e)for(var t=0;t<e.length;t++)e[t]&&""!=e[t]&&i._localFileArr.push("resource/"+e[t]);2==++n&&r.onSuccess(null)};i.getList(e,"assets","resource"),i.getList(e,"update","resource")}else egret.callLater(function(){r.onFail(1,null)},i)},e.prototype.getList=function(t,e,r){void 0===r&&(r="");var i=egret.PromiseObject.create();i.onSuccessFunc=function(e){t(e)},i.onErrorFunc=function(){console.error("list files error")},"assets"==e?egret_native.Game.listResource(r,i):egret_native.Game.listUpdate(r,i)},e.prototype.getChangeList=function(){var e=[],t=this._localFileArr;for(var r in this._versionInfo)t.indexOf(this.getVirtualUrl(r))<0&&e.push({url:this.getVirtualUrl(r),size:this._versionInfo[r].s});return e},e.prototype.getVirtualUrl=function(e){return this._versionInfo&&this._versionInfo[e]?"resource/"+this._versionInfo[e].v.substring(0,2)+"/"+this._versionInfo[e].v+"_"+this._versionInfo[e].s+"."+e.substring(e.lastIndexOf(".")+1):e},e.prototype.getLocalData=function(e){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var t=egret_native.readUpdateFileSync(e);if(null!=t)return JSON.parse(t);if(null!=(t=egret_native.readResourceFileSync(e)))return JSON.parse(t)}return null},e}(),t.NativeVersionController=r,__reflect(r.prototype,"RES.native.NativeVersionController",["RES.VersionController","RES.IVersionController"]),egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(e.VersionController=r)}(RES||(RES={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.soundDic={},e.resItemDic=[],e}return __extends(e,t),e.prototype.loadFile=function(e,t,r){if(this.soundDic[e.name])t.call(r,e);else{var i=new egret.Sound;i.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this),this.resItemDic[i.$hashCode]={item:e,func:t,thisObject:r},i.load(n.$getVirtualUrl(e.url)),e.data&&(i.type=e.data.soundType)}},e.prototype.onLoadFinish=function(e){var t=e.$target;t.removeEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this);var r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,n=r.func;i.loaded=e.$type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t),n.call(r.thisObject,i)},e.prototype.analyzeData=function(e,t){var r=e.name;!this.soundDic[r]&&t&&(this.soundDic[r]=t)},e.prototype.getRes=function(e){return this.soundDic[e]},e.prototype.hasRes=function(e){return!!this.getRes(e)},e.prototype.destroyRes=function(e){return!!this.soundDic[e]&&(delete this.soundDic[e],!0)},e}(n.AnalyzerBase);n.SoundAnalyzer=e,__reflect(e.prototype,"RES.SoundAnalyzer")}(RES||(RES={})),function(l){l.registerAnalyzer=function(e,t){o.registerAnalyzer(e,t)},l.getAnalyzer=function(e){return o.$getAnalyzerByType(e)},l.registerVersionController=function(e){o.$registerVersionController(e)},l.getVersionController=function(){return o.vcs},l.loadConfig=function(e,t,r){void 0===t&&(t=""),void 0===r&&(r="json"),o.loadConfig(e,t,r)},l.loadGroup=function(e,t){void 0===t&&(t=0),o.loadGroup(e,t)},l.isGroupLoaded=function(e){return o.isGroupLoaded(e)},l.getGroupByName=function(e){return o.getGroupByName(e)},l.createGroup=function(e,t,r){return void 0===r&&(r=!1),o.createGroup(e,t,r)},l.hasRes=function(e){return o.hasRes(e)},l.parseConfig=function(e,t){void 0===t&&(t=""),o.parseConfig(e,t)},l.getRes=function(e){return o.getRes(e)},l.getResAsync=function(e,t,r){o.getResAsync(e,t,r)},l.getResByUrl=function(e,t,r,i){void 0===i&&(i=""),o.getResByUrl(e,t,r,i)},l.destroyRes=function(e,t){return o.destroyRes(e,t)},l.setMaxLoadingThread=function(e){o.setMaxLoadingThread(e)},l.setMaxRetryTimes=function(e){o.setMaxRetryTimes(e)},l.addEventListener=function(e,t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=0),o.addEventListener(e,t,r,i,n)},l.removeEventListener=function(e,t,r,i){void 0===i&&(i=!1),o.removeEventListener(e,t,r,i)},l.$getVirtualUrl=function(e){return o.vcs?o.vcs.getVirtualUrl(e):e};var e=function(t){function u(){var e=t.call(this)||this;return e.analyzerDic={},e.analyzerClassMap={},e.configItemList=[],e.callLaterFlag=!1,e.configComplete=!1,e.loadedGroups=[],e.groupNameList=[],e.asyncDic={},e._loadedUrlTypes={},e.init(),e}return __extends(u,t),u.prototype.$getAnalyzerByType=function(e){var t=this.analyzerDic[e];if(!t){var r=this.analyzerClassMap[e];if(!r)return null;t=this.analyzerDic[e]=new r}return t},u.prototype.registerAnalyzer=function(e,t){this.analyzerClassMap[e]=t},u.prototype.$registerVersionController=function(e){this.vcs=e},u.prototype.init=function(){this.vcs=new l.VersionController;var e=this.analyzerClassMap;e[l.ResourceItem.TYPE_BIN]=l.BinAnalyzer,e[l.ResourceItem.TYPE_IMAGE]=l.ImageAnalyzer,e[l.ResourceItem.TYPE_TEXT]=l.TextAnalyzer,e[l.ResourceItem.TYPE_JSON]=l.JsonAnalyzer,e[l.ResourceItem.TYPE_SHEET]=l.SheetAnalyzer,e[l.ResourceItem.TYPE_FONT]=l.FontAnalyzer,e[l.ResourceItem.TYPE_SOUND]=l.SoundAnalyzer,e[l.ResourceItem.TYPE_XML]=l.XMLAnalyzer,this.resConfig=new l.ResourceConfig,this.resLoader=new l.ResourceLoader,this.resLoader.callBack=this.onResourceItemComp,(this.resLoader.resInstance=this).resLoader.addEventListener(l.ResourceEvent.GROUP_COMPLETE,this.onGroupComp,this),this.resLoader.addEventListener(l.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupError,this)},u.prototype.loadConfig=function(e,t,r){void 0===r&&(r="json");var i={url:e,resourceRoot:t,type:r};this.configItemList.push(i),this.callLaterFlag||(egret.callLater(this.startLoadConfig,this),this.callLaterFlag=!0)},u.prototype.startLoadConfig=function(){var r=this;this.callLaterFlag=!1;var e=this.configItemList;this.configItemList=[];for(var t=(this.loadingConfigList=e).length,i=[],n=0;n<t;n++){var o=e[n],s=new l.ResourceItem(o.url,o.url,o.type);i.push(s)}var a={onSuccess:function(e){r.resLoader.loadGroup(i,u.GROUP_CONFIG,Number.MAX_VALUE)},onFail:function(e,t){l.ResourceEvent.dispatchResourceEvent(r,l.ResourceEvent.CONFIG_LOAD_ERROR)}};this.vcs?this.vcs.fetchVersion(a):this.resLoader.loadGroup(i,u.GROUP_CONFIG,Number.MAX_VALUE)},u.prototype.isGroupLoaded=function(e){return-1!=this.loadedGroups.indexOf(e)},u.prototype.getGroupByName=function(e){return this.resConfig.getGroupByName(e)},u.prototype.loadGroup=function(e,t){if(void 0===t&&(t=0),-1==this.loadedGroups.indexOf(e)){if(!this.resLoader.isGroupInLoading(e))if(this.configComplete){var r=this.resConfig.getGroupByName(e);this.resLoader.loadGroup(r,e,t)}else this.groupNameList.push({name:e,priority:t})}else l.ResourceEvent.dispatchResourceEvent(this,l.ResourceEvent.GROUP_COMPLETE,e)},u.prototype.createGroup=function(e,t,r){if(void 0===r&&(r=!1),r){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1)}return this.resConfig.createGroup(e,t,r)},u.prototype.onGroupComp=function(e){if(e.groupName==u.GROUP_CONFIG){for(var t=this.loadingConfigList.length,r=0;r<t;r++){var i=this.loadingConfigList[r],n=this.$getAnalyzerByType(i.type),o=n.getRes(i.url);n.destroyRes(i.url),this.resConfig.parseConfig(o,i.resourceRoot)}this.configComplete=!0,this.loadingConfigList=null,l.ResourceEvent.dispatchResourceEvent(this,l.ResourceEvent.CONFIG_COMPLETE),this.loadDelayGroups()}else this.loadedGroups.push(e.groupName),this.dispatchEvent(e)},u.prototype.loadDelayGroups=function(){var e=this.groupNameList;this.groupNameList=[];for(var t=e.length,r=0;r<t;r++){var i=e[r];this.loadGroup(i.name,i.priority)}},u.prototype.onGroupError=function(e){e.groupName==u.GROUP_CONFIG?(this.loadingConfigList=null,l.ResourceEvent.dispatchResourceEvent(this,l.ResourceEvent.CONFIG_LOAD_ERROR)):this.dispatchEvent(e)},u.prototype.hasRes=function(e){var t=this.resConfig.getType(e);if(""==t){var r=l.AnalyzerBase.getStringTail(e);if(""==(t=this.resConfig.getType(r)))return!1}return!0},u.prototype.parseConfig=function(e,t){this.resConfig.parseConfig(e,t),this.configComplete||this.loadingConfigList||(this.configComplete=!0,this.loadDelayGroups())},u.prototype.getRes=function(e){var t=this.resConfig.getType(e);if(""==t){var r=l.AnalyzerBase.getStringPrefix(e);if(""==(t=this.resConfig.getType(r)))return null}return this.$getAnalyzerByType(t).getRes(e)},u.prototype.getResAsync=function(e,t,r){var i=this.resConfig.getType(e),n=this.resConfig.getName(e);if(""!=i||(n=l.AnalyzerBase.getStringPrefix(e),""!=(i=this.resConfig.getType(n)))){var o=this.$getAnalyzerByType(i).getRes(e);if(o)egret.$callAsync(t,r,o,e);else{var s={key:e,compFunc:t,thisObject:r};if(this.asyncDic[n])this.asyncDic[n].push(s);else{this.asyncDic[n]=[s];var a=this.resConfig.getResourceItem(n);this.resLoader.loadItem(a)}}}else egret.$callAsync(t,r)},u.prototype.getResByUrl=function(e,t,r,i){if(void 0===i&&(i=""),e){i||(i=this.getTypeByUrl(e)),null!=this._loadedUrlTypes[e]&&this._loadedUrlTypes[e]!=i&&egret.$warn(3202),this._loadedUrlTypes[e]=i;var n=e,o=this.$getAnalyzerByType(i).getRes(n);if(o)egret.$callAsync(t,r,o,e);else{var s={key:n,compFunc:t,thisObject:r};if(this.asyncDic[n])this.asyncDic[n].push(s);else{this.asyncDic[n]=[s];var a=new l.ResourceItem(n,e,i);this.resLoader.loadItem(a)}}}else egret.$callAsync(t,r)},u.prototype.getTypeByUrl=function(e){var t,r=e.substr(e.lastIndexOf(".")+1);switch(r&&(r=r.toLowerCase()),r){case l.ResourceItem.TYPE_XML:case l.ResourceItem.TYPE_JSON:case l.ResourceItem.TYPE_SHEET:t=r;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":t=l.ResourceItem.TYPE_IMAGE;break;case"fnt":t=l.ResourceItem.TYPE_FONT;break;case"txt":t=l.ResourceItem.TYPE_TEXT;break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":t=l.ResourceItem.TYPE_SOUND;break;default:t=l.ResourceItem.TYPE_BIN}return t},u.prototype.onResourceItemComp=function(e){var t=this.asyncDic[e.name];delete this.asyncDic[e.name];for(var r=this.$getAnalyzerByType(e.type),i=t.length,n=0;n<i;n++){var o=t[n],s=r.getRes(o.key);o.compFunc.call(o.thisObject,s,o.key)}},u.prototype.destroyRes=function(e,t){void 0===t&&(t=!0);var r=this.resConfig.getRawGroupByName(e);if(r&&0<r.length){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1);for(var n=r.length,o=0;o<n;o++){var s=r[o];if(!t&&this.isResInLoadedGroup(s.name));else s.loaded=!1,this.$getAnalyzerByType(s.type).destroyRes(s.name),this.removeLoadedGroupsByItemName(s.name)}return!0}var a=this.resConfig.getType(e);if(""==a)return null!=(a=this._loadedUrlTypes[e])&&""!=a&&(delete this._loadedUrlTypes[e],this.$getAnalyzerByType(a).destroyRes(e),!0);(s=this.resConfig.getRawResourceItem(e)).loaded=!1;var u=this.$getAnalyzerByType(a).destroyRes(e);return this.removeLoadedGroupsByItemName(s.name),u},u.prototype.removeLoadedGroupsByItemName=function(e){for(var t=this.loadedGroups,r=t.length,i=0;i<r;i++)for(var n=this.resConfig.getRawGroupByName(t[i]),o=n.length,s=0;s<o;s++){if(n[s].name==e){t.splice(i,1),i--,r=t.length;break}}},u.prototype.isResInLoadedGroup=function(e){for(var t=this.loadedGroups,r=t.length,i=0;i<r;i++)for(var n=this.resConfig.getRawGroupByName(t[i]),o=n.length,s=0;s<o;s++){if(n[s].name==e)return!0}return!1},u.prototype.setMaxLoadingThread=function(e){e<1&&(e=1),this.resLoader.thread=e},u.prototype.setMaxRetryTimes=function(e){e=Math.max(e,0),this.resLoader.maxRetryTimes=e},u}(egret.EventDispatcher);e.GROUP_CONFIG="RES__CONFIG",__reflect(e.prototype,"Resource");var o=new e}(RES||(RES={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.sheetMap={},e.recyclerIamge=[],e._dataFormat=egret.HttpResponseType.TEXT,e}return __extends(e,t),e.prototype.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var o=this.analyzeConfig(i,t.response);if(o)return this.loadImage(o,r),void this.recycler.push(t)}else this.analyzeBitmap(i,t.data);t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),n.call(r.thisObject,i)},e.prototype.analyzeConfig=function(t,r){var e,i=t.name,n="";try{var o=r;e=JSON.parse(o)}catch(e){egret.$warn(1017,t.url,r)}if(e)if((this.sheetMap[i]=e).file)n=this.getRelativePath(t.url,e.file);else{var s=t.url.split("?"),a=s[0].split("/");a[a.length-1]=a[a.length-1].split(".")[0]+".png",n="";for(var u=0;u<a.length;u++)n+=a[u]+(u<a.length-1?"/":"");2==s.length&&(n+=s[2])}return n},e.prototype.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=e.data&&e.data.subkeys?"":r,o=this.parseAnimation(t,i,n);this.fileDic[r]=o}},e.prototype.getRelativePath=function(e,t){var r=(e=e.split("\\").join("/")).lastIndexOf("/");return-1!=r?e.substring(0,r+1)+t:t},e.prototype.parseAnimation=function(e,t,r){for(var i,n=Object.keys(t.mc),o=t.mc[n[0]].frames,s=o.length,a=0;a<s;a++){i=t.res[o[a].res];var u=new egret.Texture;u._bitmapData=e,u.$initData(i.x,i.y,i.w,i.h,o[a].x,o[a].y,o[a].sourceW,o[a].sourceH,e.width,e.height)}return[]},e.prototype.destroyRes=function(e){return!!this.fileDic[e]&&(delete this.fileDic[e],!0)},e.prototype.loadImage=function(e,t){var r=this.getImageLoader();this.resItemDic[r.hashCode]=t,r.load(i.$getVirtualUrl(e))},e.prototype.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||((e=new egret.ImageLoader).addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},e}(i.BinAnalyzer);i.AnimationAnalyzer=e,__reflect(e.prototype,"RES.AnimationAnalyzer")}(RES||(RES={})),function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.en_US=e.$locale_strings.en_US||{};var t=e.$locale_strings.en_US;t[3200]="RES.createGroup() passed in non-existed key value in configuration: {0}",t[3201]='RES loaded non-existed or empty resource group:"{0}"',t[3202]="Do not use the different types of ways to load the same material!",t[3203]="Can't find the analyzer of the specified file type:{0}。 Please register the specified analyzer in the initialization of the project first,then start the resource loading process。"}(egret||(egret={})),function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.zh_CN=e.$locale_strings.zh_CN||{};var t=e.$locale_strings.zh_CN;t[3200]="RES.createGroup()传入了配置中不存在的键值: {0}",t[3201]='RES加载了不存在或空的资源组:"{0}"',t[3202]="请不要使用不同的类型方式来加载同一个素材！",t[3203]="找不到指定文件类型的解析器:{0}。 请先在项目初始化里注册指定文件类型的解析器，再启动资源加载。"}(egret||(egret={}));
var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,EXML,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui,eui;!function(t){!function(t){var e=function(e){function t(){var t=e.call(this)||this;return t.targetLevel=Number.POSITIVE_INFINITY,t.invalidatePropertiesFlag=!1,t.invalidateClientPropertiesFlag=!1,t.invalidatePropertiesQueue=new i,t.invalidateSizeFlag=!1,t.invalidateClientSizeFlag=!1,t.invalidateSizeQueue=new i,t.invalidateDisplayListFlag=!1,t.invalidateDisplayListQueue=new i,t.eventDisplay=new egret.Bitmap,t.listenersAttached=!1,t}return __extends(t,e),t.prototype.invalidateProperties=function(t){this.invalidatePropertiesFlag||(this.invalidatePropertiesFlag=!0,this.listenersAttached||this.attachListeners()),this.targetLevel<=t.$nestLevel&&(this.invalidateClientPropertiesFlag=!0),this.invalidatePropertiesQueue.insert(t)},t.prototype.validateProperties=function(){for(var t=this.invalidatePropertiesQueue,e=t.shift();e;)e.$stage&&e.validateProperties(),e=t.shift();t.isEmpty()&&(this.invalidatePropertiesFlag=!1)},t.prototype.invalidateSize=function(t){this.invalidateSizeFlag||(this.invalidateSizeFlag=!0,this.listenersAttached||this.attachListeners()),this.targetLevel<=t.$nestLevel&&(this.invalidateClientSizeFlag=!0),this.invalidateSizeQueue.insert(t)},t.prototype.validateSize=function(){for(var t=this.invalidateSizeQueue,e=t.pop();e;)e.$stage&&e.validateSize(),e=t.pop();t.isEmpty()&&(this.invalidateSizeFlag=!1)},t.prototype.invalidateDisplayList=function(t){this.invalidateDisplayListFlag||(this.invalidateDisplayListFlag=!0,this.listenersAttached||this.attachListeners()),this.invalidateDisplayListQueue.insert(t)},t.prototype.validateDisplayList=function(){for(var t=this.invalidateDisplayListQueue,e=t.shift();e;)e.$stage&&e.validateDisplayList(),e=t.shift();t.isEmpty()&&(this.invalidateDisplayListFlag=!1)},t.prototype.attachListeners=function(){this.eventDisplay.addEventListener(egret.Event.ENTER_FRAME,this.doPhasedInstantiationCallBack,this),this.eventDisplay.addEventListener(egret.Event.RENDER,this.doPhasedInstantiationCallBack,this),egret.sys.$invalidateRenderFlag=!0,this.listenersAttached=!0},t.prototype.doPhasedInstantiationCallBack=function(t){this.eventDisplay.removeEventListener(egret.Event.ENTER_FRAME,this.doPhasedInstantiationCallBack,this),this.eventDisplay.removeEventListener(egret.Event.RENDER,this.doPhasedInstantiationCallBack,this),this.doPhasedInstantiation()},t.prototype.doPhasedInstantiation=function(){this.invalidatePropertiesFlag&&this.validateProperties(),this.invalidateSizeFlag&&this.validateSize(),this.invalidateDisplayListFlag&&this.validateDisplayList(),this.invalidatePropertiesFlag||this.invalidateSizeFlag||this.invalidateDisplayListFlag?this.attachListeners():this.listenersAttached=!1},t.prototype.validateClient=function(t){var e,i=!1,n=this.targetLevel;this.targetLevel===Number.POSITIVE_INFINITY&&(this.targetLevel=t.$nestLevel);for(var r=this.invalidatePropertiesQueue,o=this.invalidateSizeQueue,s=this.invalidateDisplayListQueue;!i;){for(i=!0,e=r.removeSmallestChild(t);e;)e.$stage&&e.validateProperties(),e=r.removeSmallestChild(t);for(r.isEmpty()&&(this.invalidatePropertiesFlag=!1),this.invalidateClientPropertiesFlag=!1,e=o.removeLargestChild(t);e;){if(e.$stage&&e.validateSize(),this.invalidateClientPropertiesFlag&&(e=r.removeSmallestChild(t))){r.insert(e),i=!1;break}e=o.removeLargestChild(t)}for(o.isEmpty()&&(this.invalidateSizeFlag=!1),this.invalidateClientPropertiesFlag=!1,this.invalidateClientSizeFlag=!1,e=s.removeSmallestChild(t);e;){if(e.$stage&&e.validateDisplayList(),this.invalidateClientPropertiesFlag&&(e=r.removeSmallestChild(t))){r.insert(e),i=!1;break}if(this.invalidateClientSizeFlag&&(e=o.removeLargestChild(t))){o.insert(e),i=!1;break}e=s.removeSmallestChild(t)}s.isEmpty()&&(this.invalidateDisplayListFlag=!1)}n===Number.POSITIVE_INFINITY&&(this.targetLevel=Number.POSITIVE_INFINITY)},t}(egret.EventDispatcher);t.Validator=e,__reflect(e.prototype,"eui.sys.Validator");var i=function(){function t(){this.depthBins={},this.minDepth=0,this.maxDepth=-1}return t.prototype.insert=function(t){var e=t.$nestLevel;this.maxDepth<this.minDepth?this.minDepth=this.maxDepth=e:(e<this.minDepth&&(this.minDepth=e),e>this.maxDepth&&(this.maxDepth=e));var i=this.depthBins[e];i||(i=this.depthBins[e]=new n),i.insert(t)},t.prototype.pop=function(){var t,e=this.minDepth;if(e<=this.maxDepth){for(var i=this.depthBins[this.maxDepth];!i||0===i.length;){if(this.maxDepth--,this.maxDepth<e)return null;i=this.depthBins[this.maxDepth]}for(t=i.pop();!(i&&0!=i.length||(this.maxDepth--,this.maxDepth<e));)i=this.depthBins[this.maxDepth]}return t},t.prototype.shift=function(){var t,e=this.maxDepth;if(this.minDepth<=e){for(var i=this.depthBins[this.minDepth];!i||0===i.length;){if(this.minDepth++,this.minDepth>e)return null;i=this.depthBins[this.minDepth]}for(t=i.pop();!(i&&0!=i.length||(this.minDepth++,this.minDepth>e));)i=this.depthBins[this.minDepth]}return t},t.prototype.removeLargestChild=function(t){for(var e=t.$hashCode,i=t.$nestLevel,n=this.maxDepth,r=i;r<=n;){var o=this.depthBins[n];if(o&&0<o.length){if(n===i){if(o.map[e])return o.remove(t),t}else{if(!egret.is(t,"egret.DisplayObjectContainer"))break;for(var s=o.items,a=o.length,h=0;h<a;h++){var l=s[h];if(t.contains(l))return o.remove(l),l}}n--}else if(n==this.maxDepth&&this.maxDepth--,--n<r)break}return null},t.prototype.removeSmallestChild=function(t){for(var e=t.$nestLevel,i=e,n=this.maxDepth,r=t.$hashCode;i<=n;){var o=this.depthBins[i];if(o&&0<o.length){if(i===e){if(o.map[r])return o.remove(t),t}else{if(!egret.is(t,"egret.DisplayObjectContainer"))break;for(var s=o.items,a=o.length,h=0;h<a;h++){var l=s[h];if(t.contains(l))return o.remove(l),l}}i++}else if(i==this.minDepth&&this.minDepth++,n<++i)break}return null},t.prototype.isEmpty=function(){return this.minDepth>this.maxDepth},t}();__reflect(i.prototype,"DepthQueue");var n=function(){function t(){this.map={},this.items=[],this.length=0}return t.prototype.insert=function(t){var e=t.$hashCode;this.map[e]||(this.map[e]=!0,this.length++,this.items.push(t))},t.prototype.pop=function(){var t=this.items.pop();return t&&(this.length--,0===this.length?this.map={}:this.map[t.$hashCode]=!1),t},t.prototype.remove=function(t){var e=this.items.indexOf(t);0<=e&&(this.items.splice(e,1),this.length--,0===this.length?this.map={}:this.map[t.$hashCode]=!1)},t}();__reflect(n.prototype,"DepthBin")}(t.sys||(t.sys={}))}(eui||(eui={})),(eui||(eui={})).registerProperty=function(t,e,i,n){var r=t.prototype;r.__meta__=r.__meta__||{},r.__meta__[e]=i,n&&(r.__defaultProperty__=e)},function(a){!function(p){function c(t){return 1===t.a&&0===t.b&&0===t.c&&1===t.d}function u(t,e){if("function"!=typeof t[e])return!1;var i=t[e].toString(),n=i.indexOf("{"),r=i.lastIndexOf("}");return""==(i=i.substring(n+1,r)).trim()}function r(t,e){for(var i in e)"prototype"!=i&&e.hasOwnProperty(i)&&(t[i]=e[i]);for(var n=t.prototype,r=e.prototype,o=Object.keys(r),s=o.length,a=0;a<s;a++){var h=o[a];if("__meta__"!=h&&(!n.hasOwnProperty(h)||u(n,h))){var l=Object.getOwnPropertyDescriptor(r,h);Object.defineProperty(n,h,l)}}}var s="eui.UIComponent",i=new p.Validator,o=function(e){function t(){var t=e.call(this)||this;return t.initializeUIValues(),t}return __extends(t,e),t.prototype.initializeUIValues=function(){this.$UIComponent={0:NaN,1:NaN,2:NaN,3:NaN,4:NaN,5:NaN,6:NaN,7:NaN,8:NaN,9:NaN,10:0,11:0,12:0,13:1e5,14:0,15:1e5,16:0,17:0,18:NaN,19:NaN,20:0,21:0,22:0,23:0,24:!0,25:!0,26:!0,27:!1,28:!1,29:!1},this.$includeInLayout=!0,this.$touchEnabled=!0},t.prototype.createChildren=function(){},t.prototype.childrenCreated=function(){},t.prototype.commitProperties=function(){var t=this.$UIComponent;(t[22]!=t[10]||t[23]!=t[11])&&(this.dispatchEventWith(egret.Event.RESIZE),t[22]=t[10],t[23]=t[11]),(t[20]!=this.$getX()||t[21]!=this.$getY())&&(a.UIEvent.dispatchUIEvent(this,a.UIEvent.MOVE),t[20]=this.$getX(),t[21]=this.$getY())},t.prototype.measure=function(){},t.prototype.updateDisplayList=function(t,e){},Object.defineProperty(t.prototype,"includeInLayout",{get:function(){return this.$includeInLayout},set:function(t){t=!!t,this.$includeInLayout!==t&&(this.$includeInLayout=!0,this.invalidateParentLayout(),this.$includeInLayout=t)},enumerable:!0,configurable:!0}),t.prototype.$onAddToStage=function(t,e){this.$super.$onAddToStage.call(this,t,e),this.checkInvalidateFlag();var i=this.$UIComponent;i[29]||(i[29]=!0,this.createChildren(),this.childrenCreated(),a.UIEvent.dispatchUIEvent(this,a.UIEvent.CREATION_COMPLETE))},t.prototype.checkInvalidateFlag=function(t){var e=this.$UIComponent;e[24]&&i.invalidateProperties(this),e[25]&&i.invalidateSize(this),e[26]&&i.invalidateDisplayList(this)},Object.defineProperty(t.prototype,"left",{get:function(){return this.$UIComponent[0]},set:function(t){t=t&&"number"!=typeof t?t.toString().trim():+t;var e=this.$UIComponent;e[0]!==t&&(e[0]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.$UIComponent[1]},set:function(t){t=t&&"number"!=typeof t?t.toString().trim():+t;var e=this.$UIComponent;e[1]!==t&&(e[1]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.$UIComponent[2]},set:function(t){t=t&&"number"!=typeof t?t.toString().trim():+t;var e=this.$UIComponent;e[2]!==t&&(e[2]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.$UIComponent[3]},set:function(t){t=t&&"number"!=typeof t?t.toString().trim():+t;var e=this.$UIComponent;e[3]!=t&&(e[3]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalCenter",{get:function(){return this.$UIComponent[4]},set:function(t){t=t&&"number"!=typeof t?t.toString().trim():+t;var e=this.$UIComponent;e[4]!==t&&(e[4]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalCenter",{get:function(){return this.$UIComponent[5]},set:function(t){t=t&&"number"!=typeof t?t.toString().trim():+t;var e=this.$UIComponent;e[5]!==t&&(e[5]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"percentWidth",{get:function(){return this.$UIComponent[6]},set:function(t){t=+t;var e=this.$UIComponent;e[6]!==t&&(e[6]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"percentHeight",{get:function(){return this.$UIComponent[7]},set:function(t){t=+t;var e=this.$UIComponent;e[7]!==t&&(e[7]=t,this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"explicitWidth",{get:function(){return this.$UIComponent[8]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"explicitHeight",{get:function(){return this.$UIComponent[9]},enumerable:!0,configurable:!0}),t.prototype.$getWidth=function(){return this.validateSizeNow(),this.$UIComponent[10]},t.prototype.$setWidth=function(t){t=+t;var e=this.$UIComponent;return!(t<0||e[10]===t&&e[8]===t)&&(e[8]=t,isNaN(t)&&this.invalidateSize(),this.invalidateProperties(),this.invalidateDisplayList(),this.invalidateParentLayout(),!0)},t.prototype.validateSizeNow=function(){this.validateSize(!0),this.updateFinalSize()},t.prototype.$getHeight=function(){return this.validateSizeNow(),this.$UIComponent[11]},t.prototype.$setHeight=function(t){t=+t;var e=this.$UIComponent;return!(t<0||e[11]===t&&e[9]===t)&&(e[9]=t,isNaN(t)&&this.invalidateSize(),this.invalidateProperties(),this.invalidateDisplayList(),this.invalidateParentLayout(),!0)},Object.defineProperty(t.prototype,"minWidth",{get:function(){return this.$UIComponent[12]},set:function(t){t=+t||0;var e=this.$UIComponent;t<0||e[12]===t||(e[12]=t,this.invalidateSize(),this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this.$UIComponent[13]},set:function(t){t=+t||0;var e=this.$UIComponent;t<0||e[13]===t||(e[13]=t,this.invalidateSize(),this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minHeight",{get:function(){return this.$UIComponent[14]},set:function(t){t=+t||0;var e=this.$UIComponent;t<0||e[14]===t||(e[14]=t,this.invalidateSize(),this.invalidateParentLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxHeight",{get:function(){return this.$UIComponent[15]},set:function(t){t=+t||0;var e=this.$UIComponent;t<0||e[15]===t||(e[15]=t,this.invalidateSize(),this.invalidateParentLayout())},enumerable:!0,configurable:!0}),t.prototype.setMeasuredSize=function(t,e){var i=this.$UIComponent;i[16]=Math.ceil(+t||0),i[17]=Math.ceil(+e||0)},t.prototype.setActualSize=function(t,e){var i=!1,n=this.$UIComponent;n[10]!==t&&(n[10]=t,i=!0),n[11]!==e&&(n[11]=e,i=!0),i&&(this.invalidateDisplayList(),this.dispatchEventWith(egret.Event.RESIZE))},t.prototype.$invalidateMatrix=function(){this.$super.$invalidateMatrix.call(this),this.invalidateParentLayout()},t.prototype.$setMatrix=function(t,e){return void 0===e&&(e=!0),this.$super.$setMatrix.call(this,t,e),this.invalidateParentLayout(),!0},t.prototype.$setAnchorOffsetX=function(t){return this.$super.$setAnchorOffsetX.call(this,t),this.invalidateParentLayout(),!0},t.prototype.$setAnchorOffsetY=function(t){return this.$super.$setAnchorOffsetY.call(this,t),this.invalidateParentLayout(),!0},t.prototype.$setX=function(t){var e=this.$super.$setX.call(this,t);return e&&(this.invalidateParentLayout(),this.invalidateProperties()),e},t.prototype.$setY=function(t){var e=this.$super.$setY.call(this,t);return e&&(this.invalidateParentLayout(),this.invalidateProperties()),e},t.prototype.invalidateProperties=function(){var t=this.$UIComponent;t[24]||(t[24]=!0,this.$stage&&i.invalidateProperties(this))},t.prototype.validateProperties=function(){var t=this.$UIComponent;t[24]&&(this.commitProperties(),t[24]=!1)},t.prototype.invalidateSize=function(){var t=this.$UIComponent;t[25]||(t[25]=!0,this.$stage&&i.invalidateSize(this))},t.prototype.validateSize=function(t){if(t){var e=this.$children;if(e)for(var i=e.length,n=0;n<i;n++){var r=e[n];egret.is(r,s)&&r.validateSize(!0)}}var o=this.$UIComponent;o[25]&&(this.measureSizes()&&(this.invalidateDisplayList(),this.invalidateParentLayout()),o[25]=!1)},t.prototype.measureSizes=function(){var t=!1,e=this.$UIComponent;if(!e[25])return t;(isNaN(e[8])||isNaN(e[9]))&&(this.measure(),e[16]<e[12]&&(e[16]=e[12]),e[16]>e[13]&&(e[16]=e[13]),e[17]<e[14]&&(e[17]=e[14]),e[17]>e[15]&&(e[17]=e[15]));var i=this.getPreferredUWidth(),n=this.getPreferredUHeight();return(i!==e[18]||n!==e[19])&&(e[18]=i,e[19]=n,t=!0),t},t.prototype.invalidateDisplayList=function(){var t=this.$UIComponent;t[26]||(t[26]=!0,this.$stage&&i.invalidateDisplayList(this))},t.prototype.validateDisplayList=function(){var t=this.$UIComponent;t[26]&&(this.updateFinalSize(),this.updateDisplayList(t[10],t[11]),t[26]=!1)},t.prototype.updateFinalSize=function(){var t,e,i=this.$UIComponent;t=i[27]?i[10]:isNaN(i[8])?i[16]:i[8],e=i[28]?i[11]:isNaN(i[9])?i[17]:i[9],this.setActualSize(t,e)},t.prototype.validateNow=function(){this.$stage&&i.validateClient(this)},t.prototype.invalidateParentLayout=function(){var t=this.$parent;t&&this.$includeInLayout&&egret.is(t,s)&&(t.invalidateSize(),t.invalidateDisplayList())},t.prototype.setLayoutBoundsSize=function(t,e){if(t=+t,!((e=+e)<0||t<0)){var i,n,r=this.$UIComponent,o=r[13],s=r[15],a=Math.min(r[12],o),h=Math.min(r[14],s);isNaN(t)?(r[27]=!1,i=this.getPreferredUWidth()):(r[27]=!0,i=Math.max(a,Math.min(o,t))),isNaN(e)?(r[28]=!1,n=this.getPreferredUHeight()):(r[28]=!0,n=Math.max(h,Math.min(s,e)));var l=this.getAnchorMatrix();if(c(l))return void this.setActualSize(i,n);var u=p.MatrixUtil.fitBounds(t,e,l,r[8],r[9],this.getPreferredUWidth(),this.getPreferredUHeight(),a,h,o,s);u||(u=egret.Point.create(a,h)),this.setActualSize(u.x,u.y),egret.Point.release(u)}},t.prototype.setLayoutBoundsPosition=function(t,e){if(!c(this.$getMatrix())||0!=this.anchorOffsetX||0!=this.anchorOffsetY){var i=egret.$TempRectangle;this.getLayoutBounds(i),t+=this.$getX()-i.x,e+=this.$getY()-i.y}var n=this.$super.$setX.call(this,t);(this.$super.$setY.call(this,e)||n)&&a.UIEvent.dispatchUIEvent(this,a.UIEvent.MOVE)},t.prototype.getLayoutBounds=function(t){var e,i,n=this.$UIComponent;e=n[27]?n[10]:isNaN(n[8])?n[16]:n[8],i=n[28]?n[11]:isNaN(n[9])?n[17]:n[9],this.applyMatrix(t,e,i)},t.prototype.getPreferredUWidth=function(){var t=this.$UIComponent;return isNaN(t[8])?t[16]:t[8]},t.prototype.getPreferredUHeight=function(){var t=this.$UIComponent;return isNaN(t[9])?t[17]:t[9]},t.prototype.getPreferredBounds=function(t){var e=this.getPreferredUWidth(),i=this.getPreferredUHeight();this.applyMatrix(t,e,i)},t.prototype.applyMatrix=function(t,e,i){t.setTo(0,0,e,i);var n=this.getAnchorMatrix();c(n)?(t.x+=n.tx,t.y+=n.ty):n.$transformBounds(t)},t.prototype.getAnchorMatrix=function(){var t=this.$getMatrix(),e=this.anchorOffsetX,i=this.anchorOffsetY;if(0!=e||0!=i){var n=egret.$TempMatrix;return t.$preMultiplyInto(n.setTo(1,0,0,1,-e,-i),n),n}return t},t}(egret.DisplayObject);p.UIComponentImpl=o,__reflect(o.prototype,"eui.sys.UIComponentImpl",["eui.UIComponent","egret.DisplayObject"]),p.mixin=r,p.implementUIComponent=function(t,e,i){r(t,o);var n=t.prototype;n.$super=e.prototype,a.registerProperty(t,"left","Percentage"),a.registerProperty(t,"right","Percentage"),a.registerProperty(t,"top","Percentage"),a.registerProperty(t,"bottom","Percentage"),a.registerProperty(t,"horizontalCenter","Percentage"),a.registerProperty(t,"verticalCenter","Percentage"),i&&(n.$childAdded=function(t,e){this.invalidateSize(),this.invalidateDisplayList()},n.$childRemoved=function(t,e){this.invalidateSize(),this.invalidateDisplayList()})}}(a.sys||(a.sys={}))}(eui||(eui={})),function(a){var t=function(n){function t(t,e){void 0===e&&(e=[]);var i=n.call(this)||this;return i.name=t,i.overrides=e,i}return __extends(t,n),t.prototype.initialize=function(t,e){for(var i=this.overrides,n=i.length,r=0;r<n;r++){var o=i[r];if(o instanceof a.AddItems){var s=t[o.target];s&&s instanceof a.Image&&!s.$parent&&(e.addChild(s),e.removeChild(s))}}},t}(egret.HashObject);a.State=t,__reflect(t.prototype,"eui.State")}(eui||(eui={})),function(t){!function(t){var e=function(){function t(){}return Object.defineProperty(t.prototype,"states",{get:function(){return this.$stateValues.states},set:function(t){t||(t=[]);for(var e=this.$stateValues,i={},n=(e.states=t).length,r=0;r<n;r++){var o=t[r];i[o.name]=o}e.statesMap=i,e.parent&&this.commitCurrentState()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentState",{get:function(){return this.$stateValues.currentState},set:function(t){var e=this.$stateValues;e.explicitState=t,e.currentState=t,this.commitCurrentState()},enumerable:!0,configurable:!0}),t.prototype.commitCurrentState=function(){var t=this.$stateValues;if(t.parent){if(!t.statesMap[t.currentState]){if(!(0<t.states.length))return;t.currentState=t.states[0].name}if(t.oldState!=t.currentState){var e=t.parent,i=t.statesMap[t.oldState];if(i)for(var n=(o=i.overrides).length,r=0;r<n;r++)o[r].remove(this,e);if(t.oldState=t.currentState,i=t.statesMap[t.currentState]){var o,s=(o=i.overrides).length;for(r=0;r<s;r++)o[r].apply(this,e)}}}},t.prototype.hasState=function(t){return!!this.$stateValues.statesMap[t]},t.prototype.initializeStates=function(t){this.$stateValues.intialized=!0;for(var e=this.states,i=e.length,n=0;n<i;n++)e[n].initialize(this,t)},t}();t.StateClient=e,__reflect(e.prototype,"eui.sys.StateClient");var i=function(){this.intialized=!1,this.statesMap={},this.states=[],this.oldState=null,this.explicitState=null,this.currentState=null,this.parent=null,this.stateIsDirty=!1};t.StateValues=i,__reflect(i.prototype,"eui.sys.StateValues")}(t.sys||(t.sys={}))}(eui||(eui={})),function(p){var t=function(i){function t(){var t=i.call(this)||this;return t.initializeUIValues(),t.$Component={0:null,1:null,2:"",3:!0,4:!1,5:!1,6:!0,7:!0,8:null},t.$touchEnabled=!0,t}return __extends(t,i),Object.defineProperty(t.prototype,"hostComponentKey",{get:function(){return this.$Component[0]},set:function(t){this.$Component[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skinName",{get:function(){return this.$Component[1]},set:function(t){var e=this.$Component;if(e[5]=!0,e[1]!=t){if(t)e[1]=t;else{var i=egret.getImplementation("eui.Theme");if(i){var n=i.getSkinName(this);n&&(e[1]=n)}}this.$parseSkinName()}},enumerable:!0,configurable:!0}),t.prototype.$parseSkinName=function(){var t,e=this.skinName;if(e)if(e.prototype)t=new e;else if("string"==typeof e){var i=void 0,n=e.trim();if("<"==n.charAt(0))i=EXML.parse(n);else if(!(i=egret.getDefinitionByName(e))&&-1!=n.toLowerCase().indexOf(".exml"))return void EXML.load(e,this.onExmlLoaded,this,!0);i&&(t=new i)}else t=e;this.setSkin(t)},t.prototype.onExmlLoaded=function(t,e){if(this.skinName==e){var i=new t;this.setSkin(i)}},Object.defineProperty(t.prototype,"skin",{get:function(){return this.$Component[8]},enumerable:!0,configurable:!0}),t.prototype.setSkin=function(t){!t||t instanceof p.Skin||(t=null);var e=this.$Component,i=e[8];if(i){for(var n=(s=i.skinParts).length,r=0;r<n;r++){this[h=s[r]]&&this.setSkinPart(h,null)}if(u=i.$elementsContent){n=u.length;for(r=0;r<n;r++){var o=u[r];o.$parent==this&&this.removeChild(o)}}i.hostComponent=null}if(e[8]=t){var s,a=(s=t.skinParts).length;for(r=0;r<a;r++){var h,l=t[h=s[r]];l&&this.setSkinPart(h,l)}var u;if(u=t.$elementsContent)for(r=u.length-1;0<=r;r--)this.addChildAt(u[r],0);t.hostComponent=this}this.invalidateSize(),this.invalidateDisplayList(),this.dispatchEventWith(egret.Event.COMPLETE)},t.prototype.setSkinPart=function(t,e){var i=this[t];i&&this.partRemoved(t,i),(this[t]=e)&&this.partAdded(t,e)},t.prototype.partAdded=function(t,e){},t.prototype.partRemoved=function(t,e){},t.prototype.$setTouchChildren=function(t){t=!!t;var e=this.$Component;return e[6]=t,!e[3]||(e[6]=t,i.prototype.$setTouchChildren.call(this,t))},t.prototype.$setTouchEnabled=function(t){t=!!t;var e=this.$Component;return e[7]=t,!e[3]||i.prototype.$setTouchEnabled.call(this,t)},Object.defineProperty(t.prototype,"enabled",{get:function(){return this.$Component[3]},set:function(t){t=!!t,this.$setEnabled(t)},enumerable:!0,configurable:!0}),t.prototype.$setEnabled=function(t){var e=this.$Component;return t!==e[3]&&((e[3]=t)?(this.$touchEnabled=e[7],this.$touchChildren=e[6]):(this.$touchEnabled=!1,this.$touchChildren=!1),this.invalidateState(),!0)},Object.defineProperty(t.prototype,"currentState",{get:function(){var t=this.$Component;return t[2]?t[2]:this.getCurrentState()},set:function(t){var e=this.$Component;t!=e[2]&&(e[2]=t,this.invalidateState())},enumerable:!0,configurable:!0}),t.prototype.invalidateState=function(){var t=this.$Component;t[4]||(t[4]=!0,this.invalidateProperties())},t.prototype.getCurrentState=function(){return""},t.prototype.createChildren=function(){var t=this.$Component;if(!t[1]){var e=egret.getImplementation("eui.Theme");if(e){var i=e.getSkinName(this);i&&(t[1]=i,this.$parseSkinName())}}},t.prototype.childrenCreated=function(){},t.prototype.commitProperties=function(){p.sys.UIComponentImpl.prototype.commitProperties.call(this);var t=this.$Component;t[4]&&(t[4]=!1,t[8]&&(t[8].currentState=this.currentState))},t.prototype.measure=function(){p.sys.measure(this);var t=this.$Component[8];if(t){var e=this.$UIComponent;isNaN(t.width)?(e[16]<t.minWidth&&(e[16]=t.minWidth),e[16]>t.maxWidth&&(e[16]=t.maxWidth)):e[16]=t.width,isNaN(t.height)?(e[17]<t.minHeight&&(e[17]=t.minHeight),e[17]>t.maxHeight&&(e[17]=t.maxHeight)):e[17]=t.height}},t.prototype.updateDisplayList=function(t,e){p.sys.updateDisplayList(this,t,e)},t.prototype.invalidateParentLayout=function(){},t.prototype.setMeasuredSize=function(t,e){},t.prototype.invalidateProperties=function(){},t.prototype.validateProperties=function(){},t.prototype.invalidateSize=function(){},t.prototype.validateSize=function(t){},t.prototype.invalidateDisplayList=function(){},t.prototype.validateDisplayList=function(){},t.prototype.validateNow=function(){},t.prototype.setLayoutBoundsSize=function(t,e){},t.prototype.setLayoutBoundsPosition=function(t,e){},t.prototype.getLayoutBounds=function(t){},t.prototype.getPreferredBounds=function(t){},t}(egret.DisplayObjectContainer);p.Component=t,__reflect(t.prototype,"eui.Component",["eui.UIComponent","egret.DisplayObject"]),p.registerProperty(t,"skinName","Class"),p.sys.implementUIComponent(t,egret.DisplayObjectContainer,!0)}(eui||(eui={})),function(t){var n="__bindables__";t.registerBindable=function(t,e){if(t.hasOwnProperty(n))t[n].push(e);else{var i=[e];t[n]&&(i=t[n].concat(i)),t[n]=i}}}(eui||(eui={})),function(o){var t=function(a){function t(){var t=a.call(this)||this;return t.$layout=null,t.$stateValues=new o.sys.StateValues,t.initializeUIValues(),t.$Group={0:0,1:0,2:0,3:0,4:!1,5:!1},t.$stateValues.parent=t}return __extends(t,a),Object.defineProperty(t.prototype,"elementsContent",{set:function(t){if(t)for(var e=t.length,i=0;i<e;i++)this.addChild(t[i])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layout",{get:function(){return this.$layout},set:function(t){this.$setLayout(t)},enumerable:!0,configurable:!0}),t.prototype.$setLayout=function(t){return this.$layout!=t&&(this.$layout&&(this.$layout.target=null),(this.$layout=t)&&(t.target=this),this.invalidateSize(),this.invalidateDisplayList(),!0)},Object.defineProperty(t.prototype,"contentWidth",{get:function(){return this.$Group[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentHeight",{get:function(){return this.$Group[1]},enumerable:!0,configurable:!0}),t.prototype.setContentSize=function(t,e){t=Math.ceil(+t||0),e=Math.ceil(+e||0);var i=this.$Group,n=i[0]!==t,r=i[1]!==e;(n||r)&&(i[0]=t,i[1]=e,n&&o.PropertyEvent.dispatchPropertyEvent(this,o.PropertyEvent.PROPERTY_CHANGE,"contentWidth"),r&&o.PropertyEvent.dispatchPropertyEvent(this,o.PropertyEvent.PROPERTY_CHANGE,"contentHeight"))},Object.defineProperty(t.prototype,"scrollEnabled",{get:function(){return this.$Group[4]},set:function(t){t=!!t;var e=this.$Group;t!==e[4]&&(e[4]=t,this.updateScrollRect())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollH",{get:function(){return this.$Group[2]},set:function(t){t=+t||0;var e=this.$Group;t!==e[2]&&(e[2]=t,this.updateScrollRect()&&this.$layout&&this.$layout.scrollPositionChanged(),o.PropertyEvent.dispatchPropertyEvent(this,o.PropertyEvent.PROPERTY_CHANGE,"scrollH"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollV",{get:function(){return this.$Group[3]},set:function(t){t=+t||0;var e=this.$Group;t!=e[3]&&(e[3]=t,this.updateScrollRect()&&this.$layout&&this.$layout.scrollPositionChanged(),o.PropertyEvent.dispatchPropertyEvent(this,o.PropertyEvent.PROPERTY_CHANGE,"scrollV"))},enumerable:!0,configurable:!0}),t.prototype.updateScrollRect=function(){var t=this.$Group,e=t[4];if(e){var i=this.$UIComponent;this.scrollRect=egret.$TempRectangle.setTo(t[2],t[3],i[10],i[11])}else this.$scrollRect&&(this.scrollRect=null);return e},Object.defineProperty(t.prototype,"numElements",{get:function(){return this.$children.length},enumerable:!0,configurable:!0}),t.prototype.getElementAt=function(t){return this.$children[t]},t.prototype.getVirtualElementAt=function(t){return this.getElementAt(t)},t.prototype.setVirtualElementIndicesInView=function(t,e){},Object.defineProperty(t.prototype,"touchThrough",{get:function(){return this.$Group[5]},set:function(t){this.$Group[5]=!!t},enumerable:!0,configurable:!0}),t.prototype.$hitTest=function(t,e){var i=a.prototype.$hitTest.call(this,t,e);if(i||this.$Group[5])return i;if(!this.$visible||!this.touchEnabled)return null;var n=this.globalToLocal(t,e,egret.$TempPoint),r=this.$UIComponent,o=egret.$TempRectangle.setTo(0,0,r[10],r[11]),s=this.$scrollRect;return s&&(o.x=s.x,o.y=s.y),o.contains(n.x,n.y)?this:null},t.prototype.invalidateState=function(){var t=this.$stateValues;t.stateIsDirty||(t.stateIsDirty=!0,this.invalidateProperties())},t.prototype.getCurrentState=function(){return""},t.prototype.createChildren=function(){this.$layout||this.$setLayout(new o.BasicLayout),this.initializeStates(this.$stage)},t.prototype.childrenCreated=function(){},t.prototype.commitProperties=function(){o.sys.UIComponentImpl.prototype.commitProperties.call(this);var t=this.$stateValues;t.stateIsDirty&&(t.stateIsDirty=!1,t.explicitState||(t.currentState=this.getCurrentState(),this.commitCurrentState()))},t.prototype.measure=function(){return this.$layout?void this.$layout.measure():void this.setMeasuredSize(0,0)},t.prototype.updateDisplayList=function(t,e){this.$layout&&this.$layout.updateDisplayList(t,e),this.updateScrollRect()},t.prototype.invalidateParentLayout=function(){},t.prototype.setMeasuredSize=function(t,e){},t.prototype.invalidateProperties=function(){},t.prototype.validateProperties=function(){},t.prototype.invalidateSize=function(){},t.prototype.validateSize=function(t){},t.prototype.invalidateDisplayList=function(){},t.prototype.validateDisplayList=function(){},t.prototype.validateNow=function(){},t.prototype.setLayoutBoundsSize=function(t,e){},t.prototype.setLayoutBoundsPosition=function(t,e){},t.prototype.getLayoutBounds=function(t){},t.prototype.getPreferredBounds=function(t){},t}(egret.DisplayObjectContainer);o.Group=t,__reflect(t.prototype,"eui.Group",["eui.IViewport","eui.UIComponent","egret.DisplayObject"]),o.sys.implementUIComponent(t,egret.DisplayObjectContainer,!0),o.sys.mixin(t,o.sys.StateClient),o.registerProperty(t,"elementsContent","Array",!0),o.registerProperty(t,"states","State[]")}(eui||(eui={})),function(c){var t=function(p){function t(){var t=p.call(this)||this;return t.$dataProviderChanged=!1,t.$dataProvider=null,t.$indexToRenderer=[],t.$DataGroup={0:!0,1:!1,2:{},3:{},4:!1,5:!1,6:null,7:null,8:!1,9:null,10:!1,11:!1,12:null,13:null,14:!1},t}return __extends(t,p),Object.defineProperty(t.prototype,"useVirtualLayout",{get:function(){return this.$layout?this.$layout.$useVirtualLayout:this.$DataGroup[0]},set:function(t){t=!!t;var e=this.$DataGroup;t!==e[0]&&(e[0]=t,this.$layout&&(this.$layout.useVirtualLayout=t))},enumerable:!0,configurable:!0}),t.prototype.$setLayout=function(t){if(t==this.$layout)return!1;this.$layout&&(this.$layout.setTypicalSize(0,0),this.$layout.removeEventListener("useVirtualLayoutChanged",this.onUseVirtualLayoutChanged,this)),this.$layout&&t&&this.$layout.$useVirtualLayout!=t.$useVirtualLayout&&this.onUseVirtualLayoutChanged();var e=p.prototype.$setLayout.call(this,t);if(t){var i=this.$DataGroup[9];i&&t.setTypicalSize(i.width,i.height),t.useVirtualLayout=this.$DataGroup[0],t.addEventListener("useVirtualLayoutChanged",this.onUseVirtualLayoutChanged,this)}return e},t.prototype.onUseVirtualLayoutChanged=function(t){var e=this.$DataGroup;e[1]=!0,e[10]=!0,this.removeDataProviderListener(),this.invalidateProperties()},t.prototype.setVirtualElementIndicesInView=function(t,e){if(this.$layout&&this.$layout.$useVirtualLayout)for(var i=this.$indexToRenderer,n=Object.keys(i),r=n.length,o=0;o<r;o++){var s=+n[o];(s<t||e<s)&&this.freeRendererByIndex(s)}},t.prototype.getElementAt=function(t){return this.$indexToRenderer[t]},t.prototype.getVirtualElementAt=function(t){if((t=0|+t)<0||t>=this.$dataProvider.length)return null;var e=this.$indexToRenderer[t];if(!e){var i=this.$dataProvider.getItemAt(t);e=this.createVirtualRenderer(i),this.$indexToRenderer[t]=e,this.updateRenderer(e,t,i);var n=this.$DataGroup;n[4]&&(e.validateNow(),n[4]=!1,this.rendererAdded(e,t,i))}return e},t.prototype.freeRendererByIndex=function(t){var e=this.$indexToRenderer[t];e&&(delete this.$indexToRenderer[t],this.doFreeRenderer(e))},t.prototype.doFreeRenderer=function(t){var e=this.$DataGroup,i=e[2][t.$hashCode].$hashCode;e[3][i]||(e[3][i]=[]),e[3][i].push(t),t.visible=!1},t.prototype.invalidateSize=function(){this.$DataGroup[4]||p.prototype.invalidateSize.call(this)},t.prototype.createVirtualRenderer=function(t){var e,i=this.itemToRendererClass(t),n=i.$hashCode,r=this.$DataGroup,o=r[3];return o[n]&&0<o[n].length?((e=o[n].pop()).visible=!0,this.invalidateDisplayList(),e):(r[4]=!0,this.createOneRenderer(i))},t.prototype.createOneRenderer=function(t){var e=new t,i=this.$DataGroup;return i[2][e.$hashCode]=t,egret.is(e,"eui.IItemRenderer")?(i[13]&&this.setItemRenderSkinName(e,i[13]),this.addChild(e),e):null},t.prototype.setItemRenderSkinName=function(t,e){if(t&&t instanceof c.Component){var i=t;i.$Component[5]||(i.skinName=e,i.$Component[5]=!1)}},Object.defineProperty(t.prototype,"dataProvider",{get:function(){return this.$dataProvider},set:function(t){this.$setDataProvider(t)},enumerable:!0,configurable:!0}),t.prototype.$setDataProvider=function(t){return!(this.$dataProvider==t||t&&!t.getItemAt)&&(this.removeDataProviderListener(),this.$dataProvider=t,this.$dataProviderChanged=!0,this.$DataGroup[10]=!0,this.invalidateProperties(),this.invalidateSize(),this.invalidateDisplayList(),!0)},t.prototype.removeDataProviderListener=function(){this.$dataProvider&&this.$dataProvider.removeEventListener(c.CollectionEvent.COLLECTION_CHANGE,this.onCollectionChange,this)},t.prototype.onCollectionChange=function(t){switch(t.kind){case c.CollectionEventKind.ADD:this.itemAddedHandler(t.items,t.location);break;case c.CollectionEventKind.REMOVE:this.itemRemovedHandler(t.items,t.location);break;case c.CollectionEventKind.UPDATE:case c.CollectionEventKind.REPLACE:this.itemUpdatedHandler(t.items[0],t.location);break;case c.CollectionEventKind.RESET:case c.CollectionEventKind.REFRESH:if(this.$layout&&this.$layout.$useVirtualLayout)for(var e=this.$indexToRenderer,i=Object.keys(e),n=i.length-1;0<=n;n--){var r=+i[n];this.freeRendererByIndex(r)}this.$dataProviderChanged=!0,this.invalidateProperties()}this.invalidateSize(),this.invalidateDisplayList()},t.prototype.itemAddedHandler=function(t,e){for(var i=t.length,n=0;n<i;n++)this.itemAdded(t[n],e+n);this.resetRenderersIndices()},t.prototype.itemRemovedHandler=function(t,e){for(var i=t.length-1;0<=i;i--)this.itemRemoved(t[i],e+i);this.resetRenderersIndices()},t.prototype.itemAdded=function(t,e){if(this.$layout&&this.$layout.elementAdded(e),this.$layout&&this.$layout.$useVirtualLayout)this.$indexToRenderer.splice(e,0,null);else{var i=this.createVirtualRenderer(t);if(this.$indexToRenderer.splice(e,0,i),i){this.updateRenderer(i,e,t);var n=this.$DataGroup;n[4]&&(n[4]=!1,this.rendererAdded(i,e,t))}}},t.prototype.itemRemoved=function(t,e){this.$layout&&this.$layout.elementRemoved(e);var i=this.$indexToRenderer[e];this.$indexToRenderer.length>e&&this.$indexToRenderer.splice(e,1),i&&(this.$layout&&this.$layout.$useVirtualLayout?this.doFreeRenderer(i):(this.rendererRemoved(i,e,t),this.removeChild(i)))},t.prototype.resetRenderersIndices=function(){var t=this.$indexToRenderer;if(0!=t.length)if(this.$layout&&this.$layout.$useVirtualLayout)for(var e=Object.keys(t),i=e.length,n=0;n<i;n++){var r=+e[n];this.resetRendererItemIndex(r)}else{var o=t.length;for(r=0;r<o;r++)this.resetRendererItemIndex(r)}},t.prototype.itemUpdatedHandler=function(t,e){if(!this.$DataGroup[11]){var i=this.$indexToRenderer[e];i&&this.updateRenderer(i,e,t)}},t.prototype.resetRendererItemIndex=function(t){var e=this.$indexToRenderer[t];e&&(e.itemIndex=t)},Object.defineProperty(t.prototype,"itemRenderer",{get:function(){return this.$DataGroup[6]},set:function(t){var e=this.$DataGroup;e[6]!=t&&(e[6]=t,e[5]=!0,e[8]=!0,e[10]=!0,this.removeDataProviderListener(),this.invalidateProperties())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemRendererSkinName",{get:function(){return this.$DataGroup[13]},set:function(t){var e=this.$DataGroup;e[13]!=t&&(e[13]=t,this.$UIComponent[29]&&(e[14]=!0,this.invalidateProperties()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemRendererFunction",{get:function(){return this.$DataGroup[7]},set:function(t){var e=this.$DataGroup;e[7]!=t&&(e[7]=t,e[5]=!0,e[8]=!0,this.removeDataProviderListener(),this.invalidateProperties())},enumerable:!0,configurable:!0}),t.prototype.itemToRendererClass=function(t){var e,i=this.$DataGroup;return i[7]&&(e=i[7](t)),e||(e=i[6]),e||(e=c.ItemRenderer),e.$hashCode||(e.$hashCode=egret.$hashCount++),e},t.prototype.createChildren=function(){if(!this.$layout){var t=new c.VerticalLayout;t.gap=0,t.horizontalAlign=c.JustifyAlign.CONTENT_JUSTIFY,this.$setLayout(t)}p.prototype.createChildren.call(this)},t.prototype.commitProperties=function(){var t=this.$DataGroup;if((t[5]||this.$dataProviderChanged||t[1])&&(this.removeAllRenderers(),this.$layout&&this.$layout.clearVirtualLayoutCache(),this.setTypicalLayoutRect(null),t[1]=!1,t[5]=!1,this.$dataProvider&&this.$dataProvider.addEventListener(c.CollectionEvent.COLLECTION_CHANGE,this.onCollectionChange,this),this.$layout&&this.$layout.$useVirtualLayout?(this.invalidateSize(),this.invalidateDisplayList()):this.createRenderers(),this.$dataProviderChanged&&(this.$dataProviderChanged=!1,this.scrollV=this.scrollH=0)),p.prototype.commitProperties.call(this),t[8]&&(t[8]=!1,this.$dataProvider&&0<this.$dataProvider.length&&(t[12]=this.$dataProvider.getItemAt(0),this.measureRendererSize())),t[14]){t[14]=!1;for(var e=t[13],i=this.$indexToRenderer,n=Object.keys(i),r=n.length,o=0;o<r;o++){var s=n[o];this.setItemRenderSkinName(i[s],e)}var a=t[3];r=(n=Object.keys(a)).length;for(o=0;o<r;o++)for(var h=a[n[o]],l=h.length,u=0;u<l;u++)this.setItemRenderSkinName(h[u],e)}},t.prototype.measure=function(){this.$layout&&this.$layout.$useVirtualLayout&&this.ensureTypicalLayoutElement(),p.prototype.measure.call(this)},t.prototype.updateDisplayList=function(t,e){var i=this.$layout&&this.$layout.$useVirtualLayout;i&&this.ensureTypicalLayoutElement(),p.prototype.updateDisplayList.call(this,t,e);var n=this.$DataGroup;if(i){var r=n[9];if(r){var o=this.$indexToRenderer[0];if(o){var s=egret.$TempRectangle;o.getPreferredBounds(s),(s.width!=r.width||s.height!=r.height)&&(n[9]=null)}}}},t.prototype.ensureTypicalLayoutElement=function(){this.$DataGroup[9]||this.$dataProvider&&0<this.$dataProvider.length&&(this.$DataGroup[12]=this.$dataProvider.getItemAt(0),this.measureRendererSize())},t.prototype.measureRendererSize=function(){var t=this.$DataGroup;if(t[12]){var e=this.createVirtualRenderer(t[12]);if(e){this.updateRenderer(e,0,t[12]),e.validateNow();var i=egret.$TempRectangle;e.getPreferredBounds(i);var n=new egret.Rectangle(0,0,i.width,i.height);this.$layout&&this.$layout.$useVirtualLayout?(t[4]&&this.rendererAdded(e,0,t[12]),this.doFreeRenderer(e)):this.removeChild(e),this.setTypicalLayoutRect(n),t[4]=!1}else this.setTypicalLayoutRect(null)}else this.setTypicalLayoutRect(null)},t.prototype.setTypicalLayoutRect=function(t){this.$DataGroup[9]=t,this.$layout&&(t?this.$layout.setTypicalSize(t.width,t.height):this.$layout.setTypicalSize(0,0))},t.prototype.removeAllRenderers=function(){for(var t=this.$indexToRenderer,e=Object.keys(t),i=e.length,n=0;n<i;n++){(p=t[e[n]])&&(this.rendererRemoved(p,p.itemIndex,p.data),this.removeChild(p))}this.$indexToRenderer=[];var r=this.$DataGroup;if(r[10]){var o=r[3],s=Object.keys(o),a=s.length;for(n=0;n<a;n++)for(var h=o[s[n]],l=h.length,u=0;u<l;u++){var p=h[u];this.rendererRemoved(p,p.itemIndex,p.data),this.removeChild(p)}r[3]={},r[2]={},r[10]=!1}},t.prototype.createRenderers=function(){if(this.$dataProvider)for(var t=0,e=this.$dataProvider.length,i=0;i<e;i++){var n=this.$dataProvider.getItemAt(i),r=this.itemToRendererClass(n),o=this.createOneRenderer(r);o&&(this.$indexToRenderer[t]=o,this.updateRenderer(o,t,n),this.rendererAdded(o,t,n),t++)}},t.prototype.updateRenderer=function(t,e,i){var n=this.$DataGroup;return n[11]=!0,t.itemIndex=e,t.data=i,n[11]=!1,t},Object.defineProperty(t.prototype,"numElements",{get:function(){return this.$dataProvider?this.$dataProvider.length:0},enumerable:!0,configurable:!0}),t.prototype.rendererAdded=function(t,e,i){},t.prototype.rendererRemoved=function(t,e,i){},t}(c.Group);c.DataGroup=t,__reflect(t.prototype,"eui.DataGroup"),c.registerProperty(t,"itemRenderer","Class"),c.registerProperty(t,"itemRendererSkinName","Class"),c.registerProperty(t,"dataProvider","eui.ICollection",!0)}(eui||(eui={})),function(t){var e=function(e){function t(){var t=e.call(this)||this;return t.labelDisplay=null,t._label="",t.iconDisplay=null,t._icon=null,t.touchCaptured=!1,t.touchChildren=!1,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchBegin,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"label",{get:function(){return this._label},set:function(t){this._label=t,this.labelDisplay&&(this.labelDisplay.text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this._icon},set:function(t){this._icon=t,this.iconDisplay&&(this.iconDisplay.source=t)},enumerable:!0,configurable:!0}),t.prototype.onTouchCancle=function(t){var e=t.$currentTarget;e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!1,this.invalidateState()},t.prototype.onTouchBegin=function(t){this.$stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!0,this.invalidateState(),t.updateAfterEvent()},t.prototype.onStageTouchEnd=function(t){var e=t.$currentTarget;e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.contains(t.target)&&this.buttonReleased(),this.touchCaptured=!1,this.invalidateState()},t.prototype.getCurrentState=function(){return this.enabled?this.touchCaptured?"down":"up":"disabled"},t.prototype.partAdded=function(t,e){e===this.labelDisplay?this.labelDisplay.text=this._label:e==this.iconDisplay&&(this.iconDisplay.source=this._icon)},t.prototype.buttonReleased=function(){},t}(t.Component);t.Button=e,__reflect(e.prototype,"eui.Button")}(eui||(eui={})),function(n){var t=function(i){function t(){var t=i.call(this)||this;return t.$Range={0:100,1:!1,2:0,3:!1,4:0,5:0,6:!1,7:1,8:!1,9:!1},t}return __extends(t,i),Object.defineProperty(t.prototype,"maximum",{get:function(){return this.$Range[0]},set:function(t){t=+t||0;var e=this.$Range;t!==e[0]&&(e[0]=t,e[1]=!0,this.invalidateProperties(),this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimum",{get:function(){return this.$Range[2]},set:function(t){t=+t||0;var e=this.$Range;t!==e[2]&&(e[2]=t,e[3]=!0,this.invalidateProperties(),this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){var t=this.$Range;return t[6]?t[5]:t[4]},set:function(t){t=+t||0,this.$setValue(t)},enumerable:!0,configurable:!0}),t.prototype.$setValue=function(t){if(t===this.value)return!1;var e=this.$Range;return e[5]=t,e[6]=!0,this.invalidateProperties(),!0},Object.defineProperty(t.prototype,"snapInterval",{get:function(){return this.$Range[7]},set:function(t){var e=this.$Range;e[9]=!0,(t=+t||0)!==e[7]&&(isNaN(t)?(e[7]=1,e[9]=!1):e[7]=t,e[8]=!0,this.invalidateProperties())},enumerable:!0,configurable:!0}),t.prototype.commitProperties=function(){i.prototype.commitProperties.call(this);var t=this.$Range;if(t[2]>t[0]&&(t[1]?t[0]=t[2]:t[2]=t[0]),t[6]||t[1]||t[3]||t[8]){var e=t[6]?t[5]:t[4];t[6]=!1,t[1]=!1,t[3]=!1,t[8]=!1,this.setValue(this.nearestValidValue(e,t[7]))}},t.prototype.nearestValidSize=function(t){var e=this.snapInterval;if(0==e)return t;var i=Math.round(t/e)*e;return Math.abs(i)<e?e:i},t.prototype.nearestValidValue=function(t,e){var i=this.$Range;if(0==e)return Math.max(i[2],Math.min(i[0],t));var n=i[0]-i[2],r=1;if(t-=i[2],e!=Math.round(e)){var o=(1+e).toString().split(".");n*=r=Math.pow(10,o[1].length),t=Math.round(t*r),e=Math.round(e*r)}var s=Math.max(0,Math.floor(t/e)*e),a=Math.min(n,Math.floor((t+e)/e)*e);return((a-s)/2<=t-s?a:s)/r+i[2]},t.prototype.setValue=function(t){var e=this.$Range;e[4]!==t&&(e[0]>e[2]?e[4]=Math.min(e[0],Math.max(e[2],t)):e[4]=t,e[6]=!1,this.invalidateDisplayList(),n.PropertyEvent.dispatchPropertyEvent(this,n.PropertyEvent.PROPERTY_CHANGE,"value"))},t.prototype.updateDisplayList=function(t,e){i.prototype.updateDisplayList.call(this,t,e),this.updateSkinDisplayList()},t.prototype.updateSkinDisplayList=function(){},t}(n.Component);n.Range=t,__reflect(t.prototype,"eui.Range"),n.registerBindable(t.prototype,"value")}(eui||(eui={})),function(t){var e=function(e){function t(){var t=e.call(this)||this;return t.$target=null,t.$useVirtualLayout=!1,t.$typicalWidth=71,t.$typicalHeight=22,t}return __extends(t,e),Object.defineProperty(t.prototype,"target",{get:function(){return this.$target},set:function(t){this.$target!==t&&(this.$target=t,this.clearVirtualLayoutCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVirtualLayout",{get:function(){return this.$useVirtualLayout},set:function(t){t=!!t,this.$useVirtualLayout!=t&&(this.$useVirtualLayout=t,this.dispatchEventWith("useVirtualLayoutChanged"),this.$useVirtualLayout&&!t&&this.clearVirtualLayoutCache(),this.target&&this.target.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.setTypicalSize=function(t,e){e=+e||22,((t=+t||71)!==this.$typicalWidth||e!==this.$typicalHeight)&&(this.$typicalWidth=t,this.$typicalHeight=e,this.$target&&this.$target.invalidateSize())},t.prototype.scrollPositionChanged=function(){},t.prototype.clearVirtualLayoutCache=function(){},t.prototype.elementAdded=function(t){},t.prototype.elementRemoved=function(t){},t.prototype.getElementIndicesInView=function(){return null},t.prototype.measure=function(){},t.prototype.updateDisplayList=function(t,e){},t}(egret.EventDispatcher);t.LayoutBase=e,__reflect(e.prototype,"eui.LayoutBase")}(eui||(eui={})),function(e){var t=function(n){function t(){var t=n.apply(this,arguments)||this;return t.$selected=!1,t.$autoSelected=!0,t}return __extends(t,n),Object.defineProperty(t.prototype,"selected",{get:function(){return this.$selected},set:function(t){this.$setSelected(t)},enumerable:!0,configurable:!0}),t.prototype.$setSelected=function(t){return(t=!!t)!==this.$selected&&(this.$selected=t,this.invalidateState(),e.PropertyEvent.dispatchPropertyEvent(this,e.PropertyEvent.PROPERTY_CHANGE,"selected"),!0)},t.prototype.getCurrentState=function(){var t=n.prototype.getCurrentState.call(this);if(this.$selected){var e=t+"AndSelected",i=this.skin;return i&&i.hasState(e)?e:"disabled"==t?"disabled":"down"}return t},t.prototype.buttonReleased=function(){this.$autoSelected&&(this.selected=!this.$selected,this.dispatchEventWith(egret.Event.CHANGE))},t}(e.Button);e.ToggleButton=t,__reflect(t.prototype,"eui.ToggleButton"),e.registerBindable(t.prototype,"selected")}(eui||(eui={})),function(a){var t=function(o){function s(){var t=o.call(this)||this;return t.$ListBase={0:!1,1:!1,2:-2,3:-1,4:!1,5:void 0,6:!1,7:null,8:!1},t}return __extends(s,o),Object.defineProperty(s.prototype,"requireSelection",{get:function(){return this.$ListBase[0]},set:function(t){t=!!t;var e=this.$ListBase;t!==e[0]&&((e[0]=t)&&(e[1]=!0,this.invalidateProperties()))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"selectedIndex",{get:function(){return this.$getSelectedIndex()},set:function(t){t=0|+t,this.setSelectedIndex(t,!1)},enumerable:!0,configurable:!0}),s.prototype.$getSelectedIndex=function(){var t=this.$ListBase;return t[2]!=s.NO_PROPOSED_SELECTION?t[2]:t[3]},s.prototype.setSelectedIndex=function(t,e){if(t!=this.selectedIndex){var i=this.$ListBase;e&&(i[4]=i[4]||e),i[2]=t,this.invalidateProperties()}},Object.defineProperty(s.prototype,"selectedItem",{get:function(){var t=this.$ListBase;if(void 0!==t[5])return t[5];var e=this.$getSelectedIndex();return e!=s.NO_SELECTION&&null!=this.$dataProvider&&this.$dataProvider.length>e?this.$dataProvider.getItemAt(e):void 0},set:function(t){this.setSelectedItem(t,!1)},enumerable:!0,configurable:!0}),s.prototype.setSelectedItem=function(t,e){if(void 0===e&&(e=!1),this.selectedItem!==t){var i=this.$ListBase;e&&(i[4]=i[4]||e),i[5]=t,this.invalidateProperties()}},s.prototype.commitProperties=function(){var t=this.$dataProviderChanged;o.prototype.commitProperties.call(this);var e=this.$ListBase,i=this.$getSelectedIndex(),n=this.$dataProvider;t&&(0<=i&&n&&i<n.length?this.itemSelected(i,!0):this.requireSelection?e[2]=0:this.setSelectedIndex(-1,!1)),e[1]&&(e[1]=!1,e[0]&&i==s.NO_SELECTION&&n&&0<n.length&&(e[2]=0)),void 0!==e[5]&&(e[2]=n?n.getItemIndex(e[5]):s.NO_SELECTION,e[5]=void 0);var r=!1;e[2]!=s.NO_PROPOSED_SELECTION&&(r=this.commitSelection()),e[6]&&(e[6]=!1,r||a.PropertyEvent.dispatchPropertyEvent(this,a.PropertyEvent.PROPERTY_CHANGE,"selectedIndex"))},s.prototype.updateRenderer=function(t,e,i){return this.itemSelected(e,this.$isItemIndexSelected(e)),o.prototype.updateRenderer.call(this,t,e,i)},s.prototype.itemSelected=function(t,e){var i=this.$indexToRenderer[t];i&&(i.selected=e)},s.prototype.$isItemIndexSelected=function(t){return t==this.selectedIndex},s.prototype.commitSelection=function(t){void 0===t&&(t=!0);var e=this.$dataProvider,i=this.$ListBase,n=e?e.length-1:-1,r=i[3],o=i[2];if(o<s.NO_SELECTION&&(o=s.NO_SELECTION),n<o&&(o=n),i[0]&&o==s.NO_SELECTION&&e&&0<e.length)return i[2]=s.NO_PROPOSED_SELECTION,i[4]=!1;if(i[4]&&!this.dispatchEventWith(egret.Event.CHANGING,!1,!0,!0))return this.itemSelected(i[2],!1),i[2]=s.NO_PROPOSED_SELECTION,i[4]=!1;return i[3]=o,i[2]=s.NO_PROPOSED_SELECTION,r!=s.NO_SELECTION&&this.itemSelected(r,!1),i[3]!=s.NO_SELECTION&&this.itemSelected(i[3],!0),t&&(i[4]&&(this.dispatchEventWith(egret.Event.CHANGE),i[4]=!1),a.PropertyEvent.dispatchPropertyEvent(this,a.PropertyEvent.PROPERTY_CHANGE,"selectedIndex"),a.PropertyEvent.dispatchPropertyEvent(this,a.PropertyEvent.PROPERTY_CHANGE,"selectedItem")),!0},s.prototype.adjustSelection=function(t,e){void 0===e&&(e=!1);var i=this.$ListBase;i[2]!=s.NO_PROPOSED_SELECTION?i[2]=t:i[3]=t,i[6]=!0,this.invalidateProperties()},s.prototype.itemAdded=function(t,e){o.prototype.itemAdded.call(this,t,e);var i=this.$getSelectedIndex();i==s.NO_SELECTION?this.$ListBase[0]&&this.adjustSelection(e,!0):e<=i&&this.adjustSelection(i+1,!0)},s.prototype.itemRemoved=function(t,e){if(o.prototype.itemRemoved.call(this,t,e),this.selectedIndex!=s.NO_SELECTION){var i=this.$getSelectedIndex();e==i?this.requireSelection&&this.$dataProvider&&0<this.$dataProvider.length?0==e?(this.$ListBase[2]=0,this.invalidateProperties()):this.setSelectedIndex(0,!1):this.adjustSelection(-1,!1):e<i&&this.adjustSelection(i-1,!1)}},s.prototype.onCollectionChange=function(t){o.prototype.onCollectionChange.call(this,t),t.kind==a.CollectionEventKind.RESET?0==this.$dataProvider.length&&this.setSelectedIndex(s.NO_SELECTION,!1):t.kind==a.CollectionEventKind.REFRESH&&this.dataProviderRefreshed()},s.prototype.dataProviderRefreshed=function(){this.setSelectedIndex(s.NO_SELECTION,!1)},s.prototype.rendererAdded=function(t,e,i){t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRendererTouchBegin,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.onRendererTouchEnd,this),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onRendererTouchCancle,this)},s.prototype.rendererRemoved=function(t,e,i){t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRendererTouchBegin,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onRendererTouchEnd,this),t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onRendererTouchCancle,this)},s.prototype.onRendererTouchBegin=function(t){var e=this.$ListBase;t.$isDefaultPrevented||(e[8]=!1,e[7]=t.$currentTarget,this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stage_touchEndHandler,this))},s.prototype.onRendererTouchCancle=function(t){var e=this.$ListBase;e[7]=null,e[8]=!0,this.$stage&&this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_touchEndHandler,this)},s.prototype.onRendererTouchEnd=function(t){var e=this.$ListBase,i=t.$currentTarget;i==e[7]&&(e[8]||(this.setSelectedIndex(i.itemIndex,!0),a.ItemTapEvent.dispatchItemTapEvent(this,a.ItemTapEvent.ITEM_TAP,i)),e[8]=!1)},s.prototype.stage_touchEndHandler=function(t){t.$currentTarget.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_touchEndHandler,this),this.$ListBase[7]=null},s}(a.DataGroup);t.NO_SELECTION=-1,t.NO_PROPOSED_SELECTION=-2,a.ListBase=t,__reflect(t.prototype,"eui.ListBase"),a.registerBindable(t.prototype,"selectedIndex"),a.registerBindable(t.prototype,"selectedItem")}(eui||(eui={})),function(i){var t=function(e){function t(){var t=e.call(this)||this;return t.thumb=null,t.$viewport=null,t.autoVisibility=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"viewport",{get:function(){return this.$viewport},set:function(t){if(t!=this.$viewport){var e=this.$viewport;e&&(e.removeEventListener(i.PropertyEvent.PROPERTY_CHANGE,this.onPropertyChanged,this),e.removeEventListener(egret.Event.RESIZE,this.onViewportResize,this)),(this.$viewport=t)&&(t.addEventListener(i.PropertyEvent.PROPERTY_CHANGE,this.onPropertyChanged,this),t.addEventListener(egret.Event.RESIZE,this.onViewportResize,this)),this.invalidateDisplayList()}},enumerable:!0,configurable:!0}),t.prototype.onViewportResize=function(t){this.invalidateDisplayList()},t.prototype.onPropertyChanged=function(t){},t}(i.Component);i.ScrollBarBase=t,__reflect(t.prototype,"eui.ScrollBarBase")}(eui||(eui={})),function(u){var t=function(i){function t(){var t=i.call(this)||this;return t.trackHighlight=null,t.thumb=null,t.track=null,t.$SliderBase={0:0,1:0,2:0,3:0,4:null,5:null,6:300,7:0,8:0,9:!0},t.maximum=10,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchBegin,t),t}return __extends(t,i),Object.defineProperty(t.prototype,"slideDuration",{get:function(){return this.$SliderBase[6]},set:function(t){this.$SliderBase[6]=+t||0},enumerable:!0,configurable:!0}),t.prototype.pointToValue=function(t,e){return this.minimum},Object.defineProperty(t.prototype,"liveDragging",{get:function(){return this.$SliderBase[9]},set:function(t){this.$SliderBase[9]=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pendingValue",{get:function(){return this.$SliderBase[7]},set:function(t){t=+t||0;var e=this.$SliderBase;t!==e[7]&&(e[7]=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.setValue=function(t){this.$SliderBase[7]=t,i.prototype.setValue.call(this,t)},t.prototype.partAdded=function(t,e){i.prototype.partAdded.call(this,t,e),e==this.thumb?(this.thumb.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onThumbTouchBegin,this),this.thumb.addEventListener(egret.Event.RESIZE,this.onTrackOrThumbResize,this)):e==this.track?(this.track.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTrackTouchBegin,this),this.track.addEventListener(egret.Event.RESIZE,this.onTrackOrThumbResize,this)):e===this.trackHighlight&&(this.trackHighlight.touchEnabled=!1,egret.is(this.trackHighlight,"egret.DisplayObjectContainer")&&(this.trackHighlight.touchChildren=!1))},t.prototype.partRemoved=function(t,e){i.prototype.partRemoved.call(this,t,e),e==this.thumb?(this.thumb.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onThumbTouchBegin,this),this.thumb.removeEventListener(egret.Event.RESIZE,this.onTrackOrThumbResize,this)):e==this.track&&(this.track.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTrackTouchBegin,this),this.track.removeEventListener(egret.Event.RESIZE,this.onTrackOrThumbResize,this))},t.prototype.onTrackOrThumbResize=function(t){this.updateSkinDisplayList()},t.prototype.onThumbTouchBegin=function(t){var e=this.$SliderBase;e[5]&&e[5].isPlaying&&this.stopAnimation();var i=this.$stage;i.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouchMove,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this);var n=this.thumb.globalToLocal(t.stageX,t.stageY,egret.$TempPoint);e[0]=n.x,e[1]=n.y,u.UIEvent.dispatchUIEvent(this,u.UIEvent.CHANGE_START)},t.prototype.onStageTouchMove=function(t){var e=this.$SliderBase;e[2]=t.$stageX,e[3]=t.$stageY;var i=this.track;if(i){var n=i.globalToLocal(e[2],e[3],egret.$TempPoint),r=this.pointToValue(n.x-e[0],n.y-e[1]);r=this.nearestValidValue(r,this.snapInterval),this.updateWhenTouchMove(r),t.updateAfterEvent()}},t.prototype.updateWhenTouchMove=function(t){t!=this.$SliderBase[7]&&(this.liveDragging?(this.setValue(t),this.dispatchEventWith(egret.Event.CHANGE)):this.pendingValue=t)},t.prototype.onStageTouchEnd=function(t){var e=t.$currentTarget;e.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouchMove,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),u.UIEvent.dispatchUIEvent(this,u.UIEvent.CHANGE_END);var i=this.$SliderBase;this.liveDragging||this.value==i[7]||(this.setValue(i[7]),this.dispatchEventWith(egret.Event.CHANGE))},t.prototype.onTouchBegin=function(t){this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stageTouchEndHandler,this),this.$SliderBase[4]=t.$target},t.prototype.stageTouchEndHandler=function(t){var e=t.$target,i=this.$SliderBase;t.$currentTarget.removeEventListener(egret.TouchEvent.TOUCH_END,this.stageTouchEndHandler,this),i[4]!=e&&this.contains(e)&&egret.TouchEvent.dispatchTouchEvent(this,egret.TouchEvent.TOUCH_TAP,!0,!0,t.$stageX,t.$stageY,t.touchPointID),i[4]=null},t.prototype.$animationUpdateHandler=function(t){this.pendingValue=t.currentValue},t.prototype.animationEndHandler=function(t){this.setValue(this.$SliderBase[8]),this.dispatchEventWith(egret.Event.CHANGE),u.UIEvent.dispatchUIEvent(this,u.UIEvent.CHANGE_END)},t.prototype.stopAnimation=function(){this.$SliderBase[5].stop(),this.setValue(this.nearestValidValue(this.pendingValue,this.snapInterval)),this.dispatchEventWith(egret.Event.CHANGE),u.UIEvent.dispatchUIEvent(this,u.UIEvent.CHANGE_END)},t.prototype.onTrackTouchBegin=function(t){var e=this.thumb?this.thumb.width:0,i=this.thumb?this.thumb.height:0,n=t.$stageX-e/2,r=t.$stageY-i/2,o=this.track.globalToLocal(n,r,egret.$TempPoint),s=this.$Range,a=this.pointToValue(o.x,o.y);a=this.nearestValidValue(a,s[7]);var h=this.$SliderBase;if(a!=h[7])if(0!=h[6]){h[5]||(h[5]=new u.sys.Animation(this.$animationUpdateHandler,this),h[5].endFunction=this.animationEndHandler);var l=h[5];l.isPlaying&&this.stopAnimation(),h[8]=a,l.duration=h[6]*(Math.abs(h[7]-h[8])/(s[0]-s[2])),l.from=h[7],l.to=h[8],u.UIEvent.dispatchUIEvent(this,u.UIEvent.CHANGE_START),l.play()}else this.setValue(a),this.dispatchEventWith(egret.Event.CHANGE)},t}(u.Range);u.SliderBase=t,__reflect(t.prototype,"eui.SliderBase")}(eui||(eui={})),function(eui){var sys;!function(sys){function getRepeatedIds(t){var e=[];return this.repeatedIdMap={},this.getIds(t,e),e}function getIds(t,e){if(t.namespace!=sys.NS_W&&t.attributes.id){var i=t.attributes.id;this.repeatedIdMap[i]?e.push(toXMLString(t)):this.repeatedIdMap[i]=!0}var n=t.children;if(n)for(var r=n.length,o=0;o<r;o++){var s=n[o];1!==s.nodeType||this.isInnerClass(s)||this.getIds(s,e)}}function toXMLString(t){if(!t)return"";for(var e="  at <"+t.name,i=t.attributes,n=Object.keys(i),r=n.length,o=0;o<r;o++){var s=n[o],a=i[s];("id"!=s||"__"!=a.substring(0,2))&&(e+=" "+s+'="'+a+'"')}return e+(0==t.children.length?"/>":">")}function checkDeclarations(t,e){if(t){var i=t.children;if(i)for(var n=i.length,r=0;r<n;r++){var o=i[r];1==o.nodeType&&(o.attributes.includeIn&&e.push(toXMLString(o)),o.attributes.excludeFrom&&e.push(toXMLString(o)),checkDeclarations(o,e))}}}function getPropertyStr(t){return toXMLString(t.parent)+"\n      \t"+toXMLString(t).substring(5)}var exmlParserPool=[],parsedClasses={},innerClassCount=1,HOST_COMPONENT="hostComponent",SKIN_CLASS="eui.Skin",DECLARATIONS="Declarations",RECTANGLE="egret.Rectangle",TYPE_CLASS="Class",TYPE_ARRAY="Array",TYPE_PERCENTAGE="Percentage",TYPE_STATE="State[]",SKIN_NAME="skinName",ELEMENTS_CONTENT="elementsContent",basicTypes=[TYPE_ARRAY,"boolean","string","number"],wingKeys=["id","locked","includeIn","excludeFrom"],htmlEntities=[["<","&lt;"],[">","&gt;"],["&","&amp;"],['"',"&quot;"],["'","&apos;"]],jsKeyWords=["null","NaN","undefined","true","false"],EXMLParser=function(){function EXMLParser(){this.delayAssignmentDic={}}return EXMLParser.prototype.$parseCode=function(codeText,classStr){var className=classStr||"$exmlClass"+innerClassCount++,clazz=eval(codeText),hasClass=!0;if(hasClass&&clazz){egret.registerClass(clazz,className);for(var paths=className.split("."),length_15=paths.length,definition=__global,i=0;i<length_15-1;i++){var path=paths[i];definition=definition[path]||(definition[path]={})}definition[paths[length_15-1]]||(definition[paths[length_15-1]]=clazz)}return clazz},EXMLParser.prototype.parse=function(text){var xmlData=null;xmlData=egret.XML.parse(text);var hasClass=!1,className="";xmlData.attributes.class?(className=xmlData.attributes.class,delete xmlData.attributes.class,hasClass=!!className):className="$exmlClass"+innerClassCount++;var exClass=this.parseClass(xmlData,className),code=exClass.toCode(),clazz=null;if(clazz=eval(code),hasClass&&clazz){egret.registerClass(clazz,className);for(var paths=className.split("."),length_16=paths.length,definition=__global,i=0;i<length_16-1;i++){var path=paths[i];definition=definition[path]||(definition[path]={})}definition[paths[length_16-1]]||(definition[paths[length_16-1]]=clazz)}return clazz},EXMLParser.prototype.parseClass=function(t,e){sys.exmlConfig||(sys.exmlConfig=new sys.EXMLConfig),this.currentXML=t,this.currentClassName=e,this.delayAssignmentDic={},this.idDic={},this.stateCode=[],this.stateNames=[],this.skinParts=[],this.bindings=[],this.declarations=null,this.currentClass=new sys.EXClass,this.stateIds=[];var i=e.lastIndexOf(".");this.currentClass.className=-1!=i?e.substring(i+1):e,this.startCompile();var n=this.currentClass;return this.currentClass=null,n},EXMLParser.prototype.startCompile=function(){var t=this.getClassNameOfNode(this.currentXML);this.isSkinClass=t==SKIN_CLASS,this.currentClass.superClass=t,this.getStateNames();var e=this.currentXML.children;if(e)for(var i=e.length,n=0;n<i;n++){var r=e[n];if(1===r.nodeType&&r.namespace==sys.NS_W&&r.localName==DECLARATIONS){this.declarations=r;break}}this.currentXML.namespace&&(this.addIds(this.currentXML.children),this.createConstructFunc())},EXMLParser.prototype.addIds=function(t){if(t)for(var e=t.length,i=0;i<e;i++){var n=t[i];if(1==n.nodeType&&n.namespace&&!this.isInnerClass(n)&&(this.addIds(n.children),n.namespace!=sys.NS_W&&n.localName))if(this.isProperty(n)){var r=n.localName.indexOf("."),o=n.children;if(-1==r||!o||0==o.length)continue;var s=o[0];this.stateIds.push(s.attributes.id)}else if(1===n.nodeType){var a=n.attributes.id;if(a){var h=new RegExp("^[a-zA-Z_$]{1}[a-z0-9A-Z_$]*");null==a.match(h)&&egret.$warn(2022,a),-1==this.skinParts.indexOf(a)&&this.skinParts.push(a),this.createVarForNode(n),this.isStateNode(n)&&this.stateIds.push(a)}else this.createIdForNode(n),this.isStateNode(n)&&this.stateIds.push(n.attributes.id)}}},EXMLParser.prototype.isInnerClass=function(t){if(t.hasOwnProperty("isInnerClass"))return t.isInnerClass;var e="Skin"==t.localName&&t.namespace==sys.NS_S;if(!e)if(this.isProperty(t))e=!1;else{var i=void 0,n=t.parent;if(this.isProperty(n)){var r=(i=n.localName).indexOf(".");-1!=r&&(i.substring(r+1),i=i.substring(0,r)),n=n.parent}else i=sys.exmlConfig.getDefaultPropById(n.localName,n.namespace);var o=sys.exmlConfig.getClassNameById(n.localName,n.namespace);e=sys.exmlConfig.getPropertyType(i,o)==TYPE_CLASS}return t.isInnerClass=e},EXMLParser.prototype.containsState=function(t){var e=t.attributes;if(e.includeIn||e.excludeFrom)return!0;for(var i=Object.keys(e),n=i.length,r=0;r<n;r++){if(-1!=i[r].indexOf("."))return!0}return!1},EXMLParser.prototype.createIdForNode=function(t){var e=this.getNodeId(t);this.idDic[e]?this.idDic[e]++:this.idDic[e]=1,e+=this.idDic[e],t.attributes.id=e},EXMLParser.prototype.getNodeId=function(t){return t.attributes.id?t.attributes.id:"_"+t.localName},EXMLParser.prototype.createVarForNode=function(t){""!=this.getClassNameOfNode(t)&&(this.currentClass.getVariableByName(t.attributes.id)||this.currentClass.addVariable(new sys.EXVariable(t.attributes.id)))},EXMLParser.prototype.createFuncForNode=function(t){var e=t.localName;if(this.isBasicTypeData(e))return this.createBasicTypeForNode(t);var i=this.getClassNameOfNode(t),n=new sys.EXFunction,r=t.attributes.id;n.name=r+"_i",this.currentClass.addFunction(n);var o=new sys.EXCodeBlock;n.codeBlock=o;"Object"==e?o.addVar("t","{}"):o.addVar("t","new "+i+"()"),!!this.currentClass.getVariableByName(r)&&o.addAssignment("this."+r,"t"),this.addAttributesToCodeBlock(o,"t",t),this.initlizeChildNode(t,o,"t");var s=this.delayAssignmentDic[r];if(s)for(var a=s.length,h=0;h<a;h++){var l=s[h];o.concat(l)}return o.addReturn("t"),"this."+n.name+"()"},EXMLParser.prototype.isBasicTypeData=function(t){return-1!=basicTypes.indexOf(t)},EXMLParser.prototype.createBasicTypeForNode=function(t){var e=t.localName,i="",n=this.currentClass.getVariableByName(t.attributes.id),r=t.children,o="";if(r&&0<r.length){var s=r[0];3==s.nodeType&&(o=s.text.trim())}switch(e){case TYPE_ARRAY:var a=[];if(r)for(var h=r.length,l=0;l<h;l++){var u=r[l];1==u.nodeType&&a.push(this.createFuncForNode(u))}i="["+a.join(",")+"]";break;case"boolean":i="false"!=o&&o?"true":"false";break;case"number":-1!=(i=o).indexOf("%")&&(i=i.substring(0,i.length-1));break;case"string":i=this.formatString(o)}return n&&(n.defaultValue=i),i},EXMLParser.prototype.addAttributesToCodeBlock=function(t,e,i){var n,r,o=i.attributes,s=Object.keys(o);s.sort();for(var a=s.length,h=0;h<a;h++)if(n=s[h],this.isNormalKey(n)&&(r=o[n],n=this.formatKey(n,r),r=this.formatValue(n,r,i))){if(this.currentClass.getVariableByName(r)){var l="this.",u=o.id,p=l+u+" = t;";this.currentClass.getVariableByName(u)||this.createVarForNode(i),t.containsCodeLine(p)||t.addCodeLineAt(p,1);var c=new sys.EXCodeBlock;"this"==e?c.addAssignment(e,l+r,n):(c.startIf(l+u),c.addAssignment(l+u,l+r,n),c.endBlock()),this.delayAssignmentDic[r]||(this.delayAssignmentDic[r]=[]),this.delayAssignmentDic[r].push(c),r=l+r}t.addAssignment(e,r,n)}},EXMLParser.prototype.initlizeChildNode=function(t,e,i){var n=t.children;if(n&&0!=n.length){for(var r=sys.exmlConfig.getClassNameById(t.localName,t.namespace),o=[],s=n.length,a=[],h=0;h<s;h++){var l=n[h];if(1==l.nodeType&&l.namespace!=sys.NS_W)if(this.isInnerClass(l)){if("Skin"==l.localName){var u=this.parseInnerClass(l);(c=sys.exmlConfig.getPropertyType(SKIN_NAME,r))?e.addAssignment(i,u,SKIN_NAME):egret.$error(2005,this.currentClassName,SKIN_NAME,getPropertyStr(l))}}else{var p=l.localName;if(this.isProperty(l)){if(!this.isNormalKey(p))continue;var c;if(!(c=sys.exmlConfig.getPropertyType(l.localName,r)))continue;if(!l.children||0==l.children.length)continue;this.addChildrenToProp(l.children,c,p,e,i,void 0,a,t)}else o.push(l)}}if(0!=o.length){var d=sys.exmlConfig.getDefaultPropById(t.localName,t.namespace),f=sys.exmlConfig.getPropertyType(d,r);d&&f&&this.addChildrenToProp(o,f,d,e,i,void 0,a,t)}}},EXMLParser.prototype.parseInnerClass=function(t){var e=exmlParserPool.pop();e||(e=new EXMLParser);var i=this.currentClass.className+"$"+t.localName+innerClassCount++,n=e.parseClass(t,i);return this.currentClass.addInnerClass(n),exmlParserPool.push(e),i},EXMLParser.prototype.addChildrenToProp=function(t,e,i,n,r,o,s,a){var h="",l=t.length;if(1<l){if(e!=TYPE_ARRAY)return;for(var u=[],p=0;p<l;p++){1==(y=t[p]).nodeType&&(h=this.createFuncForNode(y),this.getClassNameOfNode(y),this.isStateNode(y)||u.push(h))}h="["+u.join(",")+"]"}else{var c=t[0];if(e==TYPE_ARRAY)if(c.localName==TYPE_ARRAY){u=[];if(c.children)for(var d=c.children.length,f=0;f<d;f++){var y;1==(y=c.children[f]).nodeType&&(h=this.createFuncForNode(y),this.getClassNameOfNode(y),this.isStateNode(y)||u.push(h))}h="["+u.join(",")+"]"}else h=this.createFuncForNode(c),this.getClassNameOfNode(c),h=this.isStateNode(c)?"[]":"["+h+"]";else if(1==c.nodeType)if(e==TYPE_CLASS){if(1<l)return;h=this.parseInnerClass(t[0])}else this.getClassNameOfNode(c),h=this.createFuncForNode(c);else h=this.formatValue(i,c.text,a)}""!=h&&(-1==h.indexOf("()")&&(i=this.formatKey(i,h)),-1==s.indexOf(i)&&s.push(i),n.addAssignment(r,h,i))},EXMLParser.prototype.isProperty=function(t){if(t.hasOwnProperty("isProperty"))return t.isProperty;var e,i=t.localName;if(i&&1===t.nodeType&&t.parent&&!this.isBasicTypeData(i)){var n=t.parent,r=i.indexOf(".");-1!=r&&(i=i.substr(0,r));var o=sys.exmlConfig.getClassNameById(n.localName,n.namespace);e=!!sys.exmlConfig.getPropertyType(i,o)}else e=!1;return t.isProperty=e},EXMLParser.prototype.isNormalKey=function(t){return!(!t||-1!=t.indexOf(".")||-1!=t.indexOf(":")||-1!=wingKeys.indexOf(t))},EXMLParser.prototype.formatKey=function(t,e){return-1!=e.indexOf("%")&&("height"==t?t="percentHeight":"width"==t&&(t="percentWidth")),t},EXMLParser.prototype.formatValue=function(t,e,i){e||(e="");var n=e;e=e.trim();var r=this.getClassNameOfNode(i),o=sys.exmlConfig.getPropertyType(t,r),s=this.formatBinding(t,e,i);if(s){this.checkIdForState(i);var a="this";i!==this.currentXML&&(a+="."+i.attributes.id),this.bindings.push(new sys.EXBinding(a,t,s.templates,s.chainIndex)),e=""}else if(o==RECTANGLE)e="new "+RECTANGLE+"("+e+")";else if(o==TYPE_PERCENTAGE)-1!=e.indexOf("%")&&(e=this.formatString(e));else switch(o){case TYPE_CLASS:t==SKIN_NAME&&(e=this.formatString(n));break;case"number":0==e.indexOf("#")?e="0x"+e.substring(1):-1!=e.indexOf("%")&&(e=parseFloat(e.substr(0,e.length-1)).toString());break;case"boolean":e="false"!=e&&e?"true":"false";break;case"string":case"any":e=this.formatString(n)}return e},EXMLParser.prototype.formatString=function(t){return'"'+(t=(t=(t=(t=this.unescapeHTMLEntity(t)).split("\n").join("\\n")).split("\r").join("\\n")).split('"').join('\\"'))+'"'},EXMLParser.prototype.formatBinding=function(t,e,i){if(!e)return null;if("{"!=(e=e.trim()).charAt(0)||"}"!=e.charAt(e.length-1))return null;for(var n=-1==(e=e.substring(1,e.length-1).trim()).indexOf("+")?[e]:this.parseTemplates(e),r=[],o=n.length,s=0;s<o;s++){var a=n[s].trim();if(a){var h=a.charAt(0);if(!("'"==h||'"'==h||"0"<=h&&h<="9"||"-"==h||-1==a.indexOf(".")&&-1!=jsKeyWords.indexOf(a))){0==a.indexOf("this.")&&(a=a.substring(5));var l=a.split(".")[0];l!=HOST_COMPONENT&&-1==this.skinParts.indexOf(l)&&(a=HOST_COMPONENT+"."+a),n[s]='"'+a+'"',r.push(s)}}else n.splice(s,1),s--,o--}return{templates:n,chainIndex:r}},EXMLParser.prototype.parseTemplates=function(t){if(-1==t.indexOf("'"))return t.split("+");var e=!1,i="";for(t=t.split("\\'").join("\v0\v");0<t.length;){var n=t.indexOf("'");if(-1==n){i+=t;break}i+=t.substring(0,n+1),-1==(n=(t=t.substring(n+1)).indexOf("'"))&&(n=t.length-1,e=!0),i+=t.substring(0,n+1).split("+").join("\v1\v"),t=t.substring(n+1)}t=i.split("\v0\v").join("\\'"),e&&(t+="'");for(var r=t.split("+"),o=r.length,s=0;s<o;s++)r[s]=r[s].split("\v1\v").join("+");return r},EXMLParser.prototype.unescapeHTMLEntity=function(t){if(!t)return"";for(var e=htmlEntities.length,i=0;i<e;i++){var n=htmlEntities[i],r=n[0],o=n[1];t=t.split(o).join(r)}return t},EXMLParser.prototype.createConstructFunc=function(){var t=new sys.EXCodeBlock;t.addEmptyLine();if(this.addAttributesToCodeBlock(t,"this",this.currentXML),this.declarations){var e=this.declarations.children;if(e&&0<e.length)for(var i=e.length,n=0;n<i;n++){var r=e[n];if(1==r.nodeType){var o=this.createFuncForNode(r);o&&t.addCodeLine(o+";")}}}this.initlizeChildNode(this.currentXML,t,"this");var s,a,h=this.stateIds;if(0<h.length){a=h.length;for(n=0;n<a;n++)s=h[n],t.addCodeLine("this."+s+"_i();");t.addEmptyLine()}var l=this.skinParts,u="[]";if(0<(a=l.length)){for(n=0;n<a;n++)l[n]='"'+l[n]+'"';u="["+l.join(",")+"]"}var p=new sys.EXFunction;p.name="skinParts",p.isGet=!0;var c=new sys.EXCodeBlock;c.addReturn(u),p.codeBlock=c,this.currentClass.addFunction(p),this.currentXML.attributes.id="",this.createStates(this.currentXML);for(var d,f=this.currentXML,y=(this.getClassNameOfNode(f),f.attributes),g=Object.keys(y),v=g.length,m=0;m<v;m++){var $=g[m],E=y[$],C=$.indexOf(".");if(-1!=C){var _=$.substring(0,C);_=this.formatKey(_,E);var S=this.formatValue(_,E,f);if(!S)continue;var P=$.substr(C+1),T=(d=this.getStateByName(P,f)).length;if(0<T)for(n=0;n<T;n++){(I=d[n]).addOverride(new sys.EXSetProperty("",_,S))}}}var x=this.stateCode;if(0<(a=x.length)){t.addCodeLine("this.states = [");var b=!0;for(n=0;n<a;n++){var I=x[n];b?b=!1:t.addCodeLine("\t,");for(var L=I.toCode().split("\n"),N=0;N<L.length;){var O=L[N];O&&t.addCodeLine("\t"+O),N++}}t.addCodeLine("];")}var A=this.bindings;if(0<(a=A.length)){t.addEmptyLine();for(n=0;n<a;n++){var M=A[n];t.addCodeLine(M.toCode())}}this.currentClass.constructCode=t},EXMLParser.prototype.isStateNode=function(t){var e=t.attributes;return e.hasOwnProperty("includeIn")||e.hasOwnProperty("excludeFrom")},EXMLParser.prototype.getStateNames=function(){var t=this.currentXML,e=sys.exmlConfig.getClassNameById(t.localName,t.namespace);if(sys.exmlConfig.getPropertyType("states",e)==TYPE_STATE){var i=t.attributes.states;i&&delete t.attributes.states;var n,r,o=this.stateNames,s=t.children;if(s)for(var a=s.length,h=0;h<a;h++)if(1==(r=s[h]).nodeType&&"states"==r.localName){r.namespace=sys.NS_W,n=r.children;break}if(n||i)if(i){var l=i.split(","),u=l.length;for(h=0;h<u;h++){($=l[h].trim())&&(-1==o.indexOf($)&&o.push($),this.stateCode.push(new sys.EXState($)))}}else{var p=n.length;for(h=0;h<p;h++){var c=n[h];if(1==c.nodeType){var d=[],f=c.attributes;if(f.stateGroups)for(var y=f.stateGroups.split(","),g=y.length,v=0;v<g;v++){var m=y[v].trim();m&&(-1==o.indexOf(m)&&o.push(m),d.push(m))}var $=f.name;-1==o.indexOf($)&&o.push($),this.stateCode.push(new sys.EXState($,d))}}}}},EXMLParser.prototype.createStates=function(t){var e=t.children;if(e)for(var i=e.length,n=0;n<i;n++){var r=e[n];if(1==r.nodeType&&!this.isInnerClass(r)&&(this.createStates(r),r.namespace!=sys.NS_W&&r.localName))if(this.isProperty(r)){var o=r.localName,s=o.indexOf("."),a=r.children;if(-1==s||!a||0==a.length)continue;var h=o.substring(s+1);o=o.substring(0,s);var l=this.getClassNameOfNode(t),u=(sys.exmlConfig.getPropertyType(o,l),a[0]),p=void 0;if(1==u.nodeType?(this.createFuncForNode(u),this.checkIdForState(u),p="this."+u.attributes.id):p=this.formatValue(o,u.text,t),0<(x=(y=this.getStateByName(h,r)).length))for(var c=0;c<x;c++){(g=y[c]).addOverride(new sys.EXSetProperty(t.attributes.id,o,p))}}else if(this.containsState(r)){var d=r.attributes,f=d.id;this.getClassNameOfNode(r),this.checkIdForState(r);h=void 0;var y=void 0,g=void 0;if(this.isStateNode(r)){var v="",m=r.parent;m.localName==TYPE_ARRAY&&(m=m.parent),m&&m.parent&&this.isProperty(m)&&(m=m.parent),m&&m!=this.currentXML&&(v=m.attributes.id,this.checkIdForState(m));var $=this.findNearNodeId(r),E=[];if(d.includeIn)E=d.includeIn.split(",");else{var C=d.excludeFrom.split(","),_=C.length;for(c=0;c<_;c++){var S=C[c];this.getStateByName(S,r)}_=this.stateCode.length;for(c=0;c<_;c++)g=this.stateCode[c],-1==C.indexOf(g.name)&&E.push(g.name)}for(var P=E.length,T=0;T<P;T++)if(h=E[T],0<(y=this.getStateByName(h,r)).length){var x=y.length;for(c=0;c<x;c++)(g=y[c]).addOverride(new sys.EXAddItems(f,v,$.position,$.relativeTo))}}for(var b=Object.keys(d),I=b.length,L=0;L<I;L++){var N=b[L];p=d[N];if(-1!=(s=N.indexOf("."))){var O=N.substring(0,s);O=this.formatKey(O,p);var A=this.formatBinding(O,p,r);if(!A&&!(p=this.formatValue(O,p,r)))continue;if(h=N.substr(s+1),0<(x=(y=this.getStateByName(h,r)).length))for(c=0;c<x;c++)g=y[c],A?g.addOverride(new sys.EXSetStateProperty(f,O,A.templates,A.chainIndex)):g.addOverride(new sys.EXSetProperty(f,O,p))}}}}},EXMLParser.prototype.checkIdForState=function(t){if(t&&!this.currentClass.getVariableByName(t.attributes.id)){this.createVarForNode(t);var e=t.attributes.id,i=e+"_i",n=this.currentClass.getFuncByName(i);if(n){var r="this."+e+" = t;",o=n.codeBlock;o&&(o.containsCodeLine(r)||o.addCodeLineAt(r,1))}}},EXMLParser.prototype.getStateByName=function(t,e){for(var i=[],n=this.stateCode,r=n.length,o=0;o<r;o++){var s=n[o];if(s.name==t)-1==i.indexOf(s)&&i.push(s);else if(0<s.stateGroups.length){for(var a=!1,h=s.stateGroups.length,l=0;l<h;l++){if(s.stateGroups[l]==t){a=!0;break}}a&&-1==i.indexOf(s)&&i.push(s)}}return i},EXMLParser.prototype.findNearNodeId=function(t){for(var e,i,n="",r=-1,o=!1,s=t.parent.children,a=s.length,h=0;h<a;h++){var l=s[h];this.isProperty(l)||(l==t?(o=!0,r=h):!o||i||this.isStateNode(l)||(i=l),o||this.isStateNode(l)||l)}return 0==r?{position:e=0,relativeTo:n}:r==a-1?{position:e=1,relativeTo:n}:i&&(e=2,n=i.attributes.id)?(this.checkIdForState(i),{position:e,relativeTo:n}):{position:1,relativeTo:n}},EXMLParser.prototype.getClassNameOfNode=function(t){return sys.exmlConfig.getClassNameById(t.localName,t.namespace)},EXMLParser}();sys.EXMLParser=EXMLParser,__reflect(EXMLParser.prototype,"eui.sys.EXMLParser")}(sys=eui.sys||(eui.sys={}))}(eui||(eui={})),function(t){var h=[],l={},u={},e=function(){function t(){}return t.prototype.getAsset=function(t,e,i){var n=l[t];if(n)n.push([e,i]);else{var r=h.pop();r||(r=new egret.ImageLoader),l[t]=[[e,i]],u[r.$hashCode]=t,r.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),r.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this),r.load(t)}},t.prototype.onLoadFinish=function(t){var e,i=t.currentTarget;i.removeEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),i.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this),t.$type==egret.Event.COMPLETE&&((e=new egret.Texture)._setBitmapData(i.data),i.data=null),h.push(i);var n=u[i.$hashCode];delete u[i.$hashCode];var r=l[n];delete l[n];for(var o=r.length,s=0;s<o;s++){var a=r[s];a[0].call(a[1],e,n)}},t}();t.DefaultAssetAdapter=e,__reflect(e.prototype,"eui.DefaultAssetAdapter",["eui.IAssetAdapter"])}(eui||(eui={})),function(t){var e=function(e){function t(){var t=e.apply(this,arguments)||this;return t.$horizontalAlign="left",t.$verticalAlign="top",t.$gap=6,t.$paddingLeft=0,t.$paddingRight=0,t.$paddingTop=0,t.$paddingBottom=0,t.elementSizeTable=[],t.startIndex=-1,t.endIndex=-1,t.indexInViewCalculated=!1,t.maxElementSize=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"horizontalAlign",{get:function(){return this.$horizontalAlign},set:function(t){this.$horizontalAlign!=t&&(this.$horizontalAlign=t,this.$target&&this.$target.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlign",{get:function(){return this.$verticalAlign},set:function(t){this.$verticalAlign!=t&&(this.$verticalAlign=t,this.$target&&this.$target.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gap",{get:function(){return this.$gap},set:function(t){t=+t||0,this.$gap!==t&&(this.$gap=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this.$paddingLeft},set:function(t){t=+t||0,this.$paddingLeft!==t&&(this.$paddingLeft=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this.$paddingRight},set:function(t){t=+t||0,this.$paddingRight!==t&&(this.$paddingRight=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this.$paddingTop},set:function(t){t=+t||0,this.$paddingTop!==t&&(this.$paddingTop=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this.$paddingBottom},set:function(t){t=+t||0,this.$paddingBottom!==t&&(this.$paddingBottom=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),t.prototype.invalidateTargetLayout=function(){var t=this.$target;t&&(t.invalidateSize(),t.invalidateDisplayList())},t.prototype.measure=function(){this.$target&&(this.$useVirtualLayout?this.measureVirtual():this.measureReal())},t.prototype.measureReal=function(){},t.prototype.measureVirtual=function(){},t.prototype.updateDisplayList=function(t,e){var i=this.$target;if(i)return 0==i.numElements?void i.setContentSize(Math.ceil(this.$paddingLeft+this.$paddingRight),Math.ceil(this.$paddingTop+this.$paddingBottom)):void(this.$useVirtualLayout?this.updateDisplayListVirtual(t,e):this.updateDisplayListReal(t,e))},t.prototype.getStartPosition=function(t){return 0},t.prototype.getElementSize=function(t){return 0},t.prototype.getElementTotalSize=function(){return 0},t.prototype.elementRemoved=function(t){this.$useVirtualLayout&&(e.prototype.elementRemoved.call(this,t),this.elementSizeTable.splice(t,1))},t.prototype.clearVirtualLayoutCache=function(){this.$useVirtualLayout&&(this.elementSizeTable=[],this.maxElementSize=0)},t.prototype.findIndexAt=function(t,e,i){var n=.5*(e+i)|0,r=this.getStartPosition(n),o=this.getElementSize(n);return r<=t&&t<r+o+this.$gap?n:e==i?-1:t<r?this.findIndexAt(t,e,Math.max(e,n-1)):this.findIndexAt(t,Math.min(n+1,i),i)},t.prototype.scrollPositionChanged=function(){(e.prototype.scrollPositionChanged.call(this),this.$useVirtualLayout)&&(this.getIndexInView()&&(this.indexInViewCalculated=!0,this.target.invalidateDisplayList()))},t.prototype.getIndexInView=function(){return!1},t.prototype.updateDisplayListVirtual=function(t,e){},t.prototype.updateDisplayListReal=function(t,e){},t.prototype.flexChildrenProportionally=function(t,e,i,n){var r,o=n.length;do{r=!0;var s=e-t*i/100;0<s?e-=s:s=0;for(var a=e/i,h=0;h<o;h++){var l=n[h],u=l.percent*a;if(u<l.min){var p=l.min;l.size=p,n[h]=n[--o],i-=(n[o]=l).percent,p<=s?s-=p:(e-=p-s,s=0),r=!1;break}if(u>l.max){var c=l.max;l.size=c,n[h]=n[--o],i-=(n[o]=l).percent,c<=s?s-=c:(e-=c-s,s=0),r=!1;break}l.size=u}}while(!r)},t}(t.LayoutBase);t.LinearLayoutBase=e,__reflect(e.prototype,"eui.LinearLayoutBase")}(eui||(eui={})),function(t){var e;e=function(){this.layoutElement=null,this.size=0,this.percent=NaN,this.min=NaN,this.max=NaN},(t.sys||(t.sys={})).ChildInfo=e,__reflect(e.prototype,"eui.sys.ChildInfo")}(eui||(eui={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(t.ToggleButton);t.CheckBox=e,__reflect(e.prototype,"eui.CheckBox")}(eui||(eui={})),function(e){var n=new e.DefaultAssetAdapter,t=function(i){function t(t){var e=i.call(this)||this;return e.sourceChanged=!1,e._source=null,e.initializeUIValues(),t&&(e.source=t),e}return __extends(t,i),Object.defineProperty(t.prototype,"scale9Grid",{get:function(){return this.$scale9Grid},set:function(t){this.$scale9Grid=t,this.$invalidateContentBounds(),this.invalidateDisplayList()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillMode",{get:function(){return this.$fillMode},set:function(t){t!=this.$fillMode&&(this.$fillMode=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.$setFillMode=function(t){var e=i.prototype.$setFillMode.call(this,t);return this.invalidateDisplayList(),e},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},set:function(t){t!=this._source&&(this._source=t,this.$stage?this.parseSource():(this.sourceChanged=!0,this.invalidateProperties()))},enumerable:!0,configurable:!0}),t.prototype.$setBitmapData=function(t){if(t==this.$Bitmap[0])return!1;var e=i.prototype.$setBitmapData.call(this,t);return this.sourceChanged=!1,this.invalidateSize(),this.invalidateDisplayList(),e},t.prototype.parseSource=function(){this.sourceChanged=!1;var t=this._source;if(t&&"string"==typeof t){var e=egret.getImplementation("eui.IAssetAdapter");e||(e=n),e.getAsset(this._source,this.contentChanged,this)}else this.$setBitmapData(t)},t.prototype.contentChanged=function(t,e){e===this._source&&egret.is(t,"egret.Texture")&&(this.$setBitmapData(t),t&&this.dispatchEventWith(egret.Event.COMPLETE))},t.prototype.$measureContentBounds=function(t){var e=(this.$Bitmap,this.$Bitmap[0]);if(e){var i=this.$UIComponent,n=i[10],r=i[11];if(isNaN(n)||isNaN(r))return void t.setEmpty();"clip"==this.$fillMode&&(n>e.$getTextureWidth()&&(n=e.$getTextureWidth()),r>e.$getTextureHeight()&&(r=e.$getTextureHeight())),t.setTo(0,0,n,r)}else t.setEmpty()},t.prototype.$render=function(){if(this.$Bitmap[0]){var t=this.$UIComponent,e=t[10],i=t[11];if(0!==e&&0!==i){var n=this.$Bitmap;egret.sys.BitmapNode.$updateTextureData(this.$renderNode,n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],e,i,n[13],n[14],this.scale9Grid||n[0].scale9Grid,this.$fillMode,n[10])}}},t.prototype.createChildren=function(){this.sourceChanged&&this.parseSource()},t.prototype.childrenCreated=function(){},t.prototype.commitProperties=function(){e.sys.UIComponentImpl.prototype.commitProperties.call(this),this.sourceChanged&&this.parseSource()},t.prototype.measure=function(){var t=this.$Bitmap[0];t?this.setMeasuredSize(t.$getTextureWidth(),t.$getTextureHeight()):this.setMeasuredSize(0,0)},t.prototype.updateDisplayList=function(t,e){this.$invalidateContentBounds()},t.prototype.invalidateParentLayout=function(){},t.prototype.setMeasuredSize=function(t,e){},t.prototype.invalidateProperties=function(){},t.prototype.validateProperties=function(){},t.prototype.invalidateSize=function(){},t.prototype.validateSize=function(t){},t.prototype.invalidateDisplayList=function(){},t.prototype.validateDisplayList=function(){},t.prototype.validateNow=function(){},t.prototype.setLayoutBoundsSize=function(t,e){},t.prototype.setLayoutBoundsPosition=function(t,e){},t.prototype.getLayoutBounds=function(t){},t.prototype.getPreferredBounds=function(t){},t}(egret.Bitmap);e.Image=t,__reflect(t.prototype,"eui.Image",["eui.UIComponent","egret.DisplayObject"]),e.sys.implementUIComponent(t,egret.Bitmap),e.registerProperty(t,"scale9Grid","egret.Rectangle")}(eui||(eui={})),function(i){var t=function(e){function t(){var t=e.call(this)||this;return t._data=null,t._selected=!1,t.itemIndex=-1,t.touchCaptured=!1,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchBegin,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,i.PropertyEvent.dispatchPropertyEvent(this,i.PropertyEvent.PROPERTY_CHANGE,"data"),this.dataChanged()},enumerable:!0,configurable:!0}),t.prototype.dataChanged=function(){},Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected!=t&&(this._selected=t,this.invalidateState())},enumerable:!0,configurable:!0}),t.prototype.onTouchCancle=function(t){this.touchCaptured=!1;var e=t.$currentTarget;e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.invalidateState()},t.prototype.onTouchBegin=function(t){this.$stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!0,this.invalidateState(),t.updateAfterEvent()},t.prototype.onStageTouchEnd=function(t){var e=t.$currentTarget;e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancle,this),e.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this),this.touchCaptured=!1,this.invalidateState()},t.prototype.getCurrentState=function(){var t="up";if(this.touchCaptured&&(t="down"),this._selected){var e=t+"AndSelected",i=this.skin;return i&&i.hasState(e)?e:"disabled"==t?"disabled":"down"}return t},t}(i.Component);i.ItemRenderer=t,__reflect(t.prototype,"eui.ItemRenderer",["eui.IItemRenderer"]),i.registerBindable(t.prototype,"data")}(eui||(eui={})),function(i){var r=i.sys.UIComponentImpl,t=function(n){function t(t){var e=n.call(this)||this;return e.$styleSetMap={fontFamily:!0,size:!0,bold:!0,italic:!0,textAlign:!0,verticalAlign:!0,lineSpacing:!0,textColor:!0,wordWrap:!0,displayAsPassword:!0,strokeColor:!0,stroke:!0,maxChars:!0,multiline:!0,border:!0,borderColor:!0,background:!0,backgroundColor:!0},e.$revertStyle={},e.$style=null,e.$changeFromStyle=!1,e._widthConstraint=NaN,e.initializeUIValues(),e.text=t,e}return __extends(t,n),Object.defineProperty(t.prototype,"style",{get:function(){return this.$style},set:function(t){this.$setStyle(t)},enumerable:!0,configurable:!0}),t.prototype.$setStyle=function(t){if(this.$style!=t){this.$style=t;var e=egret.getImplementation("eui.Theme");if(e){for(var i in this.$changeFromStyle=!0,this.$revertStyle)this[i]=this.$revertStyle[i];if(this.$revertStyle={},null==t)return void(this.$changeFromStyle=!1);for(var n=t.split(","),r=0;r<n.length;r++){var o=e.$getStyleConfig(n[r]);if(o)for(var i in o)if(this.$styleSetMap[i]){var s=this[i];this[i]=o[i],this.$revertStyle[i]=s}}this.$changeFromStyle=!1}}},t.prototype.$setFontFamily=function(t){return this.$changeFromStyle||(delete this.$revertStyle.fontFanily,this.$styleSetMap.fontFanily=!1),n.prototype.$setFontFamily.call(this,t)},t.prototype.$setSize=function(t){return this.$changeFromStyle||(delete this.$revertStyle.size,this.$styleSetMap.size=!1),n.prototype.$setSize.call(this,t)},t.prototype.$setBold=function(t){return this.$changeFromStyle||(delete this.$revertStyle.bold,this.$styleSetMap.bold=!1),n.prototype.$setBold.call(this,t)},t.prototype.$setItalic=function(t){return this.$changeFromStyle||(delete this.$revertStyle.italic,this.$styleSetMap.italic=!1),n.prototype.$setItalic.call(this,t)},t.prototype.$setTextAlign=function(t){return this.$changeFromStyle||(delete this.$revertStyle.textAlign,this.$styleSetMap.textAlign=!1),n.prototype.$setTextAlign.call(this,t)},t.prototype.$setVerticalAlign=function(t){return this.$changeFromStyle||(delete this.$revertStyle.verticalAlign,this.$styleSetMap.verticalAlign=!1),n.prototype.$setVerticalAlign.call(this,t)},t.prototype.$setLineSpacing=function(t){return this.$changeFromStyle||(delete this.$revertStyle.lineSpacing,this.$styleSetMap.lineSpacing=!1),n.prototype.$setLineSpacing.call(this,t)},t.prototype.$setTextColor=function(t){return this.$changeFromStyle||(delete this.$revertStyle.textColor,this.$styleSetMap.textColor=!1),n.prototype.$setTextColor.call(this,t)},t.prototype.$setWordWrap=function(t){this.$changeFromStyle||(delete this.$revertStyle.wordWrap,this.$styleSetMap.wordWrap=!1),n.prototype.$setWordWrap.call(this,t)},t.prototype.$setDisplayAsPassword=function(t){return this.$changeFromStyle||(delete this.$revertStyle.displayAsPassword,this.$styleSetMap.displayAsPassword=!1),n.prototype.$setDisplayAsPassword.call(this,t)},t.prototype.$setStrokeColor=function(t){return this.$changeFromStyle||(delete this.$revertStyle.strokeColor,this.$styleSetMap.strokeColor=!1),n.prototype.$setStrokeColor.call(this,t)},t.prototype.$setStroke=function(t){return this.$changeFromStyle||(delete this.$revertStyle.stroke,this.$styleSetMap.stroke=!1),n.prototype.$setStroke.call(this,t)},t.prototype.$setMaxChars=function(t){return this.$changeFromStyle||(delete this.$revertStyle.maxChars,this.$styleSetMap.maxChars=!1),n.prototype.$setMaxChars.call(this,t)},t.prototype.$setMultiline=function(t){return this.$changeFromStyle||(delete this.$revertStyle.multiline,this.$styleSetMap.multiline=!1),n.prototype.$setMultiline.call(this,t)},t.prototype.$setBorder=function(t){this.$changeFromStyle||(delete this.$revertStyle.border,this.$styleSetMap.border=!1),n.prototype.$setBorder.call(this,t)},t.prototype.$setBorderColor=function(t){this.$changeFromStyle||(delete this.$revertStyle.borderColor,this.$styleSetMap.borderColor=!1),n.prototype.$setBorderColor.call(this,t)},t.prototype.$setBackground=function(t){this.$changeFromStyle||(delete this.$revertStyle.background,this.$styleSetMap.background=!1),n.prototype.$setBackground.call(this,t)},t.prototype.$setBackgroundColor=function(t){this.$changeFromStyle||(delete this.$revertStyle.backgroundColor,this.$styleSetMap.backgroundColor=!1),n.prototype.$setBackgroundColor.call(this,t)},t.prototype.$invalidateContentBounds=function(){n.prototype.$invalidateContentBounds.call(this),this.invalidateSize()},t.prototype.$setWidth=function(t){var e=n.prototype.$setWidth.call(this,t),i=r.prototype.$setWidth.call(this,t);return e&&i},t.prototype.$setHeight=function(t){var e=n.prototype.$setHeight.call(this,t),i=r.prototype.$setHeight.call(this,t);return e&&i},t.prototype.$setText=function(t){var e=n.prototype.$setText.call(this,t);return i.PropertyEvent.dispatchPropertyEvent(this,i.PropertyEvent.PROPERTY_CHANGE,"text"),e},t.prototype.createChildren=function(){},t.prototype.childrenCreated=function(){},t.prototype.commitProperties=function(){},t.prototype.measure=function(){var t=this.$UIComponent,e=this.$TextField[3],i=NaN;isNaN(this._widthConstraint)?isNaN(t[8])?1e5!=t[13]&&(i=t[13]):i=t[8]:(i=this._widthConstraint,this._widthConstraint=NaN),n.prototype.$setWidth.call(this,i),this.setMeasuredSize(this.textWidth,this.textHeight),n.prototype.$setWidth.call(this,e)},t.prototype.updateDisplayList=function(t,e){n.prototype.$setWidth.call(this,t),n.prototype.$setHeight.call(this,e)},t.prototype.invalidateParentLayout=function(){},t.prototype.setMeasuredSize=function(t,e){},t.prototype.invalidateProperties=function(){},t.prototype.validateProperties=function(){},t.prototype.invalidateSize=function(){},t.prototype.validateSize=function(t){},t.prototype.invalidateDisplayList=function(){},t.prototype.validateDisplayList=function(){},t.prototype.validateNow=function(){},t.prototype.setLayoutBoundsSize=function(t,e){if(r.prototype.setLayoutBoundsSize.call(this,t,e),isNaN(t)||t===this._widthConstraint||0==t)this._widthConstraint=t;else{this._widthConstraint=t;var i=this.$UIComponent;isNaN(i[9])&&t!=i[16]&&this.invalidateSize()}},t.prototype.setLayoutBoundsPosition=function(t,e){},t.prototype.getLayoutBounds=function(t){},t.prototype.getPreferredBounds=function(t){},t}(egret.TextField);i.Label=t,__reflect(t.prototype,"eui.Label",["eui.UIComponent","egret.DisplayObject","eui.IDisplayText"]),i.sys.implementUIComponent(t,egret.TextField),i.registerBindable(t.prototype,"text")}(eui||(eui={})),function(a){var t=function(s){function t(){var n=s.apply(this,arguments)||this;return n.allowMultipleSelection=!1,n._selectedIndices=[],n.isValidIndex=function(t,e,i){return n.$dataProvider&&0<=t&&t<n.$dataProvider.length&&t%1==0},n}return __extends(t,s),Object.defineProperty(t.prototype,"selectedIndices",{get:function(){return this._proposedSelectedIndices?this._proposedSelectedIndices:this._selectedIndices},set:function(t){this.setSelectedIndices(t,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedIndex",{get:function(){return this._proposedSelectedIndices?0<this._proposedSelectedIndices.length?this._proposedSelectedIndices[0]:-1:this.$getSelectedIndex()},set:function(t){this.setSelectedIndex(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){var t=[],e=this.selectedIndices;if(e)for(var i=e.length,n=0;n<i;n++)t[n]=this.$dataProvider.getItemAt(e[n]);return t},set:function(t){var e=[];if(t)for(var i=t.length,n=0;n<i;n++){var r=this.$dataProvider.getItemIndex(t[n]);if(-1!=r&&e.splice(0,0,r),-1==r){e=[];break}}this.setSelectedIndices(e,!1)},enumerable:!0,configurable:!0}),t.prototype.setSelectedIndices=function(t,e){var i=this.$ListBase;e&&(i[4]=i[4]||e),this._proposedSelectedIndices=t||[],this.invalidateProperties()},t.prototype.commitProperties=function(){s.prototype.commitProperties.call(this),this._proposedSelectedIndices&&this.commitSelection()},t.prototype.commitSelection=function(t){void 0===t&&(t=!0);var e=this.$ListBase,i=e[3];if(this._proposedSelectedIndices){if(this._proposedSelectedIndices=this._proposedSelectedIndices.filter(this.isValidIndex),!this.allowMultipleSelection&&0<this._proposedSelectedIndices.length){var n=[];n.push(this._proposedSelectedIndices[0]),this._proposedSelectedIndices=n}0<this._proposedSelectedIndices.length?e[2]=this._proposedSelectedIndices[0]:e[2]=-1}var r=s.prototype.commitSelection.call(this,!1);if(!r)return this._proposedSelectedIndices=null,!1;var o=this.$getSelectedIndex();return o>a.ListBase.NO_SELECTION&&(this._proposedSelectedIndices?-1==this._proposedSelectedIndices.indexOf(o)&&this._proposedSelectedIndices.push(o):this._proposedSelectedIndices=[o]),this._proposedSelectedIndices&&(-1!=this._proposedSelectedIndices.indexOf(i)&&this.itemSelected(i,!0),this.commitMultipleSelection()),t&&r&&(e[4]&&(this.dispatchEventWith(egret.Event.CHANGE),e[4]=!1),a.PropertyEvent.dispatchPropertyEvent(this,a.PropertyEvent.PROPERTY_CHANGE,"selectedIndex"),a.PropertyEvent.dispatchPropertyEvent(this,a.PropertyEvent.PROPERTY_CHANGE,"selectedItem")),r},t.prototype.commitMultipleSelection=function(){var t,e,i=[],n=[],r=this._selectedIndices,o=this._proposedSelectedIndices;if(0<r.length&&0<o.length){for(e=o.length,t=0;t<e;t++)-1==r.indexOf(o[t])&&n.push(o[t]);for(e=r.length,t=0;t<e;t++)-1==o.indexOf(r[t])&&i.push(r[t])}else 0<r.length?i=r:0<o.length&&(n=o);if(this._selectedIndices=o,0<i.length)for(e=i.length,t=0;t<e;t++)this.itemSelected(i[t],!1);if(0<n.length)for(e=n.length,t=0;t<e;t++)this.itemSelected(n[t],!0);this._proposedSelectedIndices=null},t.prototype.$isItemIndexSelected=function(t){return this.allowMultipleSelection?-1!=this._selectedIndices.indexOf(t):s.prototype.$isItemIndexSelected.call(this,t)},t.prototype.dataProviderRefreshed=function(){this.allowMultipleSelection||s.prototype.dataProviderRefreshed.call(this)},t.prototype.calculateSelectedIndices=function(t){var e=[],i=this._selectedIndices,n=i.length;if(0<n){if(1==n&&i[0]==t)return this.$ListBase[0]&&e.splice(0,0,i[0]),e;for(var r=!1,o=0;o<n;o++)i[o]==t?r=!0:i[o]!=t&&e.splice(0,0,i[o]);return r||e.splice(0,0,t),e}return e.splice(0,0,t),e},t.prototype.onRendererTouchEnd=function(t){if(this.allowMultipleSelection){var e=t.currentTarget;if(e!=this.$ListBase[7])return;this.setSelectedIndices(this.calculateSelectedIndices(e.itemIndex),!0),a.ItemTapEvent.dispatchItemTapEvent(this,a.ItemTapEvent.ITEM_TAP,e)}else s.prototype.onRendererTouchEnd.call(this,t)},t}(a.ListBase);a.List=t,__reflect(t.prototype,"eui.List")}(eui||(eui={})),function(e){var t=function(i){function t(){var t=i.call(this)||this;return t.closeButton=null,t.moveArea=null,t.titleDisplay=null,t._title="",t.offsetPointX=0,t.offsetPointY=0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onWindowTouchBegin,t,!1,100),t}return __extends(t,i),t.prototype.onWindowTouchBegin=function(t){this.$parent.addChild(this)},Object.defineProperty(t.prototype,"elementsContent",{set:function(t){if(t)for(var e=t.length,i=0;i<e;i++)this.addChild(t[i])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._title},set:function(t){this._title=t,this.titleDisplay&&(this.titleDisplay.text=this.title)},enumerable:!0,configurable:!0}),t.prototype.partAdded=function(t,e){i.prototype.partAdded.call(this,t,e),e==this.titleDisplay?this.titleDisplay.text=this._title:e==this.moveArea?this.moveArea.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this):e==this.closeButton&&this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseButtonClick,this)},t.prototype.partRemoved=function(t,e){i.prototype.partRemoved.call(this,t,e),e==this.moveArea?this.moveArea.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this):e==this.closeButton&&this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseButtonClick,this)},t.prototype.onCloseButtonClick=function(t){e.UIEvent.dispatchUIEvent(this,e.UIEvent.CLOSING,!0,!0)&&this.close()},t.prototype.close=function(){this.$parent&&this.$parent.removeChild(this)},t.prototype.onTouchBegin=function(t){this.$includeInLayout=!1,this.offsetPointX=this.x-t.$stageX,this.offsetPointY=this.y-t.$stageY,this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.onTouchMove=function(t){this.x=t.$stageX+this.offsetPointX,this.y=t.$stageY+this.offsetPointY},t.prototype.onTouchEnd=function(t){this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t}(e.Component);e.Panel=t,__reflect(t.prototype,"eui.Panel"),e.registerProperty(t,"elementsContent","Array",!0)}(eui||(eui={})),function(u){var t=function(o){function t(){var t=o.call(this)||this;return t.thumb=null,t.labelDisplay=null,t._labelFunction=null,t._slideDuration=500,t._direction=u.Direction.LTR,t.slideToValue=0,t.animationValue=0,t.thumbInitX=0,t.thumbInitY=0,t.animation=new u.sys.Animation(t.animationUpdateHandler,t),t}return __extends(t,o),Object.defineProperty(t.prototype,"labelFunction",{get:function(){return this._labelFunction},set:function(t){this._labelFunction!=t&&(this._labelFunction=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.valueToLabel=function(t,e){return null!=this.labelFunction?this._labelFunction(t,e):t+" / "+e},Object.defineProperty(t.prototype,"slideDuration",{get:function(){return this._slideDuration},set:function(t){t=0|+t,this._slideDuration!==t&&(this._slideDuration=t,this.animation.isPlaying&&(this.animation.stop(),this.setValue(this.slideToValue)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction!=t&&(this.thumb&&(this.thumb.x=this.thumbInitX),this.thumb&&(this.thumb.y=this.thumbInitY),this._direction=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.$setValue=function(t){if(this.value===t)return!1;var e=this.$Range,i=o.prototype.$setValue.call(this,t);if(0<this._slideDuration&&this.$stage){this.validateProperties();var n=this.animation;if(n.isPlaying&&(this.animationValue=this.slideToValue,this.invalidateDisplayList(),n.stop()),this.slideToValue=this.nearestValidValue(t,e[7]),this.slideToValue===this.animationValue)return i;var r=this._slideDuration*(Math.abs(this.animationValue-this.slideToValue)/(e[0]-e[2]));n.duration=r===1/0?0:r,n.from=this.animationValue,n.to=this.slideToValue,n.play()}else this.animationValue=this.value;return i},t.prototype.animationUpdateHandler=function(t){var e=this.$Range,i=this.nearestValidValue(t.currentValue,e[7]);this.animationValue=Math.min(e[0],Math.max(e[2],i)),this.invalidateDisplayList()},t.prototype.partAdded=function(t,e){o.prototype.partAdded.call(this,t,e),e===this.thumb&&(this.thumb.x&&(this.thumbInitX=this.thumb.x),this.thumb.y&&(this.thumbInitY=this.thumb.y),this.thumb.addEventListener(egret.Event.RESIZE,this.onThumbResize,this))},t.prototype.partRemoved=function(t,e){o.prototype.partRemoved.call(this,t,e),e===this.thumb&&this.thumb.removeEventListener(egret.Event.RESIZE,this.onThumbResize,this)},t.prototype.onThumbResize=function(t){this.updateSkinDisplayList()},t.prototype.updateSkinDisplayList=function(){var t=this.animation.isPlaying?this.animationValue:this.value,e=this.maximum,i=this.thumb;if(i){var n=i.width,r=i.height,o=Math.round(t/e*n);(o<0||o===1/0)&&(o=0);var s=Math.round(t/e*r);(s<0||s===1/0)&&(s=0);var a=i.$scrollRect;a||(a=egret.$TempRectangle),a.setTo(0,0,n,r);var h=i.x-a.x,l=i.y-a.y;switch(this._direction){case u.Direction.LTR:a.width=o,i.x=h;break;case u.Direction.RTL:a.width=o,a.x=n-o,i.x=a.x;break;case u.Direction.TTB:a.height=s,i.y=l;break;case u.Direction.BTT:a.height=s,a.y=r-s,i.y=a.y}i.scrollRect=a}this.labelDisplay&&(this.labelDisplay.text=this.valueToLabel(t,e))},t}(u.Range);u.ProgressBar=t,__reflect(t.prototype,"eui.ProgressBar")}(eui||(eui={})),function(e){var n={},t=function(i){function t(){var t=i.call(this)||this;return t.$indexNumber=0,t.$radioButtonGroup=null,t._group=null,t.groupChanged=!1,t._groupName="radioGroup",t._value=null,t.groupName="radioGroup",t}return __extends(t,i),Object.defineProperty(t.prototype,"enabled",{get:function(){return!!this.$Component[3]&&(!this.$radioButtonGroup||this.$radioButtonGroup.$enabled)},set:function(t){this.$setEnabled(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"group",{get:function(){if(!this._group&&this._groupName){var t=n[this._groupName];t||((t=new e.RadioButtonGroup).$name=this._groupName,n[this._groupName]=t),this._group=t}return this._group},set:function(t){this._group!=t&&(this.$radioButtonGroup&&this.$radioButtonGroup.$removeInstance(this,!1),this._group=t,this._groupName=t?this.group.$name:"radioGroup",this.groupChanged=!0,this.invalidateProperties(),this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupName",{get:function(){return this._groupName},set:function(t){t&&""!=t&&(this._groupName=t,this.$radioButtonGroup&&this.$radioButtonGroup.$removeInstance(this,!1),this._group=null,this.groupChanged=!0,this.invalidateProperties(),this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.$setSelected=function(t){var e=i.prototype.$setSelected.call(this,t);return this.invalidateDisplayList(),e},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value!=t&&(this._value=t,this.$selected&&this.group&&e.PropertyEvent.dispatchPropertyEvent(this.group,e.PropertyEvent.PROPERTY_CHANGE,"selectedValue"))},enumerable:!0,configurable:!0}),t.prototype.commitProperties=function(){this.groupChanged&&(this.addToGroup(),this.groupChanged=!1),i.prototype.commitProperties.call(this)},t.prototype.updateDisplayList=function(t,e){i.prototype.updateDisplayList.call(this,t,e),this.group&&(this.$selected?this._group.$setSelection(this,!1):this.group.selection==this&&this._group.$setSelection(null,!1))},t.prototype.buttonReleased=function(){this.enabled&&!this.selected&&(this.$radioButtonGroup||this.addToGroup(),i.prototype.buttonReleased.call(this),this.group.$setSelection(this,!0))},t.prototype.addToGroup=function(){var t=this.group;return t&&t.$addInstance(this),t},t}(e.ToggleButton);e.RadioButton=t,__reflect(t.prototype,"eui.RadioButton")}(eui||(eui={})),function(r){function h(t,e){var i=t.parent,n=e.parent;if(!i||!n)return 0;var r=t.$nestLevel,o=e.$nestLevel,s=0,a=0;return i==n&&(s=i.getChildIndex(t),a=n.getChildIndex(e)),o<r||a<s?1:r<o||s<a?-1:t==e?0:h(i,n)}var i=0,t=function(e){function t(){var t=e.call(this)||this;return t.$name=null,t.radioButtons=[],t.$enabled=!0,t._selectedValue=null,t._selection=null,t.$name="_radioButtonGroup"+i++,t}return __extends(t,e),t.prototype.getRadioButtonAt=function(t){return this.radioButtons[t]},Object.defineProperty(t.prototype,"enabled",{get:function(){return this.$enabled},set:function(t){if(t=!!t,this.$enabled!==t){this.$enabled=t;for(var e=this.radioButtons,i=e.length,n=0;n<i;n++)e[n].invalidateState()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRadioButtons",{get:function(){return this.radioButtons.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedValue",{get:function(){return this.selection?null!=this.selection.value?this.selection.value:this.selection.label:null},set:function(t){if(null!=(this._selectedValue=t))for(var e=this.numRadioButtons,i=0;i<e;i++){var n=this.radioButtons[i];if(n.value==t||n.label==t){this.changeSelection(i,!1),this._selectedValue=null,r.PropertyEvent.dispatchPropertyEvent(this,r.PropertyEvent.PROPERTY_CHANGE,"selectedValue");break}}else this.$setSelection(null,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selection},set:function(t){this._selection!=t&&this.$setSelection(t,!1)},enumerable:!0,configurable:!0}),t.prototype.$addInstance=function(t){t.addEventListener(egret.Event.REMOVED,this.removedHandler,this);var e=this.radioButtons;e.push(t),e.sort(h);for(var i=e.length,n=0;n<i;n++)e[n].$indexNumber=n;this._selectedValue&&(this.selectedValue=this._selectedValue),1==t.selected&&(this.selection=t),t.$radioButtonGroup=this,t.invalidateState()},t.prototype.$removeInstance=function(t,e){if(t)for(var i=!1,n=this.radioButtons,r=n.length,o=0;o<r;o++){var s=n[o];i?s.$indexNumber=s.$indexNumber-1:s==t&&(e&&t.addEventListener(egret.Event.ADDED,this.addedHandler,this),t==this._selection&&(this._selection=null),t.$radioButtonGroup=null,t.invalidateState(),this.radioButtons.splice(o,1),i=!0,o--,r--)}},t.prototype.$setSelection=function(t,e){if(this._selection==t)return!1;if(t){for(var i=this.numRadioButtons,n=0;n<i;n++)if(t==this.getRadioButtonAt(n)){this.changeSelection(n,e);break}}else this._selection&&(this._selection.selected=!1,this._selection=null,e&&this.dispatchEventWith(egret.Event.CHANGE));return r.PropertyEvent.dispatchPropertyEvent(this,r.PropertyEvent.PROPERTY_CHANGE,"selectedValue"),!0},t.prototype.changeSelection=function(t,e){var i=this.getRadioButtonAt(t);i&&i!=this._selection&&(this._selection&&(this._selection.selected=!1),this._selection=i,this._selection.selected=!0,e&&this.dispatchEventWith(egret.Event.CHANGE))},t.prototype.addedHandler=function(t){var e=t.target;e&&(e.removeEventListener(egret.Event.ADDED,this.addedHandler,this),this.$addInstance(e))},t.prototype.removedHandler=function(t){var e=t.target;e&&(e.removeEventListener(egret.Event.REMOVED,this.removedHandler,this),this.$removeInstance(e,!0))},t}(egret.EventDispatcher);r.RadioButtonGroup=t,__reflect(t.prototype,"eui.RadioButtonGroup"),r.registerBindable(t.prototype,"selectedValue")}(eui||(eui={})),function(t){var e=function(r){function t(t,e,i){var n=r.call(this)||this;return n.$fillColor=0,n.$fillAlpha=1,n.$strokeColor=4473924,n.$strokeAlpha=1,n.$strokeWeight=0,n.$ellipseWidth=0,n.$ellipseHeight=0,n.touchChildren=!1,n.$graphics=new egret.Graphics,n.$graphics.$setTarget(n),n.width=t,n.height=e,n.fillColor=i,n}return __extends(t,r),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.$graphics},enumerable:!0,configurable:!0}),t.prototype.$measureContentBounds=function(t){this.$graphics&&t.setTo(0,0,this.width,this.height)},Object.defineProperty(t.prototype,"fillColor",{get:function(){return this.$fillColor},set:function(t){null!=t&&this.$fillColor!=t&&(this.$fillColor=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillAlpha",{get:function(){return this.$fillAlpha},set:function(t){this.$fillAlpha!=t&&(this.$fillAlpha=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeColor",{get:function(){return this.$strokeColor},set:function(t){this.$strokeColor!=t&&(this.$strokeColor=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeAlpha",{get:function(){return this.$strokeAlpha},set:function(t){this.$strokeAlpha!=t&&(this.$strokeAlpha=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeWeight",{get:function(){return this.$strokeWeight},set:function(t){this.$strokeWeight!=t&&(this.$strokeWeight=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ellipseWidth",{get:function(){return this.$ellipseWidth},set:function(t){this.$ellipseWidth!=t&&(this.$ellipseWidth=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ellipseHeight",{get:function(){return this.$ellipseHeight},set:function(t){this.$ellipseHeight!=t&&(this.$ellipseHeight=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.updateDisplayList=function(t,e){var i=this.graphics;i.clear(),0<this.$strokeWeight&&(i.beginFill(this.$fillColor,0),i.lineStyle(this.$strokeWeight,this.$strokeColor,this.$strokeAlpha,!0,"normal","square","miter"),0==this.$ellipseWidth&&0==this.$ellipseHeight?i.drawRect(this.$strokeWeight/2,this.$strokeWeight/2,t-this.$strokeWeight,e-this.$strokeWeight):i.drawRoundRect(this.$strokeWeight/2,this.$strokeWeight/2,t-this.$strokeWeight,e-this.$strokeWeight,this.$ellipseWidth,this.$ellipseHeight),i.endFill()),i.beginFill(this.$fillColor,this.$fillAlpha),i.lineStyle(this.$strokeWeight,this.$strokeColor,0,!0,"normal","square","miter"),0==this.$ellipseWidth&&0==this.$ellipseHeight?i.drawRect(this.$strokeWeight,this.$strokeWeight,t-2*this.$strokeWeight,e-2*this.$strokeWeight):i.drawRoundRect(this.$strokeWeight,this.$strokeWeight,t-2*this.$strokeWeight,e-2*this.$strokeWeight,this.$ellipseWidth,this.$ellipseHeight),i.endFill(),this.$invalidateContentBounds()},t}(t.Component);t.Rect=e,__reflect(e.prototype,"eui.Rect")}(eui||(eui={})),function(l){var i,t=function(n){function h(){var t=n.call(this)||this;t.$bounces=!0,t.horizontalScrollBar=null,t.verticalScrollBar=null;var e=new l.sys.TouchScroll(t.horizontalUpdateHandler,t.horizontalEndHandler,t),i=new l.sys.TouchScroll(t.verticalUpdateHandler,t.verticalEndHanlder,t);return t.$Scroller={0:"auto",1:"auto",2:null,3:0,4:0,5:!1,6:!1,7:!1,8:e,9:i,10:null,11:!1,12:!1},t}return __extends(h,n),Object.defineProperty(h.prototype,"bounces",{get:function(){return this.$bounces},set:function(t){this.$bounces=!!t;var e=this.$Scroller[8];e&&(e.$bounces=this.$bounces);var i=this.$Scroller[9];i&&(i.$bounces=this.$bounces)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"throwSpeed",{get:function(){return this.$Scroller[8].$scrollFactor},set:function(t){(t=+t)<0&&(t=0),this.$Scroller[8].$scrollFactor=t,this.$Scroller[9].$scrollFactor=t},enumerable:!0,configurable:!0}),h.prototype.$getThrowInfo=function(t,e){return i?(i.currentPos=t,i.toPos=e):i=new l.ScrollerThrowEvent(l.ScrollerThrowEvent.THROW,!1,!1,t,e),i},Object.defineProperty(h.prototype,"scrollPolicyV",{get:function(){return this.$Scroller[0]},set:function(t){var e=this.$Scroller;e[0]!=t&&(e[0]=t,this.checkScrollPolicy())},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"scrollPolicyH",{get:function(){return this.$Scroller[1]},set:function(t){var e=this.$Scroller;e[1]!=t&&(e[1]=t,this.checkScrollPolicy())},enumerable:!0,configurable:!0}),h.prototype.stopAnimation=function(){var t=this.$Scroller,e=t[9],i=t[8];e.animation.isPlaying?l.UIEvent.dispatchUIEvent(this,l.UIEvent.CHANGE_END):i.animation.isPlaying&&l.UIEvent.dispatchUIEvent(this,l.UIEvent.CHANGE_END),e.stop(),i.stop();var n=this.verticalScrollBar,r=this.horizontalScrollBar;n&&n.autoVisibility&&(n.visible=!1),r&&r.autoVisibility&&(r.visible=!1)},Object.defineProperty(h.prototype,"viewport",{get:function(){return this.$Scroller[10]},set:function(t){var e=this.$Scroller;t!=e[10]&&(this.uninstallViewport(),e[10]=t,e[11]=!1,this.installViewport())},enumerable:!0,configurable:!0}),h.prototype.installViewport=function(){var t=this.viewport;t&&(this.addChildAt(t,0),t.scrollEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBeginCapture,this,!0),t.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEndCapture,this,!0),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTapCapture,this,!0),t.addEventListener(egret.Event.REMOVED,this.onViewPortRemove,this)),this.horizontalScrollBar&&(this.horizontalScrollBar.viewport=t),this.verticalScrollBar&&(this.verticalScrollBar.viewport=t)},h.prototype.uninstallViewport=function(){this.horizontalScrollBar&&(this.horizontalScrollBar.viewport=null),this.verticalScrollBar&&(this.verticalScrollBar.viewport=null);var t=this.viewport;t&&(t.scrollEnabled=!1,t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBeginCapture,this,!0),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEndCapture,this,!0),t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTapCapture,this,!0),t.removeEventListener(egret.Event.REMOVED,this.onViewPortRemove,this),0==this.$Scroller[11]&&this.removeChild(t))},h.prototype.onViewPortRemove=function(t){t.target==this.viewport&&(this.$Scroller[11]=!0,this.viewport=null)},h.prototype.setSkin=function(t){n.prototype.setSkin.call(this,t);var e=this.viewport;e&&this.addChildAt(e,0)},h.prototype.onTouchBeginCapture=function(t){this.$Scroller[12]=!1,this.checkScrollPolicy()&&this.onTouchBegin(t)},h.prototype.onTouchEndCapture=function(t){this.$Scroller[12]&&(t.stopPropagation(),this.onTouchEnd(t))},h.prototype.onTouchTapCapture=function(t){this.$Scroller[12]&&t.stopPropagation()},h.prototype.checkScrollPolicy=function(){var t=this.$Scroller,e=t[10];if(!e)return!1;var i,n,r=e.$UIComponent;switch(t[1]){case"auto":i=e.contentWidth>r[10]||0!==e.scrollH;break;case"on":i=!0;break;case"off":i=!1}switch(t[6]=i,t[0]){case"auto":n=e.contentHeight>r[11]||0!==e.scrollV;break;case"on":n=!0;break;case"off":n=!1}return t[7]=n,i||n},h.prototype.onTouchBegin=function(t){if(!t.isDefaultPrevented()&&this.checkScrollPolicy()){this.downTarget=t.target;var e=this.$Scroller;this.stopAnimation(),e[3]=t.$stageX,e[4]=t.$stageY,e[6]&&e[8].start(t.$stageX),e[7]&&e[9].start(t.$stageY);var i=this.$stage;this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this,!0),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveListeners,this)}},h.prototype.onTouchMove=function(t){if(!t.isDefaultPrevented()){var e=this.$Scroller;if(!e[5]){var i;i=!(Math.abs(e[3]-t.$stageX)<h.scrollThreshold);var n;if(n=!(Math.abs(e[4]-t.$stageY)<h.scrollThreshold),!i&&!n)return;if(!n&&i&&"off"==e[1])return;if(!i&&n&&"off"==e[0])return;e[12]=!0,e[5]=!0,this.dispatchCancelEvent(t);var r=this.horizontalScrollBar,o=this.verticalScrollBar;r&&r.autoVisibility&&e[6]&&(r.visible=!0),o&&o.autoVisibility&&e[7]&&(o.visible=!0),e[2]&&e[2].reset(),l.UIEvent.dispatchUIEvent(this,l.UIEvent.CHANGE_START),this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)}t.preventDefault();var s=e[10],a=s.$UIComponent;e[6]&&e[8].update(t.$stageX,s.contentWidth-a[10],s.scrollH),e[7]&&e[9].update(t.$stageY,s.contentHeight-a[11],s.scrollV)}},h.prototype.onTouchCancel=function(t){this.$Scroller[5]||this.onRemoveListeners()},h.prototype.dispatchCancelEvent=function(t){var e=this.$Scroller[10];if(e){for(var i=new egret.TouchEvent(egret.TouchEvent.TOUCH_CANCEL,t.bubbles,t.cancelable),n=this.downTarget,r=this.$getPropagationList(n),o=r.length,s=.5*r.length,a=-1,h=0;h<o;h++)if(r[h]===e){a=h;break}r.splice(0,a+1),s-=a+1,this.$dispatchPropagationEvent(i,r,s),egret.Event.release(i)}},h.prototype.onTouchEnd=function(t){var e=this.$Scroller;e[5]=!1,this.onRemoveListeners();var i=e[10],n=i.$UIComponent;e[8].isStarted()&&e[8].finish(i.scrollH,i.contentWidth-n[10]),e[9].isStarted()&&e[9].finish(i.scrollV,i.contentHeight-n[11])},h.prototype.onRemoveListeners=function(){var t=this.$stage;this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this,!0),t.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchCancel,!0),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveListeners,this)},h.prototype.horizontalUpdateHandler=function(t){this.$Scroller[10].scrollH=t,this.dispatchEventWith(egret.Event.CHANGE)},h.prototype.verticalUpdateHandler=function(t){this.$Scroller[10].scrollV=t,this.dispatchEventWith(egret.Event.CHANGE)},h.prototype.horizontalEndHandler=function(){this.$Scroller[9].isPlaying()||this.onChangeEnd()},h.prototype.verticalEndHanlder=function(){this.$Scroller[8].isPlaying()||this.onChangeEnd()},h.prototype.onChangeEnd=function(){var t=this.$Scroller,e=this.horizontalScrollBar,i=this.verticalScrollBar;(e&&e.visible||i&&i.visible)&&(t[2]||(t[2]=new egret.Timer(200,1),t[2].addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onAutoHideTimer,this)),t[2].reset(),t[2].start()),l.UIEvent.dispatchUIEvent(this,l.UIEvent.CHANGE_END)},h.prototype.onAutoHideTimer=function(t){var e=this.horizontalScrollBar,i=this.verticalScrollBar;e&&e.autoVisibility&&(e.visible=!1),i&&i.autoVisibility&&(i.visible=!1)},h.prototype.updateDisplayList=function(t,e){n.prototype.updateDisplayList.call(this,t,e);var i=this.viewport;i&&(i.setLayoutBoundsSize(t,e),i.setLayoutBoundsPosition(0,0))},h.prototype.partAdded=function(t,e){n.prototype.partAdded.call(this,t,e),e==this.horizontalScrollBar?(this.horizontalScrollBar.touchChildren=!1,this.horizontalScrollBar.touchEnabled=!1,this.horizontalScrollBar.viewport=this.viewport,this.horizontalScrollBar.autoVisibility&&(this.horizontalScrollBar.visible=!1)):e==this.verticalScrollBar&&(this.verticalScrollBar.touchChildren=!1,this.verticalScrollBar.touchEnabled=!1,this.verticalScrollBar.viewport=this.viewport,this.verticalScrollBar.autoVisibility&&(this.verticalScrollBar.visible=!1))},h}(l.Component);t.scrollThreshold=5,l.Scroller=t,__reflect(t.prototype,"eui.Scroller"),l.registerProperty(t,"viewport","eui.IViewport",!0)}(eui||(eui={})),function(i){var t=function(e){function t(){var t=e.apply(this,arguments)||this;return t.maxWidth=1e5,t.minWidth=0,t.maxHeight=1e5,t.minHeight=0,t.width=NaN,t.height=NaN,t.$elementsContent=[],t._hostComponent=null,t.$stateValues=new i.sys.StateValues,t}return __extends(t,e),Object.defineProperty(t.prototype,"elementsContent",{set:function(t){this.$elementsContent=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hostComponent",{get:function(){return this._hostComponent},set:function(t){this._hostComponent!=t&&(this._hostComponent&&this._hostComponent.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),this._hostComponent=t,(this.$stateValues.parent=t)&&(this.commitCurrentState(),this.$stateValues.intialized||(t.$stage?this.initializeStates(t.$stage):t.once(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this))),i.PropertyEvent.dispatchPropertyEvent(this,i.PropertyEvent.PROPERTY_CHANGE,"hostComponent"))},enumerable:!0,configurable:!0}),t.prototype.onAddedToStage=function(t){this.initializeStates(this._hostComponent.$stage)},t}(egret.EventDispatcher);i.Skin=t,__reflect(t.prototype,"eui.Skin"),i.sys.mixin(t,i.sys.StateClient),i.registerProperty(t,"elementsContent","Array",!0),i.registerProperty(t,"states","State[]"),i.registerBindable(t.prototype,"hostComponent")}(eui||(eui={})),function(n){var t=function(i){function t(){var t=i.call(this)||this;return t.indexBeingUpdated=!1,t.requireSelection=!0,t.useVirtualLayout=!1,t}return __extends(t,i),t.prototype.createChildren=function(){if(!this.$layout){var t=new n.HorizontalLayout;t.gap=0,t.horizontalAlign=n.JustifyAlign.JUSTIFY,t.verticalAlign=n.JustifyAlign.CONTENT_JUSTIFY,this.$setLayout(t)}i.prototype.createChildren.call(this)},t.prototype.$setDataProvider=function(t){var e=this.$dataProvider;return e&&e instanceof n.ViewStack&&(e.removeEventListener(n.PropertyEvent.PROPERTY_CHANGE,this.onViewStackIndexChange,this),this.removeEventListener(egret.Event.CHANGE,this.onIndexChanged,this)),t&&t instanceof n.ViewStack&&(t.addEventListener(n.PropertyEvent.PROPERTY_CHANGE,this.onViewStackIndexChange,this),this.addEventListener(egret.Event.CHANGE,this.onIndexChanged,this)),i.prototype.$setDataProvider.call(this,t)},t.prototype.onIndexChanged=function(t){this.indexBeingUpdated=!0,this.$dataProvider.selectedIndex=this.selectedIndex,this.indexBeingUpdated=!1},t.prototype.onViewStackIndexChange=function(t){"selectedIndex"!=t.property||this.indexBeingUpdated||this.setSelectedIndex(this.$dataProvider.selectedIndex,!1)},t}(n.ListBase);n.TabBar=t,__reflect(t.prototype,"eui.TabBar")}(eui||(eui={})),function(r){var o=egret.FocusEvent,t=function(n){function t(){var t=n.call(this)||this;return t.isFocus=!1,t.$TextInput={0:null,1:null,2:null,3:null,4:null,5:null,6:"",7:null,8:egret.TextFieldInputType.TEXT},t}return __extends(t,n),Object.defineProperty(t.prototype,"prompt",{get:function(){return this.promptDisplay?this.promptDisplay.text:this.$TextInput[0]},set:function(t){this.$TextInput[0]=t,this.promptDisplay&&(this.promptDisplay.text=t),this.invalidateProperties(),this.invalidateState()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayAsPassword",{get:function(){if(this.textDisplay)return this.textDisplay.displayAsPassword;var t=this.$TextInput[1];return t||!1},set:function(t){this.$TextInput[1]=t,this.textDisplay&&(this.textDisplay.displayAsPassword=t),this.invalidateProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputType",{get:function(){return this.textDisplay?this.textDisplay.inputType:this.$TextInput[8]},set:function(t){this.$TextInput[8]=t,this.textDisplay&&(this.textDisplay.inputType=t),this.invalidateProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textColor",{get:function(){return this.textDisplay?this.textDisplay.textColor:this.$TextInput[2]},set:function(t){this.$TextInput[2]=t,this.textDisplay&&(this.textDisplay.textColor=t),this.invalidateProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxChars",{get:function(){if(this.textDisplay)return this.textDisplay.maxChars;var t=this.$TextInput[3];return t||0},set:function(t){this.$TextInput[3]=t,this.textDisplay&&(this.textDisplay.maxChars=t),this.invalidateProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){if(this.textDisplay)return this.textDisplay.maxWidth;var t=this.$TextInput[4];return t||1e5},set:function(t){this.$TextInput[4]=t,this.textDisplay&&(this.textDisplay.maxWidth=t),this.invalidateProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxHeight",{get:function(){this.textDisplay;var t=this.$TextInput[5];return t||1e5},set:function(t){this.$TextInput[5]=t,this.textDisplay&&(this.textDisplay.maxHeight=t),this.invalidateProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.textDisplay?this.textDisplay.text:this.$TextInput[6]},set:function(t){this.$TextInput[6]=t,this.textDisplay&&(this.textDisplay.text=t),this.invalidateProperties(),this.invalidateState()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"restrict",{get:function(){return this.textDisplay?this.textDisplay.restrict:this.$TextInput[7]},set:function(t){this.$TextInput[7]=t,this.textDisplay&&(this.textDisplay.restrict=t),this.invalidateProperties()},enumerable:!0,configurable:!0}),t.prototype.focusInHandler=function(t){this.isFocus=!0,this.invalidateState()},t.prototype.focusOutHandler=function(t){this.isFocus=!1,this.invalidateState()},t.prototype.getCurrentState=function(){var t=this.skin;return!this.prompt||this.isFocus||this.text?this.enabled?"normal":"disabled":this.enabled&&t.hasState("normalWithPrompt")?"normalWithPrompt":!this.enabled&&t.hasState("disabledWithPrompt")?"disabledWithPrompt":void 0},t.prototype.partAdded=function(t,e){n.prototype.partAdded.call(this,t,e);var i=this.$TextInput;e==this.textDisplay?(this.textDisplayAdded(),this.textDisplay instanceof r.EditableText&&(this.textDisplay.addEventListener(o.FOCUS_IN,this.focusInHandler,this),this.textDisplay.addEventListener(o.FOCUS_OUT,this.focusOutHandler,this))):e==this.promptDisplay&&i[0]&&(this.promptDisplay.text=i[0])},t.prototype.partRemoved=function(t,e){n.prototype.partRemoved.call(this,t,e),e==this.textDisplay?(this.textDisplayRemoved(),this.textDisplay instanceof r.EditableText&&(this.textDisplay.removeEventListener(o.FOCUS_IN,this.focusInHandler,this),this.textDisplay.removeEventListener(o.FOCUS_OUT,this.focusOutHandler,this))):e==this.promptDisplay&&(this.$TextInput[0]=this.promptDisplay.text)},t.prototype.textDisplayAdded=function(){var t=this.$TextInput;t[1]&&(this.textDisplay.displayAsPassword=t[1]),t[2]&&(this.textDisplay.textColor=t[2]),t[3]&&(this.textDisplay.maxChars=t[3]),t[4]&&(this.textDisplay.maxWidth=t[4]),t[5]&&(this.textDisplay.maxHeight=t[5]),t[6]&&(this.textDisplay.text=t[6]),t[7]&&(this.textDisplay.restrict=t[7]),t[8]&&(this.textDisplay.inputType=t[8])},t.prototype.textDisplayRemoved=function(){var t=this.$TextInput;t[1]=this.textDisplay.displayAsPassword,t[2]=this.textDisplay.textColor,t[3]=this.textDisplay.maxChars,t[4]=this.textDisplay.maxWidth,t[5]=this.textDisplay.maxHeight,t[6]=this.textDisplay.text,t[7]=this.textDisplay.restrict,t[8]=this.textDisplay.inputType},t}(r.Component);r.TextInput=t,__reflect(t.prototype,"eui.TextInput")}(eui||(eui={})),function(c){var t=function(){function p(){}return p.bindProperty=function(t,e,i,n){var r=c.Watcher.watch(t,e,null,null);if(r){var o=function(t){i[n]=t};r.setHandler(o,null),o(r.getValue())}return r},p.bindHandler=function(t,e,i,n){var r=c.Watcher.watch(t,e,i,n);return r&&i.call(n,r.getValue()),r},p.$bindProperties=function(t,e,i,n,r){if(1==e.length&&1==i.length)return p.bindProperty(t,e[0].split("."),n,r);for(var o,s=function(){n[r]=function(t){for(var e=t[0],i=e instanceof c.Watcher?e.getValue():e,n=t.length,r=1;r<n;r++){var o=t[r];o instanceof c.Watcher&&(o=o.getValue()),i+=o}return i}(e)},a=i.length,h=0;h<a;h++){var l=i[h],u=e[l].split(".");(o=c.Watcher.watch(t,u,null,null))&&(e[l]=o).setHandler(s,null)}return s(),o},p}();c.Binding=t,__reflect(t.prototype,"eui.Binding")}(eui||(eui={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(t.ToggleButton);t.ToggleSwitch=e,__reflect(e.prototype,"eui.ToggleSwitch")}(eui||(eui={})),function(t){var e=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemoveFromStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(t){this.$stage.addEventListener(egret.Event.RESIZE,this.onResize,this),this.onResize()},t.prototype.onRemoveFromStage=function(t){this.$stage.removeEventListener(egret.Event.RESIZE,this.onResize,this)},t.prototype.onResize=function(t){var e=this.$stage;this.$setWidth(e.$stageWidth),this.$setHeight(e.$stageHeight)},t}(t.Group);t.UILayer=e,__reflect(e.prototype,"eui.UILayer")}(eui||(eui={})),function(t){var e=function(c){function t(){return c.apply(this,arguments)||this}return __extends(t,c),t.prototype.updateDisplayList=function(t,e){c.prototype.updateDisplayList.call(this,t,e);var i=this.thumb,n=this.$viewport;if(i&&n){var r=egret.$TempRectangle;i.getPreferredBounds(r);var o=r.height,s=r.x,a=n.scrollV,h=n.contentHeight,l=n.height;if(a<=0){var u=o*(1- -a/(.5*l));u=Math.max(5,Math.round(u)),i.setLayoutBoundsSize(NaN,u),i.setLayoutBoundsPosition(s,0)}else if(h-l<=a){u=o*(1-(a-h+l)/(.5*l));u=Math.max(5,Math.round(u)),i.setLayoutBoundsSize(NaN,u),i.setLayoutBoundsPosition(s,e-u)}else{var p=(e-o)*a/(h-l);i.setLayoutBoundsSize(NaN,NaN),i.setLayoutBoundsPosition(s,p)}}},t.prototype.onPropertyChanged=function(t){switch(t.property){case"scrollV":case"contentHeight":this.invalidateDisplayList()}},t}(t.ScrollBarBase);t.VScrollBar=e,__reflect(e.prototype,"eui.VScrollBar")}(eui||(eui={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.pointToValue=function(t,e){if(!this.thumb||!this.track)return 0;var i=this.$Range,n=i[0]-i[2],r=this.getThumbRange();return i[2]+(0!=r?(r-e)/r*n:0)},e.prototype.getThumbRange=function(){var t=egret.$TempRectangle;this.track.getLayoutBounds(t);var e=t.height;return this.thumb.getLayoutBounds(t),e-t.height},e.prototype.updateSkinDisplayList=function(){if(this.thumb&&this.track){var t=this.$Range,e=this.getThumbRange(),i=t[0]-t[2],n=0<i?e-(this.pendingValue-t[2])/i*e:0,r=this.track.localToGlobal(0,n,egret.$TempPoint),o=r.x,s=r.y,a=this.thumb.$parent.globalToLocal(o,s,egret.$TempPoint).y,h=egret.$TempRectangle,l=h.height;if(this.thumb.getLayoutBounds(h),this.thumb.setLayoutBoundsPosition(h.x,Math.round(a)),this.trackHighlight){var u=this.trackHighlight.$parent.globalToLocal(o,s,egret.$TempPoint).y;this.trackHighlight.y=Math.round(u+l),this.trackHighlight.height=Math.round(e-u)}}},e}(t.SliderBase);t.VSlider=e,__reflect(e.prototype,"eui.VSlider")}(eui||(eui={})),function(r){var t=function(n){function t(){var t=n.call(this)||this;return t._selectedChild=null,t.proposedSelectedIndex=r.ListBase.NO_PROPOSED_SELECTION,t._selectedIndex=-1,t}return __extends(t,n),Object.defineProperty(t.prototype,"layout",{get:function(){return this.$layout},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedChild",{get:function(){var t=this.selectedIndex;return 0<=t&&t<this.numChildren?this.getChildAt(t):null},set:function(t){var e=this.getChildIndex(t);0<=e&&e<this.numChildren&&this.setSelectedIndex(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedIndex",{get:function(){return this.proposedSelectedIndex!=r.ListBase.NO_PROPOSED_SELECTION?this.proposedSelectedIndex:this._selectedIndex},set:function(t){t=0|+t,this.setSelectedIndex(t)},enumerable:!0,configurable:!0}),t.prototype.setSelectedIndex=function(t){t!=this.selectedIndex&&(this.proposedSelectedIndex=t,this.invalidateProperties(),r.PropertyEvent.dispatchPropertyEvent(this,r.PropertyEvent.PROPERTY_CHANGE,"selectedIndex"))},t.prototype.$childAdded=function(t,e){n.prototype.$childAdded.call(this,t,e),this.showOrHide(t,!1);var i=this.selectedIndex;-1==i?this.setSelectedIndex(e):e<=this.selectedIndex&&this.$stage&&this.setSelectedIndex(i+1),r.CollectionEvent.dispatchCollectionEvent(this,r.CollectionEvent.COLLECTION_CHANGE,r.CollectionEventKind.ADD,e,-1,[t.name])},t.prototype.$childRemoved=function(t,e){n.prototype.$childRemoved.call(this,t,e),this.showOrHide(t,!0);var i=this.selectedIndex;e==i?0<this.numChildren?0==e?(this.proposedSelectedIndex=0,this.invalidateProperties()):this.setSelectedIndex(0):this.setSelectedIndex(-1):e<i&&this.setSelectedIndex(i-1),r.CollectionEvent.dispatchCollectionEvent(this,r.CollectionEvent.COLLECTION_CHANGE,r.CollectionEventKind.REMOVE,e,-1,[t.name])},t.prototype.commitProperties=function(){n.prototype.commitProperties.call(this),this.proposedSelectedIndex!=r.ListBase.NO_PROPOSED_SELECTION&&(this.commitSelection(this.proposedSelectedIndex),this.proposedSelectedIndex=r.ListBase.NO_PROPOSED_SELECTION)},t.prototype.commitSelection=function(t){0<=t&&t<this.numChildren?(this._selectedIndex=t,this._selectedChild&&this.showOrHide(this._selectedChild,!1),this._selectedChild=this.getElementAt(this._selectedIndex),this.showOrHide(this._selectedChild,!0)):(this._selectedChild=null,this._selectedIndex=-1),this.invalidateSize(),this.invalidateDisplayList()},t.prototype.showOrHide=function(t,e){egret.is(t,"eui.UIComponent")&&(t.includeInLayout=e),t.visible=e},Object.defineProperty(t.prototype,"length",{get:function(){return this.$children.length},enumerable:!0,configurable:!0}),t.prototype.getItemAt=function(t){var e=this.$children[t];return e?e.name:""},t.prototype.getItemIndex=function(t){for(var e=this.$children,i=e.length,n=0;n<i;n++)if(e[n].name==t)return n;return-1},t}(r.Group);r.ViewStack=t,__reflect(t.prototype,"eui.ViewStack",["eui.ICollection","egret.IEventDispatcher"]),r.registerBindable(t.prototype,"selectedIndex")}(eui||(eui={})),function(t){!function(t){function i(t){return-.5*(Math.cos(Math.PI*t)-1)}var e=function(){function t(t,e){this.easerFunction=i,this.isPlaying=!1,this.duration=500,this.currentValue=0,this.from=0,this.to=0,this.startTime=0,this.endFunction=null,this.updateFunction=t,this.thisObject=e}return t.prototype.play=function(){this.stop(),this.start()},t.prototype.start=function(){this.isPlaying=!1,this.currentValue=0,this.startTime=egret.getTimer(),this.doInterval(this.startTime),egret.startTick(this.doInterval,this)},t.prototype.stop=function(){this.isPlaying=!1,this.startTime=0,egret.stopTick(this.doInterval,this)},t.prototype.doInterval=function(t){var e=t-this.startTime;this.isPlaying||(this.isPlaying=!0);var i=this.duration,n=0==i?1:Math.min(e,i)/i;this.easerFunction&&(n=this.easerFunction(n)),this.currentValue=this.from+(this.to-this.from)*n,this.updateFunction&&this.updateFunction.call(this.thisObject,this);var r=i<=e;return r&&this.stop(),r&&this.endFunction&&this.endFunction.call(this.thisObject,this),!0},t}();t.Animation=e,__reflect(e.prototype,"eui.sys.Animation")}(t.sys||(t.sys={}))}(eui||(eui={})),function(t){var e=function(){function t(){}return t.prototype.getTheme=function(t,i,e,n){var r=new egret.HttpRequest;r.addEventListener(egret.Event.COMPLETE,function(t){var e=t.target;i.call(n,e.response)},n),r.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){e.call(n)},n),r.responseType=egret.HttpResponseType.TEXT,r.open(t),r.send()},t}();t.DefaultThemeAdapter=e,__reflect(e.prototype,"eui.DefaultThemeAdapter",["eui.IThemeAdapter"])}(eui||(eui={})),function(a){function h(t,e){for(var i=t[l],n=i.length,r=0;r<n;r+=2){var o=i[r],s=i[r+1];o.call(s,e)}}var l="__listeners__",u=0,t=function(){function o(t,e,i,n){this.isExecuting=!1,this.property=t,this.handler=e,this.next=n,this.thisObject=i}return o.watch=function(t,e,i,n){if(0<e.length){var r=new o(e.shift(),i,n,o.watch(null,e,i,n));return r.reset(t),r}return null},o.checkBindable=function(t,e){var i=t.__bindables__;if(i&&-1!=i.indexOf(e))return!0;var n=egret.is(t,"egret.IEventDispatcher");n||t[l]||(t[l]=[]);var r=function t(e,i){var n=Object.getOwnPropertyDescriptor(e,i);if(n)return n;var r=Object.getPrototypeOf(e);return r?t(r,i):null}(t,e);if(r&&r.set&&r.get){var o=r.set;r.set=function(t){this[e]!=t&&(o.call(this,t),n?a.PropertyEvent.dispatchPropertyEvent(this,a.PropertyEvent.PROPERTY_CHANGE,e):h(this,e))}}else{if(r&&(r.get||r.set))return!1;var s="_"+ ++u+e;t[s]=r?r.value:null,r={enumerable:!0,configurable:!0,get:function(){return this[s]},set:function(t){this[s]!=t&&(this[s]=t,n?a.PropertyEvent.dispatchPropertyEvent(this,a.PropertyEvent.PROPERTY_CHANGE,e):h(this,e))}}}Object.defineProperty(t,e,r),a.registerBindable(t,e)},o.prototype.unwatch=function(){this.reset(null),this.handler=null,this.next&&(this.next.handler=null)},o.prototype.getValue=function(){return this.next?this.next.getValue():this.getHostPropertyValue()},o.prototype.setHandler=function(t,e){this.handler=t,this.thisObject=e,this.next&&this.next.setHandler(t,e)},o.prototype.reset=function(t){var e=this.host;if(e)if(egret.is(e,"egret.IEventDispatcher"))e.removeEventListener(a.PropertyEvent.PROPERTY_CHANGE,this.wrapHandler,this);else{var i=(n=e[l]).indexOf(this);n.splice(i-1,2)}if(this.host=t)if(o.checkBindable(t,this.property),egret.is(t,"egret.IEventDispatcher"))t.addEventListener(a.PropertyEvent.PROPERTY_CHANGE,this.wrapHandler,this,!1,100);else{var n;(n=t[l]).push(this.onPropertyChange),n.push(this)}this.next&&this.next.reset(this.getHostPropertyValue())},o.prototype.getHostPropertyValue=function(){return this.host?this.host[this.property]:null},o.prototype.wrapHandler=function(t){this.onPropertyChange(t.property)},o.prototype.onPropertyChange=function(t){if(t==this.property&&!this.isExecuting)try{this.isExecuting=!0,this.next&&this.next.reset(this.getHostPropertyValue()),this.handler.call(this.thisObject,this.getValue())}finally{this.isExecuting=!1}},o}();a.Watcher=t,__reflect(t.prototype,"eui.Watcher")}(eui||(eui={})),function(o){var t=function(i){function t(t){var e=i.call(this)||this;return e._source=t||[],e}return __extends(t,i),Object.defineProperty(t.prototype,"source",{get:function(){return this._source},set:function(t){t||(t=[]),this._source=t,this.dispatchCoEvent(o.CollectionEventKind.RESET)},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){this.dispatchCoEvent(o.CollectionEventKind.REFRESH)},Object.defineProperty(t.prototype,"length",{get:function(){return this._source.length},enumerable:!0,configurable:!0}),t.prototype.addItem=function(t){this._source.push(t),this.dispatchCoEvent(o.CollectionEventKind.ADD,this._source.length-1,-1,[t])},t.prototype.addItemAt=function(t,e){e<0||this._source.length,this._source.splice(e,0,t),this.dispatchCoEvent(o.CollectionEventKind.ADD,e,-1,[t])},t.prototype.getItemAt=function(t){return this._source[t]},t.prototype.getItemIndex=function(t){for(var e=this._source.length,i=0;i<e;i++)if(this._source[i]===t)return i;return-1},t.prototype.itemUpdated=function(t){var e=this.getItemIndex(t);-1!=e&&this.dispatchCoEvent(o.CollectionEventKind.UPDATE,e,-1,[t])},t.prototype.removeAll=function(){var t=this._source.concat();this._source=[],this.dispatchCoEvent(o.CollectionEventKind.REMOVE,0,-1,t)},t.prototype.removeItemAt=function(t){if(!(t<0||t>=this._source.length)){var e=this._source.splice(t,1)[0];return this.dispatchCoEvent(o.CollectionEventKind.REMOVE,t,-1,[e]),e}},t.prototype.replaceItemAt=function(t,e){if(!(e<0||e>=this._source.length)){var i=this._source.splice(e,1,t)[0];return this.dispatchCoEvent(o.CollectionEventKind.REPLACE,e,-1,[t],[i]),i}},t.prototype.replaceAll=function(t){t||(t=[]);for(var e=t.length,i=this._source.length,n=e;n<i;n++)this.removeItemAt(e);for(n=0;n<e;n++)i<=n?this.addItemAt(t[n],n):this.replaceItemAt(t[n],n);this._source=t},t.prototype.dispatchCoEvent=function(t,e,i,n,r){o.CollectionEvent.dispatchCollectionEvent(this,o.CollectionEvent.COLLECTION_CHANGE,t,e,i,n,r)},t}(egret.EventDispatcher);o.ArrayCollection=t,__reflect(t.prototype,"eui.ArrayCollection",["eui.ICollection","egret.IEventDispatcher"]),o.registerProperty(t,"source","Array",!0)}(eui||(eui={})),function(r){var o=r.sys.UIComponentImpl,t=function(n){function t(){var t=n.call(this)||this;return t._widthConstraint=NaN,t.$isShowPrompt=!1,t.$promptColor=6710886,t.$isFocusIn=!1,t.initializeUIValues(),t.type=egret.TextFieldType.INPUT,t.$EditableText={0:null,1:16777215,2:!1},t}return __extends(t,n),t.prototype.$invalidateContentBounds=function(){n.prototype.$invalidateContentBounds.call(this),this.invalidateSize()},t.prototype.$setWidth=function(t){var e=n.prototype.$setWidth.call(this,t),i=o.prototype.$setWidth.call(this,t);return e&&i},t.prototype.$setHeight=function(t){var e=n.prototype.$setHeight.call(this,t),i=o.prototype.$setHeight.call(this,t);return e&&i},t.prototype.$getText=function(){var t=n.prototype.$getText.call(this);return t==this.$EditableText[0]&&(t=""),t},t.prototype.$setText=function(t){var e=this.$EditableText[0];(e!=t||null==e)&&(this.$isShowPrompt=!1,this.textColor=this.$EditableText[1],this.displayAsPassword=this.$EditableText[2]),this.$isFocusIn||(""==t||null==t)&&(t=e,this.$isShowPrompt=!0,n.prototype.$setTextColor.call(this,this.$promptColor),n.prototype.$setDisplayAsPassword.call(this,!1));var i=n.prototype.$setText.call(this,t);return r.PropertyEvent.dispatchPropertyEvent(this,r.PropertyEvent.PROPERTY_CHANGE,"text"),i},t.prototype.$onAddToStage=function(t,e){r.sys.UIComponentImpl.prototype.$onAddToStage.call(this,t,e),this.addEventListener(egret.FocusEvent.FOCUS_IN,this.onfocusIn,this),this.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onfocusOut,this)},t.prototype.$onRemoveFromStage=function(){r.sys.UIComponentImpl.prototype.$onRemoveFromStage.call(this),this.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onfocusIn,this),this.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.onfocusOut,this)},Object.defineProperty(t.prototype,"prompt",{get:function(){return this.$EditableText[0]},set:function(t){var e=this.$EditableText,i=e[0];if(i!=t){e[0]=t;var n=this.text;n&&n!=i||this.showPromptText()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"promptColor",{get:function(){return this.$promptColor},set:function(t){if(t=0|+t,this.$promptColor!=t){this.$promptColor=t;var e=this.text;e&&e!=this.$EditableText[0]||this.showPromptText()}},enumerable:!0,configurable:!0}),t.prototype.onfocusOut=function(){this.$isFocusIn=!1,this.text||this.showPromptText()},t.prototype.onfocusIn=function(){this.$isFocusIn=!0,this.$isShowPrompt=!1,this.displayAsPassword=this.$EditableText[2];var t=this.$EditableText,e=this.text;e&&e!=t[0]||(this.textColor=t[1],this.text="")},t.prototype.showPromptText=function(){var t=this.$EditableText;this.$isShowPrompt=!0,n.prototype.$setTextColor.call(this,this.$promptColor),n.prototype.$setDisplayAsPassword.call(this,!1),this.text=t[0]},t.prototype.$setTextColor=function(t){return t=0|+t,this.$EditableText[1]=t,this.$isShowPrompt||n.prototype.$setTextColor.call(this,t),!0},t.prototype.$setDisplayAsPassword=function(t){return this.$EditableText[2]=t,this.$isShowPrompt||n.prototype.$setDisplayAsPassword.call(this,t),!0},t.prototype.createChildren=function(){this.onfocusOut()},t.prototype.childrenCreated=function(){},t.prototype.commitProperties=function(){},t.prototype.measure=function(){var t=this.$UIComponent,e=this.$TextField[3],i=NaN;isNaN(this._widthConstraint)?isNaN(t[8])?1e5!=t[13]&&(i=t[13]):i=t[8]:(i=this._widthConstraint,this._widthConstraint=NaN),n.prototype.$setWidth.call(this,i),this.setMeasuredSize(this.textWidth,this.textHeight),n.prototype.$setWidth.call(this,e)},t.prototype.updateDisplayList=function(t,e){n.prototype.$setWidth.call(this,t),n.prototype.$setHeight.call(this,e)},t.prototype.invalidateParentLayout=function(){},t.prototype.setMeasuredSize=function(t,e){},t.prototype.invalidateProperties=function(){},t.prototype.validateProperties=function(){},t.prototype.invalidateSize=function(){},t.prototype.validateSize=function(t){},t.prototype.invalidateDisplayList=function(){},t.prototype.validateDisplayList=function(){},t.prototype.validateNow=function(){},t.prototype.setLayoutBoundsSize=function(t,e){if(o.prototype.setLayoutBoundsSize.call(this,t,e),!isNaN(t)&&t!==this._widthConstraint&&0!=t){var i=this.$UIComponent;isNaN(i[9])&&t!=i[16]&&(this._widthConstraint=t,this.invalidateSize())}},t.prototype.setLayoutBoundsPosition=function(t,e){},t.prototype.getLayoutBounds=function(t){},t.prototype.getPreferredBounds=function(t){},t}(egret.TextField);r.EditableText=t,__reflect(t.prototype,"eui.EditableText",["eui.UIComponent","egret.DisplayObject","eui.IDisplayText"]),r.sys.implementUIComponent(t,egret.TextField),r.registerBindable(t.prototype,"text")}(eui||(eui={})),function(i){var r=i.sys.UIComponentImpl,t=function(n){function t(t){var e=n.call(this)||this;return e.$createChildrenCalled=!1,e.$fontChanged=!1,e._widthConstraint=NaN,e.initializeUIValues(),e.text=t,e}return __extends(t,n),t.prototype.$invalidateContentBounds=function(){n.prototype.$invalidateContentBounds.call(this),this.invalidateSize()},t.prototype.$setWidth=function(t){var e=n.prototype.$setWidth.call(this,t),i=r.prototype.$setWidth.call(this,t);return e&&i},t.prototype.$setHeight=function(t){var e=n.prototype.$setHeight.call(this,t),i=r.prototype.$setHeight.call(this,t);return e&&i},t.prototype.$setText=function(t){var e=n.prototype.$setText.call(this,t);return i.PropertyEvent.dispatchPropertyEvent(this,i.PropertyEvent.PROPERTY_CHANGE,"text"),e},t.prototype.$setFont=function(t){return this.$BitmapText,this.$font!=t&&(this.$font=t,this.$createChildrenCalled?this.$parseFont():this.$fontChanged=!0,this.$BitmapText[6]=!0)},t.prototype.$parseFont=function(){if(this.$fontChanged=!1,this.$font&&"string"==typeof this.$font){var t=egret.getImplementation("eui.IAssetAdapter");t||(t=new i.DefaultAssetAdapter),t.getAsset(this.$font,this.$onFontChanged,this)}else this.$setFontData(this.$font)},t.prototype.$onFontChanged=function(t,e){e===this.$font&&this.$setFontData(t)},t.prototype.$setFontData=function(t){return t!=this.$BitmapText[5]&&(this.$BitmapText[5]=t,this.$invalidateContentBounds(),!0)},t.prototype.createChildren=function(){this.$fontChanged&&this.$parseFont(),this.$createChildrenCalled=!0},t.prototype.childrenCreated=function(){},t.prototype.commitProperties=function(){},t.prototype.measure=function(){var t=this.$UIComponent,e=this.$BitmapText[0],i=NaN;isNaN(this._widthConstraint)?isNaN(t[8])?1e5!=t[13]&&(i=t[13]):i=t[8]:(i=this._widthConstraint,this._widthConstraint=NaN),n.prototype.$setWidth.call(this,i),this.setMeasuredSize(this.textWidth,this.textHeight),n.prototype.$setWidth.call(this,e)},t.prototype.updateDisplayList=function(t,e){n.prototype.$setWidth.call(this,t),n.prototype.$setHeight.call(this,e)},t.prototype.invalidateParentLayout=function(){},t.prototype.setMeasuredSize=function(t,e){},t.prototype.invalidateProperties=function(){},t.prototype.validateProperties=function(){},t.prototype.invalidateSize=function(){},t.prototype.validateSize=function(t){},t.prototype.invalidateDisplayList=function(){},t.prototype.validateDisplayList=function(){},t.prototype.validateNow=function(){},t.prototype.setLayoutBoundsSize=function(t,e){if(r.prototype.setLayoutBoundsSize.call(this,t,e),!isNaN(t)&&t!==this._widthConstraint&&0!=t){var i=this.$UIComponent;isNaN(i[9])&&t!=i[16]&&(this._widthConstraint=t,this.invalidateSize())}},t.prototype.setLayoutBoundsPosition=function(t,e){},t.prototype.getLayoutBounds=function(t){},t.prototype.getPreferredBounds=function(t){},t}(egret.BitmapText);i.BitmapLabel=t,__reflect(t.prototype,"eui.BitmapLabel",["eui.UIComponent","egret.DisplayObject","eui.IDisplayText"]),i.sys.implementUIComponent(t,egret.BitmapText),i.registerBindable(t.prototype,"text")}(eui||(eui={})),function(t){!function(n){function r(t){var e=t-1;return e*e*e+1}var c=[1,1.33,1.66,2],d=Math.log(.998),t=function(){function t(t,e,i){this.$scrollFactor=1,this.previousTime=0,this.velocity=0,this.previousVelocity=[],this.currentPosition=0,this.previousPosition=0,this.currentScrollPos=0,this.maxScrollPos=0,this.offsetPoint=0,this.$bounces=!0,this.started=!0,this.updateFunction=t,this.endFunction=e,this.target=i,this.animation=new n.Animation(this.onScrollingUpdate,this),this.animation.endFunction=this.finishScrolling,this.animation.easerFunction=r}return t.prototype.isPlaying=function(){return this.animation.isPlaying},t.prototype.stop=function(){this.animation.stop(),egret.stopTick(this.onTick,this),this.started=!1},t.prototype.isStarted=function(){return this.started},t.prototype.start=function(t){this.started=!0,this.velocity=0,this.previousVelocity.length=0,this.previousTime=egret.getTimer(),this.previousPosition=this.currentPosition=t,this.offsetPoint=t,egret.startTick(this.onTick,this)},t.prototype.update=function(t,e,i){e=Math.max(e,0),this.currentPosition=t,this.maxScrollPos=e;var n=this.offsetPoint-t,r=n+i;this.offsetPoint=t,r<0&&(this.$bounces?r-=.5*n:r=0),e<r&&(this.$bounces?r-=.5*n:r=e),this.currentScrollPos=r,this.updateFunction.call(this.target,r)},t.prototype.finish=function(t,e){egret.stopTick(this.onTick,this),this.started=!1;for(var i=2.33*this.velocity,n=this.previousVelocity,r=n.length,o=2.33,s=0;s<r;s++){var a=c[s];i+=n[0]*a,o+=a}var h=i/o,l=Math.abs(h),u=0,p=0;if(.02<l)if((p=t+(h-.02)/d*2*this.$scrollFactor)<0||e<p)for(p=t;.02<Math.abs(h);)h*=(p-=h)<0||e<p?.998*.95:.998,u++;else u=Math.log(.02/l)/d;else p=t;this.target.$getThrowInfo&&(p=this.target.$getThrowInfo(t,p).toPos);0<u?(this.$bounces||(p<0?p=0:e<p&&(p=e)),this.throwTo(p,u)):this.finishScrolling()},t.prototype.onTick=function(t){var e=t-this.previousTime;if(10<e){var i=this.previousVelocity;4<=i.length&&i.shift(),this.velocity=(this.currentPosition-this.previousPosition)/e,i.push(this.velocity),this.previousTime=t,this.previousPosition=this.currentPosition}return!0},t.prototype.finishScrolling=function(t){var e=this.currentScrollPos,i=this.maxScrollPos,n=e;e<0&&(n=0),i<e&&(n=i),this.throwTo(n,300)},t.prototype.throwTo=function(t,e){void 0===e&&(e=500);var i=this.currentScrollPos;if(i!=t){var n=this.animation;n.duration=e,n.from=i,n.to=t,n.play()}else this.endFunction.call(this.target)},t.prototype.onScrollingUpdate=function(t){this.currentScrollPos=t.currentValue,this.updateFunction.call(this.target,t.currentValue)},t}();n.TouchScroll=t,__reflect(t.prototype,"eui.sys.TouchScroll")}(t.sys||(t.sys={}))}(eui||(eui={})),function(t){var e=function(){};e.LTR="ltr",e.RTL="rtl",e.TTB="ttb",e.BTT="btt",t.Direction=e,__reflect(e.prototype,"eui.Direction")}(eui||(eui={})),function(t){var e=function(){};e.AUTO="auto",e.OFF="off",e.ON="on",t.ScrollPolicy=e,__reflect(e.prototype,"eui.ScrollPolicy")}(eui||(eui={})),function(i){var t=function(n){function t(t,e){var i=n.call(this)||this;return i.delayList=[],i.skinMap={},i.$styles={},i.initialized=!t,e&&egret.registerImplementation("eui.Theme",i),i.$configURL=t,i.load(t),i}return __extends(t,n),t.prototype.load=function(t){var e=egret.getImplementation("eui.IThemeAdapter");e||(e=new i.DefaultThemeAdapter),e.getTheme(t,this.onConfigLoaded,this.onConfigLoaded,this)},t.prototype.onConfigLoaded=function(t){var e;if(t&&(e=JSON.parse(t)),e&&e.skins)for(var i=this.skinMap,n=e.skins,r=Object.keys(n),o=r.length,s=0;s<o;s++){var a=r[s];i[a]||this.mapSkin(a,n[a])}e.styles&&(this.$styles=e.styles),e.exmls&&0!=e.exmls.length?e.exmls[0].gjs?(e.exmls.forEach(function(t){return EXML.$parseURLContentAsJs(t.path,t.gjs,t.className)}),this.onLoaded()):e.exmls[0].content?(e.exmls.forEach(function(t){return EXML.$parseURLContent(t.path,t.content)}),this.onLoaded()):EXML.$loadAll(e.exmls,this.onLoaded,this,!0):this.onLoaded()},t.prototype.onLoaded=function(t,e){this.initialized=!0,this.handleDelayList(),this.dispatchEventWith(egret.Event.COMPLETE)},t.prototype.handleDelayList=function(){for(var t=this.delayList,e=t.length,i=0;i<e;i++){var n=t[i];if(!n.$Component[5]){var r=this.getSkinName(n);r&&(n.$Component[1]=r,n.$parseSkinName())}}t.length=0},t.prototype.getSkinName=function(t){if(!this.initialized)return-1==this.delayList.indexOf(t)&&this.delayList.push(t),"";var e=this.skinMap[t.hostComponentKey];return e||(e=this.findSkinName(t)),e},t.prototype.findSkinName=function(t){if(!t)return"";var e=t.__class__;if(void 0===e)return"";var i=this.skinMap[e];return i||"eui.Component"==e?i:this.findSkinName(Object.getPrototypeOf(t))},t.prototype.mapSkin=function(t,e){this.skinMap[t]=e},t.prototype.$getStyleConfig=function(t){return this.$styles[t]},t}(egret.EventDispatcher);i.Theme=t,__reflect(t.prototype,"eui.Theme")}(eui||(eui={})),function(t){var e=function(l){function u(t,e,i,n,r,o,s,a){var h=l.call(this,t,e,i)||this;return h.$initTo(n,r,o,s,a),h}return __extends(u,l),u.prototype.$initTo=function(t,e,i,n,r){this.kind=t,this.location=0|+e,this.oldLocation=0|+i,this.items=n||[],this.oldItems=r||[]},u.prototype.clean=function(){l.prototype.clean.call(this),this.items=this.oldItems=null},u.dispatchCollectionEvent=function(t,e,i,n,r,o,s){if(!t.hasEventListener(e))return!0;var a=egret.Event.create(u,e);a.$initTo(i,n,r,o,s);var h=t.dispatchEvent(a);return egret.Event.release(a),h},u}(egret.Event);e.COLLECTION_CHANGE="collectionChange",t.CollectionEvent=e,__reflect(e.prototype,"eui.CollectionEvent")}(eui||(eui={})),function(t){var e=function(){};e.ADD="add",e.REFRESH="refresh",e.REMOVE="remove",e.REPLACE="replace",e.RESET="reset",e.UPDATE="update",t.CollectionEventKind=e,__reflect(e.prototype,"eui.CollectionEventKind")}(eui||(eui={})),function(t){var e=function(e){function o(){var t=e.apply(this,arguments)||this;return t.item=null,t.itemRenderer=null,t.itemIndex=-1,t}return __extends(o,e),o.prototype.clean=function(){e.prototype.clean.call(this),this.item=this.itemRenderer=null},o.dispatchItemTapEvent=function(t,e,i){if(!t.hasEventListener(e))return!0;var n=egret.Event.create(o,e);n.item=i.data,n.itemIndex=i.itemIndex,n.itemRenderer=i;var r=t.dispatchEvent(n);return egret.Event.release(n),r},o}(egret.Event);e.ITEM_TAP="itemTap",t.ItemTapEvent=e,__reflect(e.prototype,"eui.ItemTapEvent")}(eui||(eui={})),function(t){var e=function(o){function s(t,e,i,n){var r=o.call(this,t,e,i)||this;return r.property=n,r}return __extends(s,o),s.dispatchPropertyEvent=function(t,e,i){if(!t.hasEventListener(e))return!0;var n=egret.Event.create(s,e);n.property=i;var r=t.dispatchEvent(n);return egret.Event.release(n),r},s}(egret.Event);e.PROPERTY_CHANGE="propertyChange",t.PropertyEvent=e,__reflect(e.prototype,"eui.PropertyEvent")}(eui||(eui={})),function(t){var e=function(s){function t(t,e,i,n,r){var o=s.call(this,t,e,i)||this;return n=+n,r=+r,o.currentPos=n,o.toPos=r,o}return __extends(t,s),t}(egret.Event);e.THROW="throw",t.ScrollerThrowEvent=e,__reflect(e.prototype,"eui.ScrollerThrowEvent")}(eui||(eui={})),function(t){var e=function(n){function s(t,e,i){return n.call(this,t,e,i)||this}return __extends(s,n),s.dispatchUIEvent=function(t,e,i,n){if(!t.hasEventListener(e))return!0;var r=egret.Event.create(s,e,i,n),o=t.dispatchEvent(r);return egret.Event.release(r),o},s}(egret.Event);e.CREATION_COMPLETE="creationComplete",e.CHANGE_END="changeEnd",e.CHANGE_START="changeStart",e.CLOSING="closing",e.MOVE="move",t.UIEvent=e,__reflect(e.prototype,"eui.UIEvent")}(eui||(eui={})),function(t){!function(t){var e=function(){function t(){this.indent=0}return t.prototype.toCode=function(){return""},t.prototype.getIndent=function(t){void 0===t&&(t=this.indent);for(var e="",i=0;i<t;i++)e+="\t";return e},t}();t.CodeBase=e,__reflect(e.prototype,"eui.sys.CodeBase");var i=function(e){function t(){var t=e.apply(this,arguments)||this;return t.className="",t.superClass="",t.innerClassBlock=[],t.variableBlock=[],t.functionBlock=[],t}return __extends(t,e),t.prototype.addInnerClass=function(t){-1==this.innerClassBlock.indexOf(t)&&this.innerClassBlock.push(t)},t.prototype.addVariable=function(t){-1==this.variableBlock.indexOf(t)&&this.variableBlock.push(t)},t.prototype.getVariableByName=function(t){for(var e=this.variableBlock,i=e.length,n=0;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.addFunction=function(t){-1==this.functionBlock.indexOf(t)&&this.functionBlock.push(t)},t.prototype.getFuncByName=function(t){for(var e=this.functionBlock,i=e.length,n=0;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.toCode=function(){var t=this.indent,e=this.getIndent(t),i=this.getIndent(t+1),n=this.getIndent(t+2),r=e+"(function (";r+=this.superClass?"_super) {\n"+i+"__extends("+this.className+", _super);\n":") {\n";for(var o=this.innerClassBlock,s=o.length,a=0;a<s;a++){var h=o[a];h.indent=t+1,r+=i+"var "+h.className+" = "+h.toCode()+"\n\n"}r+=i+"function "+this.className+"() {\n",this.superClass&&(r+=n+"_super.call(this);\n");var l=this.variableBlock;s=l.length;for(a=0;a<s;a++){var u=l[a];u.defaultValue&&(r+=n+u.toCode()+"\n")}if(this.constructCode){var p=this.constructCode.toCode().split("\n");s=p.length;for(a=0;a<s;a++){r+=n+p[a]+"\n"}}r+=i+"}\n",r+=i+"var _proto = "+this.className+".prototype;\n\n";var c=this.functionBlock;s=c.length;for(a=0;a<s;a++){var d=c[a];d.indent=t+1,r+=d.toCode()+"\n"}return(r+=i+"return "+this.className+";\n"+e)+(this.superClass?"})("+this.superClass+");":"})();")},t}(e);t.EXClass=i,__reflect(i.prototype,"eui.sys.EXClass");var n=function(e){function t(){var t=e.apply(this,arguments)||this;return t.lines=[],t}return __extends(t,e),t.prototype.addVar=function(t,e){var i=e?" = "+e:"";this.addCodeLine("var "+t+i+";")},t.prototype.addAssignment=function(t,e,i){var n=i?"."+i:"";this.addCodeLine(t+n+" = "+e+";")},t.prototype.addReturn=function(t){this.addCodeLine("return "+t+";")},t.prototype.addEmptyLine=function(){this.addCodeLine("")},t.prototype.startIf=function(t){this.addCodeLine("if("+t+")"),this.startBlock()},t.prototype.startElse=function(){this.addCodeLine("else"),this.startBlock()},t.prototype.startElseIf=function(t){this.addCodeLine("else if("+t+")"),this.startBlock()},t.prototype.startBlock=function(){this.addCodeLine("{"),this.indent++},t.prototype.endBlock=function(){this.indent--,this.addCodeLine("}")},t.prototype.doFunction=function(t,e){var i=e.join(",");this.addCodeLine(t+"("+i+")")},t.prototype.addCodeLine=function(t){this.lines.push(this.getIndent()+t)},t.prototype.addCodeLineAt=function(t,e){this.lines.splice(e,0,this.getIndent()+t)},t.prototype.containsCodeLine=function(t){return-1!=this.lines.indexOf(t)},t.prototype.concat=function(t){this.lines=this.lines.concat(t.lines)},t.prototype.toCode=function(){return this.lines.join("\n")},t}(e);t.EXCodeBlock=n,__reflect(n.prototype,"eui.sys.EXCodeBlock");var r=function(e){function t(){var t=e.apply(this,arguments)||this;return t.codeBlock=null,t.isGet=!1,t.name="",t}return __extends(t,e),t.prototype.toCode=function(){var t,e=this.getIndent(),i=this.getIndent(this.indent+1),n=e;if(this.isGet?(t=this.getIndent(this.indent+2),n+='Object.defineProperty(_proto, "skinParts", {\n',n+=i+"get: function () {\n"):(t=i,n+="_proto."+this.name+" = function () {\n"),this.codeBlock)for(var r=this.codeBlock.toCode().split("\n"),o=r.length,s=0;s<o;s++){n+=t+r[s]+"\n"}return n+(this.isGet?i+"},\n"+i+"enumerable: true,\n"+i+"configurable: true\n"+e+"});":e+"};")},t}(e);t.EXFunction=r,__reflect(r.prototype,"eui.sys.EXFunction");var o=function(n){function t(t,e){var i=n.call(this)||this;return i.indent=2,i.name=t,i.defaultValue=e,i}return __extends(t,n),t.prototype.toCode=function(){return this.defaultValue?"this."+this.name+" = "+this.defaultValue+";":""},t}(e);t.EXVariable=o,__reflect(o.prototype,"eui.sys.EXVariable");var s=function(n){function t(t,e){var i=n.call(this)||this;return i.name="",i.stateGroups=[],i.addItems=[],i.setProperty=[],i.name=t,e&&(i.stateGroups=e),i}return __extends(t,n),t.prototype.addOverride=function(t){t instanceof a?this.addItems.push(t):this.setProperty.push(t)},t.prototype.toCode=function(){for(var t=this.getIndent(1),e='new eui.State ("'+this.name+'",\n'+t+"[\n",i=0,n=!0,r=this.addItems.concat(this.setProperty);i<r.length;){n?n=!1:e+=",\n";for(var o=r[i].toCode().split("\n"),s=o.length,a=0;a<s;a++){var h=o[a];o[a]=t+t+h}e+=o.join("\n"),i++}return e+"\n"+t+"])"},t}(e);t.EXState=s,__reflect(s.prototype,"eui.sys.EXState");var a=function(o){function t(t,e,i,n){var r=o.call(this)||this;return r.target=t,r.property=e,r.position=i,r.relativeTo=n,r}return __extends(t,o),t.prototype.toCode=function(){return'new eui.AddItems("'+this.target+'","'+this.property+'",'+this.position+',"'+this.relativeTo+'")'},t}(e);t.EXAddItems=a,__reflect(a.prototype,"eui.sys.EXAddItems");var h=function(r){function t(t,e,i){var n=r.call(this)||this;return n.target=t,n.name=e,n.value=i,n}return __extends(t,r),t.prototype.toCode=function(){return'new eui.SetProperty("'+this.target+'","'+this.name+'",'+this.value+")"},t}(e);t.EXSetProperty=h,__reflect(h.prototype,"eui.sys.EXSetProperty");var l=function(o){function t(t,e,i,n){var r=o.call(this)||this;return t=t?"this."+t:"this",r.target=t,r.property=e,r.templates=i,r.chainIndex=n,r}return __extends(t,o),t.prototype.toCode=function(){return"new eui.SetStateProperty(this, ["+this.templates.join(",")+"],["+this.chainIndex.join(",")+"],"+this.target+',"'+this.property+'")'},t}(e);t.EXSetStateProperty=l,__reflect(l.prototype,"eui.sys.EXSetStateProperty");var u=function(o){function t(t,e,i,n){var r=o.call(this)||this;return r.target=t,r.property=e,r.templates=i,r.chainIndex=n,r}return __extends(t,o),t.prototype.toCode=function(){return"eui.Binding.$bindProperties(this, ["+this.templates.join(",")+"],["+this.chainIndex.join(",")+"],"+this.target+',"'+this.property+'")'},t}(e);t.EXBinding=u,__reflect(u.prototype,"eui.sys.EXBinding")}(t.sys||(t.sys={}))}(eui||(eui={})),function(t){function a(t){return h.parse(t)}function p(t,e){var i=null;if(e&&(i=a(e)),t){c[t]=i;var n=l[t];delete l[t];for(var r=n?n.length:0,o=0;o<r;o++){var s=n[o];s[0]&&s[1]&&s[0].call(s[1],i,t)}}return i}function o(e,i){var t=e;-1==e.indexOf("://")&&(t=s+e);var n=function(t){t||(t=""),i(e,t)},r=egret.getImplementation("eui.IThemeAdapter");r||(r=new eui.DefaultThemeAdapter),r.getTheme(t,n,n,this)}var h=new eui.sys.EXMLParser,l={},c={},s="";Object.defineProperty(t,"prefixURL",{get:function(){return s},set:function(t){s=t},enumerable:!0,configurable:!0}),t.parse=a,t.load=function(t,e,i,n){if(void 0===n&&(n=!1),!(n&&t in c)){var r=l[t];return r?void r.push([e,i]):(l[t]=[[e,i]],void o(t,p))}e&&e.call(i,c[t],t)},t.$loadAll=function(a,h,l,e){if(void 0===e&&(e=!1),a&&0!=a.length){var u=[];a.forEach(function(t){if(e&&t in c)return u[t]="",void u.push(t);o(t,function(t,e){var i,r,n,o,s;u[t]=e,u.push(t),u.length==a.length&&(r=u,n=h,o=l,s=[],(i=a).forEach(function(t,e){if(t in c&&!r[t])s[e]=c[t];else{var i=r[t],n=p(t,i);s[e]=n}}),n&&n.call(o,s,i))})})}else h&&h.call(l,[],a)},t.$parseURLContentAsJs=function(t,e,i){var n=null;if(e&&(n=h.$parseCode(e,i)),t){c[t]=n;var r=l[t];delete l[t];for(var o=r?r.length:0,s=0;s<o;s++){var a=r[s];a[0]&&a[1]&&a[0].call(a[1],n,t)}}return n},t.$parseURLContent=p}(EXML||(EXML={})),function(t){!function(n){function s(t){var e=egret.getDefinitionByName(t);return e?e.prototype:null}function f(t){return t?new t:null}n.NS_S="http://ns.egret.com/eui",n.NS_W="http://ns.egret.com/wing";var r=["Point","Matrix","Rectangle"],y=["Array","boolean","string","number"],g=0,v={},t=function(){function t(){}return t.prototype.$describe=function(t){if(!t)return null;var e,i=Object.getPrototypeOf(t);if(!i)return null;if(i.hasOwnProperty("__hashCode__")&&(e=v[i.__hashCode__]))return e;var n=Object.getPrototypeOf(i);if(!n)return null;var r,o=f(n.constructor),s=this.$describe(o);if(s){var a=function(){};a.prototype=s,e=new a}else e={};for(var h=Object.keys(i).concat(Object.keys(t)),l=h.length,u=t.__meta__,p=0;p<l;p++){var c=h[p];if("constructor"!=c&&"_"!=c.charAt(0)&&"$"!=c.charAt(0)){var d=void 0;if(u&&u[c])d=u[c];else if(r=t[c],"[object Array]"===Object.prototype.toString.call(r))d="Array";else{if("function"==(d=typeof t[c]))continue;-1==y.indexOf(d)&&(d="any")}e[c]=d}}return Object.getPrototypeOf(n)&&(i.__hashCode__=g++,v[i.__hashCode__]=e),e},t.prototype.getClassNameById=function(t,e){if(e==n.NS_S){if("Object"==t)return t;if(-1!=r.indexOf(t))return"egret."+t}var i="";return-1!=y.indexOf(t)?t:(e==n.NS_W||(i=e&&e!=n.NS_S?e.substring(0,e.length-1)+t:"eui."+t),s(i)||(i=""),i)},t.prototype.getDefaultPropById=function(t,e){var i,n=s(this.getClassNameById(t,e));return n&&(i=n.__defaultProperty__),i||""},t.prototype.getPropertyType=function(t,e){if("Object"==e)return"any";var i="",n=s(e);if(n){if(!n.hasOwnProperty("__hashCode__")){var r=f(egret.getDefinitionByName(e));if(!r)return i;this.$describe(r)}var o=v[n.__hashCode__];o&&(i=o[t])}return i},t}();n.EXMLConfig=t,__reflect(t.prototype,"eui.sys.EXMLConfig")}(t.sys||(t.sys={}))}(eui||(eui={})),function(t){egret.$locale_strings=egret.$locale_strings||{},egret.$locale_strings.en_US=egret.$locale_strings.en_US||{};var e=egret.$locale_strings.en_US;e[2001]="EXML parsing error {0}: EXML file can't be found ",e[2002]="EXML parsing error : invalid XML file:\n{0}",e[2003]="EXML parsing error {0}: the class definitions corresponding to nodes can't be found  \n {1}",e[2004]="EXML parsing error {0}: nodes cannot contain id property with the same name \n {1}",e[2005]="EXML parsing error {0}: property with the name of '{1}' does not exist on the node, or the property does not have a default value: \n {2}",e[2006]="EXML parsing error {0}: undefined view state name: '{1}' \n {2}",e[2007]="EXML parsing error {0}: only UIComponent objects within the container can use the includeIn and excludeFrom properties\n {1}",e[2008]="EXML parsing error {0}: fail to assign values of '{1}' class to property: '{2}' \n {3}",e[2009]="EXML parsing error {0}: only one ID can be referenced in the node property value '{}' label; and complex expression is not allowed to use \n {1}",e[2010]="EXML parsing error {0}: ID referenced by property: '{1}':  '{2}' does not exist \n {3}",e[2011]="EXML parsing error {0}: fail to assign more than one child nodes to the same property: '{1}' \n {2}",e[2012]="EXML parsing error {0}: no default property exists on the node; and you must explicitly declare the property name that the child node  is assigned to \n {1}",e[2013]="EXML parsing error {0}: view state grammar is not allowed to use on property nodes of Array class \n {1} ",e[2014]="EXML parsing error {0}: assigning the skin class itself to the node property is not allowed \n {1}",e[2015]="EXML parsing error {0}: class definition referenced by node: {1} does not exist \n {2}",e[2016]="EXML parsing error {0}: format error of 'scale9Grid' property value on the node: {1}",e[2017]="EXML parsing error {0}: namespace prefix missing on the node: {1}",e[2018]="EXML parsing error {0}: format error of 'skinName' property value on the node: {1}",e[2019]="EXML parsing error {0}: the container’s child item must be visible nodes: {1}",e[2020]="EXML parsing error {0}: for child nodes in w: Declarations, the includeIn and excludeFrom properties are not allowed to use \n {1}",e[2021]="Compile errors in {0}, the attribute name: {1}, the attribute value: {2}.",e[2022]="EXML parsing error: there contains illegal characters in the id `{0}`",e[2101]="EXML parsing warnning : fail to register the class property : {0},there is already a class with the same name in the global,please try to rename the class name for the exml. \n {1}",e[2102]="EXML parsing warnning {0}: no child node can be found on the property code \n {1}",e[2103]="EXML parsing warnning {0}: the same property '{1}' on the node is assigned multiple times \n {2}",e[2104]="EXML parsing warnning, Instantiate class {0} error，the parameters of its constructor method must be empty.",e[2201]="BasicLayout doesn't support virtualization.",e[2202]="parse skinName error，the parsing result of skinName must be a instance of eui.Skin.",e[2203]="Could not find the skin class '{0}'。",e[2301]="parse source failed，could not find asset from URL：{0} ."}(eui||(eui={})),function(t){egret.$locale_strings=egret.$locale_strings||{},egret.$locale_strings.zh_CN=egret.$locale_strings.zh_CN||{};var e=egret.$locale_strings.zh_CN;e[2001]="EXML解析错误 {0}: 找不到EXML文件",e[2002]="EXML解析错误: 不是有效的XML文件:\n{0}",e[2003]="EXML解析错误 {0}: 无法找到节点所对应的类定义\n{1}",e[2004]="EXML解析错误 {0}: 节点不能含有同名的id属性\n{1}",e[2005]="EXML解析错误 {0}: 节点上不存在名为'{1}'的属性，或者该属性没有初始值:\n{2}",e[2006]="EXML解析错误 {0}: 未定义的视图状态名称:'{1}'\n{2}",e[2007]="EXML解析错误 {0}: 只有处于容器内的 UIComponent 对象可以使用includeIn和excludeFrom属性\n{1}",e[2008]="EXML解析错误 {0}: 无法将'{1}'类型的值赋给属性:'{2}'\n{3}",e[2009]="EXML解析错误 {0}: 在节点属性值的‘{}’标签内只能引用一个ID，不允许使用复杂表达式\n{1}",e[2010]="EXML解析错误 {0}: 属性:'{1}'所引用的ID: '{2}'不存在\n{3}",e[2011]="EXML解析错误 {0}: 无法将多个子节点赋值给同一个属性:'{1}'\n{2}",e[2012]="EXML解析错误 {0}: 节点上不存在默认属性，必须显式声明子节点要赋值到的属性名\n{1}",e[2013]="EXML解析错误 {0}: 类型为Array的属性节点上不允许使用视图状态语法\n{1}",e[2014]="EXML解析错误 {0}: 不允许将皮肤类自身赋值给节点属性\n{1}",e[2015]="EXML解析错误 {0}: 节点引用的类定义:{1}不存在\n{2}",e[2016]="EXML解析错误 {0}: 节点上'scale9Grid'属性值的格式错误:{1}",e[2017]="EXML解析错误 {0}: 节点上缺少命名空间前缀:{1}",e[2018]="EXML解析错误 {0}: 节点上'skinName'属性值的格式错误:{1}",e[2019]="EXML解析错误 {0}: 容器的子项必须是可视节点:{1}",e[2020]="EXML解析错误 {0}: 在w:Declarations内的子节点，不允许使用includeIn和excludeFrom属性\n{1}",e[2021]="{0} 中存在编译错误，属性名 : {1}，属性值 : {2}",e[2022]="EXML解析错误: id `{0}` 中含有非法字符",e[2101]="EXML解析警告: 在EXML根节点上声明的 class 属性: {0} 注册失败，所对应的类已经存在，请尝试重命名要注册的类名。\n{1}",e[2102]="EXML解析警告 {0}: 在属性节点上找不到任何子节点\n{1}",e[2103]="EXML解析警告 {0}: 节点上的同一个属性'{1}'被多次赋值\n{2}",e[2104]="EXML解析警告，无法直接实例化自定义组件：{0} ，在EXML中使用的自定义组件必须要能直接被实例化，否则可能导致后续EXML解析报错。",e[2201]="BasicLayout 不支持虚拟化。",e[2202]="皮肤解析出错，属性 skinName 的值必须要能够解析为一个 eui.Skin 的实例。",e[2203]="找不到指定的皮肤类 '{0}'。",e[2301]="素材解析失败，找不到URL：{0} 所对应的资源。"}(eui||(eui={})),function(o){var t=function(r){function t(){return r.call(this)||this}return __extends(t,r),t.prototype.measure=function(){r.prototype.measure.call(this),o.sys.measure(this.$target)},t.prototype.updateDisplayList=function(t,e){r.prototype.updateDisplayList.call(this,t,e);var i=this.$target,n=o.sys.updateDisplayList(i,t,e);i.setContentSize(Math.ceil(n.x),Math.ceil(n.y))},t}(o.LayoutBase);o.BasicLayout=t,__reflect(t.prototype,"eui.BasicLayout")}(eui||(eui={})),function(t){!function(t){function P(t,e){if(!t||"number"==typeof t)return t;var i=t,n=i.indexOf("%");return-1==n?+i:.01*+i.substring(0,n)*e}var T="eui.UIComponent";t.measure=function(t){if(t){for(var e=0,i=0,n=egret.$TempRectangle,r=t.numChildren,o=0;o<r;o++){var s=t.getChildAt(o);if(egret.is(s,T)&&s.$includeInLayout){var a=s.$UIComponent,h=+a[4],l=+a[5],u=+a[0],p=+a[1],c=+a[2],d=+a[3],f=void 0,y=void 0;s.getPreferredBounds(n),isNaN(u)||isNaN(p)?isNaN(h)?isNaN(u)&&isNaN(p)?f=n.x:(f=isNaN(u)?0:u,f+=isNaN(p)?0:p):f=2*Math.abs(h):f=u+p,isNaN(c)||isNaN(d)?isNaN(l)?isNaN(c)&&isNaN(d)?y=n.y:(y=isNaN(c)?0:c,y+=isNaN(d)?0:d):y=2*Math.abs(l):y=c+d;var g=n.width,v=n.height;e=Math.ceil(Math.max(e,f+g)),i=Math.ceil(Math.max(i,y+v))}}t.setMeasuredSize(e,i)}},t.updateDisplayList=function(t,e,i){if(t){for(var n=t.numChildren,r=0,o=0,s=egret.$TempRectangle,a=0;a<n;a++){var h=t.getChildAt(a);if(egret.is(h,T)&&h.$includeInLayout){var l=h.$UIComponent,u=P(l[4],.5*e),p=P(l[5],.5*i),c=P(l[0],e),d=P(l[1],e),f=P(l[2],i),y=P(l[3],i),g=l[6],v=l[7],m=NaN,$=NaN;isNaN(c)||isNaN(d)?isNaN(g)||(m=Math.round(e*Math.min(.01*g,1))):m=e-d-c,isNaN(f)||isNaN(y)?isNaN(v)||($=Math.round(i*Math.min(.01*v,1))):$=i-y-f,h.setLayoutBoundsSize(m,$),h.getLayoutBounds(s);var E,C,_=s.width,S=s.height;E=isNaN(u)?isNaN(c)?isNaN(d)?s.x:e-_-d:c:Math.round((e-_)/2+u),C=isNaN(p)?isNaN(f)?isNaN(y)?s.y:i-S-y:f:Math.round((i-S)/2+p),h.setLayoutBoundsPosition(E,C),r=Math.max(r,E+_),o=Math.max(o,C+S)}}return egret.$TempPoint.setTo(r,o)}}}(t.sys||(t.sys={}))}(eui||(eui={})),function(t){var e=function(){};e.LEFT="left",e.JUSTIFY_USING_GAP="justifyUsingGap",e.JUSTIFY_USING_WIDTH="justifyUsingWidth",t.ColumnAlign=e,__reflect(e.prototype,"eui.ColumnAlign")}(eui||(eui={})),function(X){var W="eui.UIComponent",t=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.measureReal=function(){for(var t=this.$target,e=t.numElements,i=e,n=0,r=0,o=egret.$TempRectangle,s=0;s<e;s++){var a=t.getElementAt(s);egret.is(a,W)&&a.$includeInLayout?(a.getPreferredBounds(o),n+=o.width,r=Math.max(r,o.height)):i--}n+=(i-1)*this.$gap;var h=this.$paddingLeft+this.$paddingRight,l=this.$paddingTop+this.$paddingBottom;t.setMeasuredSize(n+h,r+l)},t.prototype.measureVirtual=function(){for(var t=this.$target,e=this.$typicalWidth,i=this.getElementTotalSize(),n=Math.max(this.maxElementSize,this.$typicalHeight),r=egret.$TempRectangle,o=this.endIndex,s=this.elementSizeTable,a=this.startIndex;a<o;a++){var h=t.getElementAt(a);egret.is(h,W)&&h.$includeInLayout&&(h.getPreferredBounds(r),i+=r.width,i-=isNaN(s[a])?e:s[a],n=Math.max(n,r.height))}var l=this.$paddingLeft+this.$paddingRight,u=this.$paddingTop+this.$paddingBottom;t.setMeasuredSize(i+l,n+u)},t.prototype.updateDisplayListReal=function(t,e){var i=this.$target,n=this.$paddingLeft,r=this.$paddingRight,o=this.$paddingTop,s=this.$paddingBottom,a=this.$gap,h=Math.max(0,t-n-r),l=Math.max(0,e-o-s),u=this.$horizontalAlign==X.JustifyAlign.JUSTIFY,p=this.$verticalAlign==X.JustifyAlign.JUSTIFY||this.$verticalAlign==X.JustifyAlign.CONTENT_JUSTIFY,c=0;p||(this.$verticalAlign==egret.VerticalAlign.MIDDLE?c=.5:this.$verticalAlign==egret.VerticalAlign.BOTTOM&&(c=1));var d,f,y,g=i.numElements,v=g,m=n,$=o,E=0,C=0,_=[],S=h,P=this.maxElementSize,T=egret.$TempRectangle;for(d=0;d<g;d++){var x=i.getElementAt(d);if(egret.is(x,W)&&x.$includeInLayout)if(x.getPreferredBounds(T),P=Math.max(P,T.height),u)E+=T.width;else{var b=x.$UIComponent;isNaN(b[6])?S-=T.width:(C+=b[6],(y=new X.sys.ChildInfo).layoutElement=x,y.percent=b[6],y.min=b[12],y.max=b[13],_.push(y))}else v--}S=0<(S-=a*(v-1))?S:0;var I,L=h-E-a*(v-1),N=v,O={};if(u){if(L<0){for(I=S/v,d=0;d<g;d++)f=i.getElementAt(d),egret.is(f,W)&&f.$includeInLayout&&(f.getPreferredBounds(T),T.width<=I&&(S-=T.width,N--));S=0<S?S:0}}else if(0<C){this.flexChildrenProportionally(h,S,C,_);var A=0,M=_.length;for(d=0;d<M;d++){y=_[d];var B=Math.round(y.size+A);A+=y.size-B,S-=O[y.layoutElement.$hashCode]=B}S=0<S?S:0}this.$horizontalAlign==egret.HorizontalAlign.CENTER?m=n+.5*S:this.$horizontalAlign==egret.HorizontalAlign.RIGHT&&(m=n+S);var D=n,R=o,w=0,V=0,z=Math.ceil(l);this.$verticalAlign==X.JustifyAlign.CONTENT_JUSTIFY&&(z=Math.ceil(Math.max(l,P)));var H,U,k=0;for(d=0;d<g;d++){var F=0;if(f=i.getElementAt(d),egret.is(f,W)&&f.$includeInLayout){if(f.getPreferredBounds(T),H=NaN,u?(U=NaN,0<L?U=S*T.width/E:L<0&&T.width>I&&(U=S/N),isNaN(U)||(k+=U-(H=Math.round(U+k)))):H=O[f.$hashCode],p)$=o,f.setLayoutBoundsSize(H,z),f.getLayoutBounds(T);else{var G=NaN;b=f.$UIComponent;if(!isNaN(f.percentHeight)){var j=Math.min(100,b[7]);G=Math.round(l*j*.01)}f.setLayoutBoundsSize(H,G),f.getLayoutBounds(T),$=o+(F=0<(F=(l-T.height)*c)?F:0)}f.setLayoutBoundsPosition(Math.round(m),Math.round($)),w=Math.ceil(T.width),V=Math.ceil(T.height),D=Math.max(D,m+w),R=Math.max(R,$+V),m+=w+a}}this.maxElementSize=P,i.setContentSize(D+r,R+s)},t.prototype.updateDisplayListVirtual=function(t,e){var i=this.$target;this.indexInViewCalculated?this.indexInViewCalculated=!1:this.getIndexInView();var n,r=this.$paddingRight,o=this.$paddingTop,s=this.$paddingBottom,a=this.$gap,h=i.numElements;if(-1==this.startIndex||-1==this.endIndex)return n=this.getStartPosition(h)-a+r,void i.setContentSize(n,i.contentHeight);var l=this.endIndex;i.setVirtualElementIndicesInView(this.startIndex,l);var u=this.$verticalAlign==X.JustifyAlign.JUSTIFY||this.$verticalAlign==X.JustifyAlign.CONTENT_JUSTIFY,p=this.$verticalAlign==X.JustifyAlign.CONTENT_JUSTIFY,c=0;u||(this.$verticalAlign==egret.VerticalAlign.MIDDLE?c=.5:this.$verticalAlign==egret.VerticalAlign.BOTTOM&&(c=1));var d,f=egret.$TempRectangle,y=Math.max(0,e-o-s),g=Math.ceil(y),v=this.$typicalHeight,m=this.$typicalWidth,$=this.maxElementSize,E=Math.max(v,this.maxElementSize);if(p){for(var C=this.startIndex;C<=l;C++)d=i.getVirtualElementAt(C),egret.is(d,W)&&d.$includeInLayout&&(d.getPreferredBounds(f),$=Math.max($,f.height));g=Math.ceil(Math.max(y,$))}for(var _=0,S=0,P=0,T=!1,x=this.elementSizeTable,b=this.startIndex;b<=l;b++){var I=0;d=i.getVirtualElementAt(b),egret.is(d,W)&&d.$includeInLayout&&(d.getPreferredBounds(f),p||($=Math.max($,f.height)),u?(S=o,d.setLayoutBoundsSize(NaN,g),d.getLayoutBounds(f)):(d.getLayoutBounds(f),S=o+(I=0<(I=(y-f.height)*c)?I:0)),P=Math.max(P,f.height),T||(isNaN(x[b])?m:x[b])!=f.width&&(T=!0),x[b]=f.width,_=this.getStartPosition(b),d.setLayoutBoundsPosition(Math.round(_),Math.round(S)))}P+=o+s,n=this.getStartPosition(h)-a+r,this.maxElementSize=$,i.setContentSize(n,P),(T||E<this.maxElementSize)&&i.invalidateSize()},t.prototype.getStartPosition=function(t){if(!this.$useVirtualLayout&&this.$target){var e=this.$target.getElementAt(t);if(e)return e.x}for(var i=this.$typicalWidth,n=this.$paddingLeft,r=this.$gap,o=this.elementSizeTable,s=0;s<t;s++){var a=o[s];isNaN(a)&&(a=i),n+=a+r}return n},t.prototype.getElementSize=function(t){if(this.$useVirtualLayout){var e=this.elementSizeTable[t];return isNaN(e)&&(e=this.$typicalWidth),e}return this.$target?this.$target.getElementAt(t).width:0},t.prototype.getElementTotalSize=function(){for(var t=this.$typicalWidth,e=this.$gap,i=0,n=this.$target.numElements,r=this.elementSizeTable,o=0;o<n;o++){var s=r[o];isNaN(s)&&(s=t),i+=s+e}return i-e},t.prototype.elementAdded=function(t){this.useVirtualLayout&&(e.prototype.elementAdded.call(this,t),this.elementSizeTable.splice(t,0,this.$typicalWidth))},t.prototype.getIndexInView=function(){var t=this.$target;if(!t||0==t.numElements)return this.startIndex=this.endIndex=-1,!1;var e=t.$UIComponent;if(e[10]<=0||e[11]<=0)return this.startIndex=this.endIndex=-1,!1;var i=t.numElements,n=this.getStartPosition(i-1)+this.elementSizeTable[i-1]+this.$paddingRight,r=t.scrollH;if(r>n-this.$paddingRight)return this.startIndex=-1,!(this.endIndex=-1);var o=t.scrollH+e[10];if(o<this.$paddingLeft)return this.startIndex=-1,!(this.endIndex=-1);var s=this.startIndex,a=this.endIndex;return this.startIndex=this.findIndexAt(r,0,i-1),-1==this.startIndex&&(this.startIndex=0),this.endIndex=this.findIndexAt(o,0,i-1),-1==this.endIndex&&(this.endIndex=i-1),s!=this.startIndex||a!=this.endIndex},t}(X.LinearLayoutBase);X.HorizontalLayout=t,__reflect(t.prototype,"eui.HorizontalLayout")}(eui||(eui={})),function(t){var e=function(){};e.JUSTIFY="justify",e.CONTENT_JUSTIFY="contentJustify",t.JustifyAlign=e,__reflect(e.prototype,"eui.JustifyAlign")}(eui||(eui={})),function(t){var e=function(){};e.TOP="top",e.JUSTIFY_USING_GAP="justifyUsingGap",e.JUSTIFY_USING_HEIGHT="justifyUsingHeight",t.RowAlign=e,__reflect(e.prototype,"eui.RowAlign")}(eui||(eui={})),function(b){var I="eui.UIComponent",t=function(x){function t(){var t=x.call(this)||this;return t.explicitHorizontalGap=NaN,t._horizontalGap=6,t.explicitVerticalGap=NaN,t._verticalGap=6,t._columnCount=-1,t._requestedColumnCount=0,t._rowCount=-1,t._requestedRowCount=0,t.explicitColumnWidth=NaN,t._columnWidth=NaN,t.explicitRowHeight=NaN,t._rowHeight=NaN,t._paddingLeft=0,t._paddingRight=0,t._paddingTop=0,t._paddingBottom=0,t._horizontalAlign=b.JustifyAlign.JUSTIFY,t._verticalAlign=b.JustifyAlign.JUSTIFY,t._columnAlign=b.ColumnAlign.LEFT,t._rowAlign=b.RowAlign.TOP,t._orientation=b.TileOrientation.ROWS,t.maxElementWidth=0,t.maxElementHeight=0,t.startIndex=-1,t.endIndex=-1,t.indexInViewCalculated=!1,t}return __extends(t,x),Object.defineProperty(t.prototype,"horizontalGap",{get:function(){return this._horizontalGap},set:function(t){(t=+t)!==this._horizontalGap&&(this.explicitHorizontalGap=t,this._horizontalGap=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalGap",{get:function(){return this._verticalGap},set:function(t){(t=+t)!==this._verticalGap&&(this.explicitVerticalGap=t,this._verticalGap=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnCount",{get:function(){return this._columnCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requestedColumnCount",{get:function(){return this._requestedColumnCount},set:function(t){t=+t||0,this._requestedColumnCount!==t&&(this._requestedColumnCount=t,this._columnCount=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowCount",{get:function(){return this._rowCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requestedRowCount",{get:function(){return this._requestedRowCount},set:function(t){t=+t||0,this._requestedRowCount!=t&&(this._requestedRowCount=t,this._rowCount=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnWidth",{get:function(){return this._columnWidth},set:function(t){(t=+t)!==this._columnWidth&&(this.explicitColumnWidth=t,this._columnWidth=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeight",{get:function(){return this._rowHeight},set:function(t){(t=+t)!==this._rowHeight&&(this.explicitRowHeight=t,this._rowHeight=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this._paddingLeft},set:function(t){t=+t||0,this._paddingLeft!=t&&(this._paddingLeft=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this._paddingRight},set:function(t){t=+t||0,this._paddingRight!==t&&(this._paddingRight=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this._paddingTop},set:function(t){t=+t||0,this._paddingTop!=t&&(this._paddingTop=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this._paddingBottom},set:function(t){t=+t||0,this._paddingBottom!==t&&(this._paddingBottom=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlign",{get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!=t&&(this._horizontalAlign=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlign",{get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!=t&&(this._verticalAlign=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnAlign",{get:function(){return this._columnAlign},set:function(t){this._columnAlign!=t&&(this._columnAlign=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowAlign",{get:function(){return this._rowAlign},set:function(t){this._rowAlign!=t&&(this._rowAlign=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orientation",{get:function(){return this._orientation},set:function(t){this._orientation!=t&&(this._orientation=t,this.invalidateTargetLayout())},enumerable:!0,configurable:!0}),t.prototype.invalidateTargetLayout=function(){var t=this.$target;t&&(t.invalidateSize(),t.invalidateDisplayList())},t.prototype.measure=function(){var t=this.$target;if(t){var e=this._columnCount,i=this._rowCount,n=this._columnWidth,r=this._rowHeight,o=0,s=0,a=t.$UIComponent;this.calculateRowAndColumn(a[8],a[9]);var h=0<this._requestedColumnCount?this._requestedColumnCount:this._columnCount,l=0<this._requestedRowCount?this._requestedRowCount:this._rowCount,u=isNaN(this._horizontalGap)?0:this._horizontalGap,p=isNaN(this._verticalGap)?0:this._verticalGap;0<h&&(o=h*(this._columnWidth+u)-u),0<l&&(s=l*(this._rowHeight+p)-p);var c=this._paddingLeft+this._paddingRight,d=this._paddingTop+this._paddingBottom;t.setMeasuredSize(o+c,s+d),this._columnCount=e,this._rowCount=i,this._columnWidth=n,this._rowHeight=r}},t.prototype.calculateRowAndColumn=function(t,e){var i=this.$target,n=isNaN(this._horizontalGap)?0:this._horizontalGap,r=isNaN(this._verticalGap)?0:this._verticalGap;this._rowCount=this._columnCount=-1;for(var o=i.numElements,s=o,a=0;a<s;a++){var h=i.getElementAt(a);!h||egret.is(h,I)&&h.$includeInLayout||o--}if(0!=o){(isNaN(this.explicitColumnWidth)||isNaN(this.explicitRowHeight))&&this.updateMaxElementSize(),isNaN(this.explicitColumnWidth)?this._columnWidth=this.maxElementWidth:this._columnWidth=this.explicitColumnWidth,isNaN(this.explicitRowHeight)?this._rowHeight=this.maxElementHeight:this._rowHeight=this.explicitRowHeight;var l=this._columnWidth+n;l<=0&&(l=1);var u=this._rowHeight+r;u<=0&&(u=1);var p=this._orientation==b.TileOrientation.COLUMNS,c=!isNaN(t),d=!isNaN(e),f=this._paddingLeft,y=this._paddingRight,g=this._paddingTop,v=this._paddingBottom;if(0<this._requestedColumnCount||0<this._requestedRowCount)0<this._requestedRowCount&&(this._rowCount=Math.min(this._requestedRowCount,o)),0<this._requestedColumnCount&&(this._columnCount=Math.min(this._requestedColumnCount,o));else if(c||d)if(!c||d&&p){var m=Math.max(0,e-g-v);this._rowCount=Math.floor((m+r)/u),this._rowCount=Math.max(1,Math.min(this._rowCount,o))}else{var $=Math.max(0,t-f-y);this._columnCount=Math.floor(($+n)/l),this._columnCount=Math.max(1,Math.min(this._columnCount,o))}else{var E=Math.sqrt(o*l*u);p?this._rowCount=Math.max(1,Math.round(E/u)):this._columnCount=Math.max(1,Math.round(E/l))}-1==this._rowCount&&(this._rowCount=Math.max(1,Math.ceil(o/this._columnCount))),-1==this._columnCount&&(this._columnCount=Math.max(1,Math.ceil(o/this._rowCount))),0<this._requestedColumnCount&&0<this._requestedRowCount&&(this._orientation==b.TileOrientation.ROWS?this._rowCount=Math.max(1,Math.ceil(o/this._requestedColumnCount)):this._columnCount=Math.max(1,Math.ceil(o/this._requestedRowCount)))}else this._rowCount=this._columnCount=0},t.prototype.updateMaxElementSize=function(){this.$target&&(this.$useVirtualLayout?(this.maxElementWidth=Math.max(this.maxElementWidth,this.$typicalWidth),this.maxElementHeight=Math.max(this.maxElementHeight,this.$typicalHeight),this.doUpdateMaxElementSize(this.startIndex,this.endIndex)):this.doUpdateMaxElementSize(0,this.$target.numElements-1))},t.prototype.doUpdateMaxElementSize=function(t,e){var i=this.maxElementWidth,n=this.maxElementHeight,r=egret.$TempRectangle,o=this.$target;if(-1!=t&&-1!=e)for(var s=t;s<=e;s++){var a=o.getVirtualElementAt(s);egret.is(a,I)&&a.$includeInLayout&&(a.getPreferredBounds(r),i=Math.max(i,r.width),n=Math.max(n,r.height))}this.maxElementWidth=i,this.maxElementHeight=n},t.prototype.clearVirtualLayoutCache=function(){x.prototype.clearVirtualLayoutCache.call(this),this.maxElementWidth=0,this.maxElementHeight=0},t.prototype.scrollPositionChanged=function(){this.$useVirtualLayout&&(this.getIndexInView()&&(this.indexInViewCalculated=!0,this.$target.invalidateDisplayList()))},t.prototype.getIndexInView=function(){if(!this.$target||0==this.$target.numElements)return this.startIndex=this.endIndex=-1,!1;var t=this.$target,e=t.numElements;if(!this.$useVirtualLayout)return this.startIndex=0,this.endIndex=e-1,!1;var i=t.$UIComponent;if(0==i[10]||0==i[11])return this.startIndex=this.endIndex=-1,!1;var n=this.startIndex,r=this.endIndex,o=this._paddingLeft,s=this._paddingTop,a=isNaN(this._horizontalGap)?0:this._horizontalGap,h=isNaN(this._verticalGap)?0:this._verticalGap;if(this._orientation==b.TileOrientation.COLUMNS){var l=this._columnWidth+a;if(l<=0)return this.startIndex=0,this.endIndex=e-1,!1;var u=t.scrollH,p=u+i[10],c=Math.floor((u-o)/l);c<0&&(c=0);var d=Math.ceil((p-o)/l);d<0&&(d=0),this.startIndex=Math.min(e-1,Math.max(0,c*this._rowCount)),this.endIndex=Math.min(e-1,Math.max(0,d*this._rowCount-1))}else{var f=this._rowHeight+h;if(f<=0)return this.startIndex=0,this.endIndex=e-1,!1;var y=t.scrollV,g=y+i[11],v=Math.floor((y-s)/f);v<0&&(v=0);var m=Math.ceil((g-s)/f);m<0&&(m=0),this.startIndex=Math.min(e-1,Math.max(0,v*this._columnCount)),this.endIndex=Math.min(e-1,Math.max(0,m*this._columnCount-1))}return this.startIndex!=n||this.endIndex!=r},t.prototype.updateDisplayList=function(t,e){if(x.prototype.updateDisplayList.call(this,t,e),this.$target){var i=this.$target,n=this._paddingLeft,r=this._paddingRight,o=this._paddingTop,s=this._paddingBottom;if(this.indexInViewCalculated)this.indexInViewCalculated=!1;else{if(this.calculateRowAndColumn(t,e),0==this._rowCount||0==this._columnCount)return void i.setContentSize(n+r,o+s);this.adjustForJustify(t,e),this.getIndexInView()}if(this.$useVirtualLayout&&(this.calculateRowAndColumn(t,e),this.adjustForJustify(t,e)),-1==this.startIndex||-1==this.endIndex)return void i.setContentSize(0,0);var a=this.endIndex;i.setVirtualElementIndicesInView(this.startIndex,a);for(var h,l,u,p,c,d=this._orientation==b.TileOrientation.COLUMNS,f=this.startIndex,y=isNaN(this._horizontalGap)?0:this._horizontalGap,g=isNaN(this._verticalGap)?0:this._verticalGap,v=this._rowCount,m=this._columnCount,$=this._columnWidth,E=this._rowHeight,C=this.startIndex;C<=a;C++)h=this.$useVirtualLayout?this.target.getVirtualElementAt(C):this.target.getElementAt(C),egret.is(h,I)&&h.$includeInLayout&&(d?(p=Math.ceil((f+1)/v)-1,-1==(c=Math.ceil((f+1)%v)-1)&&(c=v-1)):(-1==(p=Math.ceil((f+1)%m)-1)&&(p=m-1),c=Math.ceil((f+1)/m)-1),l=p*($+y)+n,u=c*(E+g)+o,this.sizeAndPositionElement(h,l,u,$,E),f++);var _=n+r,S=o+s,P=($+y)*m-y,T=(E+g)*v-g;i.setContentSize(P+_,T+S)}},t.prototype.sizeAndPositionElement=function(t,e,i,n,r){var o=NaN,s=NaN,a=t.$UIComponent;this._horizontalAlign==b.JustifyAlign.JUSTIFY?o=n:isNaN(a[6])||(o=n*a[6]*.01),this._verticalAlign==b.JustifyAlign.JUSTIFY?s=r:isNaN(a[7])||(s=r*a[7]*.01),t.setLayoutBoundsSize(Math.round(o),Math.round(s));var h=e,l=egret.$TempRectangle;switch(t.getLayoutBounds(l),this._horizontalAlign){case egret.HorizontalAlign.RIGHT:h+=n-l.width;break;case egret.HorizontalAlign.CENTER:h=e+(n-l.width)/2}var u=i;switch(this._verticalAlign){case egret.VerticalAlign.BOTTOM:u+=r-l.height;break;case egret.VerticalAlign.MIDDLE:u+=(r-l.height)/2}t.setLayoutBoundsPosition(Math.round(h),Math.round(u))},t.prototype.adjustForJustify=function(t,e){var i=this._paddingLeft,n=this._paddingRight,r=this._paddingTop,o=this._paddingBottom,s=Math.max(0,t-i-n),a=Math.max(0,e-r-o);isNaN(this.explicitVerticalGap)||(this._verticalGap=this.explicitVerticalGap),isNaN(this.explicitHorizontalGap)||(this._horizontalGap=this.explicitHorizontalGap),this._verticalGap=isNaN(this._verticalGap)?0:this._verticalGap,this._horizontalGap=isNaN(this._horizontalGap)?0:this._horizontalGap;var h,l=a-this._rowHeight*this._rowCount,u=s-this._columnWidth*this._columnCount;0<l&&(this._rowAlign==b.RowAlign.JUSTIFY_USING_GAP?(h=Math.max(1,this._rowCount-1),this._verticalGap=l/h):this._rowAlign==b.RowAlign.JUSTIFY_USING_HEIGHT&&0<this._rowCount&&(this._rowHeight+=(l-(this._rowCount-1)*this._verticalGap)/this._rowCount)),0<u&&(this._columnAlign==b.ColumnAlign.JUSTIFY_USING_GAP?(h=Math.max(1,this._columnCount-1),this._horizontalGap=u/h):this._columnAlign==b.ColumnAlign.JUSTIFY_USING_WIDTH&&0<this._columnCount&&(this._columnWidth+=(u-(this._columnCount-1)*this._horizontalGap)/this._columnCount))},t}(b.LayoutBase);b.TileLayout=t,__reflect(t.prototype,"eui.TileLayout")}(eui||(eui={})),function(t){var e=function(){};e.ROWS="rows",e.COLUMNS="columns",t.TileOrientation=e,__reflect(e.prototype,"eui.TileOrientation")}(eui||(eui={})),function(X){var W="eui.UIComponent",t=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.measureReal=function(){for(var t=this.$target,e=t.numElements,i=e,n=0,r=0,o=egret.$TempRectangle,s=0;s<e;s++){var a=t.getElementAt(s);egret.is(a,W)&&a.$includeInLayout?(a.getPreferredBounds(o),r+=o.height,n=Math.max(n,o.width)):i--}r+=(i-1)*this.$gap;var h=this.$paddingLeft+this.$paddingRight,l=this.$paddingTop+this.$paddingBottom;t.setMeasuredSize(n+h,r+l)},t.prototype.measureVirtual=function(){for(var t=this.$target,e=this.$typicalHeight,i=this.getElementTotalSize(),n=Math.max(this.maxElementSize,this.$typicalWidth),r=egret.$TempRectangle,o=this.endIndex,s=this.elementSizeTable,a=this.startIndex;a<o;a++){var h=t.getElementAt(a);egret.is(h,W)&&h.$includeInLayout&&(h.getPreferredBounds(r),i+=r.height,i-=isNaN(s[a])?e:s[a],n=Math.max(n,r.width))}var l=this.$paddingLeft+this.$paddingRight,u=this.$paddingTop+this.$paddingBottom;t.setMeasuredSize(n+l,i+u)},t.prototype.updateDisplayListReal=function(t,e){var i=this.$target,n=this.$paddingLeft,r=this.$paddingRight,o=this.$paddingTop,s=this.$paddingBottom,a=this.$gap,h=Math.max(0,t-n-r),l=Math.max(0,e-o-s),u=this.$verticalAlign==X.JustifyAlign.JUSTIFY,p=this.$horizontalAlign==X.JustifyAlign.JUSTIFY||this.$horizontalAlign==X.JustifyAlign.CONTENT_JUSTIFY,c=0;p||(this.$horizontalAlign==egret.HorizontalAlign.CENTER?c=.5:this.$horizontalAlign==egret.HorizontalAlign.RIGHT&&(c=1));var d,f,y,g=i.numElements,v=g,m=n,$=o,E=0,C=0,_=[],S=l,P=this.maxElementSize,T=egret.$TempRectangle;for(d=0;d<g;d++){var x=i.getElementAt(d);if(egret.is(x,W)&&x.$includeInLayout)if(x.getPreferredBounds(T),P=Math.max(P,T.width),u)E+=T.height;else{var b=x.$UIComponent;isNaN(b[7])?S-=T.height:(C+=b[7],(y=new X.sys.ChildInfo).layoutElement=x,y.percent=b[7],y.min=b[14],y.max=b[15],_.push(y))}else v--}S=0<(S-=a*(v-1))?S:0;var I,L=l-E-a*(v-1),N=v,O={};if(u){if(L<0){for(I=S/v,d=0;d<g;d++)f=i.getElementAt(d),egret.is(f,W)&&f.$includeInLayout&&(f.getPreferredBounds(T),T.height<=I&&(S-=T.height,N--));S=0<S?S:0}}else if(0<C){this.flexChildrenProportionally(l,S,C,_);var A=0,M=_.length;for(d=0;d<M;d++){y=_[d];var B=Math.round(y.size+A);A+=y.size-B,S-=O[y.layoutElement.$hashCode]=B}S=0<S?S:0}this.$verticalAlign==egret.VerticalAlign.MIDDLE?$=o+.5*S:this.$verticalAlign==egret.VerticalAlign.BOTTOM&&($=o+S);var D=n,R=o,w=0,V=0,z=Math.ceil(h);this.$horizontalAlign==X.JustifyAlign.CONTENT_JUSTIFY&&(z=Math.ceil(Math.max(h,P)));var H,U,k=0;for(d=0;d<g;d++){var F=0;if(f=i.getElementAt(d),egret.is(f,W)&&f.$includeInLayout){if(f.getPreferredBounds(T),H=NaN,u?(U=NaN,0<L?U=S*T.height/E:L<0&&T.height>I&&(U=S/N),isNaN(U)||(k+=U-(H=Math.round(U+k)))):H=O[f.$hashCode],p)m=n,f.setLayoutBoundsSize(z,H),f.getLayoutBounds(T);else{var G=NaN;b=f.$UIComponent;if(!isNaN(b[6])){var j=Math.min(100,b[6]);G=Math.round(h*j*.01)}f.setLayoutBoundsSize(G,H),f.getLayoutBounds(T),m=n+(F=0<(F=(h-T.width)*c)?F:0)}f.setLayoutBoundsPosition(Math.round(m),Math.round($)),w=Math.ceil(T.width),V=Math.ceil(T.height),D=Math.max(D,m+w),R=Math.max(R,$+V),$+=V+a}}this.maxElementSize=P,i.setContentSize(D+r,R+s)},t.prototype.updateDisplayListVirtual=function(t,e){var i=this.$target;this.indexInViewCalculated?this.indexInViewCalculated=!1:this.getIndexInView();var n,r=this.$paddingBottom,o=this.$paddingLeft,s=this.$paddingRight,a=this.$gap,h=i.numElements;if(-1==this.startIndex||-1==this.endIndex)return n=this.getStartPosition(h)-a+r,void i.setContentSize(i.contentWidth,n);var l=this.endIndex;i.setVirtualElementIndicesInView(this.startIndex,l);var u=this.$horizontalAlign==X.JustifyAlign.JUSTIFY||this.$horizontalAlign==X.JustifyAlign.CONTENT_JUSTIFY,p=this.$horizontalAlign==X.JustifyAlign.CONTENT_JUSTIFY,c=0;u||(this.$horizontalAlign==egret.HorizontalAlign.CENTER?c=.5:this.$horizontalAlign==egret.HorizontalAlign.RIGHT&&(c=1));var d,f=egret.$TempRectangle,y=Math.max(0,t-o-s),g=Math.ceil(y),v=this.$typicalHeight,m=this.$typicalWidth,$=this.maxElementSize,E=Math.max(m,this.maxElementSize);if(p){for(var C=this.startIndex;C<=l;C++)d=i.getVirtualElementAt(C),egret.is(d,W)&&d.$includeInLayout&&(d.getPreferredBounds(f),$=Math.max($,f.width));g=Math.ceil(Math.max(y,$))}for(var _=0,S=0,P=0,T=!1,x=this.elementSizeTable,b=this.startIndex;b<=l;b++){var I=0;d=i.getVirtualElementAt(b),egret.is(d,W)&&d.$includeInLayout&&(d.getPreferredBounds(f),p||($=Math.max($,f.width)),u?(_=o,d.setLayoutBoundsSize(g,NaN),d.getLayoutBounds(f)):(d.getLayoutBounds(f),_=o+(I=0<(I=(y-f.width)*c)?I:0)),P=Math.max(P,f.width),T||(isNaN(x[b])?v:x[b])!=f.height&&(T=!0),x[b]=f.height,S=this.getStartPosition(b),d.setLayoutBoundsPosition(Math.round(_),Math.round(S)))}P+=o+s,n=this.getStartPosition(h)-a+r,this.maxElementSize=$,i.setContentSize(P,n),(T||E<this.maxElementSize)&&i.invalidateSize()},t.prototype.getStartPosition=function(t){if(!this.$useVirtualLayout&&this.$target){var e=this.$target.getElementAt(t);if(e)return e.y}for(var i=this.$typicalHeight,n=this.$paddingTop,r=this.$gap,o=this.elementSizeTable,s=0;s<t;s++){var a=o[s];isNaN(a)&&(a=i),n+=a+r}return n},t.prototype.getElementSize=function(t){if(this.$useVirtualLayout){var e=this.elementSizeTable[t];return isNaN(e)&&(e=this.$typicalHeight),e}return this.$target?this.$target.getElementAt(t).height:0},t.prototype.getElementTotalSize=function(){for(var t=this.$typicalHeight,e=this.$gap,i=0,n=this.$target.numElements,r=this.elementSizeTable,o=0;o<n;o++){var s=r[o];isNaN(s)&&(s=t),i+=s+e}return i-e},t.prototype.elementAdded=function(t){this.$useVirtualLayout&&(e.prototype.elementAdded.call(this,t),this.elementSizeTable.splice(t,0,this.$typicalHeight))},t.prototype.getIndexInView=function(){var t=this.$target;if(!t||0==t.numElements)return this.startIndex=this.endIndex=-1,!1;var e=t.$UIComponent;if(0==e[10]||0==e[11])return this.startIndex=this.endIndex=-1,!1;var i=t.numElements,n=this.getStartPosition(i-1)+this.elementSizeTable[i-1]+this.$paddingBottom,r=t.scrollV;if(r>n-this.$paddingBottom)return this.startIndex=-1,!(this.endIndex=-1);var o=t.scrollV+e[11];if(o<this.$paddingTop)return this.startIndex=-1,!(this.endIndex=-1);var s=this.startIndex,a=this.endIndex;return this.startIndex=this.findIndexAt(r,0,i-1),-1==this.startIndex&&(this.startIndex=0),this.endIndex=this.findIndexAt(o,0,i-1),-1==this.endIndex&&(this.endIndex=i-1),s!=this.startIndex||a!=this.endIndex},t}(X.LinearLayoutBase);X.VerticalLayout=t,__reflect(t.prototype,"eui.VerticalLayout")}(eui||(eui={})),function(t){var e=function(c){function t(){return c.apply(this,arguments)||this}return __extends(t,c),t.prototype.updateDisplayList=function(t,e){c.prototype.updateDisplayList.call(this,t,e);var i=this.thumb,n=this.$viewport;if(i&&n){var r=egret.$TempRectangle;i.getPreferredBounds(r);var o=r.width,s=r.y,a=n.scrollH,h=n.contentWidth,l=n.width;if(a<=0){var u=o*(1- -a/(.5*l));u=Math.max(5,Math.round(u)),i.setLayoutBoundsSize(u,NaN),i.setLayoutBoundsPosition(0,s)}else if(h-l<=a){u=o*(1-(a-h+l)/(.5*l));u=Math.max(5,Math.round(u)),i.setLayoutBoundsSize(u,NaN),i.setLayoutBoundsPosition(t-u,s)}else{var p=(t-o)*a/(h-l);i.setLayoutBoundsSize(NaN,NaN),i.setLayoutBoundsPosition(p,s)}}},t.prototype.onPropertyChanged=function(t){switch(t.property){case"scrollH":case"contentWidth":this.invalidateDisplayList()}},t}(t.ScrollBarBase);t.HScrollBar=e,__reflect(e.prototype,"eui.HScrollBar")}(eui||(eui={})),function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.pointToValue=function(t,e){if(!this.thumb||!this.track)return 0;var i=this.$Range,n=i[0]-i[2],r=this.getThumbRange();return i[2]+(0!=r?t/r*n:0)},e.prototype.getThumbRange=function(){var t=egret.$TempRectangle;this.track.getLayoutBounds(t);var e=t.width;return this.thumb.getLayoutBounds(t),e-t.width},e.prototype.updateSkinDisplayList=function(){if(this.thumb&&this.track){var t=this.$Range,e=this.getThumbRange(),i=t[0]-t[2],n=0<i?(this.pendingValue-t[2])/i*e:0,r=this.track.localToGlobal(n,0,egret.$TempPoint),o=r.x,s=r.y,a=this.thumb.$parent.globalToLocal(o,s,egret.$TempPoint).x,h=egret.$TempRectangle;if(this.thumb.getLayoutBounds(h),this.thumb.setLayoutBoundsPosition(Math.round(a),h.y),this.trackHighlight&&this.trackHighlight.$parent){var l=this.trackHighlight.$parent.globalToLocal(o,s,egret.$TempPoint).x-n;this.trackHighlight.x=Math.round(l),this.trackHighlight.width=Math.round(n)}}},e}(t.SliderBase);t.HSlider=e,__reflect(e.prototype,"eui.HSlider")}(eui||(eui={})),function(t){var e=function(){function t(t,e,i,n){this.target=t,this.propertyName=e,this.position=i,this.relativeTo=n}return t.prototype.apply=function(t,e){var i,n=t[this.relativeTo],r=t[this.target],o=this.propertyName?t[this.propertyName]:e;if(r&&o){switch(this.position){case 0:i=0;break;case 1:i=-1;break;case 2:i=o.getChildIndex(n);break;case 3:i=o.getChildIndex(n)+1}-1==i&&(i=o.numChildren),egret.is(o,"eui.Component")&&o.$Component[8].$elementsContent.push(r),o.addChildAt(r,i)}},t.prototype.remove=function(t,e){var i=this.propertyName?t[this.propertyName]:e,n=t[this.target];if(n&&i&&(n.$parent===i&&i.removeChild(n),egret.is(i,"eui.Component"))){var r=i.$Component[8].$elementsContent,o=r.indexOf(n);-1<o&&r.splice(o,1)}},t}();t.AddItems=e,__reflect(e.prototype,"eui.AddItems",["eui.IOverride"])}(eui||(eui={})),function(t){var e=function(){function t(t,e,i){this.target=t,this.name=e,this.value=i}return t.prototype.apply=function(t,e){var i=this.target?t[this.target]:t;i&&(this.oldValue=i[this.name],this.setPropertyValue(i,this.name,this.value,this.oldValue))},t.prototype.remove=function(t,e){var i=this.target?t[this.target]:t;i&&(this.setPropertyValue(i,this.name,this.oldValue,this.oldValue),this.oldValue=null)},t.prototype.setPropertyValue=function(t,e,i,n){t[e]=null==i?i:"number"==typeof n?+i:"boolean"==typeof n?this.toBoolean(i):i},t.prototype.toBoolean=function(t){return"string"==typeof t?"true"==t.toLowerCase():0!=t},t}();t.SetProperty=e,__reflect(e.prototype,"eui.SetProperty",["eui.IOverride"])}(eui||(eui={})),function(n){var t=function(){function t(t,e,i,n,r){this.host=t,this.templates=e,this.chainIndex=i,this.target=n,this.prop=r}return t.prototype.apply=function(t,e){if(this.target){var i=this.target[this.prop];this.oldValue&&this.setPropertyValue(this.target,this.prop,this.oldValue,this.oldValue),i&&(this.oldValue=i),n.Binding.$bindProperties(this.host,this.templates.concat(),this.chainIndex.concat(),this.target,this.prop)}},t.prototype.remove=function(t,e){if(this.target){var i=this.oldValue;this.target[this.prop]&&(this.oldValue=this.target[this.prop]),i&&this.setPropertyValue(this.target,this.prop,i,i)}},t.prototype.setPropertyValue=function(t,e,i,n){t[e]=null==i?i:"number"==typeof n?+i:"boolean"==typeof n?this.toBoolean(i):i},t.prototype.toBoolean=function(t){return"string"==typeof t?"true"==t.toLowerCase():0!=t},t}();n.SetStateProperty=t,__reflect(t.prototype,"eui.SetStateProperty",["eui.IOverride"])}(eui||(eui={})),function(t){!function(t){function m(t,e,i,n,r,o,s,a,h,l){var u;if(!isNaN(i)&&isNaN(n)){if(u=c(t,e,i,o,i,a,i,l))return u}else if(isNaN(i)&&!isNaN(n)&&(u=c(t,e,r,n,s,n,h,n)))return u;return c(t,e,r,o,s,a,h,l)}function $(t,e,i,n,r,o,s,a,h,l){var u;if(!isNaN(i)&&isNaN(n)){if(u=p(t,e,i,o,i,a,i,l))return u}else if(isNaN(i)&&!isNaN(n)&&(u=p(t,e,r,n,s,n,h,n)))return u;return p(t,e,r,o,s,a,h,l)}function p(t,e,i,n,r,o,s,a){var h=e.b,l=e.d;if(-1e-9<h&&h<1e-9&&(h=0),-1e-9<l&&l<1e-9&&(l=0),0==h&&0==l)return null;if(0==h&&0==l)return null;if(0==h)return egret.Point.create(i,t/Math.abs(l));if(0==l)return egret.Point.create(t/Math.abs(h),n);var u,p,c,d=0<=h*l?l:-l;if(0!=d&&0<i){var f=1/d;o<=(c=(t-h*(p=i=Math.max(r,Math.min(s,i))))*f)&&c<=a&&0<=h*p+d*c&&(u=egret.Point.create(p,c)),o<=(c=(-t-h*p)*f)&&c<=a&&h*p+d*c<0&&(!u||C(u.x,u.y,e).width>C(p,c,e).width)&&(egret.Point.release(u),u=egret.Point.create(p,c))}if(0!=h&&0<n){var y=1/h;r<=(p=(t-d*(c=n=Math.max(o,Math.min(a,n))))*y)&&p<=s&&0<=h*p+d*c&&(!u||C(u.x,u.y,e).width>C(p,c,e).width)&&(u=egret.Point.create(p,c)),r<=(p=(-t-d*c)*y)&&p<=s&&h*p+d*c<0&&(!u||C(u.x,u.y,e).width>C(p,c,e).width)&&(egret.Point.release(u),u=egret.Point.create(p,c))}if(u)return u;var g=e.a,v=e.c;return E(h,d,t,r,o,s,a,g,0<=g*v?v:-v)}function c(t,e,i,n,r,o,s,a){var h=e.a,l=e.c;if(-1e-9<h&&h<1e-9&&(h=0),-1e-9<l&&l<1e-9&&(l=0),0==h&&0==l)return null;if(0==h)return egret.Point.create(i,t/Math.abs(l));if(0==l)return egret.Point.create(t/Math.abs(h),n);var u,p,c,d=0<=h*l?l:-l;if(0!=d&&0<i){var f=1/d;o<=(c=(t-h*(p=i=Math.max(r,Math.min(s,i))))*f)&&c<=a&&0<=h*p+d*c&&(u=egret.Point.create(p,c)),o<=(c=(-t-h*p)*f)&&c<=a&&h*p+d*c<0&&(!u||C(u.x,u.y,e).height>C(p,c,e).height)&&(egret.Point.release(u),u=egret.Point.create(p,c))}if(0!=h&&0<n){var y=1/h;r<=(p=(t-d*(c=n=Math.max(o,Math.min(a,n))))*y)&&p<=s&&0<=h*p+d*c&&(!u||C(u.x,u.y,e).height>C(p,c,e).height)&&(egret.Point.release(u),u=egret.Point.create(p,c)),r<=(p=(-t-d*c)*y)&&p<=s&&h*p+d*c<0&&(!u||C(u.x,u.y,e).height>C(p,c,e).height)&&(egret.Point.release(u),u=egret.Point.create(p,c))}if(u)return u;var g=e.b,v=e.d;return E(h,d,t,r,o,s,a,g,0<=g*v?v:-v)}function E(t,e,i,n,r,o,s,a,h){if(0==t||0==e)return null;var l,u,p=(i-n*t)/e,c=(i-o*t)/e,d=Math.max(r,Math.min(p,c)),f=Math.min(s,Math.max(p,c)),y=a*e-t*h;return d<=f?(u=Math.abs(y)<1e-9?i/(t+e):a*i/y,l=(i-e*(u=Math.max(d,Math.min(u,f))))/t,egret.Point.create(l,u)):(p=-(n*t+i)/e,c=-(o*t+i)/e,(d=Math.max(r,Math.min(p,c)))<=(f=Math.min(s,Math.max(p,c)))?(u=Math.abs(y)<1e-9?-i/(t+e):-a*i/y,l=(-i-e*(u=Math.max(d,Math.min(u,f))))/t,egret.Point.create(l,u)):null)}function C(t,e,i){var n=egret.$TempRectangle.setTo(0,0,t,e);return i.$transformBounds(n),n}function _(t,e,i,n,r,o){return egret.Point.create(n*r-e*o,t*o-i*r)}var e=function(){function t(){}return t.fitBounds=function(t,e,i,n,r,o,s,a,h,l,u){if(isNaN(t)&&isNaN(e))return egret.Point.create(o,s);var p,c=a<.1?0:a-.1,d=h<.1?0:h-.1,f=l+.1,y=u+.1;if(isNaN(t)||isNaN(e))return isNaN(t)?$(e,i,n,r,o,s,c,d,f,y):m(t,i,n,r,o,s,c,d,f,y);if(!(p=function(t,e,i,n,r,o,s){var a=i.a,h=i.b,l=i.c,u=i.d;if(-1e-9<a&&a<1e-9&&(a=0),-1e-9<h&&h<1e-9&&(h=0),-1e-9<l&&l<1e-9&&(l=0),-1e-9<u&&u<1e-9&&(u=0),0==h&&0==l)return 0==a||0==u?null:egret.Point.create(t/Math.abs(a),e/Math.abs(u));if(0==a&&0==u)return 0==h||0==l?null:egret.Point.create(e/Math.abs(h),t/Math.abs(l));var p=0<=a*l?l:-l,c=0<=h*u?u:-u,d=a*c-h*p;if(Math.abs(d)<1e-9)return 0==p||0==a||a==-p?null:1e-9<Math.abs(a*e-h*t)?null:E(a,p,t,n,n,o,s,h,c);var f,y=1/d;return(f=_(a,p,h,c,t*=y,e*=y))&&n<=f.x&&f.x<=o&&r<=f.y&&f.y<=s&&0<=a*f.x+p*f.x&&0<=h*f.x+c*f.y?f:(f=_(a,p,h,c,t,-e))&&n<=f.x&&f.x<=o&&r<=f.y&&f.y<=s&&0<=a*f.x+p*f.x&&h*f.x+c*f.y<0?f:(f=_(a,p,h,c,-t,e))&&n<=f.x&&f.x<=o&&r<=f.y&&f.y<=s&&a*f.x+p*f.x<0&&0<=h*f.x+c*f.y?f:(f=_(a,p,h,c,-t,-e))&&n<=f.x&&f.x<=o&&r<=f.y&&f.y<=s&&a*f.x+p*f.x<0&&h*f.x+c*f.y<0?f:(egret.Point.release(f),null)}(t,e,i,c,d,f,y))){var g=void 0;if(g=m(t,i,n,r,o,s,c,d,f,y))e<C(g.x,g.y,i).height-.1&&(egret.Point.release(g),g=null);var v=void 0;if(v=$(e,i,n,r,o,s,c,d,f,y))t<C(v.x,v.y,i).width-.1&&(egret.Point.release(v),v=null);p=g&&v?g.x*g.y>v.x*v.y?g:v:g||v,egret.Point.release(g),egret.Point.release(v)}return p},t}();t.MatrixUtil=e,__reflect(e.prototype,"eui.sys.MatrixUtil")}(t.sys||(t.sys={}))}(eui||(eui={}));